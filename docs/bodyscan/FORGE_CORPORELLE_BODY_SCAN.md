# Detailed Documentation: Body Forge - Body Scan Pipeline

**Version:** 1.0 ‚Ä¢ **Status:** Functional and production-ready ‚Ä¢ **Last update:** January 2025

The Body Scan Pipeline is TwinForge's body scanning system, allowing users to capture their body measurements through photos and generate a photorealistic 3D avatar with detailed morphological analysis.

---

## üìã Table of Contents

- [Overview](#overview)
- [Technical Architecture](#technical-architecture)
- [Detailed User Pipeline](#detailed-user-pipeline)
- [Body Forge Tabs](#body-forge-tabs)
- [User Profile Integration](#user-profile-integration)
- [Data Generated by Spatial Forge](#data-generated-by-spatial-forge)
- [TypeScript Contracts](#typescript-contracts)
- [Detailed Edge Functions](#detailed-edge-functions)
- [Optimizations and Performance](#optimizations-and-performance)
- [Costs and Governance](#costs-and-governance)
- [Observability and Debugging](#observability-and-debugging)
- [Future Integration with Central Brain](#future-integration-with-central-brain)

---

## üéØ Overview

### Objective
Allow users to scan their body through photos, obtain detailed morphological analysis, and generate a photorealistic 3D avatar with personalized insights for body composition optimization.

### Added Value
- **Intuitive capture:** Simple photo taking (front and profile) to analyze body morphology
- **Advanced AI analysis:** Body measurements estimation, morphological classification, and 3D avatar generation
- **Personalized insights:** Recommendations adapted to the user's morphology and fitness goals
- **3D visualization:** Interactive avatar with real-time morphological adjustments
- **Progress tracking:** Historical comparison and body evolution visualization

### Role in TwinForge Ecosystem
The Body Forge generates comprehensive morphological data that feeds the future "Central Brain" for holistic advice combining body composition, nutrition, activity, and wellness optimization.

---

## üèóÔ∏è Technical Architecture

### Technical Stack
- **Frontend:** React 18 + TypeScript + Three.js + React Three Fiber
- **3D Rendering:** WebGL with optimized shaders and materials
- **State Management:** Zustand + React Query (with cache persistence)
- **Backend:** Supabase Edge Functions (Deno)
- **Spatial Forge:** OpenAI GPT-5 Vision + specialized morphological models
- **Database:** PostgreSQL with RLS and vector storage

### Data Flow
```
User (2 Photos: Front + Profile)
    ‚Üì
Frontend (Capture + Pre-processing)
    ‚Üì
Edge Function: scan-estimate (GPT-5 Vision)
    ‚Üì
Edge Function: scan-semantic (Morphological Classification)
    ‚Üì
Edge Function: scan-match (Archetype Matching)
    ‚Üì
Edge Function: scan-refine-morphs (AI Refinement)
    ‚Üì
Edge Function: scan-commit (Avatar Generation + Persistence)
    ‚Üì
Database (body_scans, user_avatars tables)
    ‚Üì
Frontend (3D Avatar + Insights Visualization)
```

---

## üîÑ Detailed User Pipeline

### 1. Body Scan Capture (`BodyScanPhotoCaptureStep`)

**Objective:** Collect the user's body photos (front and profile views).

**Input modes:**
- **Camera:** Direct capture via mobile/desktop camera with guided positioning
- **Gallery:** Selection of existing images from gallery

**Frontend Components:**
- `src/app/pages/BodyScan/BodyScanCapture/BodyScanCapture.tsx` (Main capture orchestrator)
- `src/app/pages/BodyScan/BodyScanCapture/BodyScanPhotoCaptureStep.tsx` (Photo capture step)
- `src/app/pages/BodyScan/components/CameraInterface/CameraInterface.tsx` (Camera interface)
- `src/app/pages/BodyScan/components/CameraInterface/CameraOverlayGuides.tsx` (Visual positioning guides)
- `src/app/pages/BodyScan/PhotoGuideOverlay.tsx` (Photo guide overlay)

**Data Collected:**
- **Front Photo:** Full body front view (JPEG/PNG) converted to Base64 for AI
- **Profile Photo:** Full body side view (JPEG/PNG) converted to Base64 for AI
- **Metadata:** `userId`, `clientScanId`, timestamp, photo quality metrics

**Validations:**
- File format (image), maximum size (10MB per photo)
- Body visibility validation (handled by AI in scan-estimate)
- Photo quality assessment (lighting, clarity, positioning)

### 2. Body Scan Processing (`BodyScanProcessingStep`)

**Objective:** Process the body photos through the complete AI pipeline to generate morphological data.

**Frontend Components:**
- `src/app/pages/BodyScan/BodyScanCapture/components/ImmersivePhotoAnalysis.tsx` (Immersive processing visualization)
- `src/app/pages/BodyScan/BodyScanCapture/components/PhotoCaptureStatus.tsx` (Processing status display)
- `src/app/pages/BodyScan/BodyScanCapture/services/scanProcessingService.ts` (Processing service)

**Backend Process:**

#### Phase 1: Initial Estimation (`scan-estimate`)
- **Edge Function:** `scan-estimate`
- **Model:** OpenAI GPT-5 Vision
- **Duration:** ~8-25 seconds
- **Output:** Initial body measurements, confidence scores, quality assessment

#### Phase 2: Semantic Analysis (`scan-semantic`)
- **Edge Function:** `scan-semantic`
- **Model:** GPT-5 Mini + specialized morphological models
- **Duration:** ~5-15 seconds
- **Output:** Body type classification, morphological features identification

#### Phase 3: Archetype Matching (`scan-match`)
- **Edge Function:** `scan-match`
- **Model:** Custom matching algorithms + GPT-5 Mini
- **Duration:** ~3-10 seconds
- **Output:** Closest morphological archetypes, parameter mapping

#### Phase 4: Morphological Refinement (`scan-refine-morphs`)
- **Edge Function:** `scan-refine-morphs`
- **Model:** GPT-5 Mini with specialized prompts
- **Duration:** ~10-30 seconds
- **Output:** Refined morphological parameters, enhanced accuracy

#### Phase 5: Avatar Commitment (`scan-commit`)
- **Edge Function:** `scan-commit`
- **Model:** 3D processing algorithms + profile integration
- **Duration:** ~5-15 seconds
- **Output:** Final 3D avatar data, database persistence

### 3. Results Review (`BodyScanReview`)

**Objective:** Display scan results, allow morphological adjustments, and save the avatar.

**Frontend Components:**
- `src/app/pages/BodyScan/BodyScanReview.tsx` (Main review page)
- `src/app/pages/BodyScan/BodyScanReview/components/MeasurementsCard.tsx` (Body measurements display)
- `src/app/pages/BodyScan/BodyScanReview/components/MorphAdjustmentControls.tsx` (Morphological adjustment interface)
- `src/app/pages/BodyScan/BodyScanReview/components/ActionButtons.tsx` (Save, retake, new scan buttons)
- `src/components/3d/Avatar3DViewer.tsx` (Interactive 3D avatar viewer)

**Features:**
- **3D Avatar Viewer:** Interactive visualization with rotation, zoom, and morphological adjustments
- **Measurements Display:** Height, weight, body fat percentage, muscle mass estimates
- **Morphological Insights:** AI-generated insights about body composition and recommendations
- **Real-time Adjustments:** Fine-tune morphological parameters with live 3D preview
- **Save Options:** Save avatar to profile, retake photos, start new scan

### 4. Celebration (`BodyScanCelebrationStep`)

**Objective:** Celebrate successful scan completion and encourage regular scanning.

**Frontend Components:**
- `src/app/pages/BodyScan/BodyScanCelebrationStep.tsx` (Celebration step)

**Features:**
- **Success Animation:** Celebratory animations and visual feedback
- **Scan Summary:** Key metrics and achievements from the scan
- **Next Steps:** Recommendations for avatar usage and next scan timing
- **Navigation Options:** Direct access to avatar viewer, insights, or new scan

---

## üìä Body Forge Tabs

### üéØ Scan CTA (`ScanCTA`)

**File:** `src/app/pages/Avatar/tabs/ScanCTA.tsx`

**Objective:** Encourage regular body scanning with dynamic call-to-action based on scan history.

**Key Components:**
- `ScanStatusCard`: Current scan status and recommendations
- `ProgressTrackingCard`: Days since last scan with visual progress bar
- `BenefitsCard`: Benefits of regular body scanning
- `DynamicScanCTA`: Adaptive call-to-action based on scan frequency

**Data Logic:**
- **Source:** `body_scans` table filtered by `user_id` and scan dates
- **Scan Frequency Analysis:** Calculate days since last scan, recommend optimal frequency
- **Dynamic Messaging:** Adapt CTA based on scan history and user engagement
- **Progress Visualization:** Visual representation of scan consistency

### üëÅÔ∏è Avatar (`AvatarTab`)

**File:** `src/app/pages/Avatar/tabs/AvatarTab.tsx`

**Objective:** Display and interact with the user's 3D avatar with morphological insights.

**Key Components:**
- `Avatar3DViewer`: Interactive 3D avatar with real-time rendering
- `MorphologyInsightsCard`: AI-generated insights about body composition
- `AvatarControls`: Camera controls, rotation, zoom, and view options
- `MorphAdjustmentPanel`: Fine-tune morphological parameters

**Data Logic:**
- **Source:** `user_avatars` table with latest avatar data
- **3D Rendering:** Three.js with optimized materials and lighting
- **Real-time Updates:** Live morphological parameter adjustments
- **Insights Generation:** AI-powered analysis of morphological data

### üí° Insights (`InsightsTab`)

**File:** `src/app/pages/Avatar/tabs/InsightsTab.tsx`

**Objective:** Present AI-generated morphological insights and personalized recommendations.

**Key Components:**
- `SummaryDashboard`: Overall morphological score and key metrics
- `InsightCards`: Individual insight cards with actionable recommendations
- `MorphologyAnalysis`: Detailed body composition analysis
- `ProgressComparison`: Historical comparison with previous scans

**Data Logic:**
- **Source:** `ai_morphology_insights` table with generated insights
- **AI Analysis:** GPT-5 powered morphological analysis and recommendations
- **Personalization:** Insights adapted to user profile and goals
- **Trend Analysis:** Evolution tracking and progress visualization

### üìö History (`HistoryTab`)

**File:** `src/app/pages/Avatar/tabs/HistoryTab.tsx`

**Objective:** Browse complete scan history with temporal comparisons and evolution tracking.

**Key Components:**
- `HistoricalScanModal`: Detailed view of historical scans with 3D avatar
- `ScanTimelineCard`: Chronological scan history with key metrics
- `EvolutionChart`: Visual representation of body composition changes
- `ComparisonTools`: Side-by-side scan comparisons

**Data Logic:**
- **Source:** `body_scans` table with historical data and `body_scan_history` for temporal analysis
- **Temporal Analysis:** Calculate changes between scans, identify trends
- **3D Comparison:** Historical avatar reconstruction for visual comparison
- **Metrics Evolution:** Track key measurements over time

---

## üë§ User Profile Integration

### Profile Fields Used

**Critical Fields (Required for functionality):**
- `weight_kg`: Validation and calibration of AI estimates
- `height_cm`: Scale reference for morphological calculations
- `sex`: Gender-specific morphological analysis and archetype matching

**Optimizing Fields (Improve precision and personalization):**
- `birthdate`: Age-related morphological considerations
- `objective`: Body composition goals (`fat_loss`, `muscle_gain`, `recomp`)
- `activity_level`: Influence on muscle mass estimates and recommendations
- `body_fat_perc`: Validation of AI body fat estimates
- `target_weight_kg`: Goal-oriented recommendations and progress tracking

### Profile Impact

**Automatic updates:**
- `body_fat_perc` updated based on scan analysis
- `avatar_status` and `avatar_url` updated with new avatar data
- `last_avatar_regeneration_at` timestamp for tracking

**Bidirectional synchronization:**
- Profile changes ‚Üí Recalculation of morphological parameters and insights
- Scan data ‚Üí Profile improvement suggestions and goal adjustments

---

## ü§ñ Data Generated by Spatial Forge

### Structured Raw Data

**From `scan-estimate`:**
```typescript
export interface ScanEstimateResponse {
  success: boolean;
  scan_id: string;
  extracted_data: {
    raw_measurements: {
      height_cm: number;
      weight_kg: number;
      chest_cm?: number;
      waist_cm?: number;
      hips_cm?: number;
    };
    body_fat_percentage: number;
    muscle_mass_percentage: number;
    processing_confidence: number;
    quality_assessment: {
      front_photo_quality: number;
      profile_photo_quality: number;
      visibility_score: number;
      lighting_score: number;
    };
  };
  estimated_bmi: number;
  body_type_preliminary: string;
  processing_metadata: {
    processing_time_ms: number;
    model_version: string;
    ai_model_used: string;
    tokens_used?: { input: number; output: number; };
  };
}
```

**From `scan-semantic`:**
```typescript
export interface ScanSemanticResponse {
  success: boolean;
  semantic_analysis: {
    body_shape: 'pear' | 'apple' | 'hourglass' | 'rectangle' | 'inverted_triangle';
    morphological_features: {
      shoulder_width: 'narrow' | 'average' | 'broad';
      waist_definition: 'low' | 'moderate' | 'high';
      hip_prominence: 'low' | 'moderate' | 'high';
      leg_length_ratio: 'short' | 'average' | 'long';
    };
    muscle_definition: 'low' | 'moderate' | 'high' | 'very_high';
    posture_analysis: {
      alignment_score: number;
      posture_type: string;
      corrections_needed: string[];
    };
  };
  confidence_scores: Record<string, number>;
  processing_metadata: {
    processing_time_ms: number;
    model_version: string;
  };
}
```

**From `scan-match`:**
```typescript
export interface ScanMatchResponse {
  success: boolean;
  matched_archetypes: Array<{
    archetype_id: string;
    similarity_score: number;
    morph_values: Record<string, number>;
    limb_masses: Record<string, number>;
  }>;
  final_morph_data: Record<string, number>;
  final_limb_masses: Record<string, number>;
  semantic_coherence_score: number;
  processing_metadata: {
    processing_time_ms: number;
    archetypes_evaluated: number;
    matching_algorithm: string;
  };
}
```

**From `scan-refine-morphs`:**
```typescript
export interface ScanRefineMorphsResponse {
  success: boolean;
  refined_morphs: Record<string, number>;
  refinement_reasoning: string;
  confidence_improvement: number;
  ai_adjustments: Array<{
    parameter: string;
    original_value: number;
    refined_value: number;
    reasoning: string;
  }>;
  processing_metadata: {
    processing_time_ms: number;
    model_version: string;
    tokens_used?: { input: number; output: number; };
  };
}
```

**From `scan-commit`:**
```typescript
export interface ScanCommitResponse {
  success: boolean;
  scan_id: string;
  avatar_data: {
    morph3d: Record<string, number>;
    limb_masses: Record<string, number>;
    skin_tone: {
      base_color: string;
      undertone: string;
      saturation: number;
    };
  };
  insights_generated: boolean;
  profile_updated: boolean;
  processing_metadata: {
    total_processing_time_ms: number;
    pipeline_steps_completed: number;
  };
}
```

### Advanced Analysis Data

**From `generate-morph-insights`:**
```typescript
export interface MorphologyInsights {
  insights: Array<{
    id: string;
    title: string;
    description: string;
    type: 'recommendation' | 'observation' | 'achievement' | 'goal_progress';
    category: 'morphology' | 'fitness' | 'nutrition' | 'health' | 'goals';
    priority: 'high' | 'medium' | 'low';
    confidence: number;
    actionable?: {
      action: string;
      description: string;
    };
  }>;
  summary: {
    morphology_score: number;
    goal_alignment: number;
    health_indicators: number;
    recommendations_count: number;
  };
  metadata: {
    generated_at: string;
    ai_model: string;
    confidence: number;
  };
}
```

---

## üìã TypeScript Contracts

### Main Interfaces

```typescript
// src/system/data/repositories/bodyScanRepo.ts
export interface BodyScanData {
  id: string;
  user_id: string;
  timestamp: string;
  metrics: {
    estimate_result?: ScanEstimateResponse;
    semantic_result?: ScanSemanticResponse;
    match_result?: ScanMatchResponse;
    refine_result?: ScanRefineMorphsResponse;
    commit_result?: ScanCommitResponse;
    final_shape_params?: Record<string, number>;
    final_limb_masses?: Record<string, number>;
    skin_tone?: SkinTone;
    resolved_gender?: 'male' | 'female';
  };
  created_at: string;
  morph3d?: Record<string, number>;
  limb_masses?: Record<string, number>;
  skin_tone?: SkinTone;
}

export interface UserAvatar {
  user_id: string;
  current_scan_id?: string;
  morph3d?: Record<string, number>;
  limb_masses?: Record<string, number>;
  skin_tone?: SkinTone;
  updated_at: string;
}

export interface BodyScanRequest {
  user_id: string;
  front_photo: string; // Base64
  profile_photo: string; // Base64
  client_scan_id: string;
  user_profile: UserProfileContext;
}

export interface UserProfileContext {
  sex: 'male' | 'female';
  height_cm: number;
  weight_kg: number;
  age?: number;
  activity_level?: string;
  objective?: string;
  body_fat_perc?: number;
}
```

---

## ‚öôÔ∏è Detailed Edge Functions

### üìè `scan-estimate`

**Role:** Initial body measurements estimation from photos using AI vision analysis.

**Models:**
- **OpenAI GPT-5 Vision**: Photo analysis and measurement extraction

**Specialties:**
- Body measurements estimation (height, weight, circumferences)
- Body fat percentage calculation
- Photo quality assessment and validation
- Initial body type classification

**Performance:**
- **Duration:** 8-25 seconds
- **Cost:** ~$0.002 - $0.008 per analysis
- **Confidence:** 75-85% average

### üß† `scan-semantic`

**Role:** Semantic body analysis and morphological classification.

**Model:** GPT-5 Mini + specialized morphological algorithms

**Specialties:**
- Body shape classification (pear, apple, hourglass, etc.)
- Morphological feature identification
- Muscle definition assessment
- Posture analysis and recommendations

**Performance:**
- **Duration:** 5-15 seconds
- **Cost:** ~$0.0008 - $0.003 per analysis
- **Confidence:** 80-90% average

### üéØ `scan-match`

**Role:** Archetype matching and morphological parameter calculation.

**Model:** Custom matching algorithms + GPT-5 Mini

**Specialties:**
- Morphological archetype database matching
- 3D parameter calculation and mapping
- Limb mass distribution calculation
- Semantic coherence validation

**Performance:**
- **Duration:** 3-10 seconds
- **Cost:** ~$0.0005 - $0.002 per analysis
- **Confidence:** 85-95% average

### ‚ú® `scan-refine-morphs`

**Role:** AI-powered morphological refinement for enhanced accuracy.

**Model:** GPT-5 Mini with specialized morphological prompts

**Specialties:**
- Parameter refinement based on AI analysis
- Coherence validation and adjustment
- Confidence improvement through iterative refinement
- Detailed reasoning for adjustments

**Performance:**
- **Duration:** 10-30 seconds
- **Cost:** ~$0.001 - $0.005 per analysis
- **Confidence:** 90-95% average

### üíæ `scan-commit`

**Role:** Final avatar generation and data persistence with user profile integration.

**Model:** 3D processing algorithms + profile integration logic

**Specialties:**
- Final avatar data compilation and validation
- Database persistence with RLS compliance
- User profile synchronization and updates
- Avatar generation pipeline completion

**Performance:**
- **Duration:** 5-15 seconds
- **Cost:** ~$0.0002 - $0.001 per commit
- **Confidence:** 95-99% average

---

## üéØ Optimizations and Performance

### Frontend
- **React Query:** Intelligent cache with adaptive `staleTime` and persistence in `localStorage`
- **Three.js Optimization:** Efficient 3D rendering with LOD (Level of Detail) and frustum culling
- **Zustand:** Optimized state management with selective subscriptions
- **Image Processing:** Client-side compression and optimization before AI analysis
- **Progressive Loading:** Staged loading of 3D assets and textures

### Backend
- **Server Cache:** `body_scans` and `user_avatars` tables with intelligent invalidation
- **Pipeline Optimization:** Parallel processing where possible, sequential where dependencies exist
- **Rate Limiting:** Protection against excessive AI API calls with user quotas
- **Retry Logic:** Robust error handling with exponential backoff and fallback strategies
- **Resource Management:** Efficient memory usage and cleanup in Edge Functions

### Database
- **RLS:** Row-level security for all body scan data
- **Indexes:** Optimized for frequent queries (`user_id`, `created_at`, `current_scan_id`)
- **Triggers:** Automatic `updated_at` timestamps and profile synchronization
- **Vector Storage:** Efficient storage of morphological parameters and embeddings

---

## üí∞ Costs and Governance

### Costs per Component
- **Photo Analysis (scan-estimate):** ~$0.002 - $0.008 per scan
- **Semantic Analysis (scan-semantic):** ~$0.0008 - $0.003 per scan
- **Archetype Matching (scan-match):** ~$0.0005 - $0.002 per scan
- **Morphological Refinement (scan-refine-morphs):** ~$0.001 - $0.005 per scan
- **Avatar Commitment (scan-commit):** ~$0.0002 - $0.001 per scan
- **Insights Generation:** ~$0.0008 - $0.004 per generation

### Total Pipeline Cost
- **Complete Body Scan:** ~$0.0045 - $0.023 per scan
- **With Insights:** ~$0.0053 - $0.027 per scan

### Cost Optimizations
- **Intelligent Cache:** Avoid unnecessary re-processing of similar scans
- **Progressive Fallback:** Use simpler models if advanced ones fail, reducing costs
- **User Quotas:** Configurable limits per user to control expenses
- **Batch Processing:** Optimize multiple operations where possible
- **Token Monitoring:** Precise tracking of token consumption per model and operation

### Governance
- **User Quotas:** Monthly scan limits with premium tiers
- **Audit Trail:** Complete traceability of AI calls and associated costs
- **Cost Alerts:** Notifications when predefined cost thresholds are exceeded
- **Usage Analytics:** Detailed breakdown of costs per user and operation type

---

## üîç Observability and Debugging

### Structured Logs
```typescript
// Example body scan processing log
{
  level: 'info',
  message: 'Body scan pipeline completed successfully',
  context: {
    userId: 'uuid',
    scanId: 'body_scan_123',
    clientScanId: 'client_123',
    pipelineSteps: ['estimate', 'semantic', 'match', 'refine', 'commit'],
    totalProcessingTime: 45000,
    finalConfidence: 0.92,
    morphParametersCount: 156,
    aiModelsUsed: ['gpt-5-vision', 'gpt-5-mini'],
    totalTokensUsed: 3500,
    estimatedCost: 0.018,
    philosophy: 'body_scan_pipeline_audit'
  },
  timestamp: '2025-01-24T14:30:00.000Z'
}
```

### Key Metrics
- **E2E SLO:** < 90 seconds (capture + processing + results display)
- **Success Rate:** > 95% for complete pipeline
- **Average Confidence:** > 85% for morphological parameters
- **Cache Hit Rate:** > 60% for repeated similar scans
- **3D Rendering Performance:** 60 FPS on modern devices

### Debugging
- **`clientScanId`:** End-to-end body scan tracking across all pipeline steps
- **Correlation IDs:** Frontend and backend request linking with detailed tracing
- **Error Boundaries:** Graceful error handling in 3D viewer and processing steps
- **Fallback Strategies:** Progressive degradation in case of AI or processing failures
- **Performance Monitoring:** Real-time tracking of 3D rendering performance and memory usage

---

## üß† Future Integration with Central Brain

### Exportable Data

**Quantitative Metrics:**
- `final_shape_params`: Complete morphological parameter set
- `body_measurements`: Height, weight, circumferences, body fat percentage
- `muscle_mass_percentage`: Estimated muscle mass and distribution
- `morphology_score`: Overall body composition score

**Qualitative Insights:**
- `morphological_insights`: AI-generated body composition insights
- `body_shape_classification`: Semantic body type and characteristics
- `posture_analysis`: Posture assessment and correction recommendations

**Temporal Patterns:**
- Scan frequency and consistency
- Body composition evolution over time
- Goal progress and achievement tracking

### Future Correlations

**With Energy Forge:**
- Correlation between body composition and activity performance
- Muscle development tracking based on training patterns
- Recovery optimization based on morphological data

**With Nutritional Forge:**
- Body composition changes correlated with nutritional intake
- Macro optimization based on body fat and muscle mass goals
- Metabolic rate adjustments based on body composition

**With Time Forge:**
- Impact of fasting patterns on body composition
- Optimal eating windows based on metabolic profile

### Central Brain Architecture

**Data Sources:**
```typescript
interface CentralBrainBodyInput {
  // Body Forge
  morphologicalData: BodyScanData[];
  avatarEvolution: UserAvatar[];
  bodyInsights: MorphologyInsights[];
  
  // Cross-system correlations
  activityCorrelations: ActivityBodyCorrelation[];
  nutritionCorrelations: NutritionBodyCorrelation[];
  fastingCorrelations: FastingBodyCorrelation[];
  
  // User Profile
  bodyGoals: BodyCompositionGoals;
  morphologicalPreferences: MorphologicalPreferences;
}
```

**Expected Output:**
```typescript
interface HolisticBodyRecommendations {
  bodyCompositionScore: number;
  morphologicalOptimization: MorphOptimization[];
  crossSystemInsights: CrossSystemInsight[];
  bodyEvolutionPlan: BodyEvolutionPlan;
  personalizedTrainingPlan: TrainingPlan;
  nutritionalAdjustments: NutritionalAdjustment[];
}
```

---

## üîß Maintenance and Evolution

### Extension Points
- **Advanced 3D Models:** Integration of more detailed morphological models
- **Real-time Processing:** Faster AI models for near-instantaneous results
- **Enhanced Measurements:** Additional body measurements and composition metrics
- **AR Integration:** Augmented reality overlay for real-time body analysis
- **Wearable Integration:** Sync with fitness trackers and smart scales

### Continuous Monitoring
- **Performance:** SLO and response time monitoring across all pipeline steps
- **Costs:** Continuous optimization of AI API calls and processing efficiency
- **Quality:** User feedback on avatar accuracy and morphological insights
- **Evolution:** Adaptation based on usage patterns and technological advances

---

## üìû Support and Contribution

For any technical questions or improvement suggestions regarding the Body Scan Pipeline, consult this document or contact the development team.

**Key files to consult:**
- Pipeline: `src/app/pages/BodyScan/BodyScanCapture/BodyScanCapture.tsx`
- 3D Avatar: `src/components/3d/Avatar3DViewer.tsx`
- Data hooks: `src/system/data/repositories/bodyScanRepo.ts`
- Edge Functions: `supabase/functions/scan-*`

---

*This documentation is kept up to date with each evolution of the Body Scan Pipeline. Last revision: January 2025*