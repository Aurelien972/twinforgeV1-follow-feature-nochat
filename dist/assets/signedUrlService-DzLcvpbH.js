import{l as i,s as E}from"./page-fridge-C1QVLxk9.js";const a=new Map,c=3600,d=5*60*1e3;typeof window<"u"&&setInterval(()=>{g()},d);function g(){const r=Date.now();let e=0;for(const[s,n]of a.entries())n.expiresAt<r&&(a.delete(s),e++);e>0&&i.debug("SIGNED_URL_SERVICE",`Cleaned up ${e} expired URLs from cache`)}function l(r,e){return`${r}:${e}`}function U(r,e){const s=l(r,e),n=a.get(s);if(!n)return null;const t=Date.now(),o=5*60*1e3;return n.expiresAt-o<t?(a.delete(s),null):(i.debug("SIGNED_URL_SERVICE","Using cached signed URL",{bucket:r,path:e,expiresIn:Math.round((n.expiresAt-t)/1e3)+"s"}),n.url)}function R(r,e,s,n){const t=l(r,e),o=Date.now()+n*1e3;a.set(t,{url:s,expiresAt:o}),i.debug("SIGNED_URL_SERVICE","Cached signed URL",{bucket:r,path:e,expiresIn:n+"s"})}async function u(r,e,s=c){try{const n=U(r,e);if(n)return n;i.debug("SIGNED_URL_SERVICE","Generating signed URL",{bucket:r,path:e,expirySeconds:s});const{data:t,error:o}=await E.storage.from(r).createSignedUrl(e,s);return o?(i.error("SIGNED_URL_SERVICE","Failed to generate signed URL",{bucket:r,path:e,error:o.message,errorDetails:o,statusCode:o.statusCode,hint:"Check if the file exists and RLS policies allow access"}),null):t?.signedUrl?(R(r,e,t.signedUrl,s),i.info("SIGNED_URL_SERVICE","Signed URL generated successfully",{bucket:r,path:e,expiresIn:s+"s"}),t.signedUrl):(i.error("SIGNED_URL_SERVICE","No signed URL returned",{bucket:r,path:e}),null)}catch(n){return i.error("SIGNED_URL_SERVICE","Error generating signed URL",{bucket:r,path:e,error:n instanceof Error?n.message:"Unknown error"}),null}}const I={BODY_SCANS:"body-scans",MODELS_3D:"3d-models",SILHOUETTES:"silhouettes",FAST_ARCHETYPE:"fast-archetype",MEAL_PHOTOS:"meal-photos",TRAINING_LOCATIONS:"training-locations"};export{I as P,u as g};
