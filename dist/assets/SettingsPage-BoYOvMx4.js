var pe=Object.defineProperty;var xe=(u,s,t)=>s in u?pe(u,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[s]=t;var ee=(u,s,t)=>xe(u,typeof s!="symbol"?s+"":s,t);import{r as v,j as e,bD as se,d0 as he,bH as fe,c1 as M,bu as te,bZ as ge,cg as be,d1 as je}from"./vendor-ZbFMzY-i.js";import{S as b,I as f,v as ve,w as K,x as ye,u as J,y as re,G as w,z as Q,A as I,E as B,H as $,J as R,K as X,N as Ne,o as we,q as G}from"./ui-components-OHztaiDj.js";import{P as Ee,U as _e}from"./UnderConstructionCard-BQRkWnue.js";import{a as H,n as Ce,o as Se,N as De,p as Te,q as Ae,r as Pe,D as ae,s as ke}from"./stores-ZZM8MTtI.js";import{a as Oe}from"./page-fridge-scan-C_CisW7P.js";import{l as i,s as z,a as de}from"./page-fridge-C1QVLxk9.js";import{m as P,A as ie}from"./motion-HGAT--uT.js";import{d as Ie}from"./mobileDetection-qVCXVKdX.js";import{f as ne,a as oe}from"./date-utils-BlBdbPk_.js";import"./utils-CUtLAp28.js";import"./supabase-8_3juhcZ.js";const ze=()=>{const{user:u}=H(),{devices:s,loading:t,syncing:r,syncDevice:n,disconnectDevice:l}=Oe(u?.id||null),[d,c]=v.useState(null),[p,E]=v.useState(!1),N=async o=>{i.info("[CONNECTED_DEVICES] Connect device initiated",{provider:o,showSimulator:p,userId:u?.id});const m=K[o];if(!m){i.error("[CONNECTED_DEVICES] Provider config not found",{provider:o}),alert("Configuration du provider introuvable");return}if(p){i.info("[CONNECTED_DEVICES] Simulation mode active - showing success alert",{provider:o,providerName:m.name}),alert(`Mode Simulation: Connexion à ${m.name} simulée avec succès!`);return}const C=`https://kwipydbtjagypocpvbwn.supabase.co/functions/v1/wearable-oauth-callback?provider=${o}`;try{i.info("[CONNECTED_DEVICES] Creating OAuth flow in database",{provider:o,redirectUri:C});const{data:T,error:k}=await z.rpc("create_device_auth_flow",{p_provider:o,p_redirect_uri:C});if(k){i.error("[CONNECTED_DEVICES] Failed to create auth flow",{provider:o,error:k}),alert("Erreur lors de l'initialisation de la connexion. Veuillez réessayer.");return}const S=T.state,L=T.expires_at;i.info("[CONNECTED_DEVICES] Auth flow created successfully",{provider:o,state:S,expiresAt:L});const A=new URL(m.authUrl);A.searchParams.set("response_type","code");const O=o==="google_fit"?void 0:"YOUR_CLIENT_ID";A.searchParams.set("client_id",O),A.searchParams.set("redirect_uri",C),A.searchParams.set("state",S),A.searchParams.set("scope",m.scopes.join(" ")),o==="google_fit"&&(A.searchParams.set("access_type","offline"),A.searchParams.set("prompt","consent")),i.info("[CONNECTED_DEVICES] Redirecting to OAuth provider",{provider:o,authUrl:A.toString()}),window.location.href=A.toString()}catch(T){i.error("[CONNECTED_DEVICES] Unexpected error during OAuth initialization",{provider:o,error:T instanceof Error?T.message:"Unknown error"}),alert("Une erreur inattendue s'est produite. Veuillez réessayer.")}},D=async o=>{i.info("[CONNECTED_DEVICES] Sync initiated",{deviceId:o,userId:u?.id});try{await n(o),i.info("[CONNECTED_DEVICES] Sync successful",{deviceId:o}),alert("Synchronisation réussie!")}catch(m){i.error("[CONNECTED_DEVICES] Sync failed",{deviceId:o,error:m instanceof Error?m.message:"Unknown error"}),alert(`Erreur: ${m instanceof Error?m.message:"Synchronisation échouée"}`)}},x=async o=>{if(i.info("[CONNECTED_DEVICES] Disconnect initiated",{deviceId:o,userId:u?.id}),!confirm("Voulez-vous vraiment déconnecter cet appareil?")){i.info("[CONNECTED_DEVICES] Disconnect cancelled by user",{deviceId:o});return}try{await l(o),i.info("[CONNECTED_DEVICES] Disconnect successful",{deviceId:o})}catch(m){i.error("[CONNECTED_DEVICES] Disconnect failed",{deviceId:o,error:m instanceof Error?m.message:"Unknown error"}),alert(`Erreur: ${m instanceof Error?m.message:"Déconnexion échouée"}`)}},_=o=>({connected:"Connecté",syncing:"Synchronisation...",error:"Erreur",disconnected:"Déconnecté",pending_auth:"En attente",token_expired:"Expiré"})[o];return e.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"},children:[!1,e.jsx(ie,{children:p&&e.jsx(P.div,{initial:{opacity:0,y:-10,scale:.98},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.98},transition:{duration:.3,ease:[.4,0,.2,1]},className:"simulation-alert",children:e.jsxs("div",{className:"simulation-alert-content",children:[e.jsx("div",{className:"simulation-alert-icon",children:e.jsx(b,{Icon:f.AlertCircle,size:22,color:"#F59E0B"})}),e.jsxs("div",{className:"simulation-alert-text",children:[e.jsx("h4",{children:"Mode Simulation Activé"}),e.jsx("p",{children:"Les connexions aux appareils sont simulées. Idéal pour tester sans montres réelles."})]})]})})}),e.jsx("div",{style:{marginBottom:"2rem"},children:e.jsx(ve,{variant:"detailed",showSyncButton:!0})}),t?e.jsxs("div",{className:"devices-loading",children:[e.jsx("div",{className:"devices-loading-spinner",children:e.jsx(b,{Icon:f.Loader2,size:36,color:"#18E3FF"})}),e.jsx("p",{className:"devices-loading-text",children:"Chargement des appareils..."})]}):e.jsxs(e.Fragment,{children:[s.length>0&&e.jsxs("div",{style:{marginBottom:"2.5rem"},children:[e.jsxs("h3",{className:"providers-section-title",children:["Mes Appareils (",s.length,")"]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:s.map(o=>{const m=K[o.provider],y=d===o.id;return e.jsxs(P.div,{className:"device-card",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[e.jsxs("div",{className:"device-card-main",children:[e.jsxs("div",{className:"device-card-info",children:[e.jsx("div",{className:"device-icon-wrapper",style:{background:`linear-gradient(135deg, ${m.color}15 0%, ${m.color}30 100%)`},children:e.jsx(b,{Icon:f[m.icon],size:28,color:m.color})}),e.jsxs("div",{className:"device-details",children:[e.jsx("h4",{children:o.displayName||m.name}),e.jsxs("div",{className:"device-meta",children:[e.jsx("span",{className:`status-badge ${o.status}`,children:_(o.status)}),o.lastSyncAt&&e.jsxs("span",{className:"device-last-sync",children:["Dernière synchro: ",new Date(o.lastSyncAt).toLocaleDateString("fr-FR")]})]})]})]}),e.jsxs("div",{className:"device-actions",children:[e.jsx("button",{onClick:()=>D(o.id),disabled:r||o.status==="disconnected",className:"device-action-btn",title:"Synchroniser maintenant",children:e.jsx(b,{Icon:f.RefreshCw,size:20,className:r?"animate-spin":""})}),e.jsx("button",{onClick:()=>c(y?null:o.id),className:"device-action-btn",title:y?"Réduire":"Développer",children:e.jsx(b,{Icon:y?f.ChevronUp:f.ChevronDown,size:20})})]})]}),e.jsx(ie,{children:y&&e.jsxs(P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:[.4,0,.2,1]},className:"device-expanded",children:[e.jsxs("div",{className:"device-stats-grid",children:[e.jsxs("div",{className:"device-stat-item",children:[e.jsx("h5",{children:"Types de données"}),e.jsx("div",{className:"data-types-chips",children:m.dataTypes.slice(0,5).map(C=>e.jsx("span",{className:"data-type-chip",children:C},C))})]}),e.jsxs("div",{className:"device-stat-item",children:[e.jsx("h5",{children:"Connexion"}),e.jsx("p",{className:"device-stat-value",children:new Date(o.connectedAt).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"})})]})]}),e.jsxs("button",{onClick:()=>x(o.id),className:"disconnect-btn",children:[e.jsx(b,{Icon:f.Unlink,size:18}),e.jsx("span",{children:"Déconnecter"})]})]})})]},o.id)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"providers-section-title",children:"Connecter un Appareil"}),e.jsx("div",{className:"providers-grid",children:Object.values(K).filter(o=>ye.includes(o.id)).map((o,m)=>{const y=s.some(C=>C.provider===o.id);return e.jsxs(P.div,{className:`provider-card ${y?"connected":""}`,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:m*.05},children:[e.jsx("div",{className:"provider-icon-container",style:{background:`linear-gradient(135deg, ${o.color}15 0%, ${o.color}35 100%)`},children:e.jsx(b,{Icon:f[o.icon],size:26,color:o.color})}),e.jsxs("div",{className:"provider-info",children:[e.jsx("h4",{children:o.name}),e.jsx("p",{children:o.description})]}),e.jsx("button",{onClick:()=>N(o.id),disabled:y,className:"provider-connect-btn",style:{background:y?void 0:`radial-gradient(circle at 30% 20%, ${o.color}25 0%, transparent 60%),
                             radial-gradient(circle at 70% 80%, ${o.color}20 0%, transparent 50%),
                             linear-gradient(135deg, ${o.color}15 0%, ${o.color}30 100%)`,color:y?void 0:o.color,borderColor:y?void 0:`${o.color}50`},children:y?"Déjà connecté":"Connecter"})]},o.id)})}),e.jsxs("div",{style:{marginTop:"2rem",padding:"1.5rem",borderRadius:"16px",background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx(b,{Icon:f.Clock,size:20,style:{color:"#06B6D4"}}),e.jsx("h4",{style:{fontSize:"1rem",fontWeight:"600",color:"white",margin:0},children:"Prochainement"})]}),e.jsx("p",{style:{fontSize:"0.875rem",color:"rgba(255, 255, 255, 0.7)",margin:0,lineHeight:"1.5"},children:"Garmin, Polar, Fitbit, Whoop, Oura, Suunto, Coros, et Wahoo seront bientôt disponibles."})]})]})]})]})},Fe=()=>{const{mode:u,recommendedMode:s,isLoading:t,setMode:r}=de(),{showToast:n}=J(),[l,d]=v.useState(null),[c,p]=v.useState(!1);v.useEffect(()=>{const N=re.analyzeDevice();d(N)},[]);const E=async N=>{if(!(c||t)){p(!0);try{await r(N),n({type:"success",title:`Mode ${{"high-performance":"Performance Maximale",balanced:"Équilibré",quality:"Qualité Premium"}[N]} activé`,message:"La page va se recharger pour appliquer les changements",duration:2e3}),setTimeout(()=>{window.location.reload()},2e3)}catch{n({type:"error",title:"Erreur",message:"Impossible de modifier le mode performance",duration:3e3}),p(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[l&&e.jsx(w,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(b,{Icon:f.Smartphone,size:28,color:"#60A5FA",variant:"pure"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Votre Appareil"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block mb-1",children:"Modèle"}),e.jsx("span",{className:"text-sm text-white font-medium",children:l.deviceSpecs.deviceModel})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block mb-1",children:"Catégorie"}),e.jsx("span",{className:"text-sm text-white font-medium",children:re.getCategoryLabel(l.deviceCategory)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block mb-1",children:"RAM"}),e.jsxs("span",{className:"text-sm text-white font-medium",children:[l.deviceSpecs.memoryGB,"GB"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block mb-1",children:"Score"}),e.jsxs("span",{className:"text-sm text-white font-medium",children:[l.performanceScore,"/100"]})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"h-2 rounded-full bg-slate-700 overflow-hidden",children:e.jsx(P.div,{initial:{width:0},animate:{width:`${l.performanceScore}%`},transition:{delay:.3,duration:1,ease:"easeOut"},className:"h-full rounded-full",style:{background:l.performanceScore>=70?"linear-gradient(90deg, #10B981, #34D399)":l.performanceScore>=50?"linear-gradient(90deg, #3B82F6, #60A5FA)":"linear-gradient(90deg, #F59E0B, #FBBF24)"}})})})})]})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Choisissez votre mode de performance"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Nous avons conçu 3 niveaux de qualité visuelle pour adapter l'expérience à votre appareil. Vous pouvez changer de mode à tout moment."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(Q,{mode:"high-performance",isSelected:u==="high-performance",isRecommended:s==="high-performance",onClick:()=>E("high-performance"),disabled:c||t}),e.jsx(Q,{mode:"balanced",isSelected:u==="balanced",isRecommended:s==="balanced",onClick:()=>E("balanced"),disabled:c||t}),e.jsx(Q,{mode:"quality",isSelected:u==="quality",isRecommended:s==="quality",onClick:()=>E("quality"),disabled:c||t})]})]}),e.jsx(w,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(b,{Icon:f.Info,size:20,color:"#60A5FA",variant:"pure"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-semibold text-white mb-2",children:"À propos des modes de performance"}),e.jsxs("ul",{className:"text-xs text-slate-400 leading-relaxed space-y-2",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-emerald-400 mt-0.5",children:"•"}),e.jsxs("span",{children:[e.jsx("strong",{className:"text-slate-300",children:"Performance Maximale:"})," Désactive tous les effets visuels coûteux pour garantir 60fps. Idéal pour les appareils anciens (iPhone 8-10) ou si vous privilégiez la fluidité et la batterie."]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-400 mt-0.5",children:"•"}),e.jsxs("span",{children:[e.jsx("strong",{className:"text-slate-300",children:"Équilibré:"})," Active les animations essentielles et un design soigné. Compromis idéal entre performance et esthétique. Recommandé pour iPhone 11-12 et appareils mid-range."]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-purple-400 mt-0.5",children:"•"}),e.jsxs("span",{children:[e.jsx("strong",{className:"text-slate-300",children:"Qualité Premium:"})," Active tous les effets visuels pour une expérience immersive complète. Nécessite un appareil performant (iPhone 13+ ou desktop récent)."]})]})]})]})]})})]})},Y=[{id:"nova",name:"Nova",description:"Voix dynamique et jeune",personality:"Énergique et moderne",sampleText:"Hey ! Je suis Nova. Ensemble, on va déchirer cet entraînement !",isRecommended:!0,isNew:!0},{id:"shimmer",name:"Shimmer",description:"Voix féminine chaleureuse",personality:"Encourageante et bienveillante",sampleText:"Bonjour, je suis Shimmer. Je suis là pour t'encourager à chaque étape de ton parcours.",isRecommended:!0},{id:"echo",name:"Echo",description:"Voix masculine dynamique",personality:"Énergique et motivante",sampleText:"Salut ! Je suis Echo. Prêt à donner le meilleur de toi-même ? Allez, on y va !",isRecommended:!0},{id:"alloy",name:"Alloy",description:"Voix neutre et équilibrée",personality:"Professionnelle, claire et posée",sampleText:"Bonjour, je suis Alloy. Je vous accompagne dans votre entraînement avec une voix claire et professionnelle."},{id:"fable",name:"Fable",description:"Voix expressive britannique",personality:"Élégante et inspirante",sampleText:"Bonjour, je suis Fable. Laisse-moi t'accompagner dans ton parcours avec style et élégance.",isNew:!0},{id:"onyx",name:"Onyx",description:"Voix profonde et posée",personality:"Calme et rassurante",sampleText:"Salut, je suis Onyx. Je t'accompagne avec calme et détermination vers tes objectifs.",isNew:!0}],Re=()=>{const{profile:u,updateProfile:s}=H(),{showToast:t}=J(),[r,n]=v.useState(u?.preferences?.voice_coach_voice||"alloy"),[l,d]=v.useState(null),[c,p]=v.useState(!1),E=v.useRef(null),N=v.useRef(null);v.useEffect(()=>()=>{D(),E.current?.state!=="closed"&&E.current?.close()},[]);const D=()=>{if(N.current){try{"stop"in N.current?(N.current.stop(),N.current.disconnect()):"pause"in N.current&&(N.current.pause(),N.current.currentTime=0)}catch{}N.current=null}d(null)},x=async g=>{D();const o=Y.find(m=>m.id===g);if(o){d(g);try{const m="https://kwipydbtjagypocpvbwn.supabase.co",y="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3aXB5ZGJ0amFneXBvY3B2YnduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODg0MjIsImV4cCI6MjA3MDI2NDQyMn0.IS5IdKbmnGtgU_AaGYtUgX3ewaNpsiSAui5kbFV31_U";t({type:"info",title:`Aperçu: ${o.name}`,message:"Génération de l'aperçu vocal...",duration:2e3});const C=await fetch(`${m}/functions/v1/generate-voice-preview`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${y}`,apikey:y},body:JSON.stringify({voice:g,text:o.sampleText})});if(!C.ok)throw new Error("Failed to generate voice preview");const T=await C.blob(),k=URL.createObjectURL(T),S=new Audio(k);S.volume=1,S.onended=()=>{d(null),URL.revokeObjectURL(k)},S.onerror=()=>{d(null),URL.revokeObjectURL(k),t({type:"error",title:"Erreur",message:"Erreur lors de la lecture de l'aperçu",duration:3e3})},await S.play(),N.current=S}catch(m){console.error("Error playing voice preview:",m),d(null),t({type:"error",title:"Erreur",message:"Impossible de générer l'aperçu audio. Vérifiez votre connexion.",duration:3e3})}}},_=async g=>{n(g),p(!0);try{await s({preferences:{...u?.preferences,voice_coach_voice:g}}),t({type:"success",title:"Voix enregistrée",message:`${Y.find(o=>o.id===g)?.name} sera utilisée pour le coach vocal`,duration:3e3})}catch{t({type:"error",title:"Erreur",message:"Impossible de sauvegarder la préférence de voix",duration:3e3})}finally{p(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Voix du Coach Vocal"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Choisissez la voix qui vous accompagnera pendant vos entraînements. Cliquez sur le bouton de lecture pour écouter un aperçu."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Y.map(g=>{const o=r===g.id,m=l===g.id;return e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsx(w,{className:`p-4 cursor-pointer transition-all duration-300 ${o?"ring-2 ring-cyan-400/50 bg-gradient-to-br from-cyan-500/10 to-blue-500/10":g.isRecommended?"border border-cyan-500/20 hover:border-cyan-500/40 hover:bg-white/5":"hover:bg-white/5"} ${c?"opacity-50 pointer-events-none":""}`,onClick:()=>!c&&_(g.id),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(b,{Icon:f.Mic,size:24,color:o||g.isRecommended?"#18E3FF":"#60A5FA",variant:"pure"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"text-base font-semibold text-white",children:g.name}),g.isNew&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-semibold rounded-full bg-gradient-to-r from-purple-500/20 to-pink-500/20 text-purple-300 border border-purple-500/30",children:"Nouveau"}),g.isRecommended&&!g.isNew&&e.jsx("span",{className:"text-xs text-cyan-400/70",children:"★"})]}),o&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-cyan-400",children:[e.jsx(b,{Icon:f.Check,size:14,color:"#18E3FF",variant:"pure"}),e.jsx("span",{children:"Sélectionnée"})]})]}),e.jsx("p",{className:"text-sm text-slate-400 mb-2",children:g.description}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[e.jsx(b,{Icon:f.Sparkles,size:12,color:"#94A3B8",variant:"pure"}),e.jsx("span",{children:g.personality})]}),e.jsxs("button",{onClick:y=>{y.stopPropagation(),m?D():x(g.id)},className:`mt-3 w-full flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-all ${m?"bg-cyan-500/20 text-cyan-400 hover:bg-cyan-500/30":"bg-white/10 text-white hover:bg-white/15"}`,disabled:c,children:[e.jsx(b,{Icon:m?f.X:f.Play,size:16,color:m?"#18E3FF":"#FFFFFF",variant:"pure"}),e.jsx("span",{children:m?"Arrêter l'aperçu":"Écouter un aperçu"})]})]})]})})},g.id)})}),e.jsx(w,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(b,{Icon:f.Info,size:20,color:"#60A5FA",variant:"pure"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-semibold text-white mb-2",children:"À propos du Coach Vocal"}),e.jsxs("ul",{className:"text-xs text-slate-400 leading-relaxed space-y-2",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-cyan-400 mt-0.5",children:"•"}),e.jsx("span",{children:"Le coach vocal utilise la technologie OpenAI Realtime pour vous guider en temps réel pendant vos entraînements"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-cyan-400 mt-0.5",children:"•"}),e.jsx("span",{children:"Chaque voix a sa propre personnalité pour s'adapter à votre style d'entraînement"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-cyan-400 mt-0.5",children:"•"}),e.jsx("span",{children:"Les aperçus audio sont des simulations. La voix réelle sera utilisée lors de vos séances d'entraînement"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-cyan-400 mt-0.5",children:"•"}),e.jsx("span",{children:"Vous pouvez changer de voix à tout moment selon vos préférences"})]})]})]})]})})]})},Z=[{id:"auto",name:"Automatique",description:"Détection intelligente selon votre appareil",details:"Laissez le système choisir la meilleure qualité pour votre appareil",pixelRatio:"Variable",antialiasing:"Variable",recommended:"Recommandé pour la plupart des utilisateurs",icon:f.Sparkles,iconColor:"#18E3FF"},{id:"low",name:"Économie",description:"Performances maximales, batterie optimisée",details:"Idéal pour les appareils plus anciens ou pour économiser la batterie",pixelRatio:"1.0x",antialiasing:"Désactivé",icon:f.Zap,iconColor:"#10B981"},{id:"medium",name:"Équilibré",description:"Bon compromis qualité/performance",details:"Rendu amélioré avec un impact minimal sur les performances",pixelRatio:"1.25x",antialiasing:"Désactivé",icon:f.Target,iconColor:"#60A5FA"},{id:"high",name:"Qualité",description:"Meilleur rendu visuel possible",details:"Antialiasing activé, résolution maximale - réservé aux appareils performants",pixelRatio:"1.5x",antialiasing:"Activé",recommended:"Nécessite un appareil récent (iPhone 13+, Galaxy S21+)",icon:f.Star,iconColor:"#F59E0B"}],Be=()=>{const{user:u}=H(),{quality:s,setQuality:t,getEffectiveQuality:r,detectedQuality:n}=Ce(),{showToast:l}=J(),[d,c]=v.useState(!1),[p,E]=v.useState("");v.useEffect(()=>{try{const x=Ie(),_=x.isDesktop?"Desktop":x.isTablet?"Tablette":"Mobile",g=x.performanceLevel==="high"?"Haut de gamme":x.performanceLevel==="medium"?"Milieu de gamme":"Entrée de gamme";E(`${_} - ${g}`)}catch{E("Non détecté")}},[]);const N=async x=>{if(!d){c(!0);try{await t(x,u?.id);const _=x==="auto"?n||"medium":x,g=Z.find(o=>o.id===x)?.name||x;l({type:"success",title:"Qualité 3D modifiée",message:`${g} - Les changements seront appliqués au prochain chargement 3D`,duration:4e3}),x==="high"&&n==="low"&&l({type:"warning",title:"Attention",message:'Votre appareil pourrait avoir des difficultés avec cette qualité. Vous pouvez revenir à "Automatique" si vous constatez des ralentissements.',duration:6e3})}catch{l({type:"error",title:"Erreur",message:"Impossible de sauvegarder la préférence de qualité 3D",duration:3e3})}finally{c(!1)}}},D=r();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Qualité de rendu 3D"}),e.jsx("p",{className:"text-sm text-slate-400 mb-3",children:"Contrôlez la qualité visuelle des modèles 3D (avatars, morphologie). Une qualité plus élevée améliore le rendu mais peut impacter les performances."}),p&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500 bg-slate-800/30 rounded-lg px-3 py-2 border border-slate-700/30",children:[e.jsx(b,{Icon:f.Info,size:14,color:"#64748B",variant:"pure"}),e.jsxs("span",{children:["Appareil détecté: ",p]}),n&&s==="auto"&&e.jsxs("span",{className:"ml-auto text-cyan-400",children:["→ Qualité appliquée: ",Z.find(x=>x.id===D)?.name]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Z.map(x=>{const _=s===x.id,g=D===x.id;return e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsx(w,{className:`p-4 cursor-pointer transition-all duration-300 ${_?"ring-2 ring-cyan-400/50 bg-gradient-to-br from-cyan-500/10 to-blue-500/10":x.recommended?"border border-cyan-500/20 hover:border-cyan-500/40 hover:bg-white/5":"hover:bg-white/5"} ${d?"opacity-50 pointer-events-none":""}`,onClick:()=>!d&&N(x.id),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(b,{Icon:x.icon,size:24,color:x.iconColor,variant:"pure"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"text-base font-semibold text-white",children:x.name}),g&&s==="auto"&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-semibold rounded-full bg-gradient-to-r from-cyan-500/20 to-blue-500/20 text-cyan-300 border border-cyan-500/30",children:"Appliqué"})]}),_&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-cyan-400",children:[e.jsx(b,{Icon:f.Check,size:14,color:"#18E3FF",variant:"pure"}),e.jsx("span",{children:"Sélectionné"})]})]}),e.jsx("p",{className:"text-sm text-slate-400 mb-3",children:x.description}),e.jsx("p",{className:"text-xs text-slate-500 mb-3",children:x.details}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-400",children:[e.jsx(b,{Icon:f.Maximize,size:12,color:"#94A3B8",variant:"pure"}),e.jsxs("span",{children:["Résolution: ",x.pixelRatio]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-400",children:[e.jsx(b,{Icon:f.Sparkles,size:12,color:"#94A3B8",variant:"pure"}),e.jsxs("span",{children:["AA: ",x.antialiasing]})]})]}),x.recommended&&e.jsx("div",{className:"mt-3 pt-3 border-t border-slate-700/30",children:e.jsxs("div",{className:"flex items-start gap-1.5 text-xs text-cyan-400/70",children:[e.jsx(b,{Icon:f.Info,size:12,color:"#22D3EE",variant:"pure",className:"mt-0.5 flex-shrink-0"}),e.jsx("span",{children:x.recommended})]})})]})]})})},x.id)})}),e.jsx(w,{className:"p-4 bg-gradient-to-br from-blue-500/5 to-cyan-500/5 border-cyan-500/20",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(b,{Icon:f.Info,size:20,color:"#18E3FF",variant:"pure",className:"flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 text-sm",children:[e.jsx("p",{className:"text-slate-300 mb-2",children:e.jsx("strong",{className:"text-white",children:"À propos de la qualité 3D:"})}),e.jsxs("ul",{className:"text-slate-400 space-y-1 text-xs",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Résolution (pixelRatio)"}),": Plus élevée = moins de pixélisation mais plus gourmand en ressources"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Antialiasing (AA)"}),": Lisse les bords mais consomme plus de batterie"]}),e.jsxs("li",{children:["• Le mode ",e.jsx("strong",{children:"Automatique"})," détecte votre appareil et choisit la meilleure qualité"]}),e.jsx("li",{children:"• Les changements prennent effet au prochain chargement d'un modèle 3D"})]})]})]})})]})},qe="/sw.js";class Ue{constructor(){ee(this,"serviceWorkerRegistration",null)}async registerServiceWorker(){if(!("serviceWorker"in navigator))return i.warn("WEB_PUSH","Service Workers not supported"),null;try{const s=await navigator.serviceWorker.register(qe);return this.serviceWorkerRegistration=s,i.info("WEB_PUSH","Service Worker registered",{scope:s.scope}),s}catch(s){return i.error("WEB_PUSH","Failed to register Service Worker",{error:s}),null}}async getServiceWorkerRegistration(){if(this.serviceWorkerRegistration)return this.serviceWorkerRegistration;if(!("serviceWorker"in navigator))return null;try{const s=await navigator.serviceWorker.ready;return this.serviceWorkerRegistration=s,s}catch(s){return i.error("WEB_PUSH","Failed to get Service Worker registration",{error:s}),null}}async checkPermissionState(){const s="Notification"in window&&"serviceWorker"in navigator;if(!s)return{permission:"denied",isSupported:!1,isSubscribed:!1,subscription:null};const t=Notification.permission;let r=null,n=!1;if(t==="granted"){const l=await this.getCurrentSubscription();l&&(r=this.convertSubscriptionToWebPush(l),n=!0)}return{permission:t,isSupported:s,isSubscribed:n,subscription:r}}async checkPushPermission(){return"Notification"in window?Notification.permission:"denied"}async requestPermission(){if(!("Notification"in window))return i.warn("WEB_PUSH","Notifications not supported"),"denied";try{const s=await Notification.requestPermission();return i.info("WEB_PUSH","Permission requested",{permission:s}),s}catch(s){return i.error("WEB_PUSH","Error requesting permission",{error:s}),"denied"}}async getCurrentSubscription(){const s=await this.getServiceWorkerRegistration();if(!s)return null;try{return await s.pushManager.getSubscription()}catch(t){return i.error("WEB_PUSH","Failed to get current subscription",{error:t}),null}}async subscribe(s){try{const t=await this.requestPermission();if(t!=="granted")return i.warn("WEB_PUSH","Permission not granted",{permission:t}),null;const r=await this.getServiceWorkerRegistration();if(!r)return i.error("WEB_PUSH","No service worker registration available"),null;const n=await this.getVapidPublicKey();if(!n)return i.error("WEB_PUSH","VAPID public key not available"),null;const l=await r.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.urlBase64ToUint8Array(n)});return i.info("WEB_PUSH","Subscribed to push notifications",{endpoint:l.endpoint}),this.convertSubscriptionToPayload(l)}catch(t){return i.error("WEB_PUSH","Failed to subscribe to push notifications",{error:t}),null}}async unsubscribe(){try{const s=await this.getCurrentSubscription();if(!s)return i.warn("WEB_PUSH","No active subscription to unsubscribe"),!0;const t=await s.unsubscribe();return i.info("WEB_PUSH","Unsubscribed from push notifications",{success:t}),t}catch(s){return i.error("WEB_PUSH","Failed to unsubscribe from push notifications",{error:s}),!1}}async refreshSubscription(s){try{return await this.unsubscribe(),await this.subscribe(s)}catch(t){return i.error("WEB_PUSH","Failed to refresh subscription",{error:t}),null}}async getVapidPublicKey(){try{return i.warn("WEB_PUSH","VAPID public key not configured"),null}catch(s){return i.error("WEB_PUSH","Failed to get VAPID public key",{error:s}),null}}async sendTestNotification(s){try{const{data:t,error:r}=await z.functions.invoke("send-push-notification",{body:{userId:s,notification:{title:"Test Notification",body:"Les notifications push fonctionnent correctement !",icon:"/brand/dual-ingot.svg",badge:"/brand/dual-ingot.svg",tag:"test-notification",data:{url:"/"}}}});return r?(i.error("WEB_PUSH","Failed to send test notification",{error:r}),!1):(i.info("WEB_PUSH","Test notification sent",{data:t}),!0)}catch(t){return i.error("WEB_PUSH","Error sending test notification",{error:t}),!1}}convertSubscriptionToPayload(s){const t=s.getKey("p256dh"),r=s.getKey("auth");return{subscription_endpoint:s.endpoint,subscription_keys:{p256dh:this.arrayBufferToBase64(t),auth:this.arrayBufferToBase64(r)},device_info:{userAgent:navigator.userAgent,platform:navigator.platform,browser:this.getBrowserInfo(),os:this.getOSInfo()}}}convertSubscriptionToWebPush(s){const t=s.getKey("p256dh"),r=s.getKey("auth");return{endpoint:s.endpoint,expirationTime:s.expirationTime,keys:{p256dh:this.arrayBufferToBase64(t),auth:this.arrayBufferToBase64(r)}}}urlBase64ToUint8Array(s){const t="=".repeat((4-s.length%4)%4),r=(s+t).replace(/-/g,"+").replace(/_/g,"/"),n=window.atob(r),l=new Uint8Array(n.length);for(let d=0;d<n.length;++d)l[d]=n.charCodeAt(d);return l}arrayBufferToBase64(s){const t=new Uint8Array(s);let r="";for(let n=0;n<t.byteLength;n++)r+=String.fromCharCode(t[n]);return window.btoa(r)}getBrowserInfo(){const s=navigator.userAgent;return s.includes("Chrome")?"Chrome":s.includes("Firefox")?"Firefox":s.includes("Safari")?"Safari":s.includes("Edge")?"Edge":"Unknown"}getOSInfo(){const s=navigator.userAgent;return s.includes("Win")?"Windows":s.includes("Mac")?"macOS":s.includes("Linux")?"Linux":s.includes("Android")?"Android":s.includes("iOS")?"iOS":"Unknown"}}const le=new Ue,Le=()=>{const{profile:u}=H(),s=u?.id,{globalSettings:t,categoryPreferences:r,pushSubscriptions:n,activePushSubscription:l,isLoading:d,isSaving:c,error:p,loadGlobalSettings:E,updateGlobalSetting:N,loadCategoryPreferences:D,updateCategoryPreference:x,loadPushSubscriptions:_,subscribeToPush:g,unsubscribeFromPush:o,clearError:m}=Se(),[y,C]=v.useState("default"),[T,k]=v.useState(!1);v.useEffect(()=>{s&&(async()=>{try{await Promise.all([E(s),D(s),_(s),S()])}catch(j){console.error("Failed to load notification preferences:",j)}})()},[s]);const S=async()=>{try{if(!("Notification"in window)){C("denied");return}const a=Notification.permission;C(a)}catch(a){console.error("Failed to check push permission:",a),C("denied")}},L=async()=>{if(s){k(!0);try{const a=await le.subscribe(s);a&&(await g(a,s),await S())}catch(a){console.error("Failed to subscribe to push notifications",a)}finally{k(!1)}}},A=async()=>{if(!(!l||!s)){k(!0);try{await o(l.id,s),await le.unsubscribe(),await S()}catch(a){console.error("Failed to unsubscribe from push notifications",a)}finally{k(!1)}}},O=async(a,j)=>{await N(a,j,s)},V=async(a,j,F)=>{await x(a,{[j]:F},s)},U=t.push_notifications_enabled,W=!!l,h=!("Notification"in window)||!("serviceWorker"in navigator);return e.jsxs("div",{className:"space-y-6",children:[p&&e.jsx(I,{type:"error",message:p,actions:e.jsx(B,{variant:"ghost",onClick:m,children:"Fermer"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Gérer vos notifications"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Personnalisez vos préférences de notifications pour rester informé sans être submergé."})]}),e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsxs(w,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-6",children:[e.jsx(b,{Icon:f.Bell,size:24,color:"#18E3FF",variant:"pure"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-base font-semibold text-white mb-1",children:"Paramètres globaux"}),e.jsx("p",{className:"text-xs text-slate-400 leading-relaxed",children:"Contrôlez tous vos types de notifications"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx($,{label:"Notifications push",description:"Recevez des notifications sur votre appareil même quand l'app est fermée",enabled:U,onChange:a=>O("push_notifications_enabled",a),disabled:d,loading:c}),e.jsx($,{label:"Notifications in-app",description:"Affichez les notifications quand vous utilisez l'application",enabled:t.in_app_notifications_enabled,onChange:a=>O("in_app_notifications_enabled",a),disabled:d,loading:c}),e.jsx($,{label:"Notifications email",description:"Recevez des emails pour les notifications importantes",enabled:t.email_notifications_enabled,onChange:a=>O("email_notifications_enabled",a),disabled:d,loading:c}),e.jsx($,{label:"Son des notifications",description:"Jouez un son lors de la réception d'une notification",enabled:t.notification_sound_enabled,onChange:a=>O("notification_sound_enabled",a),disabled:d,loading:c}),e.jsx($,{label:"Vibration",description:"Faites vibrer l'appareil lors de la réception d'une notification",enabled:t.notification_vibration_enabled,onChange:a=>O("notification_vibration_enabled",a),disabled:d,loading:c})]})]})}),U&&e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.1},children:e.jsxs(w,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-6",children:[e.jsx(b,{Icon:f.Smartphone,size:24,color:"#60A5FA",variant:"pure"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-base font-semibold text-white mb-1",children:"Configuration Web Push"}),e.jsx("p",{className:"text-xs text-slate-400 leading-relaxed",children:"Gérez vos abonnements aux notifications push"})]})]}),h&&e.jsx(I,{type:"warning",message:"Les notifications push ne sont pas supportées par votre navigateur."}),!h&&y==="denied"&&e.jsx(I,{type:"error",title:"Permission refusée",message:"Vous avez refusé les notifications. Vous devez autoriser les notifications dans les paramètres de votre navigateur."}),!h&&y==="granted"&&!W&&e.jsx(I,{type:"info",title:"Activez les notifications push",message:"Abonnez-vous aux notifications push pour recevoir des alertes même quand l'app est fermée.",actions:e.jsx(B,{onClick:L,loading:T,icon:e.jsx(se,{size:18}),children:"Activer les notifications push"})}),!h&&y==="default"&&e.jsx(I,{type:"info",message:"Cliquez sur le bouton ci-dessous pour autoriser les notifications push.",actions:e.jsx(B,{onClick:L,loading:T,icon:e.jsx(se,{size:18}),children:"Demander l'autorisation"})}),W&&e.jsx(I,{type:"success",title:"Notifications push actives",message:`Abonné depuis ${new Date(l.created_at).toLocaleDateString()}`,actions:e.jsx(B,{variant:"danger",onClick:A,loading:T,icon:e.jsx(he,{size:18}),children:"Désactiver les notifications push"})})]})}),e.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.2},children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-base font-semibold text-white mb-2",children:"Notifications par catégorie"}),e.jsx("p",{className:"text-xs text-slate-400 leading-relaxed",children:"Personnalisez vos préférences pour chaque type de notification"})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:De.map(a=>{const j=r.get(a.category);return e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsxs(w,{className:"p-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"text-sm font-semibold text-white mb-1",children:a.label}),e.jsx("p",{className:"text-xs text-slate-400 leading-relaxed",children:a.description})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-xs text-slate-400",children:"Push"}),e.jsx("button",{onClick:()=>V(a.category,"push_enabled",!(j?.push_enabled??!0)),disabled:d||!a.canDisable,className:`w-8 h-4 rounded-full transition-all ${j?.push_enabled??!0?"bg-cyan-500":"bg-slate-600"} ${a.canDisable?"cursor-pointer":"opacity-50 cursor-not-allowed"}`,children:e.jsx("div",{className:`w-3 h-3 bg-white rounded-full transition-transform ${j?.push_enabled??!0?"translate-x-4":"translate-x-0.5"}`})})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-xs text-slate-400",children:"In-app"}),e.jsx("button",{onClick:()=>V(a.category,"in_app_enabled",!(j?.in_app_enabled??!0)),disabled:d||!a.canDisable,className:`w-8 h-4 rounded-full transition-all ${j?.in_app_enabled??!0?"bg-cyan-500":"bg-slate-600"} ${a.canDisable?"cursor-pointer":"opacity-50 cursor-not-allowed"}`,children:e.jsx("div",{className:`w-3 h-3 bg-white rounded-full transition-transform ${j?.in_app_enabled??!0?"translate-x-4":"translate-x-0.5"}`})})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-xs text-slate-400",children:"Email"}),e.jsx("button",{onClick:()=>V(a.category,"email_enabled",!(j?.email_enabled??!1)),disabled:d||!a.canDisable,className:`w-8 h-4 rounded-full transition-all ${j?.email_enabled??!1?"bg-cyan-500":"bg-slate-600"} ${a.canDisable?"cursor-pointer":"opacity-50 cursor-not-allowed"}`,children:e.jsx("div",{className:`w-3 h-3 bg-white rounded-full transition-transform ${j?.email_enabled??!1?"translate-x-4":"translate-x-0.5"}`})})]})]})]})},a.category)})})]}),e.jsx(w,{className:"p-6 bg-gradient-to-br from-blue-500/5 to-cyan-500/5",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(b,{Icon:f.Info,size:20,color:"#60A5FA",variant:"pure"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-semibold text-white mb-2",children:"À propos des notifications"}),e.jsxs("ul",{className:"text-xs text-slate-400 leading-relaxed space-y-2",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-cyan-400 mt-0.5",children:"•"}),e.jsx("span",{children:"Les notifications push vous permettent de rester informé même quand l'application est fermée"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-cyan-400 mt-0.5",children:"•"}),e.jsx("span",{children:"Vous pouvez désactiver les notifications pour des catégories spécifiques tout en gardant les autres actives"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-cyan-400 mt-0.5",children:"•"}),e.jsx("span",{children:"Les notifications importantes (sécurité, mises à jour critiques) ne peuvent pas être désactivées"})]})]})]})]})}),d&&!p&&e.jsx(I,{type:"info",message:"Chargement des préférences de notifications..."})]})};class Ve{async requestFullExport(s,t="json"){const r={request_type:"full_export",export_format:t,included_data:["profile","training","nutrition","fasting","body_scans","activities","health","preferences","notifications"]};return this.requestExport(s,r)}async requestPartialExport(s,t,r="json"){const n={request_type:"partial_export",export_format:r,included_data:t};return this.requestExport(s,n)}async requestExport(s,t){try{i.info("DATA_EXPORT","Requesting data export",{userId:s,type:t.request_type,format:t.export_format,categories:t.included_data.length});const{data:r,error:n}=await z.rpc("request_data_export",{p_user_id:s,p_request_type:t.request_type,p_export_format:t.export_format,p_included_data:t.included_data});if(n)throw i.error("DATA_EXPORT","Failed to request export",{error:n}),n;const l=r;return i.info("DATA_EXPORT","Export request created",{requestId:l}),await this.triggerExportProcessing(l,s),l}catch(r){return i.error("DATA_EXPORT","Error requesting export",{error:r}),null}}async triggerExportProcessing(s,t){try{const{error:r}=await z.functions.invoke("export-user-data",{body:{requestId:s,userId:t}});if(r)throw i.error("DATA_EXPORT","Failed to trigger export processing",{error:r}),r;i.info("DATA_EXPORT","Export processing triggered",{requestId:s})}catch(r){i.error("DATA_EXPORT","Error triggering export processing",{error:r})}}async getExportStatus(s){try{const{data:t,error:r}=await z.from("data_export_requests").select("*").eq("id",s).maybeSingle();return r?(i.error("DATA_EXPORT","Failed to get export status",{error:r}),null):t}catch(t){return i.error("DATA_EXPORT","Error getting export status",{error:t}),null}}async pollExportProgress(s,t,r=60,n=2e3){let l=0,d=n;for(;l<r;){const c=await this.getExportStatus(s);if(!c)return i.error("DATA_EXPORT","Export request not found",{requestId:s}),null;if(t){const p=this.calculateProgress(c);t(p)}if(c.status==="completed")return i.info("DATA_EXPORT","Export completed",{requestId:s}),c;if(c.status==="failed")return i.error("DATA_EXPORT","Export failed",{requestId:s,error:c.error_message}),c;await new Promise(p=>setTimeout(p,d)),d=Math.min(d*1.5,1e4),l++}return i.warn("DATA_EXPORT","Export polling timeout",{requestId:s,attempts:l}),await this.getExportStatus(s)}calculateProgress(s){let t=0,r="Préparation";switch(s.status){case"pending":t=10,r="En attente";break;case"processing":t=50,r="Extraction des données en cours";break;case"completed":t=100,r="Terminé";break;case"failed":t=0,r="Erreur";break}return{requestId:s.id,status:s.status,progress:t,estimatedTimeRemaining:this.estimateTimeRemaining(s),currentStep:r}}estimateTimeRemaining(s){if(s.status==="completed"||s.status==="failed")return 0;if(s.status==="pending")return 120;if(s.status==="processing"){const t=new Date(s.requested_at).getTime(),n=(Date.now()-t)/1e3,d=Math.max(0,180-n);return Math.round(d)}return null}async getDownloadUrl(s){try{const t=await this.getExportStatus(s);return t?t.status!=="completed"?(i.warn("DATA_EXPORT","Export not completed",{requestId:s,status:t.status}),null):t.file_url?t.expires_at&&new Date(t.expires_at)<new Date?(i.warn("DATA_EXPORT","Download link expired",{requestId:s,expiresAt:t.expires_at}),null):t.file_url:(i.error("DATA_EXPORT","No file URL available",{requestId:s}),null):(i.error("DATA_EXPORT","Export request not found",{requestId:s}),null)}catch(t){return i.error("DATA_EXPORT","Error getting download URL",{error:t}),null}}async downloadExport(s){try{const t=await this.getDownloadUrl(s);if(!t)return i.error("DATA_EXPORT","No download URL available",{requestId:s}),!1;const r=document.createElement("a");return r.href=t,r.download=`twinforge-export-${s}`,r.target="_blank",document.body.appendChild(r),r.click(),document.body.removeChild(r),i.info("DATA_EXPORT","Export download triggered",{requestId:s}),!0}catch(t){return i.error("DATA_EXPORT","Error downloading export",{error:t}),!1}}async getExportHistory(s,t=10){try{const{data:r,error:n}=await z.from("data_export_requests").select("*").eq("user_id",s).order("requested_at",{ascending:!1}).limit(t);return n?(i.error("DATA_EXPORT","Failed to get export history",{error:n}),[]):r||[]}catch(r){return i.error("DATA_EXPORT","Error getting export history",{error:r}),[]}}async cleanupOldExports(s){try{const t=new Date;t.setDate(t.getDate()-7);const{data:r,error:n}=await z.from("data_export_requests").select("id").eq("user_id",s).eq("status","completed").lt("completed_at",t.toISOString());if(n||!r||r.length===0)return;i.info("DATA_EXPORT","Old exports found for cleanup",{count:r.length})}catch(t){i.error("DATA_EXPORT","Error cleaning up old exports",{error:t})}}formatFileSize(s){return s?s<1024?`${s} B`:s<1024*1024?`${(s/1024).toFixed(2)} KB`:s<1024*1024*1024?`${(s/(1024*1024)).toFixed(2)} MB`:`${(s/(1024*1024*1024)).toFixed(2)} GB`:"N/A"}estimateExportSize(s){const t={profile:100,training:5e3,nutrition:3e3,fasting:500,body_scans:2e4,activities:2e3,health:1e3,preferences:50,notifications:500},r=s.reduce((n,l)=>n+(t[l]||0),0)*1024;return this.formatFileSize(r)}}const ce=new Ve;class $e{async requestDeletion(s,t){try{i.info("ACCOUNT_DELETION","Requesting account deletion",{userId:s,deleteAllData:t.delete_all_data,anonymizeOnly:t.anonymize_only});const{data:r,error:n}=await z.rpc("request_account_deletion",{p_user_id:s,p_delete_all_data:t.delete_all_data,p_anonymize_only:t.anonymize_only,p_reason:t.reason||null});if(n)throw i.error("ACCOUNT_DELETION","Failed to request deletion",{error:n}),n;const l=r;return i.info("ACCOUNT_DELETION","Deletion request created",{requestId:l}),l}catch(r){return i.error("ACCOUNT_DELETION","Error requesting deletion",{error:r}),null}}async cancelDeletion(s,t){try{i.info("ACCOUNT_DELETION","Cancelling deletion request",{userId:s,reason:t.reason});const{data:r,error:n}=await z.rpc("cancel_account_deletion",{p_user_id:s,p_cancellation_reason:t.reason||null});if(n)throw i.error("ACCOUNT_DELETION","Failed to cancel deletion",{error:n}),n;const l=r;return l?i.info("ACCOUNT_DELETION","Deletion request cancelled successfully"):i.warn("ACCOUNT_DELETION","No active deletion request to cancel"),l}catch(r){return i.error("ACCOUNT_DELETION","Error cancelling deletion",{error:r}),!1}}async getActiveDeletionRequest(s){try{const{data:t,error:r}=await z.from("account_deletion_requests").select("*").eq("user_id",s).in("status",["pending","scheduled","processing"]).maybeSingle();return r?(i.error("ACCOUNT_DELETION","Failed to get deletion request",{error:r}),null):t}catch(t){return i.error("ACCOUNT_DELETION","Error getting deletion request",{error:t}),null}}async hasActiveDeletion(s){return await this.getActiveDeletionRequest(s)!==null}async getDeletionHistory(s){try{const{data:t,error:r}=await z.from("account_deletion_requests").select("*").eq("user_id",s).order("requested_at",{ascending:!1});return r?(i.error("ACCOUNT_DELETION","Failed to get deletion history",{error:r}),[]):t||[]}catch(t){return i.error("ACCOUNT_DELETION","Error getting deletion history",{error:t}),[]}}getDeletionWarningInfo(s){const t=Te(s.deletion_scheduled_at),r=new Date(s.deletion_scheduled_at),n=Ae(s);let l="info",d="";return t<=3?(l="critical",d=`Votre compte sera définitivement supprimé dans ${t} jour${t>1?"s":""}.`):t<=7?(l="warning",d=`Votre compte sera supprimé dans ${t} jours.`):(l="info",d=`Votre demande de suppression sera effective dans ${t} jours.`),{daysRemaining:t,scheduledDate:r,canCancel:n,warningLevel:l,message:d}}getDataToBeDeleted(s,t){return t?["Vos informations personnelles seront anonymisées","Vos données d'entraînement resteront pour les statistiques","Votre email et photo de profil seront supprimés","Votre identité ne sera plus associée à vos données"]:s?["Profil et informations personnelles","Historique d'entraînement complet","Journal alimentaire et recettes","Sessions de jeûne","Scans corporels et photos","Activités enregistrées","Données de santé","Préférences et paramètres","Historique des notifications"]:["Profil et informations personnelles","Données sensibles (photos, santé)","Préférences et paramètres"]}getDeletionConsequences(){return["⚠️ Cette action est irréversible après le délai de grâce","⚠️ Vous ne pourrez plus accéder à vos données","⚠️ Votre progression sera définitivement perdue","⚠️ Vos abonnements et achats seront annulés","ℹ️ Vous avez 30 jours pour annuler cette demande","ℹ️ Un email de confirmation vous sera envoyé"]}async processScheduledDeletions(){try{i.info("ACCOUNT_DELETION","Processing scheduled deletions");const{error:s}=await z.functions.invoke("process-account-deletion");if(s)throw i.error("ACCOUNT_DELETION","Failed to process scheduled deletions",{error:s}),s;i.info("ACCOUNT_DELETION","Scheduled deletions processed successfully")}catch(s){i.error("ACCOUNT_DELETION","Error processing scheduled deletions",{error:s})}}getAnonymizationInfo(){return{title:"Anonymisation des données",description:"L'anonymisation supprime vos informations personnelles tout en conservant vos données d'entraînement pour les statistiques agrégées.",whatIsKept:["Données d'entraînement (sans identification)","Statistiques de progression (anonymisées)","Données nutritionnelles agrégées"],whatIsRemoved:["Nom, email, et informations personnelles","Photos et scans corporels","Données de connexion","Préférences personnelles"]}}async sendDeletionReminder(s,t){try{i.info("ACCOUNT_DELETION","Sending deletion reminder",{userId:s,daysRemaining:t})}catch(r){i.error("ACCOUNT_DELETION","Error sending deletion reminder",{error:r})}}async sendDeletionConfirmation(s,t){try{i.info("ACCOUNT_DELETION","Sending deletion confirmation",{userId:s,requestId:t})}catch(r){i.error("ACCOUNT_DELETION","Error sending deletion confirmation",{error:r})}}async sendCancellationConfirmation(s){try{i.info("ACCOUNT_DELETION","Sending cancellation confirmation",{userId:s})}catch(t){i.error("ACCOUNT_DELETION","Error sending cancellation confirmation",{error:t})}}}const We=new $e,Me=()=>{const{profile:u}=H(),s=u?.id,{preferences:t,activeDeletionRequest:r,recentExportRequests:n,isLoading:l,isSaving:d,error:c,loadPrivacyPreferences:p,updatePrivacyPreference:E,loadExportRequests:N,requestDataExport:D,loadDeletionRequest:x,requestAccountDeletion:_,cancelAccountDeletion:g,clearError:o}=Pe(),[m,y]=v.useState(ae.filter(a=>a.includeByDefault).map(a=>a.category)),[C,T]=v.useState(!1),[k,S]=v.useState("");v.useEffect(()=>{(async()=>{if(s)try{await Promise.all([p(s),N(s),x(s)])}catch(j){console.error("Failed to load privacy settings:",j)}})()},[s]);const L=async()=>{s&&await D({request_type:"partial_export",export_format:"json",included_data:m},s)},A=async()=>{if(!s)return;await _({delete_all_data:!0,anonymize_only:!1,reason:k||void 0},s)&&(T(!1),S(""))},O=async()=>{if(!s)return;await g({reason:"Annulation par l'utilisateur"},s)&&await x(s)},V=async a=>{await ce.downloadExport(a)},U=a=>{y(j=>j.includes(a)?j.filter(F=>F!==a):[...j,a])},W=ce.estimateExportSize(m),h=r?We.getDeletionWarningInfo(r):null;return e.jsxs("div",{className:"space-y-6",children:[c&&e.jsx(I,{type:"error",message:c,actions:e.jsx(B,{variant:"ghost",onClick:o,children:"Fermer"})}),r&&h&&e.jsx(I,{type:h.warningLevel,title:"Suppression de compte programmée",message:e.jsxs("div",{children:[e.jsx("p",{children:h.message}),e.jsxs("p",{style:{marginTop:"0.5rem"},children:[e.jsx("strong",{children:"Date prévue:"})," ",h.scheduledDate.toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]})]}),actions:h.canCancel&&e.jsx(B,{variant:"secondary",onClick:O,loading:d,icon:e.jsx(fe,{size:18}),children:"Annuler la suppression"})}),e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsx(w,{className:"p-6 bg-gradient-to-br from-green-500/10 to-emerald-500/5 border border-green-500/20",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(b,{Icon:f.Shield,size:32,color:"#22C55E",variant:"pure"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-3",children:"Vos données sont strictement confidentielles et ultra-protégées"}),e.jsxs("ul",{className:"space-y-2 text-sm text-slate-300",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(M,{size:18,className:"text-green-400 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Chiffrement de bout en bout:"})," Toutes vos données sensibles sont chiffrées avant stockage"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(M,{size:18,className:"text-green-400 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Accès strictement limité:"})," Seul vous avez accès à vos données personnelles et métriques"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(M,{size:18,className:"text-green-400 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Conformité RGPD:"})," Nous respectons vos droits d'accès, de rectification et de suppression"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(M,{size:18,className:"text-green-400 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Aucun partage:"})," Vos données ne sont jamais partagées avec des tiers à des fins commerciales"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(M,{size:18,className:"text-green-400 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Contrôle total:"})," Vous pouvez exporter ou supprimer vos données à tout moment"]})]})]})]})]})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Gérer votre confidentialité"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Contrôlez vos préférences de confidentialité et gérez vos données personnelles en toute transparence."})]}),e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.1},children:e.jsxs(w,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-6",children:[e.jsx(b,{Icon:f.Shield,size:24,color:"#18E3FF",variant:"pure"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-base font-semibold text-white mb-1",children:"Préférences de confidentialité"}),e.jsx("p",{className:"text-xs text-slate-400 leading-relaxed",children:"Contrôlez comment vos données sont utilisées"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("label",{className:"block text-sm font-medium text-white mb-2",children:"Durée de conservation des données"}),e.jsxs("select",{value:t.data_retention_preference,onChange:a=>E("data_retention_preference",a.target.value,s),disabled:l,className:"w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500/50",children:[e.jsx("option",{value:"minimal",children:"Minimale (30 jours)"}),e.jsx("option",{value:"standard",children:"Standard (2 ans)"}),e.jsx("option",{value:"extended",children:"Étendue (indéfinie)"})]}),e.jsx("p",{className:"text-xs text-slate-400 mt-2",children:"Choisissez combien de temps nous conservons vos données historiques"})]}),e.jsx($,{label:"Suivi analytique",description:"Nous aide à améliorer l'application en analysant votre utilisation de manière anonymisée",enabled:t.analytics_tracking_enabled,onChange:a=>E("analytics_tracking_enabled",a,s),disabled:l,loading:d}),e.jsx($,{label:"Communications marketing",description:"Recevez des actualités, conseils et offres promotionnelles",enabled:t.marketing_communications_enabled,onChange:a=>E("marketing_communications_enabled",a,s),disabled:l,loading:d})]})]})}),e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.2},children:e.jsxs(w,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-6",children:[e.jsx(b,{Icon:f.Download,size:24,color:"#60A5FA",variant:"pure"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-base font-semibold text-white mb-1",children:"Export de vos données"}),e.jsx("p",{className:"text-xs text-slate-400 leading-relaxed",children:"Téléchargez une copie complète de vos données (droit à la portabilité RGPD)"})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx(I,{type:"info",message:"Sélectionnez les catégories de données que vous souhaitez exporter. Le fichier sera disponible pendant 7 jours."})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-4",children:ae.map(a=>e.jsxs("label",{className:"flex items-start gap-3 p-3 rounded-lg bg-white/5 border border-white/10 cursor-pointer hover:bg-white/10 transition-all",children:[e.jsx("input",{type:"checkbox",checked:m.includes(a.category),onChange:()=>U(a.category),className:"mt-0.5 w-4 h-4 rounded border-white/20 bg-white/10 text-cyan-500 focus:ring-cyan-500/50"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-white",children:a.label}),e.jsx("span",{className:"text-xs text-slate-400",children:a.estimatedSize})]}),e.jsx("p",{className:"text-xs text-slate-400 leading-relaxed",children:a.description})]})]},a.category))}),e.jsxs("div",{className:"p-4 rounded-lg bg-white/5 border border-white/10 mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"Taille estimée:"}),e.jsx("span",{className:"font-semibold text-white",children:W})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm mt-2",children:[e.jsx("span",{className:"text-slate-400",children:"Format:"}),e.jsx("span",{className:"font-semibold text-white",children:"JSON"})]})]}),e.jsx(B,{onClick:L,loading:d,disabled:m.length===0,icon:e.jsx(te,{size:18}),fullWidth:!0,children:"Demander un export"}),n.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h5",{className:"text-sm font-semibold text-white mb-3",children:"Exports récents"}),e.jsx("div",{className:"space-y-2",children:n.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm text-white",children:new Date(a.requested_at).toLocaleDateString()}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded ${a.status==="completed"?"bg-green-500/20 text-green-400":a.status==="processing"?"bg-blue-500/20 text-blue-400":a.status==="failed"?"bg-red-500/20 text-red-400":"bg-yellow-500/20 text-yellow-400"}`,children:[a.status==="completed"&&"Prêt",a.status==="processing"&&"En cours",a.status==="pending"&&"En attente",a.status==="failed"&&"Échec"]})]}),a.file_size_bytes&&e.jsx("span",{className:"text-xs text-slate-400",children:ke(a.file_size_bytes)})]}),a.status==="completed"&&a.file_url&&e.jsx(B,{variant:"secondary",onClick:()=>V(a.id),icon:e.jsx(te,{size:16}),children:"Télécharger"})]},a.id))})]})]})}),!r&&e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.3},children:e.jsxs(w,{className:"p-6 border border-red-500/20",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-6",children:[e.jsx(b,{Icon:f.Trash,size:24,color:"#EF4444",variant:"pure"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-base font-semibold text-white mb-1",children:"Suppression de compte"}),e.jsx("p",{className:"text-xs text-slate-400 leading-relaxed",children:"Supprimer définitivement votre compte et toutes vos données"})]})]}),e.jsx(I,{type:"warning",title:"Action irréversible",message:e.jsxs("div",{children:[e.jsx("p",{className:"mb-2",children:"La suppression de votre compte entraînera:"}),e.jsxs("ul",{className:"space-y-1 text-sm",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-red-400 mt-0.5",children:"•"}),e.jsx("span",{children:"Suppression de toutes vos données personnelles"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-red-400 mt-0.5",children:"•"}),e.jsx("span",{children:"Perte définitive de votre progression"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-red-400 mt-0.5",children:"•"}),e.jsx("span",{children:"Annulation de vos abonnements"})]})]}),e.jsxs("p",{className:"mt-3 text-xs",children:[e.jsx("strong",{children:"Délai de grâce:"})," Vous aurez 30 jours pour annuler cette demande."]})]})}),C?e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white mb-2",children:"Pourquoi souhaitez-vous supprimer votre compte? (optionnel)"}),e.jsx("textarea",{value:k,onChange:a=>S(a.target.value),placeholder:"Raison de la suppression...",rows:3,className:"w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white text-sm focus:outline-none focus:ring-2 focus:ring-red-500/50 placeholder-slate-500"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(B,{variant:"ghost",onClick:()=>{T(!1),S("")},fullWidth:!0,children:"Annuler"}),e.jsx(B,{variant:"danger",onClick:A,loading:d,icon:e.jsx(be,{size:18}),fullWidth:!0,children:"Confirmer la suppression"})]})]}):e.jsx(B,{variant:"danger",onClick:()=>T(!0),icon:e.jsx(ge,{size:18}),fullWidth:!0,children:"Demander la suppression du compte"})]})}),e.jsx(w,{className:"p-6 bg-gradient-to-br from-blue-500/5 to-purple-500/5",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(b,{Icon:f.Info,size:20,color:"#60A5FA",variant:"pure"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-semibold text-white mb-2",children:"Vos droits RGPD"}),e.jsxs("ul",{className:"text-xs text-slate-400 leading-relaxed space-y-2",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-cyan-400 mt-0.5",children:"•"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Droit d'accès:"})," Consultez toutes vos données stockées à tout moment"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-cyan-400 mt-0.5",children:"•"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Droit de rectification:"})," Modifiez vos informations personnelles depuis votre profil"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-cyan-400 mt-0.5",children:"•"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Droit à la portabilité:"})," Exportez vos données dans un format standard"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-cyan-400 mt-0.5",children:"•"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Droit à l'oubli:"})," Supprimez votre compte et toutes vos données définitivement"]})]})]})]})]})}),l&&!c&&e.jsx(I,{type:"info",message:"Chargement des paramètres de confidentialité..."})]})},q={free:{color:"#64748B",gradient:"linear-gradient(135deg, #64748B, #475569)",borderColor:"rgba(100, 116, 139, 0.3)",label:"Essai Gratuit"},starter_9:{color:"#3B82F6",gradient:"linear-gradient(135deg, #3B82F6, #60A5FA)",borderColor:"rgba(59, 130, 246, 0.3)",label:"Starter"},pro_19:{color:"#10B981",gradient:"linear-gradient(135deg, #10B981, #34D399)",borderColor:"rgba(16, 185, 129, 0.3)",label:"Pro"},premium_29:{color:"#F97316",gradient:"linear-gradient(135deg, #F97316, #FB923C)",borderColor:"rgba(249, 115, 22, 0.3)",label:"Premium"},elite_39:{color:"#EC4899",gradient:"linear-gradient(135deg, #EC4899, #F472B6)",borderColor:"rgba(236, 72, 153, 0.3)",label:"Elite"},expert_49:{color:"#EF4444",gradient:"linear-gradient(135deg, #EF4444, #F87171)",borderColor:"rgba(239, 68, 68, 0.3)",label:"Expert"},master_59:{color:"#8B5CF6",gradient:"linear-gradient(135deg, #8B5CF6, #A78BFA)",borderColor:"rgba(139, 92, 246, 0.3)",label:"Master"},ultimate_99:{color:"#FBBF24",gradient:"linear-gradient(135deg, #FBBF24, #FCD34D)",borderColor:"rgba(251, 191, 36, 0.3)",label:"Ultimate"}},He=(u,s)=>u==="free"?q.free:s===9?q.starter_9:s===19?q.pro_19:s===29?q.premium_29:s===39?q.elite_39:s===49?q.expert_49:s===59?q.master_59:s===99?q.ultimate_99:q.free,Ge=({planId:u,name:s,priceEur:t,tokensPerMonth:r,isCurrentPlan:n,isFree:l,onSelect:d,isLoading:c})=>{const p=He(u,t);return e.jsx(Ne,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative",children:e.jsxs(w,{className:`p-5 transition-all cursor-pointer ${n?"ring-2 scale-[1.05] shadow-2xl":"hover:scale-[1.02]"}`,style:{background:n?`${p.gradient.replace("linear-gradient","linear-gradient(135deg, ")}35, ${p.gradient.split(", ")[1]}20)`:`${p.gradient.replace("linear-gradient","linear-gradient(135deg, ")}20, ${p.gradient.split(", ")[1]}10)`,borderColor:n?`${p.color}80`:p.borderColor,boxShadow:n?`0 0 40px ${p.color}40, 0 8px 32px rgba(0, 0, 0, 0.3)`:void 0},onClick:()=>!n&&!c&&d(u),children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h3",{className:`text-lg font-bold text-white mb-1 ${n?"text-xl":""}`,children:p.label}),l&&e.jsx("p",{className:"text-xs text-slate-400",children:"Découvrez l'application"})]}),e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx(X,{size:48,variant:n?"success":"normal",withGlow:n,customColor:p.color})}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"text-3xl font-bold text-white mb-1",children:l?"Gratuit":`${t}€`}),e.jsx("div",{className:"text-xs text-slate-400",children:l?"À l'inscription":"par mois"})]}),e.jsxs("div",{className:"mb-4 py-3 px-4 rounded-lg border text-center",style:{background:"rgba(255, 255, 255, 0.05)",borderColor:p.borderColor},children:[e.jsx("div",{className:"text-2xl font-bold text-white mb-1",children:R.formatTokenAmount(r)}),e.jsx("div",{className:"text-xs text-slate-400",children:"tokens / mois"})]}),n&&e.jsx("div",{className:"mt-4 py-2 px-4 rounded-lg text-center font-bold text-sm",style:{background:`linear-gradient(135deg, ${p.color}30, ${p.color}20)`,border:`2px solid ${p.color}60`,color:"#ffffff",textShadow:`0 0 8px ${p.color}`},children:"✓ Plan Actuel"}),!n&&!l&&e.jsx("button",{onClick:E=>{E.stopPropagation(),d(u)},disabled:c,className:"w-full px-4 py-2.5 rounded-lg font-semibold text-white text-sm transition-all disabled:opacity-50",style:{background:p.gradient},children:c?"Chargement...":"Choisir ce plan"}),l&&!n&&e.jsx("div",{className:"text-center text-xs text-slate-500",children:"Plan offert à l'inscription"})]})})},Xe=()=>{const{showToast:u}=J(),{mode:s}=de(),[t,r]=v.useState(null),[n,l]=v.useState(null),[d,c]=v.useState(null),[p,E]=v.useState([]),[N,D]=v.useState(!0),[x,_]=v.useState(!1),[g,o]=v.useState(!1),m=s==="high-performance";v.useEffect(()=>{y()},[]);const y=async()=>{D(!0);try{const[h,a,j,F]=await Promise.all([R.getTokenBalance(),R.getUserSubscription(),R.getPricingConfig(),R.getTokenTransactions(20)]);r(h),l(a),c(j),E(F),j?.subscriptionPlans&&(console.log("Loaded subscription plans:",j.subscriptionPlans),Object.entries(j.subscriptionPlans).forEach(([ue,me])=>{console.log(`Plan ${ue}:`,me)}))}catch(h){console.error("Error loading subscription data:",h),u({type:"error",title:"Erreur",message:"Impossible de charger les données",duration:3e3})}finally{D(!1)}},C=async h=>{if(!x){_(!0);try{const a=await R.createCheckoutSession("subscription",h);if(a?.url)window.location.href=a.url;else throw new Error("Failed to create checkout session")}catch(a){console.error("Error creating checkout session:",a),u({type:"error",title:"Erreur",message:"Impossible de créer la session de paiement",duration:3e3}),_(!1)}}},T=async h=>{if(!x){_(!0);try{const a=await R.createCheckoutSession("payment",void 0,h);if(a?.url)window.location.href=a.url;else throw new Error("Failed to create checkout session")}catch(a){console.error("Error creating checkout session:",a),u({type:"error",title:"Erreur",message:"Impossible de créer la session de paiement",duration:3e3}),_(!1)}}};if(N)return e.jsx("div",{className:"space-y-6",children:e.jsx(w,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-center h-40",children:e.jsx("div",{className:"text-slate-400",children:"Chargement..."})})})});const k=n?.planType||"free",S=d?.subscriptionPlans||{},A=(()=>{if(!n||n.status!=="trialing")return null;const h=n.trialEnd?new Date(n.trialEnd):null;if(!h)return null;const a=new Date,j=h.getTime()-a.getTime(),F=Math.ceil(j/(1e3*60*60*24));return F>0?F:0})(),O=["starter_9","pro_19","premium_29","elite_39","expert_49","master_59","ultimate_99","free"],V=Object.entries(S).sort(([h],[a])=>{const j=O.indexOf(h),F=O.indexOf(a);return j===-1?1:F===-1?-1:j-F}),U=d?.tokenPacks?.pack_19,W=g?p:p.slice(0,5);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(w,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"rounded-xl p-5 border",style:m?{background:"rgba(247, 147, 30, 0.15)",borderColor:"rgba(247, 147, 30, 0.3)"}:{background:"linear-gradient(135deg, rgba(255, 107, 53, 0.1), rgba(253, 200, 48, 0.05))",borderColor:"rgba(247, 147, 30, 0.3)",boxShadow:"0 4px 16px rgba(247, 147, 30, 0.1)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-xs text-slate-400 font-medium",children:"Tokens Disponibles"}),e.jsx(X,{size:24,variant:"success",withGlow:!1})]}),e.jsx("div",{className:"text-4xl font-bold mb-1",style:m?{color:"#F7931E"}:{background:"linear-gradient(135deg, #FF6B35 0%, #F7931E 50%, #FDC830 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:t?R.formatTokenAmount(t.balance):"0"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Votre réserve d'énergie numérique"})]}),e.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-5 border border-slate-700/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-xs text-slate-400 font-medium",children:"Statut"}),e.jsx(b,{Icon:n?.status==="active"?f.Check:f.Clock,size:20,color:n?.status==="active"?"#10B981":"#3B82F6",variant:"pure"})]}),e.jsx("div",{className:`text-3xl font-bold mb-1 ${n?.status==="active"?"text-emerald-400":"text-blue-400"}`,children:n?.status==="active"?"Actif":"Essai Gratuit"}),e.jsx("div",{className:"text-xs text-slate-500",children:n?.status==="active"?`Renouvellement le ${ne(new Date(n.currentPeriodEnd),"dd/MM/yyyy",{locale:oe})}`:A!==null?`${A} ${A>1?"jours restants":"jour restant"} sur 14`:"15 000 tokens offerts pour découvrir l'app"})]})]})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Forfaits Mensuels"}),e.jsx("p",{className:"text-sm text-slate-400 mb-6",children:"Choisissez le forfait qui correspond à votre utilisation. Vos tokens sont renouvelés automatiquement chaque mois."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:V.map(([h,a])=>a?e.jsx(Ge,{planId:h,name:a.name||h,priceEur:a.price_eur||0,tokensPerMonth:a.tokens_per_month||0,isCurrentPlan:k===h,isFree:h==="free",onSelect:C,isLoading:x},h):(console.warn(`Plan ${h} is undefined`),null))})]}),U&&e.jsx(w,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(X,{size:48,variant:"warning",withGlow:!1})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-2",children:"Besoin de tokens supplémentaires ?"}),e.jsx("p",{className:"text-sm text-slate-400 mb-4",children:"Rechargez votre réserve à tout moment avec un pack de tokens. Les tokens achetés sont permanents et s'ajoutent à votre solde mensuel."}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"px-4 py-2 rounded-lg border",style:{background:"rgba(247, 147, 30, 0.1)",borderColor:"rgba(247, 147, 30, 0.3)"},children:e.jsxs("div",{className:"text-sm font-semibold text-white",children:[R.formatTokenAmount(U.tokens)," tokens"]})}),e.jsx("button",{onClick:()=>T("pack_19"),disabled:x,className:"px-6 py-2 rounded-lg font-semibold text-white text-sm transition-all disabled:opacity-50",style:{background:"linear-gradient(135deg, #FF6B35, #F7931E)"},children:x?"Chargement...":`Acheter pour ${R.formatCurrency(U.price_eur)}`})]})]})]})}),p.length>0&&e.jsxs(w,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(b,{Icon:f.History,size:24,color:"#60A5FA",variant:"pure"}),e.jsx("h3",{className:"text-lg font-bold text-white",children:"Historique des Transactions"})]}),p.length>5&&e.jsx("button",{onClick:()=>o(!g),className:"text-xs text-blue-400 hover:text-blue-300 transition-colors",children:g?"Voir moins":`Voir tout (${p.length})`})]}),e.jsx("div",{className:"space-y-2",children:W.map(h=>e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 bg-slate-800/30 rounded-lg border border-slate-700/30",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx(X,{size:28,variant:h.transactionType==="consume"?"warning":"success",withGlow:!1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-white mb-1",children:h.operationType?R.getOperationTypeLabel(h.operationType):h.source||"Transaction"}),e.jsx("div",{className:"text-xs text-slate-500",children:ne(new Date(h.createdAt),"dd MMM yyyy HH:mm",{locale:oe})})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`text-sm font-bold ${h.transactionType==="consume"?"text-red-400":"text-emerald-400"}`,children:[h.transactionType==="consume"?"-":"+",h.amount]}),e.jsxs("div",{className:"text-xs text-slate-500",children:["Solde: ",h.balanceAfter]})]})]},h.id))})]}),e.jsx(w,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(b,{Icon:f.Info,size:20,color:"#60A5FA",variant:"pure"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-semibold text-white mb-3",children:"Comment fonctionnent les forfaits ?"}),e.jsxs("div",{className:"space-y-3 text-xs text-slate-400",children:[e.jsxs("p",{children:[e.jsx("strong",{className:"text-white",children:"Renouvellement automatique :"})," Vos tokens sont renouvelés automatiquement chaque mois à la date anniversaire de votre abonnement."]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-white",children:"Tokens non utilisés :"})," Les tokens non utilisés d'un mois ne sont pas reportés. Choisissez le forfait adapté à votre utilisation réelle."]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-white",children:"Changement de forfait :"})," Vous pouvez changer de forfait à tout moment. Le changement prendra effet lors du prochain renouvellement."]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-white",children:"Annulation :"})," Vous pouvez annuler votre abonnement à tout moment. Vous conserverez l'accès jusqu'à la fin de la période en cours."]})]})]})]})})]})},os=()=>{const u=Ee.settings,[s]=je(),t=s.get("tab"),r=t&&u.tabs.find(c=>c.value===t)?t:u.tabs[0].value,[n,l]=v.useState(r);v.useEffect(()=>{t&&u.tabs.find(c=>c.value===t)&&l(t)},[t,u.tabs]);const d=u.tabs.find(c=>c.value===n)||u.tabs[0];return e.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"},className:"space-y-6",style:{"--settings-active-color":d.color||u.color},children:[e.jsx(we,{icon:d.icon||u.icon,title:d.label,subtitle:d.description,circuit:u.circuit,iconColor:d.color||u.color}),e.jsxs(G,{value:n,defaultValue:r,className:"w-full settings-tabs",onValueChange:c=>l(c),children:[e.jsx(G.List,{role:"tablist","aria-label":"Sections des Réglages",className:"mb-6 w-full",children:u.tabs.map(c=>e.jsx(G.Trigger,{value:c.value,icon:c.icon,children:e.jsx("span",{className:"tab-text",children:c.label})},c.value))}),u.tabs.map(c=>e.jsx(G.Panel,{value:c.value,children:c.value==="preferences"?e.jsx(Re,{}):c.value==="notifications"?e.jsx(Le,{}):c.value==="appareils"?e.jsx(ze,{}):c.value==="performance"?e.jsxs("div",{className:"space-y-8",children:[e.jsx(Fe,{}),e.jsx(Be,{})]}):c.value==="confidentialite"?e.jsx(Me,{}):c.value==="account"?e.jsx(Xe,{}):e.jsx(w,{className:"p-6",children:e.jsx(_e,{title:c.label,description:c.description,icon:c.icon,color:u.color,features:c.features})})},c.value))]})]})};export{os as default};
