import{l as h}from"./page-fridge-C1QVLxk9.js";import{g as p,s as m,h as d,f as g}from"./date-utils-BlBdbPk_.js";import"./vendor-ZbFMzY-i.js";import"./utils-CUtLAp28.js";import"./supabase-8_3juhcZ.js";import"./stores-ZZM8MTtI.js";import"./ui-components-OHztaiDj.js";import"./motion-HGAT--uT.js";import"./page-fridge-scan-C_CisW7P.js";function v(s){switch(s){case"last7Days":return 3;case"last30Days":return 8;case"last3Months":return 20;case"last6Months":return 35;case"last1Year":return 60;default:return 3}}function f(s){const t=p(new Date);let n,e;switch(s){case"last7Days":n=m(d(t,6)),e=7;break;case"last30Days":n=m(d(t,29)),e=30;break;case"last3Months":n=m(d(t,89)),e=90;break;case"last6Months":n=m(d(t,179)),e=180;break;case"last1Year":n=m(d(t,364)),e=365;break;default:n=m(d(t,6)),e=7}return{startDate:n,endDate:t,totalDays:e}}function S(s,t){const n=s.length,e=s.reduce((i,_)=>i+_.duration_min,0),l=s.reduce((i,_)=>i+_.calories_est,0),u={};s.forEach(i=>{u[i.type]=(u[i.type]||0)+1});const r=Object.entries(u).sort((i,_)=>_[1]-i[1])[0]?.[0]||"Aucune",o=s.reduce((i,_)=>!i||_.calories_est>i.calories_est?_:i,null),a=new Set(s.map(i=>g(new Date(i.timestamp),"yyyy-MM-dd"))).size,c=Math.round(a/t*100);return{total_activities:n,total_duration_min:e,total_calories:l,avg_duration_min:n>0?Math.round(e/n):0,avg_calories_per_activity:n>0?Math.round(l/n):0,most_common_activity:r,most_intense_workout:o?{type:o.type,calories:o.calories_est,date:g(new Date(o.timestamp),"dd/MM/yyyy")}:void 0,consistency_score:c,days_with_activity:a,total_days_in_period:t}}function D(s,t,n){const e=[];t.consistency_score>=70?e.push({type:"success",title:"Excellente régularité",message:`Vous avez été actif ${t.days_with_activity} jours sur ${t.total_days_in_period}. Votre constance est remarquable !`,metric:"consistency_score",value:t.consistency_score}):t.consistency_score>=40?e.push({type:"info",title:"Régularité modérée",message:`Vous avez été actif ${t.days_with_activity} jours sur ${t.total_days_in_period}. Essayez d'augmenter votre fréquence pour de meilleurs résultats.`,metric:"consistency_score",value:t.consistency_score}):e.push({type:"warning",title:"Activité irrégulière",message:`Vous avez été actif seulement ${t.days_with_activity} jours sur ${t.total_days_in_period}. Une pratique plus régulière améliorerait vos progrès.`,metric:"consistency_score",value:t.consistency_score});const l=150,u=t.total_days_in_period/7,r=t.total_duration_min/u;if(r>=l)e.push({type:"success",title:"Objectif hebdomadaire atteint",message:`Vous faites en moyenne ${Math.round(r)} minutes d'activité par semaine, dépassant l'objectif recommandé de ${l} minutes.`,metric:"weekly_duration",value:Math.round(r)});else{const i=l-r;e.push({type:"recommendation",title:"Augmentez votre volume d'entraînement",message:`Vous faites ${Math.round(r)} minutes par semaine. Ajoutez ${Math.round(i)} minutes pour atteindre l'objectif recommandé.`,metric:"weekly_duration",value:Math.round(r)})}const o=new Set(s.map(i=>i.type)).size;o>=4?e.push({type:"success",title:"Excellente variété d'activités",message:`Vous pratiquez ${o} types d'activités différents. Cette diversité est excellente pour votre condition physique globale.`,metric:"activity_variety",value:o}):o<=2&&e.push({type:"recommendation",title:"Diversifiez vos activités",message:`Vous pratiquez principalement ${t.most_common_activity}. Essayez d'ajouter d'autres types d'exercices pour un entraînement plus complet.`,metric:"activity_variety",value:o});const a=s.filter(i=>i.intensity==="high"||i.intensity==="very_high").length/s.length*100;a>=30?e.push({type:"success",title:"Bon équilibre d'intensité",message:`${Math.round(a)}% de vos séances sont à haute intensité. Cet équilibre favorise les progrès cardiovasculaires.`,metric:"high_intensity_percentage",value:Math.round(a)}):a<15&&e.push({type:"recommendation",title:"Augmentez l'intensité",message:`Seulement ${Math.round(a)}% de vos séances sont intenses. Intégrez des entraînements à haute intensité pour optimiser vos résultats.`,metric:"high_intensity_percentage",value:Math.round(a)});const c=s.filter(i=>i.wearable_device_id).length;if(c>0){const i=c/s.length*100;e.push({type:"info",title:"Données biométriques enrichies",message:`${Math.round(i)}% de vos activités sont synchronisées avec votre montre. Les données cardiaques enrichissent l'analyse.`,metric:"wearable_percentage",value:Math.round(i)})}return e}async function $(s,t,n){h.info("LOCAL_INSIGHTS_PROCESSOR","Generating local fallback insights",{userId:s,period:t,timestamp:new Date().toISOString()});try{const{startDate:e,endDate:l,totalDays:u}=f(t),r=v(t),{data:o,error:y}=await n.from("activities").select("*").eq("user_id",s).gte("timestamp",e.toISOString()).lte("timestamp",l.toISOString()).order("timestamp",{ascending:!1});if(y)throw h.error("LOCAL_INSIGHTS_PROCESSOR","Failed to fetch activities",{error:y.message,userId:s,period:t,timestamp:new Date().toISOString()}),y;const a=o?.length||0;if(h.info("LOCAL_INSIGHTS_PROCESSOR","Activities fetched successfully",{userId:s,period:t,currentActivities:a,minActivities:r,startDate:e.toISOString(),endDate:l.toISOString(),timestamp:new Date().toISOString()}),a<r)return{insights:[],summary:{total_activities:a,total_duration_min:0,total_calories:0,avg_duration_min:0,avg_calories_per_activity:0,most_common_activity:"Aucune",consistency_score:0,days_with_activity:0,total_days_in_period:u},current_activities:a,required_activities:r,insufficient_data:!0,fallback:!0,cached:!1,period:t};const c=S(o,u),i=D(o,c,t);return h.info("LOCAL_INSIGHTS_PROCESSOR","Local insights generated successfully",{userId:s,period:t,currentActivities:a,insightsCount:i.length,summaryStats:{totalActivities:c.total_activities,totalDuration:c.total_duration_min,totalCalories:c.total_calories,consistencyScore:c.consistency_score},timestamp:new Date().toISOString()}),{insights:i,summary:c,current_activities:a,required_activities:r,insufficient_data:!1,fallback:!0,cached:!1,period:t}}catch(e){throw h.error("LOCAL_INSIGHTS_PROCESSOR","Failed to generate local insights",{error:e instanceof Error?e.message:"Unknown error",userId:s,period:t,timestamp:new Date().toISOString()}),e}}export{$ as generateLocalActivityInsights,v as getMinimumActivitiesForPeriod};
