import{e as ne,b as $,R as T,j as e,u as D,r as _,c as oe,h as le}from"./vendor-ZbFMzY-i.js";import{G as b,N as u,S as o,I as n,O as ce,P as de,o as me,q as M}from"./ui-components-OHztaiDj.js";import{u as xe}from"./useScrollMemory-C-cdMoIK.js";import{l as y,s as G,a as C,u as Y,n as pe}from"./page-fridge-C1QVLxk9.js";import{A as X}from"./Avatar3DViewer-Br1Jt5km.js";import{a as z}from"./stores-ZZM8MTtI.js";import{m as I,A as P}from"./motion-HGAT--uT.js";import{g as J}from"./page-fridge-scan-C_CisW7P.js";import{f as L,a as H}from"./date-utils-BlBdbPk_.js";import"./utils-CUtLAp28.js";import"./supabase-8_3juhcZ.js";import"./mobileDetection-qVCXVKdX.js";import"./signedUrlService-DzLcvpbH.js";import"./normalizeSkinTone---q_oCYc.js";import"./debugFlags-CvPyqWqQ.js";function ge(){const{profile:s}=z(),r=ne(),i=s?.userId,a=$({queryKey:["body-scan-data",i],queryFn:async()=>{if(!i)return y.debug("USE_BODY_SCAN_DATA","No user ID available",{philosophy:"no_user_id"}),null;y.info("USE_BODY_SCAN_DATA","Fetching latest body scan",{userId:i,philosophy:"body_scan_fetch_start"});const{data:c,error:l}=await G.from("body_scans").select("*").eq("user_id",i).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(l)throw y.error("USE_BODY_SCAN_DATA","Error fetching body scan",{userId:i,error:l.message,philosophy:"body_scan_fetch_error"}),l;if(!c)return y.info("USE_BODY_SCAN_DATA","No body scan found",{userId:i,philosophy:"no_body_scan"}),null;const m=c.metrics||{},t=c.morph_values||c.morph3d||m.final_shape_params||{},v=c.limb_masses||m.final_limb_masses||{},f=c.skin_tone_map_v2||m.skin_tone||c.skin_tone||null,p=c.resolved_gender||m.resolved_gender||null,j=m.estimate_result?.extracted_data||{},x=c.raw_measurements||j.raw_measurements||{},h=c.weight||x.weight_kg||j.weight_kg||null,S=c.body_fat_percentage||j.estimated_body_fat_perc||null,N=c.bmi||j.estimated_bmi||null,w=c.waist_circumference||x.waist_cm||null;return y.info("USE_BODY_SCAN_DATA","Body scan loaded successfully",{userId:i,scanId:c.id,timestamp:c.timestamp,hasMorphValues:!!t&&Object.keys(t).length>0,morphValuesCount:Object.keys(t).length,morphValuesSource:c.morph_values?"direct_column":m.final_shape_params?"metrics_jsonb":"none",hasLimbMasses:!!v&&Object.keys(v).length>0,limbMassesCount:Object.keys(v).length,limbMassesSource:c.limb_masses?"direct_column":m.final_limb_masses?"metrics_jsonb":"none",hasSkinTone:!!f,skinToneSource:c.skin_tone_map_v2?"v2_direct_column":m.skin_tone?"metrics_jsonb":c.skin_tone?"legacy_column":"none",hasResolvedGender:!!p,resolvedGenderValue:p,resolvedGenderSource:c.resolved_gender?"direct_column":m.resolved_gender?"metrics_jsonb":"none",hasWeight:!!h,weight:h,hasBodyFat:!!S,bodyFatPercentage:S,hasBMI:!!N,bmi:N,hasWaist:!!w,waistCircumference:w,avatarVersion:c.avatar_version||m.avatar_version||"unknown",gltfModelId:c.gltf_model_id||m.gltf_model_id||"unknown",philosophy:"body_scan_loaded_with_extraction"}),{...c,morph_values:t,limb_masses:v,skin_tone:f,resolved_gender:p,weight:h,body_fat_percentage:S,bmi:N,waist_circumference:w,raw_measurements:x}},enabled:!!i,staleTime:5*60*1e3,gcTime:30*60*1e3,refetchOnMount:"always",refetchOnWindowFocus:!1}),d=()=>{y.info("USE_BODY_SCAN_DATA","Invalidating body scan data cache",{userId:i,philosophy:"cache_invalidation"}),r.invalidateQueries({queryKey:["body-scan-data",i]})},g=c=>{y.info("USE_BODY_SCAN_DATA","Updating body scan data cache manually",{userId:i,scanId:c.id,philosophy:"manual_cache_update"}),r.setQueryData(["body-scan-data",i],c)};return{bodyScanData:a.data,isLoading:a.isLoading,isError:a.isError,error:a.error,refetch:a.refetch,invalidateBodyScanData:d,updateBodyScanDataCache:g}}function ue(s,r,i){const a=[],d=i.weight_kg/Math.pow(i.height_cm/100,2),g=s.pearFigure||0,c=Math.abs(s.narrowWaist||0),l=s.bigHips||0;let m;g>.3||l>.3?m={id:"silhouette-curves",title:"Silhouette Harmonieuse",description:"Vos courbes naturelles cr√©ent une silhouette √©quilibr√©e et f√©minine",icon:"Heart",color:"#EC4899",value:"Courbes",category:"silhouette"}:c>.3?m={id:"silhouette-athletic",title:"Taille D√©finie",description:"Votre taille marqu√©e r√©v√®le une silhouette athl√©tique et structur√©e",icon:"Target",color:"#10B981",value:"Athl√©tique",category:"silhouette"}:m={id:"silhouette-balanced",title:"Silhouette √âquilibr√©e",description:"Vos proportions naturelles cr√©ent une harmonie corporelle parfaite",icon:"Circle",color:"#06B6D4",value:"√âquilibr√©e",category:"silhouette"},a.push(m);const t=s.bodybuilderSize||0,v=s.bodybuilderDetails||0,f=s.emaciated||0;let p;t>.3||v>.3?p={id:"development-muscular",title:"D√©veloppement Musculaire",description:"Votre masse musculaire t√©moigne d'un excellent travail physique",icon:"Zap",color:"#8B5CF6",value:"D√©velopp√©",category:"development"}:f<-.3?p={id:"development-lean",title:"Composition Lean",description:"Votre physique fin r√©v√®le une excellente d√©finition musculaire",icon:"TrendingUp",color:"#F59E0B",value:"D√©fini",category:"development"}:p={id:"development-natural",title:"Tonus Naturel",description:"Votre d√©veloppement musculaire naturel offre une base solide",icon:"Activity",color:"#22C55E",value:"Naturel",category:"development"},a.push(p);let j;d<18.5?j={id:"composition-lean",title:"M√©tabolisme Rapide",description:"Votre composition r√©v√®le un m√©tabolisme efficace et dynamique",icon:"Zap",color:"#06B6D4",value:"Dynamique",category:"composition"}:d>=18.5&&d<25?j={id:"composition-optimal",title:"Composition Optimale",description:"Votre √©quilibre masse/taille se situe dans la zone id√©ale",icon:"Check",color:"#10B981",value:"Optimale",category:"composition"}:d>=25&&d<30?j={id:"composition-robust",title:"Constitution Robuste",description:"Votre morphologie r√©v√®le une constitution solide et puissante",icon:"Shield",color:"#F59E0B",value:"Robuste",category:"composition"}:j={id:"composition-powerful",title:"Potentiel de Transformation",description:"Votre morphologie actuelle offre un excellent potentiel d'√©volution",icon:"TrendingUp",color:"#8B5CF6",value:"√âvolutif",category:"composition"},a.push(j);const x=s.assLarge||0,h=s.superBreast||0,S=s.breastsSmall||0;let N;return r==="female"&&(h>.2||S>.2)?N={id:"balance-feminine",title:"F√©minit√© Naturelle",description:"Vos attributs f√©minins cr√©ent une harmonie corporelle unique",icon:"Heart",color:"#EC4899",value:"F√©minine",category:"balance"}:x>.2?N={id:"balance-curves",title:"√âquilibre des Volumes",description:"La r√©partition de vos volumes cr√©e une silhouette harmonieuse",icon:"Circle",color:"var(--color-body-scan-primary)",value:"Harmonieuse",category:"balance"}:N={id:"balance-symmetrical",title:"Sym√©trie Parfaite",description:"Votre morphologie pr√©sente un √©quilibre naturel remarquable",icon:"GitCompare",color:"var(--color-body-scan-accent)",value:"Sym√©trique",category:"balance"},a.push(N),a}const ee=T.memo(({finalShapeParams:s,resolvedGender:r,userProfile:i})=>{const{isPerformanceMode:a}=C(),d=T.useMemo(()=>ue(s,r,i),[s,r,i]);return e.jsx(b,{className:"p-6",style:{background:`
          radial-gradient(circle at 30% 20%, color-mix(in srgb, #06B6D4 8%, transparent) 0%, transparent 60%),
          var(--glass-opacity-base)
        `,borderColor:"color-mix(in srgb, #06B6D4 25%, transparent)",boxShadow:`
          var(--glass-shadow-sm),
          0 0 16px color-mix(in srgb, #06B6D4 10%, transparent)
        `},children:e.jsxs(u,{className:"slide-enter",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:a?0:.3},children:[e.jsxs("div",{className:"bodyscan-flex-between mb-6",children:[e.jsxs("h4",{className:"text-white font-semibold bodyscan-flex-center bodyscan-gap-sm",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                  linear-gradient(135deg, color-mix(in srgb, #06B6D4 35%, transparent), color-mix(in srgb, #06B6D4 25%, transparent))
                `,border:"2px solid color-mix(in srgb, #06B6D4 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #06B6D4 30%, transparent)"},children:e.jsx(o,{Icon:n.Zap,size:20,style:{color:"#06B6D4"},variant:"pure"})}),"Votre Profil Morphologique"]}),e.jsxs("div",{className:"bodyscan-status-badge bodyscan-status-badge--active",children:[e.jsx("div",{className:"bodyscan-status-icon"}),e.jsx("span",{className:"bodyscan-status-text",children:"Analyse Spatiale"})]})]}),e.jsx("div",{className:"morphology-insights-grid",children:d.map((g,c)=>e.jsxs(u,{className:"morphology-insight-item",style:{"--insight-color":g.color},initial:{opacity:0,y:15},animate:{opacity:1,y:0},transition:{duration:.4,delay:a?0:.1+c*.1},whileHover:{y:-2},children:[e.jsx("div",{className:"morphology-insight-icon-container",children:e.jsx(o,{Icon:n[g.icon],size:20,color:g.color})}),e.jsx("div",{className:"morphology-insight-value",children:g.value}),e.jsx("div",{className:"morphology-insight-title",children:g.title})]},g.id))}),e.jsx(u,{className:"morphology-summary-card",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.5,delay:a?0:.6},style:{borderRadius:"24px",overflow:"hidden"},children:e.jsx("p",{className:"text-white/80 text-sm leading-relaxed",children:"Votre morphologie unique r√©v√®le un potentiel extraordinaire. Chaque caract√©ristique de votre corps raconte l'histoire de votre parcours et offre des opportunit√©s d'optimisation personnalis√©es."})})]})})});ee.displayName="MorphologyInsightsCard";function he(s){return s?{weight:s.weight?`${s.weight.toFixed(1)} kg`:"N/A",bmi:s.bmi?s.bmi.toFixed(1):"N/A",bodyFat:s.bodyFatPercentage?`${s.bodyFatPercentage.toFixed(1)}%`:"N/A",waist:s.waistCircumference?`${s.waistCircumference.toFixed(0)} cm`:"N/A",scanDate:s.createdAt?new Date(s.createdAt).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"}):"N/A"}:null}const be=[{id:"weight",label:"Poids",icon:"Scale",color:"#10B981",getValue:s=>s.weight?`${s.weight.toFixed(1)} kg`:"N/A"},{id:"bmi",label:"IMC",icon:"Activity",color:"#06B6D4",getValue:s=>s.bmi?s.bmi.toFixed(1):"N/A",getSubtext:s=>s.bmi?s.bmi<18.5?"L√©ger":s.bmi<25?"Normal":s.bmi<30?"Surpoids":"Ob√®se":""},{id:"bodyFat",label:"Masse Grasse",icon:"Droplet",color:"#F59E0B",getValue:s=>{if(s.bodyFatPercentage)return`${s.bodyFatPercentage.toFixed(1)}%`;const r=30,i=s.userProfile?.sex||s.resolvedGender||"male";if(s.bmi){const a=i==="male"?1:0,d=1.2*s.bmi+.23*r-10.8*a-5.4;return`${Math.max(5,Math.min(50,d)).toFixed(1)}%`}return"N/A"},getSubtext:s=>!s.bodyFatPercentage&&s.bmi?"Estim√©":"",getTooltip:s=>{if(!s.bodyFatPercentage&&s.bmi)return"Estimation bas√©e sur l'IMC et le sexe biologique (formule de Deurenberg)";if(!s.bodyFatPercentage)return"M√©trique non disponible pour ce scan"}},{id:"leanMass",label:"Masse Maigre",icon:"Zap",color:"#06B6D4",getValue:s=>{const r=s.weight||s.userProfile?.weight_kg,i=s.bodyFatPercentage;if(r&&i)return`${(r*((100-i)/100)).toFixed(1)} kg`;const a=s.userProfile?.height_cm,d=s.userProfile?.sex||s.resolvedGender||"male";return r&&a&&s.bmi?d==="male"?`${(.407*r+.267*a-19.2).toFixed(1)} kg`:`${(.252*r+.473*a-48.3).toFixed(1)} kg`:"N/A"},getSubtext:s=>!(s.weight&&s.bodyFatPercentage)&&s.weight&&s.userProfile?.height_cm?"Estim√©":"",getTooltip:s=>s.weight&&s.bodyFatPercentage?"Masse maigre = poids total - masse grasse. Inclut muscles, os, organes et eau corporelle.":s.weight&&s.userProfile?.height_cm?"Estimation bas√©e sur la formule de Boer utilisant le poids, la taille et le sexe biologique.":"M√©trique non disponible pour ce scan"}],se=T.memo(({scan:s})=>{const{isPerformanceMode:r}=C(),i=T.useMemo(()=>he(s),[s]);return e.jsx(b,{className:"p-6",style:{background:`
          radial-gradient(circle at 30% 20%, color-mix(in srgb, #06B6D4 8%, transparent) 0%, transparent 60%),
          var(--glass-opacity-base)
        `,borderColor:"color-mix(in srgb, #06B6D4 25%, transparent)",boxShadow:`
          var(--glass-shadow-sm),
          0 0 16px color-mix(in srgb, #06B6D4 10%, transparent)
        `},children:e.jsxs(u,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h4",{className:"text-white font-semibold flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                  linear-gradient(135deg, color-mix(in srgb, #06B6D4 35%, transparent), color-mix(in srgb, #06B6D4 25%, transparent))
                `,border:"2px solid color-mix(in srgb, #06B6D4 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #06B6D4 30%, transparent)"},children:e.jsx(o,{Icon:n.BarChart3,size:16,style:{color:"#06B6D4"},variant:"pure"})}),e.jsx("span",{children:"M√©triques Corporelles"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 rounded-full bg-green-500/10 border border-green-500/30",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400"}),e.jsxs("span",{className:"text-green-300 text-xs font-medium",children:["Scan du ",i?.scanDate]})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:be.map((a,d)=>{const g=a.getValue(s),c=a.getSubtext?.(s),l=a.getTooltip?.(s),m=g!=="N/A";return e.jsxs(u,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.4,delay:r?0:.1+d*.1},whileHover:{y:-2},className:"relative p-4 rounded-xl border transition-all duration-300 group",style:{background:m?`linear-gradient(135deg, color-mix(in srgb, ${a.color} 10%, transparent), color-mix(in srgb, ${a.color} 5%, transparent))`:"rgba(255, 255, 255, 0.03)",borderColor:m?`color-mix(in srgb, ${a.color} 30%, transparent)`:"rgba(255, 255, 255, 0.1)"},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center",style:{background:m?`color-mix(in srgb, ${a.color} 20%, transparent)`:"rgba(255, 255, 255, 0.05)"},children:e.jsx(o,{Icon:n[a.icon],size:16,color:m?a.color:"rgba(255, 255, 255, 0.3)"})}),e.jsx("span",{className:"text-white/60 text-xs font-medium",children:a.label}),l&&e.jsxs("div",{className:"relative ml-auto",children:[e.jsx(o,{Icon:n.Info,size:12,className:"text-white/40"}),e.jsx("div",{className:"absolute bottom-full right-0 mb-2 hidden group-hover:block z-10 w-48",children:e.jsx("div",{className:"bg-black/90 text-white text-xs rounded-lg px-3 py-2 shadow-xl",children:l})})]})]}),e.jsx("div",{className:"text-white text-xl font-bold mb-1",children:g}),c&&m&&e.jsx("div",{className:"text-xs font-medium",style:{color:a.color},children:c})]},a.id)})}),s.rawMeasurements&&Object.keys(s.rawMeasurements).length>0&&e.jsx(u,{className:"mt-6 p-4 rounded-xl bg-white/5 border border-white/10",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:r?0:.6},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(o,{Icon:n.Ruler,size:16,className:"text-white/40 mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white/60 text-xs font-medium mb-2",children:"Mesures d√©taill√©es"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:Object.entries(s.rawMeasurements).map(([a,d])=>e.jsxs("div",{className:"text-xs",children:[e.jsxs("span",{className:"text-white/40",children:[a.replace(/_/g," "),":"]})," ",e.jsxs("span",{className:"text-white/70 font-medium",children:[d," cm"]})]},a))})]})]})})]})})});se.displayName="BodyMetricsCard";const ye=()=>{const s=D(),{isPerformanceMode:r}=C(),i=r?"div":I.div,a=()=>{s("/body-scan")};return e.jsx(i,{...!r&&{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"}},className:"text-center py-12 py-1",children:e.jsx(b,{className:"p-8",style:{background:`radial-gradient(ellipse at center,
            rgba(6, 182, 212, 0.15) 0%,
            rgba(8, 145, 178, 0.08) 50%,
            rgba(0, 0, 0, 0.4) 100%)`,borderColor:"rgba(6, 182, 212, 0.3)",boxShadow:`
            0 0 30px rgba(6, 182, 212, 0.2),
            0 8px 32px rgba(0, 0, 0, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.1)
          `,backdropFilter:"blur(20px) saturate(1.2)"},children:e.jsxs("div",{className:"space-y-6 flex flex-col items-center",children:[e.jsx("div",{className:"w-20 h-20 mx-auto rounded-2xl flex items-center justify-center",style:{background:`radial-gradient(circle,
                rgba(6, 182, 212, 0.3) 0%,
                rgba(8, 145, 178, 0.15) 70%,
                transparent 100%)`,border:"1px solid rgba(6, 182, 212, 0.4)",boxShadow:`
                0 0 25px rgba(6, 182, 212, 0.3),
                0 4px 20px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2)
              `},children:e.jsx(o,{Icon:n.Scan,size:48,className:"text-cyan-400",style:{filter:`drop-shadow(0 0 12px rgba(6, 182, 212, 0.8))
                         drop-shadow(0 2px 8px rgba(0, 0, 0, 0.3))`}})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-3",children:"Cr√©ez votre avatar 3D personnalis√©"}),e.jsx("p",{className:"text-white/70 text-lg",children:"Scannez votre corps pour g√©n√©rer un jumeau num√©rique ultra-r√©aliste"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 my-8",children:[e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-xl flex items-center justify-center",style:{background:`radial-gradient(circle,
                    rgba(6, 182, 212, 0.3) 0%,
                    rgba(8, 145, 178, 0.1) 70%,
                    transparent 100%)`,border:"1px solid rgba(6, 182, 212, 0.4)",boxShadow:`
                    0 0 20px rgba(6, 182, 212, 0.3),
                    0 4px 15px rgba(0, 0, 0, 0.2),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2)
                  `},children:e.jsx(o,{Icon:n.User,size:24,className:"text-cyan-400",style:{filter:`drop-shadow(0 0 8px rgba(6, 182, 212, 0.6))
                             drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3))`}})}),e.jsx("h3",{className:"font-semibold text-white",children:"Mod√®le 3D pr√©cis"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Reconstruction anatomique d√©taill√©e de votre morphologie"})]}),e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-xl flex items-center justify-center",style:{background:`radial-gradient(circle,
                    rgba(6, 182, 212, 0.3) 0%,
                    rgba(8, 145, 178, 0.1) 70%,
                    transparent 100%)`,border:"1px solid rgba(6, 182, 212, 0.4)",boxShadow:`
                    0 0 20px rgba(6, 182, 212, 0.3),
                    0 4px 15px rgba(0, 0, 0, 0.2),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2)
                  `},children:e.jsx(o,{Icon:n.Ruler,size:24,className:"text-cyan-400",style:{filter:`drop-shadow(0 0 8px rgba(6, 182, 212, 0.6))
                             drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3))`}})}),e.jsx("h3",{className:"font-semibold text-white",children:"M√©triques corporelles"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Analyses compl√®tes de vos proportions et compositions"})]}),e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-xl flex items-center justify-center",style:{background:`radial-gradient(circle,
                    rgba(6, 182, 212, 0.3) 0%,
                    rgba(8, 145, 178, 0.1) 70%,
                    transparent 100%)`,border:"1px solid rgba(6, 182, 212, 0.4)",boxShadow:`
                    0 0 20px rgba(6, 182, 212, 0.3),
                    0 4px 15px rgba(0, 0, 0, 0.2),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2)
                  `},children:e.jsx(o,{Icon:n.Eye,size:24,className:"text-cyan-400",style:{filter:`drop-shadow(0 0 8px rgba(6, 182, 212, 0.6))
                             drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3))`}})}),e.jsx("h3",{className:"font-semibold text-white",children:"Visualisation 360¬∞"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Explorez votre avatar sous tous les angles en temps r√©el"})]})]}),e.jsx("div",{className:"pt-4",children:e.jsxs("button",{onClick:a,className:"group relative px-8 py-4 text-white font-semibold rounded-2xl transform hover:scale-105 transition-all duration-300",style:{background:`linear-gradient(135deg,
                  rgba(6, 182, 212, 0.8) 0%,
                  rgba(8, 145, 178, 0.9) 100%)`,border:"2px solid rgba(6, 182, 212, 0.6)",boxShadow:`
                  0 0 30px rgba(6, 182, 212, 0.4),
                  0 8px 25px rgba(0, 0, 0, 0.3),
                  inset 0 1px 0 rgba(255, 255, 255, 0.2),
                  inset 0 -1px 0 rgba(0, 0, 0, 0.2)
                `,backdropFilter:"blur(10px) saturate(1.2)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{Icon:n.Camera,size:24,className:"group-hover:rotate-12 transition-transform duration-300",style:{color:"white",filter:`drop-shadow(0 0 10px rgba(6, 182, 212, 0.8))
                             drop-shadow(0 2px 6px rgba(0, 0, 0, 0.3))`}}),e.jsx("span",{className:"text-lg",children:"Commencer le body scan"})]}),e.jsx("div",{className:"absolute inset-0 rounded-2xl blur-xl opacity-50 group-hover:opacity-75 transition-opacity duration-300 -z-10",style:{background:`linear-gradient(135deg,
                    rgba(6, 182, 212, 0.6) 0%,
                    rgba(8, 145, 178, 0.6) 100%)`}})]})}),e.jsx("div",{className:"text-white/50 text-sm p-3 rounded-xl",style:{background:`radial-gradient(ellipse at center,
                rgba(6, 182, 212, 0.1) 0%,
                transparent 70%)`,border:"1px solid rgba(6, 182, 212, 0.2)",boxShadow:"0 0 15px rgba(6, 182, 212, 0.1)"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(o,{Icon:n.Lightbulb,size:16,className:"text-cyan-400",style:{filter:"drop-shadow(0 0 6px rgba(6, 182, 212, 0.6))"}}),e.jsx("span",{children:"Astuce : Portez des v√™tements ajust√©s et capturez face + profil pour un r√©sultat optimal !"})]})})]})})})},ve=()=>{const s=D(),{profile:r}=z(),{isPerformanceMode:i}=C(),{bodyScanData:a,isLoading:d,error:g}=ge(),[c,l]=_.useState(!0),[m,t]=_.useState(!1),v=_.useRef(void 0);_.useEffect(()=>{const B=setTimeout(()=>{l(!1),y.debug("AVATAR_TAB","Component mounting delay complete",{philosophy:"minimum_skeleton_display_time"})},400);return()=>clearTimeout(B)},[]),_.useEffect(()=>{a?.id&&a.id!==v.current&&(t(!1),v.current=a.id,y.debug("AVATAR_TAB","Scan data changed to different scan, resetting viewer ready state",{scanId:a.id,previousScanId:v.current,philosophy:"reset_viewer_on_scan_change"}))},[a?.id]);const f=_.useCallback(()=>{y.info("AVATAR_TAB","Avatar 3D viewer ready callback triggered",{currentlyReady:m,scanId:a?.id,philosophy:"viewer_ready_callback_triggered"}),t(!0),y.info("AVATAR_TAB","Avatar 3D viewer fully initialized and state updated",{philosophy:"viewer_ready_state_updated"})},[m,a?.id]),p=a&&a.morph_values&&Object.keys(a.morph_values).length>0&&a.limb_masses&&Object.keys(a.limb_masses).length>0;if(_.useEffect(()=>{if(!m&&a?.id){const B=setTimeout(()=>{m||(y.warn("AVATAR_TAB","Safety timeout: forcing viewer ready after 10s",{scanId:a.id,isLoading:d,isComponentMounting:c,philosophy:"safety_timeout_force_ready"}),t(!0))},1e4);return()=>clearTimeout(B)}},[m,a?.id,d,c]),y.info("AVATAR_TAB","Scan data loaded",{hasScan:!!a,scanId:a?.id,hasMorphValues:!!a?.morph_values,morphValuesCount:a?.morph_values?Object.keys(a.morph_values).length:0,hasLimbMasses:!!a?.limb_masses,limbMassesCount:a?.limb_masses?Object.keys(a.limb_masses).length:0,hasResolvedGender:!!a?.resolved_gender,resolvedGender:a?.resolved_gender,hasWeight:!!a?.weight,weight:a?.weight,philosophy:"avatar_tab_diagnostics"}),g)return e.jsxs(b,{className:"text-center p-8",children:[e.jsx(u,{className:"w-16 h-16 mx-auto mb-6 rounded-full bg-red-500/20 border border-red-400/30 flex items-center justify-center",initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:300,damping:25},children:e.jsx(o,{Icon:n.AlertCircle,size:32,color:"#EF4444"})}),e.jsx("h3",{className:"text-xl font-bold text-white mb-3",children:"Erreur de chargement"}),e.jsx("p",{className:"text-red-300 text-sm mb-6 leading-relaxed max-w-md mx-auto",children:g instanceof Error?g.message:"Une erreur est survenue lors du chargement de votre avatar."}),e.jsx("button",{className:"btn-glass px-6 py-3",onClick:()=>window.location.reload(),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(o,{Icon:n.RotateCcw,size:16}),e.jsx("span",{children:"Actualiser"})]})})]});if(a&&!p&&y.warn("AVATAR_TAB","Scan data incomplete",{scanId:a.id,morphValuesCount:a.morph_values?Object.keys(a.morph_values).length:0,limbMassesCount:a.limb_masses?Object.keys(a.limb_masses).length:0,missingMorphs:!a.morph_values||Object.keys(a.morph_values).length===0,missingLimbMasses:!a.limb_masses||Object.keys(a.limb_masses).length===0,philosophy:"incomplete_scan_validation"}),!a||!p)return e.jsx(ye,{});if((d||c||!m)&&!g)return e.jsx(ce,{});const x=a.morph_values||{},h=a.limb_masses||{},S=a.skin_tone||null,N=a.resolved_gender||r?.sex||"male",w={sex:N,height_cm:r?.height_cm||170,weight_kg:a.weight||r?.weight_kg||70};y.info("AVATAR_TAB","Rendering avatar with data",{scanId:a.id,morphDataKeys:Object.keys(x).length,limbMassesKeys:Object.keys(h).length,hasSkinTone:!!S,resolvedGender:N,userProfile:w,philosophy:"avatar_render_data"});const E=r?.preferences?.face?.final_face_params||{},A=r?.preferences?.face?.skin_tone||null;return e.jsxs(u,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"},className:"space-y-8",children:[e.jsxs(b,{className:"bodyscan-card p-6",children:[e.jsx("div",{className:"flex items-center mb-4",children:e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                  linear-gradient(135deg, rgba(6, 182, 212, 0.35), rgba(6, 182, 212, 0.25))
                `,border:"2px solid rgba(6, 182, 212, 0.5)",boxShadow:"0 0 20px rgba(6, 182, 212, 0.3)"},children:e.jsx(o,{Icon:n.Eye,size:20,style:{color:"#06B6D4"},variant:"pure"})}),e.jsx("span",{className:"glowing-title-text",children:"Votre Avatar 3D"})]})}),e.jsx("div",{className:"avatar-3d-viewer-container h-[400px] sm:h-[500px] lg:h-[600px] rounded-xl bg-gradient-to-br from-cyan-500/10 to-blue-500/10 border border-cyan-400/20 relative overflow-hidden",children:e.jsx(X,{userProfile:w,morphData:x,limbMasses:h,skinTone:S,resolvedGender:N,faceMorphData:E,faceSkinTone:A,className:"w-full h-full",autoRotate:!0,showControls:!0,onViewerReady:f})})]}),e.jsx(se,{scan:a}),x&&Object.keys(x).length>0&&e.jsx(ee,{finalShapeParams:x,resolvedGender:N,userProfile:w}),e.jsxs(b,{className:"p-0 overflow-hidden relative",interactive:!0,style:{background:`
            radial-gradient(circle at 30% 30%, rgba(139, 92, 246, 0.15) 0%, transparent 60%),
            radial-gradient(circle at 70% 70%, rgba(139, 92, 246, 0.10) 0%, transparent 50%),
            var(--glass-opacity-base)
          `,borderColor:"rgba(139, 92, 246, 0.4)",boxShadow:`
            0 12px 40px rgba(0, 0, 0, 0.25),
            0 0 40px rgba(139, 92, 246, 0.25),
            inset 0 2px 0 rgba(255, 255, 255, 0.2)
          `},children:[!i&&e.jsx("div",{className:"absolute inset-0 rounded-inherit pointer-events-none urgent-forge-glow-css",style:{background:"radial-gradient(circle at center, color-mix(in srgb, #8B5CF6 8%, transparent) 0%, transparent 70%)",filter:"blur(20px)",transform:"scale(1.2)",zIndex:0}}),e.jsxs(u,{as:"button",onClick:()=>s("/body-scan"),className:"w-full px-8 py-4 rounded-2xl font-bold text-lg text-white relative overflow-hidden min-h-[64px] z-10",style:{background:`
              linear-gradient(135deg,
                rgba(139, 92, 246, 0.25),
                rgba(139, 92, 246, 0.15)
              )
            `,border:"none",backdropFilter:"blur(20px) saturate(160%)"},whileHover:{scale:1.01,y:-1},whileTap:{scale:.99},children:[!i&&e.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{background:"linear-gradient(90deg, transparent, rgba(139, 92, 246, 0.4), transparent)",animation:"celebration-cta-shimmer-movement 2s ease-in-out infinite",borderRadius:"inherit"}}),e.jsxs("div",{className:"relative z-10 flex items-center justify-center gap-3",children:[e.jsx(o,{Icon:n.Scan,size:24,style:{color:"#8B5CF6",filter:"drop-shadow(0 2px 6px rgba(139, 92, 246, 0.5))"},variant:"pure"}),e.jsx("span",{style:{textShadow:"0 2px 8px rgba(139, 92, 246, 0.6)",color:"white"},children:"Nouveau scan corporel"})]})]})]})]})};function fe(s){if(!s)return null;try{const r=new Date(s),i=new Date;let a=i.getFullYear()-r.getFullYear();const d=i.getMonth()-r.getMonth();return(d<0||d===0&&i.getDate()<r.getDate())&&a--,a}catch{return null}}function je(s,r){const i=s/100;return r/(i*i)}async function we(s,r){y.info("INSIGHTS_GENERATION","üöÄ Calling generate-morph-insights Edge Function",{userId:r?.userId,hasScanData:!!s,hasUserProfile:!!r,philosophy:"ai_powered_morphology_insights",supabaseUrl:"https://kwipydbtjagypocpvbwn.supabase.co",timestamp:new Date().toISOString()});try{y.info("INSIGHTS_GENERATION","üì° Invoking Supabase function...");const{data:i,error:a}=await G.functions.invoke("generate-morph-insights",{body:{scan_data:{final_shape_params:s?.morph_values||s?.finalShapeParams||{},final_limb_masses:s?.limb_masses||s?.finalLimbMasses||{},skin_tone:s?.skin_tone||s?.skinTone,resolved_gender:s?.resolved_gender||s?.resolvedGender,avatar_version:s?.avatar_version||s?.avatarVersion,scan_id:s?.id||s?.scanId},user_profile:{user_id:r?.userId,age:fe(r?.birthdate),sex:r?.sex,height_cm:r?.height||r?.height_cm,weight_kg:r?.weight||r?.weight_kg,target_weight_kg:r?.target_weight||r?.target_weight_kg,activity_level:r?.activity_level,objective:r?.objective,bmi:(r?.height||r?.height_cm)&&(r?.weight||r?.weight_kg)?je(r.height||r.height_cm,r.weight||r.weight_kg):null,goals:r?.goals||{},health:r?.health||{},emotions:r?.emotions||{},nutrition:r?.nutrition||{}},analysis_config:{include_recommendations:!0,include_comparisons:!0,include_goal_tracking:!0,detail_level:"comprehensive"}}});if(y.info("INSIGHTS_GENERATION","üì• Function response received",{hasData:!!i,hasError:!!a,errorMessage:a?.message}),a)throw y.error("INSIGHTS_GENERATION","‚ùå Failed to generate insights",{error:a.message,userId:r?.userId,errorDetails:a}),new Error(`Failed to generate insights: ${a.message}`);return y.info("INSIGHTS_GENERATION","‚úÖ Insights generated successfully",{userId:r?.userId,insightsCount:i?.insights?.length||0}),i}catch(i){throw y.error("INSIGHTS_GENERATION","‚ùå Network or parsing error",{error:i.message,stack:i.stack,userId:r?.userId}),i}}function Ne(s){switch(s){case"recommendation":return n.Target;case"observation":return n.Eye;case"achievement":return n.Check;case"goal_progress":return n.TrendingUp;default:return n.Info}}function _e(s){switch(s){case"recommendation":return"Recommandation";case"observation":return"Observation";case"achievement":return"R√©ussite";case"goal_progress":return"Progression";default:return"Info"}}function Se(s){switch(s){case"high":return"Haute";case"medium":return"Moyenne";case"low":return"Basse";default:return s}}const q=T.memo(({insight:s,index:r})=>{const{isPerformanceMode:i}=C();return e.jsxs(u,{className:"insight-card",style:{"--insight-color":s.color},initial:{opacity:0,y:15},animate:{opacity:1,y:0},transition:{duration:.4,delay:i?0:r*.1},whileHover:{y:-2},children:[e.jsxs("div",{className:"insight-card-badges",children:[e.jsxs("div",{className:`insight-metadata-badge insight-metadata-badge--type-${s.type}`,children:[e.jsx(o,{Icon:Ne(s.type),size:10,variant:"pure"}),e.jsx("span",{children:_e(s.type)})]}),(s.priority==="high"||s.priority==="medium")&&e.jsx("div",{className:`insight-metadata-badge insight-metadata-badge--priority-${s.priority}`,children:e.jsx("span",{children:Se(s.priority)})}),s.confidence>=.8&&e.jsxs("div",{className:"insight-metadata-badge insight-metadata-badge--confidence",children:[e.jsx(o,{Icon:n.Check,size:10,variant:"pure"}),e.jsxs("span",{children:[Math.round(s.confidence*100),"%"]})]})]}),e.jsxs("div",{className:"insight-card-header",children:[e.jsx("div",{className:"insight-card-icon-container",children:e.jsx(o,{Icon:n[s.icon],size:18,color:s.color})}),e.jsxs("div",{className:"insight-card-content",children:[e.jsxs("div",{className:"insight-card-title-row",children:[e.jsx("h5",{className:"insight-card-title",children:s.title}),s.value&&e.jsx("span",{className:"insight-card-value-badge",children:s.value})]}),e.jsx("p",{className:"insight-card-description",children:s.description})]})]})]})});q.displayName="InsightCard";const ke=()=>e.jsx("div",{className:"space-y-6 w-full",children:e.jsx(b,{className:"text-center p-8",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, var(--color-body-scan-warning) 8%, transparent) 0%, transparent 60%),
            var(--glass-opacity-base)
          `,borderColor:"color-mix(in srgb, var(--color-body-scan-warning) 25%, transparent)",boxShadow:`
            var(--glass-shadow-sm),
            0 0 16px color-mix(in srgb, var(--color-body-scan-warning) 10%, transparent)
          `},children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-6",children:[e.jsxs(I.div,{className:"w-20 h-20 rounded-full flex items-center justify-center relative",style:{background:"color-mix(in srgb, var(--color-body-scan-warning) 20%, transparent)",border:"2px solid color-mix(in srgb, var(--color-body-scan-warning) 40%, transparent)",boxShadow:"0 0 30px color-mix(in srgb, var(--color-body-scan-warning) 30%, transparent)"},initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:300,damping:25},children:[e.jsx(o,{Icon:n.Loader2,size:32,style:{color:"var(--color-body-scan-warning)"},variant:"pure",className:"loader-essential"}),e.jsx(I.div,{className:"absolute inset-0 rounded-full border-2",style:{borderColor:"color-mix(in srgb, var(--color-body-scan-warning) 40%, transparent)"},animate:{scale:[1,1.2,1],opacity:[.3,.6,.3]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}})]}),e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"G√©n√©ration d'insights..."}),e.jsx("p",{className:"text-white/70 text-sm leading-relaxed max-w-sm",children:"Nos syst√®mes analysent votre morphologie pour g√©n√©rer des recommandations personnalis√©es"})]})]})})}),Ie=({error:s})=>e.jsx("div",{className:"space-y-6 w-full",children:e.jsxs(b,{className:"text-center p-8",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, var(--color-body-scan-error) 8%, transparent) 0%, transparent 60%),
            var(--glass-opacity-base)
          `,borderColor:"color-mix(in srgb, var(--color-body-scan-error) 25%, transparent)",boxShadow:`
            var(--glass-shadow-sm),
            0 0 16px color-mix(in srgb, var(--color-body-scan-error) 10%, transparent)
          `},children:[e.jsx(I.div,{className:"bodyscan-size-2xl bodyscan-absolute-center-x mb-6 bodyscan-rounded-full bodyscan-flex-center",style:{background:"color-mix(in srgb, var(--color-body-scan-error) 20%, transparent)",border:"2px solid color-mix(in srgb, var(--color-body-scan-error) 40%, transparent)",boxShadow:"0 0 30px color-mix(in srgb, var(--color-body-scan-error) 30%, transparent)"},initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:300,damping:25},children:e.jsx(o,{Icon:n.AlertCircle,size:32,style:{color:"var(--color-body-scan-error)"},variant:"pure"})}),e.jsx("h3",{className:"text-xl font-bold text-white mb-3",children:"Erreur de g√©n√©ration d'insights"}),e.jsx("p",{className:"bodyscan-text-error text-sm mb-6 leading-relaxed max-w-md mx-auto",children:s instanceof Error?s.message:"Une erreur est survenue lors de la g√©n√©ration des insights."}),e.jsx("button",{className:"btn-glass--primary px-6 py-3",onClick:()=>window.location.reload(),children:e.jsxs("div",{className:"bodyscan-flex-center bodyscan-gap-sm",children:[e.jsx(o,{Icon:n.RotateCcw,size:16}),e.jsx("span",{children:"R√©essayer"})]})})]})}),ae=T.memo(({summary:s})=>{const{isPerformanceMode:r}=C();return e.jsx(b,{className:"p-6",style:{background:`
          radial-gradient(circle at 30% 20%, color-mix(in srgb, #F59E0B 8%, transparent) 0%, transparent 60%),
          var(--glass-opacity-base)
        `,borderColor:"color-mix(in srgb, #F59E0B 25%, transparent)",boxShadow:`
          var(--glass-shadow-sm),
          0 0 16px color-mix(in srgb, #F59E0B 10%, transparent)
        `},children:e.jsxs(u,{className:"slide-enter",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:[e.jsxs("div",{className:"bodyscan-flex-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold bodyscan-flex-center bodyscan-gap-sm",children:[e.jsx("div",{className:"bodyscan-header-icon-container",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                  linear-gradient(135deg, color-mix(in srgb, #F59E0B 35%, transparent), color-mix(in srgb, #F59E0B 25%, transparent))
                `,border:"2px solid color-mix(in srgb, #F59E0B 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #F59E0B 30%, transparent)"},children:e.jsx(o,{Icon:n.BarChart3,size:16,style:{color:"#F59E0B"},variant:"pure"})}),"Tableau de bord morphologique"]}),e.jsxs("div",{className:"bodyscan-status-badge bodyscan-status-badge--active",children:[e.jsx("div",{className:"bodyscan-status-icon"}),e.jsx("span",{className:"bodyscan-status-text",children:"Analyse Spatiale"})]})]}),e.jsxs("div",{className:"bodyscan-grid-cols-2 md:bodyscan-grid-cols-4 bodyscan-gap-md",children:[e.jsxs("div",{className:"summary-metric-card summary-metric-card--blue",children:[e.jsxs("div",{className:"summary-metric-value",children:[Math.round(s.morphology_score),"%"]}),e.jsx("div",{className:"summary-metric-label",children:"Score Morphologique"})]}),e.jsxs("div",{className:"summary-metric-card summary-metric-card--green",children:[e.jsxs("div",{className:"summary-metric-value",children:[Math.round(s.goal_alignment),"%"]}),e.jsx("div",{className:"summary-metric-label",children:"Alignement Objectifs"})]}),e.jsxs("div",{className:"summary-metric-card summary-metric-card--purple",children:[e.jsxs("div",{className:"summary-metric-value",children:[Math.round(s.health_indicators),"%"]}),e.jsx("div",{className:"summary-metric-label",children:"Indicateurs Sant√©"})]}),e.jsxs("div",{className:"summary-metric-card summary-metric-card--orange",children:[e.jsx("div",{className:"summary-metric-value",children:s.recommendations_count}),e.jsx("div",{className:"summary-metric-label",children:"Recommandations"})]})]})]})})});ae.displayName="SummaryDashboard";const Ce=({isOpen:s,onDiscardAndExit:r,onCancel:i,isGenerating:a,hasError:d,fallbackUsed:g})=>{const{click:c,error:l}=Y(),t=a?{title:"G√©n√©ration d'Insights en Cours",message:"Une analyse IA de votre morphologie est actuellement en cours. Si vous quittez maintenant, l'analyse sera interrompue et les insights ne seront pas g√©n√©r√©s.",icon:"Loader2",color:"#8B5CF6",actionText:"Interrompre l'analyse et Quitter",cancelText:"Continuer l'analyse"}:d?{title:"Erreur de G√©n√©ration",message:"Une erreur est survenue lors de la g√©n√©ration des insights. Vous pouvez quitter et r√©essayer plus tard, ou rester pour voir les insights de base disponibles.",icon:"AlertTriangle",color:"#EF4444",actionText:"Quitter",cancelText:"Rester et voir les insights de base"}:g?{title:"Insights de Base Disponibles",message:"L'IA n'√©tait pas disponible, mais des insights bas√©s sur des r√®gles ont √©t√© g√©n√©r√©s. Voulez-vous quitter ou consulter ces insights ?",icon:"Info",color:"#F59E0B",actionText:"Quitter",cancelText:"Consulter les insights"}:{title:"Quitter les Insights",message:"√ätes-vous s√ªr de vouloir quitter la section insights ?",icon:"AlertCircle",color:"#6B7280",actionText:"Quitter",cancelText:"Rester"};return e.jsx(P,{children:s&&e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",style:{background:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(16px)",WebkitBackdropFilter:"blur(16px)"},onClick:v=>{v.target===v.currentTarget&&(c(),i())},children:e.jsx(I.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{type:"spring",stiffness:300,damping:30},className:"w-full max-w-md",onClick:v=>v.stopPropagation(),children:e.jsxs(b,{className:"p-6 relative",style:{background:`
                  radial-gradient(circle at 30% 20%, color-mix(in srgb, ${t.color} 12%, transparent) 0%, transparent 60%),
                  radial-gradient(circle at 70% 80%, color-mix(in srgb, ${t.color} 8%, transparent) 0%, transparent 50%),
                  var(--glass-opacity)
                `,borderColor:`color-mix(in srgb, ${t.color} 30%, transparent)`,boxShadow:`
                  0 20px 60px rgba(0, 0, 0, 0.4),
                  0 0 40px color-mix(in srgb, ${t.color} 20%, transparent),
                  inset 0 2px 0 rgba(255, 255, 255, 0.2)
                `,backdropFilter:"blur(24px) saturate(160%)"},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center",style:{background:`
                      radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                      linear-gradient(135deg, color-mix(in srgb, ${t.color} 35%, transparent), color-mix(in srgb, ${t.color} 25%, transparent))
                    `,border:`2px solid color-mix(in srgb, ${t.color} 50%, transparent)`,boxShadow:`0 0 30px color-mix(in srgb, ${t.color} 40%, transparent)`},children:e.jsx(o,{Icon:n[t.icon],size:28,style:{color:t.color},className:a?"animate-spin":""})}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-3",children:t.title}),e.jsx("p",{className:"text-white/80 text-base leading-relaxed",children:t.message})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{l(),r()},className:"w-full btn-glass--warning py-3",style:{background:`
                      linear-gradient(135deg, 
                        color-mix(in srgb, #EF4444 70%, transparent), 
                        color-mix(in srgb, #DC2626 50%, transparent)
                      )
                    `,borderColor:"color-mix(in srgb, #EF4444 60%, transparent)",boxShadow:`
                      0 8px 32px color-mix(in srgb, #EF4444 30%, transparent),
                      inset 0 2px 0 rgba(255,255,255,0.2)
                    `},children:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(o,{Icon:n.X,size:18,className:"text-white"}),e.jsx("span",{className:"font-bold",children:t.actionText})]})}),e.jsx("button",{onClick:()=>{c(),i()},className:"w-full btn-glass--secondary-nav py-3",children:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(o,{Icon:n.ArrowLeft,size:18}),e.jsx("span",{className:"font-medium",children:t.cancelText})]})})]}),e.jsx("div",{className:"mt-4 p-3 rounded-xl text-center",style:{background:`color-mix(in srgb, ${t.color} 8%, transparent)`,border:`1px solid color-mix(in srgb, ${t.color} 20%, transparent)`},children:e.jsx("p",{className:"text-white/70 text-sm",children:a?"L'analyse IA sera interrompue et devra √™tre relanc√©e.":d?"Vous pourrez r√©essayer la g√©n√©ration d'insights plus tard.":g?"Les insights de base fournissent des informations utiles sur votre morphologie.":"Vous pourrez revenir consulter vos insights √† tout moment."})})]})})})})},Ae=()=>{const s=D(),{isPerformanceMode:r}=C(),i=r?"div":I.div,a=()=>{s("/body-scan")};return e.jsx(i,{...!r&&{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"}},className:"text-center py-12 py-1",children:e.jsx(b,{className:"p-8",style:{background:`radial-gradient(ellipse at center,
            rgba(245, 158, 11, 0.15) 0%,
            rgba(251, 146, 60, 0.08) 50%,
            rgba(0, 0, 0, 0.4) 100%)`,borderColor:"rgba(245, 158, 11, 0.3)",boxShadow:`
            0 0 30px rgba(245, 158, 11, 0.2),
            0 8px 32px rgba(0, 0, 0, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.1)
          `,backdropFilter:"blur(20px) saturate(1.2)"},children:e.jsxs("div",{className:"space-y-6 flex flex-col items-center",children:[e.jsx("div",{className:"w-20 h-20 mx-auto rounded-2xl flex items-center justify-center",style:{background:`radial-gradient(circle,
                rgba(245, 158, 11, 0.3) 0%,
                rgba(251, 146, 60, 0.15) 70%,
                transparent 100%)`,border:"1px solid rgba(245, 158, 11, 0.4)",boxShadow:`
                0 0 25px rgba(245, 158, 11, 0.3),
                0 4px 20px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2)
              `},children:e.jsx(o,{Icon:n.Eye,size:48,className:"text-orange-400",style:{filter:`drop-shadow(0 0 12px rgba(245, 158, 11, 0.8))
                         drop-shadow(0 2px 8px rgba(0, 0, 0, 0.3))`}})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-3",children:"D√©couvrez vos insights morphologiques"}),e.jsx("p",{className:"text-white/70 text-lg",children:"Cr√©ez votre avatar 3D pour obtenir une analyse IA compl√®te de votre morphologie"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 my-8",children:[e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-xl flex items-center justify-center",style:{background:`radial-gradient(circle,
                    rgba(245, 158, 11, 0.3) 0%,
                    rgba(251, 146, 60, 0.1) 70%,
                    transparent 100%)`,border:"1px solid rgba(245, 158, 11, 0.4)",boxShadow:`
                    0 0 20px rgba(245, 158, 11, 0.3),
                    0 4px 15px rgba(0, 0, 0, 0.2),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2)
                  `},children:e.jsx(o,{Icon:n.User,size:24,className:"text-orange-400",style:{filter:`drop-shadow(0 0 8px rgba(245, 158, 11, 0.6))
                             drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3))`}})}),e.jsx("h3",{className:"font-semibold text-white",children:"Analyse morphologique"}),e.jsx("p",{className:"text-white/60 text-sm",children:"D√©tection pr√©cise de votre type corporel et traits"})]}),e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-xl flex items-center justify-center",style:{background:`radial-gradient(circle,
                    rgba(245, 158, 11, 0.3) 0%,
                    rgba(251, 146, 60, 0.1) 70%,
                    transparent 100%)`,border:"1px solid rgba(245, 158, 11, 0.4)",boxShadow:`
                    0 0 20px rgba(245, 158, 11, 0.3),
                    0 4px 15px rgba(0, 0, 0, 0.2),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2)
                  `},children:e.jsx(o,{Icon:n.Brain,size:24,className:"text-orange-400",style:{filter:`drop-shadow(0 0 8px rgba(245, 158, 11, 0.6))
                             drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3))`}})}),e.jsx("h3",{className:"font-semibold text-white",children:"Insights personnalis√©s"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Conseils sant√© et fitness adapt√©s √† votre morphologie"})]}),e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-xl flex items-center justify-center",style:{background:`radial-gradient(circle,
                    rgba(245, 158, 11, 0.3) 0%,
                    rgba(251, 146, 60, 0.1) 70%,
                    transparent 100%)`,border:"1px solid rgba(245, 158, 11, 0.4)",boxShadow:`
                    0 0 20px rgba(245, 158, 11, 0.3),
                    0 4px 15px rgba(0, 0, 0, 0.2),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2)
                  `},children:e.jsx(o,{Icon:n.Target,size:24,className:"text-orange-400",style:{filter:`drop-shadow(0 0 8px rgba(245, 158, 11, 0.6))
                             drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3))`}})}),e.jsx("h3",{className:"font-semibold text-white",children:"Objectifs optimaux"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Recommandations bas√©es sur votre profil unique"})]})]}),e.jsx("div",{className:"pt-4",children:e.jsxs("button",{onClick:a,className:"group relative px-8 py-4 text-white font-semibold rounded-2xl transform hover:scale-105 transition-all duration-300",style:{background:`linear-gradient(135deg,
                  rgba(245, 158, 11, 0.8) 0%,
                  rgba(251, 146, 60, 0.9) 100%)`,border:"2px solid rgba(245, 158, 11, 0.6)",boxShadow:`
                  0 0 30px rgba(245, 158, 11, 0.4),
                  0 8px 25px rgba(0, 0, 0, 0.3),
                  inset 0 1px 0 rgba(255, 255, 255, 0.2),
                  inset 0 -1px 0 rgba(0, 0, 0, 0.2)
                `,backdropFilter:"blur(10px) saturate(1.2)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{Icon:n.Camera,size:24,className:"group-hover:rotate-12 transition-transform duration-300",style:{color:"white",filter:`drop-shadow(0 0 10px rgba(245, 158, 11, 0.8))
                             drop-shadow(0 2px 6px rgba(0, 0, 0, 0.3))`}}),e.jsx("span",{className:"text-lg",children:"Cr√©er mon avatar 3D"})]}),e.jsx("div",{className:"absolute inset-0 rounded-2xl blur-xl opacity-50 group-hover:opacity-75 transition-opacity duration-300 -z-10",style:{background:`linear-gradient(135deg,
                    rgba(245, 158, 11, 0.6) 0%,
                    rgba(251, 146, 60, 0.6) 100%)`}})]})}),e.jsx("div",{className:"text-white/50 text-sm p-3 rounded-xl",style:{background:`radial-gradient(ellipse at center,
                rgba(245, 158, 11, 0.1) 0%,
                transparent 70%)`,border:"1px solid rgba(245, 158, 11, 0.2)",boxShadow:"0 0 15px rgba(245, 158, 11, 0.1)"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(o,{Icon:n.Lightbulb,size:16,className:"text-orange-400",style:{filter:"drop-shadow(0 0 6px rgba(245, 158, 11, 0.6))"}}),e.jsx("span",{children:"Astuce : Prenez 2 photos (face + profil) pour une analyse morphologique ultra-pr√©cise !"})]})})]})})})},Fe=()=>{const{profile:s}=z(),{isPerformanceMode:r}=C(),{data:i,isLoading:a}=$({queryKey:["body-scans","latest",s?.userId],queryFn:async()=>{const{data:x,error:h}=await G.from("body_scans").select("*").eq("user_id",s?.userId).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(h)throw h;return x},enabled:!!s?.userId,staleTime:5*60*1e3}),[d,g]=T.useState(!1),{data:c,isLoading:l,error:m}=$({queryKey:["morph-insights",s?.userId,i?.id],queryFn:()=>we(i,s),enabled:!!(i?.id&&s?.userId),staleTime:1/0,gcTime:24*60*60*1e3,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1,retry:1}),t=()=>{g(!1),window.history.back()},v=()=>{g(!1)};if(T.useEffect(()=>{const x=h=>{l&&(h.preventDefault(),h.returnValue="Une analyse IA est en cours. √ätes-vous s√ªr de vouloir quitter ?",g(!0))};return window.addEventListener("beforeunload",x),()=>{window.removeEventListener("beforeunload",x)}},[l]),a||l)return e.jsx(ke,{});if(m)return e.jsx(Ie,{error:m});if(!i)return e.jsx(Ae,{});const f=c?.insights||[],p=c?.summary,j=c?.fallback_used||!1;return e.jsx(e.Fragment,{children:e.jsxs(u,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"},children:[e.jsx(Ce,{isOpen:d,onDiscardAndExit:t,onCancel:v,isGenerating:l,hasError:!!m,fallbackUsed:j}),e.jsxs("div",{className:"space-y-8",children:[p&&e.jsx(ae,{summary:p}),f.length>0&&e.jsxs("div",{className:"space-y-6",children:[f.filter(x=>x.priority==="high").length>0&&e.jsx(u,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:r?0:.2},children:e.jsxs(b,{className:"p-6 glass-card--priority",children:[e.jsxs("h4",{className:"text-white font-semibold mb-6 flex items-center gap-2 glowing-title-text",style:{"--title-glow-color":"#EF4444"},children:[e.jsx("div",{className:"bodyscan-header-icon-container",style:{background:`
                        radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                        linear-gradient(135deg, color-mix(in srgb, #F59E0B 35%, transparent), color-mix(in srgb, #F59E0B 25%, transparent))
                      `,border:"2px solid color-mix(in srgb, #F59E0B 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #F59E0B 30%, transparent)"},children:e.jsx(o,{Icon:n.Zap,size:16,style:{color:"#F59E0B"},variant:"pure"})}),"Insights prioritaires",e.jsx("span",{className:"text-xs bg-red-500/20 text-red-300 px-2 py-1 rounded-full",children:"Haute priorit√©"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:f.filter(x=>x.priority==="high").map((x,h)=>e.jsx(q,{insight:x,index:h},x.id))})]})}),f.filter(x=>x.category==="morphology").length>0&&e.jsx(u,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:r?0:.3},children:e.jsxs(b,{className:"p-6",children:[e.jsxs("h4",{className:"text-white font-semibold mb-6 flex items-center gap-2 glowing-title-text",style:{"--title-glow-color":"#8B5CF6"},children:[e.jsx("div",{className:"bodyscan-header-icon-container",style:{background:`
                        radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                        linear-gradient(135deg, color-mix(in srgb, #F59E0B 35%, transparent), color-mix(in srgb, #F59E0B 25%, transparent))
                      `,border:"2px solid color-mix(in srgb, #F59E0B 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #F59E0B 30%, transparent)"},children:e.jsx(o,{Icon:n.Eye,size:16,style:{color:"#F59E0B"},variant:"pure"})}),"Analyse morphologique"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:f.filter(x=>x.category==="morphology").map((x,h)=>e.jsx(q,{insight:x,index:h},x.id))})]})}),f.filter(x=>["fitness","goals"].includes(x.category)).length>0&&e.jsx(u,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:r?0:.4},children:e.jsxs(b,{className:"p-6",children:[e.jsxs("h4",{className:"text-white font-semibold mb-6 flex items-center gap-2 glowing-title-text",style:{"--title-glow-color":"#22C55E"},children:[e.jsx("div",{className:"bodyscan-header-icon-container",style:{background:`
                        radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                        linear-gradient(135deg, color-mix(in srgb, #F59E0B 35%, transparent), color-mix(in srgb, #F59E0B 25%, transparent))
                      `,border:"2px solid color-mix(in srgb, #F59E0B 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #F59E0B 30%, transparent)"},children:e.jsx(o,{Icon:n.Target,size:16,style:{color:"#F59E0B"},variant:"pure"})}),"Objectifs & Fitness"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:f.filter(x=>["fitness","goals"].includes(x.category)).map((x,h)=>e.jsx(q,{insight:x,index:h},x.id))})]})}),f.filter(x=>["health","nutrition"].includes(x.category)).length>0&&e.jsx(u,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:r?0:.5},children:e.jsxs(b,{className:"p-6",children:[e.jsxs("h4",{className:"text-white font-semibold mb-6 flex items-center gap-2 glowing-title-text",style:{"--title-glow-color":"#EC4899"},children:[e.jsx("div",{className:"bodyscan-header-icon-container",style:{background:`
                        radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                        linear-gradient(135deg, color-mix(in srgb, #F59E0B 35%, transparent), color-mix(in srgb, #F59E0B 25%, transparent))
                      `,border:"2px solid color-mix(in srgb, #F59E0B 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #F59E0B 30%, transparent)"},children:e.jsx(o,{Icon:n.Heart,size:16,style:{color:"#F59E0B"},variant:"pure"})}),"Sant√© & Nutrition"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:f.filter(x=>["health","nutrition"].includes(x.category)).map((x,h)=>e.jsx(q,{insight:x,index:h},x.id))})]})})]})]})]})})},Me=({scanId:s,onClose:r})=>{const{profile:i}=z(),a=i,d=_.useRef(null),[g,c]=_.useState(!1);_.useEffect(()=>{console.log("HISTORICAL_SCAN_MODAL: Received scanId:",s)},[s]);const{data:l,isLoading:m,error:t}=$({queryKey:["historical-scan",s],queryFn:()=>J.getById(s),enabled:!!s,staleTime:1/0,gcTime:24*60*60*1e3});_.useEffect(()=>{console.log("HISTORICAL_SCAN_MODAL: isLoading:",m,"error:",t)},[m,t]),_.useEffect(()=>{l&&console.log("HISTORICAL_SCAN_MODAL: Scan data loaded:",l)},[l]);const v=l?L(new Date(l.created_at),"dd MMMM yyyy",{locale:H}):"N/A";_.useEffect(()=>{g&&d.current?.resetCamera&&d.current.resetCamera()},[g]),_.useEffect(()=>{const p=j=>{j.key==="Escape"&&r()};return document.addEventListener("keydown",p),()=>document.removeEventListener("keydown",p)},[r]);const f=e.jsx(I.div,{className:"fixed inset-0 z-[1000] bg-black/80 backdrop-blur-lg flex items-start justify-center p-2 sm:p-4 pt-20 sm:pt-24",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:p=>{p.target===p.currentTarget&&r()},children:e.jsx(I.div,{className:"relative w-full max-w-6xl my-4 sm:my-8 rounded-xl overflow-y-auto flex flex-col",style:{height:"calc(100vh - 8rem)",maxHeight:"900px",minHeight:"600px"},initial:{scale:.9,y:50},animate:{scale:1,y:0},exit:{scale:.9,y:50},transition:{type:"spring",stiffness:300,damping:30},onClick:p=>p.stopPropagation(),children:e.jsxs(b,{className:"flex-1 p-4 sm:p-6 flex flex-col h-full bg-gradient-to-br from-purple-900/20 to-blue-900/20 border-purple-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 flex-shrink-0 pb-4 border-b border-white/10",children:[e.jsxs("h3",{className:"text-white font-semibold text-lg sm:text-xl flex items-center gap-2",children:[e.jsx(o,{Icon:n.Timeline,size:24,className:"text-blue-400"}),e.jsxs("span",{className:"truncate",children:["Scan du ",v]})]}),e.jsx("button",{onClick:r,className:"p-2 rounded-full bg-white/10 hover:bg-white/20 transition-colors flex-shrink-0","aria-label":"Fermer",children:e.jsx(o,{Icon:n.X,size:20,className:"text-white"})})]}),e.jsxs("div",{className:"flex-1 relative min-h-0 grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"lg:col-span-2 relative min-h-0",children:[m&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(o,{Icon:n.Loader2,size:48,className:"text-purple-400 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-white/70",children:"Chargement du scan..."})]})}),t&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-red-400",children:[e.jsx(o,{Icon:n.AlertCircle,size:48,className:"mx-auto mb-4"}),e.jsx("p",{children:"Erreur de chargement du scan"}),e.jsx("p",{className:"text-sm mt-2 text-red-300",children:t.message})]})}),l&&!m&&e.jsxs("div",{className:"w-full h-full relative min-h-[400px]",children:[(()=>{const p=l.metrics?.final_shape_params||l.metrics?.morph_values,j=l.metrics?.final_limb_masses||l.metrics?.limb_masses,x=l.metrics?.skin_tone,h=l.metrics?.resolved_gender||a?.sex;return console.log("HISTORICAL_SCAN_MODAL: Avatar3DViewer props:",{morphData:p,limbMasses:j,skinTone:x,resolvedGender:h,scanId:s,hasScanResult:!!l,hasUserProfile:!!a}),null})(),e.jsx(X,{ref:d,scanResult:l,userProfile:a,morphData:l.metrics?.final_shape_params||l.metrics?.morph_values,limbMasses:l.metrics?.final_limb_masses||l.metrics?.limb_masses,skinTone:l.metrics?.skin_tone,resolvedGender:l.metrics?.resolved_gender||a?.sex,className:"w-full h-full",autoRotate:!0,showControls:!0,onViewerReady:()=>c(!0)})]})]}),l&&!m&&e.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[e.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[e.jsxs("h4",{className:"text-white font-medium mb-3 flex items-center gap-2",children:[e.jsx(o,{Icon:n.BarChart3,size:16,className:"text-blue-400"}),"R√©sum√© du scan"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[l.metrics?.estimate_result?.processing_confidence&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/70",children:"Confiance"}),e.jsxs("span",{className:"text-white font-medium",children:[Math.round(l.metrics.estimate_result.processing_confidence*100),"%"]})]}),l.metrics?.resolved_gender&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/70",children:"Genre d√©tect√©"}),e.jsx("span",{className:"text-white font-medium capitalize",children:l.metrics.resolved_gender})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/70",children:"Date de cr√©ation"}),e.jsx("span",{className:"text-white font-medium",children:L(new Date(l.created_at),"HH:mm",{locale:H})})]})]})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[e.jsxs("h4",{className:"text-white font-medium mb-3 flex items-center gap-2",children:[e.jsx(o,{Icon:n.Ruler,size:16,className:"text-green-400"}),"Mesures"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[l.metrics?.estimate_result?.extracted_data?.raw_measurements?.weight_kg&&e.jsxs("div",{className:"text-center bg-white/5 rounded p-2",children:[e.jsx("p",{className:"text-white/50 text-xs",children:"Poids"}),e.jsxs("p",{className:"text-white font-medium",children:[l.metrics.estimate_result.extracted_data.raw_measurements.weight_kg.toFixed(1)," kg"]})]}),l.metrics?.estimate_result?.extracted_data?.raw_measurements?.height_cm&&e.jsxs("div",{className:"text-center bg-white/5 rounded p-2",children:[e.jsx("p",{className:"text-white/50 text-xs",children:"Taille"}),e.jsxs("p",{className:"text-white font-medium",children:[l.metrics.estimate_result.extracted_data.raw_measurements.height_cm.toFixed(1)," cm"]})]}),l.metrics?.estimate_result?.estimated_bmi&&e.jsxs("div",{className:"text-center bg-white/5 rounded p-2",children:[e.jsx("p",{className:"text-white/50 text-xs",children:"IMC"}),e.jsx("p",{className:"text-white font-medium",children:l.metrics.estimate_result.estimated_bmi.toFixed(1)})]}),l.metrics?.estimate_result?.extracted_data?.processing_confidence&&e.jsxs("div",{className:"text-center bg-white/5 rounded p-2",children:[e.jsx("p",{className:"text-white/50 text-xs",children:"Pr√©cision"}),e.jsxs("p",{className:"text-white font-medium",children:[Math.round(l.metrics.estimate_result.extracted_data.processing_confidence*100),"%"]})]})]})]}),(l.metrics?.final_shape_params||l.metrics?.morph_values)&&e.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[e.jsxs("h4",{className:"text-white font-medium mb-3 flex items-center gap-2",children:[e.jsx(o,{Icon:n.Zap,size:16,className:"text-purple-400"}),"Morphologie"]}),e.jsxs("div",{className:"text-sm text-white/70",children:[e.jsxs("p",{children:["Mod√®le 3D g√©n√©r√© avec ",Object.keys(l.metrics?.final_shape_params||l.metrics?.morph_values||{}).length," param√®tres morphologiques."]}),l.metrics?.final_limb_masses&&e.jsx("p",{className:"mt-2",children:"Masses des membres ajust√©es pour une repr√©sentation pr√©cise."})]})]})]})]})]})})});return oe.createPortal(f,document.body)},Te=()=>{const s=D(),{isPerformanceMode:r}=C(),i=r?"div":I.div,a=()=>{s("/body-scan")};return e.jsx(i,{...!r&&{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"}},className:"text-center py-12 py-1",children:e.jsx(b,{className:"p-8",style:{background:`radial-gradient(ellipse at center,
            rgba(139, 92, 246, 0.15) 0%,
            rgba(167, 139, 250, 0.08) 50%,
            rgba(0, 0, 0, 0.4) 100%)`,borderColor:"rgba(139, 92, 246, 0.3)",boxShadow:`
            0 0 30px rgba(139, 92, 246, 0.2),
            0 8px 32px rgba(0, 0, 0, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.1)
          `,backdropFilter:"blur(20px) saturate(1.2)"},children:e.jsxs("div",{className:"space-y-6 flex flex-col items-center",children:[e.jsx("div",{className:"w-20 h-20 mx-auto rounded-2xl flex items-center justify-center",style:{background:`radial-gradient(circle,
                rgba(139, 92, 246, 0.3) 0%,
                rgba(167, 139, 250, 0.15) 70%,
                transparent 100%)`,border:"1px solid rgba(139, 92, 246, 0.4)",boxShadow:`
                0 0 25px rgba(139, 92, 246, 0.3),
                0 4px 20px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2)
              `},children:e.jsx(o,{Icon:n.History,size:48,className:"text-violet-400",style:{filter:`drop-shadow(0 0 12px rgba(139, 92, 246, 0.8))
                         drop-shadow(0 2px 8px rgba(0, 0, 0, 0.3))`}})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-3",children:"Construisez votre historique corporel"}),e.jsx("p",{className:"text-white/70 text-lg",children:"Effectuez votre premier scan pour suivre votre √©volution"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 my-8",children:[e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-xl flex items-center justify-center",style:{background:`radial-gradient(circle,
                    rgba(139, 92, 246, 0.3) 0%,
                    rgba(167, 139, 250, 0.1) 70%,
                    transparent 100%)`,border:"1px solid rgba(139, 92, 246, 0.4)",boxShadow:`
                    0 0 20px rgba(139, 92, 246, 0.3),
                    0 4px 15px rgba(0, 0, 0, 0.2),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2)
                  `},children:e.jsx(o,{Icon:n.Clock,size:24,className:"text-violet-400",style:{filter:`drop-shadow(0 0 8px rgba(139, 92, 246, 0.6))
                             drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3))`}})}),e.jsx("h3",{className:"font-semibold text-white",children:"Timeline compl√®te"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Visualisez tous vos scans dans l'ordre chronologique"})]}),e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-xl flex items-center justify-center",style:{background:`radial-gradient(circle,
                    rgba(139, 92, 246, 0.3) 0%,
                    rgba(167, 139, 250, 0.1) 70%,
                    transparent 100%)`,border:"1px solid rgba(139, 92, 246, 0.4)",boxShadow:`
                    0 0 20px rgba(139, 92, 246, 0.3),
                    0 4px 15px rgba(0, 0, 0, 0.2),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2)
                  `},children:e.jsx(o,{Icon:n.TrendingUp,size:24,className:"text-violet-400",style:{filter:`drop-shadow(0 0 8px rgba(139, 92, 246, 0.6))
                             drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3))`}})}),e.jsx("h3",{className:"font-semibold text-white",children:"√âvolution suivie"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Suivez vos transformations physiques dans le temps"})]}),e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-xl flex items-center justify-center",style:{background:`radial-gradient(circle,
                    rgba(139, 92, 246, 0.3) 0%,
                    rgba(167, 139, 250, 0.1) 70%,
                    transparent 100%)`,border:"1px solid rgba(139, 92, 246, 0.4)",boxShadow:`
                    0 0 20px rgba(139, 92, 246, 0.3),
                    0 4px 15px rgba(0, 0, 0, 0.2),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2)
                  `},children:e.jsx(o,{Icon:n.BarChart,size:24,className:"text-violet-400",style:{filter:`drop-shadow(0 0 8px rgba(139, 92, 246, 0.6))
                             drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3))`}})}),e.jsx("h3",{className:"font-semibold text-white",children:"Comparaisons d√©taill√©es"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Comparez vos scans pour mesurer vos progr√®s"})]})]}),e.jsx("div",{className:"pt-4",children:e.jsxs("button",{onClick:a,className:"group relative px-8 py-4 text-white font-semibold rounded-2xl transform hover:scale-105 transition-all duration-300",style:{background:`linear-gradient(135deg,
                  rgba(139, 92, 246, 0.8) 0%,
                  rgba(167, 139, 250, 0.9) 100%)`,border:"2px solid rgba(139, 92, 246, 0.6)",boxShadow:`
                  0 0 30px rgba(139, 92, 246, 0.4),
                  0 8px 25px rgba(0, 0, 0, 0.3),
                  inset 0 1px 0 rgba(255, 255, 255, 0.2),
                  inset 0 -1px 0 rgba(0, 0, 0, 0.2)
                `,backdropFilter:"blur(10px) saturate(1.2)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{Icon:n.Camera,size:24,className:"group-hover:rotate-12 transition-transform duration-300",style:{color:"white",filter:`drop-shadow(0 0 10px rgba(139, 92, 246, 0.8))
                             drop-shadow(0 2px 6px rgba(0, 0, 0, 0.3))`}}),e.jsx("span",{className:"text-lg",children:"Effectuer mon premier scan"})]}),e.jsx("div",{className:"absolute inset-0 rounded-2xl blur-xl opacity-50 group-hover:opacity-75 transition-opacity duration-300 -z-10",style:{background:`linear-gradient(135deg,
                    rgba(139, 92, 246, 0.6) 0%,
                    rgba(167, 139, 250, 0.6) 100%)`}})]})}),e.jsx("div",{className:"text-white/50 text-sm p-3 rounded-xl",style:{background:`radial-gradient(ellipse at center,
                rgba(139, 92, 246, 0.1) 0%,
                transparent 70%)`,border:"1px solid rgba(139, 92, 246, 0.2)",boxShadow:"0 0 15px rgba(139, 92, 246, 0.1)"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(o,{Icon:n.Lightbulb,size:16,className:"text-violet-400",style:{filter:"drop-shadow(0 0 6px rgba(139, 92, 246, 0.6))"}}),e.jsx("span",{children:"Astuce : Scannez-vous r√©guli√®rement pour des comparaisons plus pr√©cises !"})]})})]})})})},F=s=>typeof s=="number"&&Number.isFinite(s),k=s=>{if(typeof s=="number")return Number.isFinite(s)?s:void 0;if(typeof s=="string"){const r=parseFloat(s);return Number.isFinite(r)?r:void 0}},Ee=s=>/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s),Q=({children:s,tone:r="info"})=>e.jsx("span",{className:`ml-2 inline-flex items-center rounded-full px-2 py-0.5 text-[10px] uppercase tracking-wide ${r==="info"?"bg-blue-500/15 text-blue-200 border border-blue-400/20":"bg-white/5 text-white/50 border border-white/10"}`,children:s}),U=({icon:s,label:r,value:i})=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-white/5 border border-white/10 flex items-center justify-center shrink-0",children:e.jsx(o,{Icon:n[s],size:14,className:"text-white/70"})}),e.jsxs("div",{className:"flex-1 flex justify-between items-baseline",children:[e.jsx("span",{className:"text-white/60 text-xs",children:r}),e.jsx("span",{className:"text-white font-medium text-sm",children:typeof i=="number"?i.toFixed(1):i})]})]}),De=()=>{const{profile:s}=z(),r=s?.userId,{isPerformanceMode:i}=C(),[a,d]=_.useState(null),[g,c]=_.useState(!1),[l,m]=_.useState(4),{data:t,isLoading:v,error:f}=$({queryKey:["body-scan-history",r,l],queryFn:()=>J.getHistory(r,l),enabled:!!r,staleTime:5*60*1e3,gcTime:10*60*1e3}),p=w=>{d(w),c(!0)},j=()=>{d(null),c(!1)};if(v)return e.jsxs(b,{className:"text-center p-8",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, var(--color-body-scan-primary) 8%, transparent) 0%, transparent 60%),
            var(--glass-opacity-base)
          `,borderColor:"color-mix(in srgb, var(--color-body-scan-primary) 25%, transparent)",boxShadow:`
            var(--glass-shadow-sm),
            0 0 16px color-mix(in srgb, var(--color-body-scan-primary) 10%, transparent)
          `},children:[e.jsx(o,{Icon:n.Loader2,size:48,className:"bodyscan-text-accent loader-essential mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-white mb-3",children:"Chargement de l'historique..."}),e.jsx("p",{className:"text-white/70 text-sm",children:"R√©cup√©ration de vos scans pass√©s."})]});if(f)return e.jsxs(b,{className:"text-center p-8",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, var(--color-body-scan-error) 8%, transparent) 0%, transparent 60%),
            var(--glass-opacity-base)
          `,borderColor:"color-mix(in srgb, var(--color-body-scan-error) 25%, transparent)",boxShadow:`
            var(--glass-shadow-sm),
            0 0 16px color-mix(in srgb, var(--color-body-scan-error) 10%, transparent)
          `},children:[e.jsx(o,{Icon:n.AlertCircle,size:48,className:"bodyscan-text-error mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-white mb-3",children:"Erreur de chargement"}),e.jsx("p",{className:"bodyscan-text-error text-sm mb-6",children:f?.message}),e.jsx("button",{onClick:()=>window.location.reload(),className:"btn-glass--primary",children:"R√©essayer"})]});if(!t||t.length===0)return e.jsx(Te,{});const x=t.filter(w=>{const E=w.id&&typeof w.id=="string"&&Ee(w.id);return console.log("Scan ID:",w.id,"Valid UUID:",E),E}),h=n.History,S=()=>{m(w=>w+4)},N=t&&t.length>0&&t.length===l;return e.jsxs(u,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"},className:"space-y-6 w-full",children:[e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:e.jsx(P,{children:x.map(w=>{const E=new Date(w.created_at),A=w?.metrics,B=k(A?.estimate_result?.extracted_data?.raw_measurements?.weight_kg)??k(A?.estimate_result?.weight_kg)??k(A?.weight_kg),K=k(A?.estimate_result?.extracted_data?.raw_measurements?.height_cm)??k(A?.estimate_result?.height_cm)??k(A?.height_cm),re=k(A?.estimate_result?.estimated_bmi)??k(A?.estimated_bmi),te=!F(B)&&F(k(s?.weight_kg)),ie=!F(K)&&F(k(s?.height_cm)),V=B??k(s?.weight_kg),R=K??k(s?.height_cm);let O=re;if(!F(O)&&F(V)&&F(R)&&R>0){const Z=R/100;O=V/(Z*Z)}const W=k(A?.estimate_result?.extracted_data?.processing_confidence);return e.jsx(u,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:e.jsxs(b,{interactive:!0,className:"p-6",style:{background:`
                      radial-gradient(circle at 30% 20%, color-mix(in srgb, var(--color-body-scan-primary) 8%, transparent) 0%, transparent 60%),
                      var(--glass-opacity-base)
                    `,borderColor:"color-mix(in srgb, var(--color-body-scan-primary) 25%, transparent)",boxShadow:`
                      var(--glass-shadow-sm),
                      0 0 16px color-mix(in srgb, var(--color-body-scan-primary) 10%, transparent)
                    `},onClick:()=>p(w.id),children:[e.jsxs("div",{className:"bodyscan-flex-between",children:[e.jsxs("div",{className:"bodyscan-flex-center bodyscan-gap-sm",children:[e.jsx("div",{className:"bodyscan-header-icon-container",style:{width:"2.25rem",height:"2.25rem"},children:e.jsx(o,{Icon:h,size:18,style:{color:"var(--color-body-scan-primary)"},variant:"pure"})}),e.jsxs("h4",{className:"text-white font-semibold text-lg",children:["Scan du ",L(E,"dd MMMM yyyy",{locale:H})]})]}),e.jsx("div",{className:"text-xs text-white/50",children:L(E,"HH:mm",{locale:H})})]}),e.jsxs("div",{className:"space-y-3 mt-4",children:[e.jsxs("div",{className:"history-metric-row",children:[e.jsx(U,{icon:"Scale",label:"Poids",value:F(V)?V:"-"}),te&&e.jsx(Q,{tone:"muted",children:"profil"})]}),e.jsxs("div",{className:"history-metric-row",children:[e.jsx(U,{icon:"Ruler",label:"Taille",value:F(R)?R:"-"}),ie&&e.jsx(Q,{tone:"muted",children:"profil"})]}),e.jsx("div",{className:"history-metric-row",children:e.jsx(U,{icon:"Activity",label:"IMC",value:F(O)?O:"-"})}),F(W)&&e.jsxs("div",{className:"history-metric-row flex items-center gap-2 text-xs text-white/60",children:[e.jsx(o,{Icon:n.Shield,size:14,className:"text-white/60"}),e.jsx("span",{children:"Confiance"}),e.jsxs("span",{className:"text-white/80 font-medium",children:[Math.round(W*100),"%"]})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-white/10",children:e.jsx("button",{className:"btn-glass--secondary-nav bodyscan-size-full py-2 text-sm",children:"Voir le scan"})})]})},w.id)})})}),N&&e.jsx("div",{className:"flex justify-center mt-8",children:e.jsx(u,{as:"button",onClick:S,className:"btn-glass--secondary px-6 py-3",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{Icon:n.ChevronDown,size:16,className:"text-white/70"}),e.jsx("span",{children:"Charger plus de scans"})]})})}),e.jsx(P,{children:g&&a&&e.jsx(Me,{scanId:a,onClose:j})})]})},ze=({onStartScan:s})=>{const r=D(),{isPerformanceMode:i}=C(),a=i?"div":I.div,{profile:d}=z(),g=pe(d),c=()=>{s?s():r("/body-scan")};return e.jsxs(a,{...!i&&{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"}},className:"text-center py-12 py-1",children:[!g.isSufficient&&e.jsx("div",{className:"mb-6",children:e.jsx(de,{completion:g,forgeName:"l'avatar 3D",forgeColor:"#8B5CF6"})}),e.jsx(b,{className:"p-8",style:{background:`radial-gradient(ellipse at center,
            rgba(139, 92, 246, 0.15) 0%,
            rgba(167, 139, 250, 0.08) 50%,
            rgba(0, 0, 0, 0.4) 100%)`,borderColor:"rgba(139, 92, 246, 0.3)",boxShadow:`
            0 0 30px rgba(139, 92, 246, 0.2),
            0 8px 32px rgba(0, 0, 0, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.1)
          `,backdropFilter:"blur(20px) saturate(1.2)"},children:e.jsxs("div",{className:"space-y-6 flex flex-col items-center",children:[e.jsx("div",{className:"w-20 h-20 mx-auto rounded-2xl flex items-center justify-center",style:{background:`radial-gradient(circle,
                rgba(139, 92, 246, 0.3) 0%,
                rgba(167, 139, 250, 0.15) 70%,
                transparent 100%)`,border:"1px solid rgba(139, 92, 246, 0.4)",boxShadow:`
                0 0 25px rgba(139, 92, 246, 0.3),
                0 4px 20px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2)
              `},children:e.jsx(o,{Icon:n.Scan,size:48,className:"text-purple-400",style:{filter:`drop-shadow(0 0 12px rgba(139, 92, 246, 0.8))
                         drop-shadow(0 2px 8px rgba(0, 0, 0, 0.3))`}})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-3",children:"Cr√©ez votre avatar 3D personnalis√©"}),e.jsx("p",{className:"text-white/70 text-lg",children:"Scannez votre corps pour g√©n√©rer un reflet num√©rique pr√©cis"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 my-8",children:[e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-xl flex items-center justify-center",style:{background:`radial-gradient(circle,
                    rgba(139, 92, 246, 0.3) 0%,
                    rgba(167, 139, 250, 0.1) 70%,
                    transparent 100%)`,border:"1px solid rgba(139, 92, 246, 0.4)",boxShadow:`
                    0 0 20px rgba(139, 92, 246, 0.3),
                    0 4px 15px rgba(0, 0, 0, 0.2),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2)
                  `},children:e.jsx(o,{Icon:n.Camera,size:24,className:"text-purple-400",style:{filter:`drop-shadow(0 0 8px rgba(139, 92, 246, 0.6))
                             drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3))`}})}),e.jsx("h3",{className:"font-semibold text-white",children:"Capture intuitive"}),e.jsx("p",{className:"text-white/60 text-sm",children:"3 photos simples suffisent pour la magie"})]}),e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-xl flex items-center justify-center",style:{background:`radial-gradient(circle,
                    rgba(139, 92, 246, 0.3) 0%,
                    rgba(167, 139, 250, 0.1) 70%,
                    transparent 100%)`,border:"1px solid rgba(139, 92, 246, 0.4)",boxShadow:`
                    0 0 20px rgba(139, 92, 246, 0.3),
                    0 4px 15px rgba(0, 0, 0, 0.2),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2)
                  `},children:e.jsx(o,{Icon:n.Sparkles,size:24,className:"text-purple-400",style:{filter:`drop-shadow(0 0 8px rgba(139, 92, 246, 0.6))
                             drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3))`}})}),e.jsx("h3",{className:"font-semibold text-white",children:"Analyse IA avanc√©e"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Estimation morphologique pr√©cise et personnalis√©e"})]}),e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-xl flex items-center justify-center",style:{background:`radial-gradient(circle,
                    rgba(139, 92, 246, 0.3) 0%,
                    rgba(167, 139, 250, 0.1) 70%,
                    transparent 100%)`,border:"1px solid rgba(139, 92, 246, 0.4)",boxShadow:`
                    0 0 20px rgba(139, 92, 246, 0.3),
                    0 4px 15px rgba(0, 0, 0, 0.2),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2)
                  `},children:e.jsx(o,{Icon:n.Eye,size:24,className:"text-purple-400",style:{filter:`drop-shadow(0 0 8px rgba(139, 92, 246, 0.6))
                             drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3))`}})}),e.jsx("h3",{className:"font-semibold text-white",children:"Visualisation 3D"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Explorez votre avatar sous tous les angles"})]})]}),e.jsx("div",{className:"pt-4",children:e.jsxs("button",{onClick:c,className:"group relative px-8 py-4 text-white font-semibold rounded-2xl transform hover:scale-105 transition-all duration-300",style:{background:`linear-gradient(135deg,
                  rgba(139, 92, 246, 0.8) 0%,
                  rgba(167, 139, 250, 0.9) 100%)`,border:"2px solid rgba(139, 92, 246, 0.6)",boxShadow:`
                  0 0 30px rgba(139, 92, 246, 0.4),
                  0 8px 25px rgba(0, 0, 0, 0.3),
                  inset 0 1px 0 rgba(255, 255, 255, 0.2),
                  inset 0 -1px 0 rgba(0, 0, 0, 0.2)
                `,backdropFilter:"blur(10px) saturate(1.2)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{Icon:n.Scan,size:24,className:"group-hover:scale-110 transition-transform duration-300",style:{color:"white",filter:`drop-shadow(0 0 10px rgba(139, 92, 246, 0.8))
                             drop-shadow(0 2px 6px rgba(0, 0, 0, 0.3))`}}),e.jsx("span",{className:"text-lg",children:"Commencer mon body scan"})]}),e.jsx("div",{className:"absolute inset-0 rounded-2xl blur-xl opacity-50 group-hover:opacity-75 transition-opacity duration-300 -z-10",style:{background:`linear-gradient(135deg,
                    rgba(139, 92, 246, 0.6) 0%,
                    rgba(167, 139, 250, 0.6) 100%)`}})]})}),e.jsx("div",{className:"text-white/50 text-sm p-3 rounded-xl",style:{background:`radial-gradient(ellipse at center,
                rgba(139, 92, 246, 0.1) 0%,
                transparent 70%)`,border:"1px solid rgba(139, 92, 246, 0.2)",boxShadow:"0 0 15px rgba(139, 92, 246, 0.1)"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(o,{Icon:n.Lightbulb,size:16,className:"text-purple-400",style:{filter:"drop-shadow(0 0 6px rgba(139, 92, 246, 0.6))"}}),e.jsx("span",{children:"Astuce : Portez des v√™tements ajust√©s pour une analyse morphologique optimale !"})]})})]})})]})};function Be(s){if(!s)return 1/0;const r=new Date,i=new Date(s),a=Math.abs(r.getTime()-i.getTime());return Math.ceil(a/(1e3*60*60*24))}function $e(s){return s===1/0?{status:"never_scanned",urgency:"high",color:"#8B5CF6",message:"Cr√©ez votre premier avatar",subtitle:"Commencez votre parcours de transformation corporelle"}:s<=7?{status:"up_to_date",urgency:"low",color:"#8B5CF6",message:"Vous √™tes √† jour !",subtitle:`Dernier scan il y a ${s} jour${s>1?"s":""}`}:s<=10?{status:"due_soon",urgency:"medium",color:"#F59E0B",message:"Scan recommand√© bient√¥t",subtitle:`Dernier scan il y a ${s} jours`}:{status:"overdue",urgency:"high",color:"#EF4444",message:"Nouveau scan recommand√©",subtitle:`Dernier scan il y a ${s} jours`}}async function Re(s){const{data:r,error:i}=await G.from("body_scans").select("id, created_at, timestamp").eq("user_id",s).order("created_at",{ascending:!1}).limit(1);if(i)throw y.error("SCAN_CTA","Failed to fetch latest body scan",{error:i.message,userId:s,timestamp:new Date().toISOString()}),i;return r&&r.length>0?r[0]:null}const qe=()=>{const s=D(),{profile:r}=z(),{click:i,success:a}=Y(),{isPerformanceMode:d}=C(),{data:g,isLoading:c,error:l}=$({queryKey:["body-scans","latest",r?.userId],queryFn:()=>Re(r?.userId),enabled:!!r?.userId,staleTime:5*60*1e3,retry:1}),m=Be(g?.created_at||null),t=$e(m);if(!c&&!l&&t.status==="never_scanned")return e.jsx(ze,{});const v=()=>{i(),a(),y.info("SCAN_CTA","User initiated new scan from CTA",{userId:r?.userId,daysSinceLastScan:m,scanStatus:t.status,timestamp:new Date().toISOString()}),s("/body-scan")},f=()=>{i(),y.info("SCAN_CTA","User navigated to insights from CTA",{userId:r?.userId,daysSinceLastScan:m,scanStatus:t.status,timestamp:new Date().toISOString()}),s("/avatar#insights")};return c?e.jsx("div",{className:"space-y-6 w-full",children:e.jsxs(b,{className:"text-center p-8",style:{background:`
              radial-gradient(circle at 30% 20%, color-mix(in srgb, var(--color-body-scan-primary) 8%, transparent) 0%, transparent 60%),
              var(--glass-opacity-base)
            `,borderColor:"color-mix(in srgb, var(--color-body-scan-primary) 25%, transparent)",boxShadow:`
              var(--glass-shadow-sm),
              0 0 16px color-mix(in srgb, var(--color-body-scan-primary) 10%, transparent)
            `},children:[e.jsx(o,{Icon:n.Loader2,size:48,className:"bodyscan-text-accent loader-essential mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-white mb-3",children:"V√©rification de votre historique..."}),e.jsx("p",{className:"text-white/70 text-sm",children:"Analyse de vos scans pr√©c√©dents."})]})}):l?e.jsx("div",{className:"space-y-6 w-full",children:e.jsxs(b,{className:"text-center p-8",style:{background:`
              radial-gradient(circle at 30% 20%, color-mix(in srgb, var(--color-body-scan-error) 8%, transparent) 0%, transparent 60%),
              var(--glass-opacity-base)
            `,borderColor:"color-mix(in srgb, var(--color-body-scan-error) 25%, transparent)",boxShadow:`
              var(--glass-shadow-sm),
              0 0 16px color-mix(in srgb, var(--color-body-scan-error) 10%, transparent)
            `},children:[e.jsx(o,{Icon:n.AlertCircle,size:48,className:"bodyscan-text-error mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-white mb-3",children:"Erreur de chargement"}),e.jsx("p",{className:"bodyscan-text-error text-sm mb-6",children:l?.message}),e.jsx("button",{onClick:()=>window.location.reload(),className:"btn-glass--primary",children:"R√©essayer"})]})}):e.jsxs(u,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"},className:"space-y-6 w-full",children:[e.jsx(u,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:e.jsxs(b,{className:"p-8 text-center relative overflow-visible",style:{background:`
              radial-gradient(circle at 30% 20%, color-mix(in srgb, ${t.color} 12%, transparent) 0%, transparent 60%),
              radial-gradient(circle at 70% 80%, color-mix(in srgb, ${t.color} 8%, transparent) 0%, transparent 50%),
              var(--glass-opacity-base)
            `,borderColor:`color-mix(in srgb, ${t.color} 30%, transparent)`,boxShadow:`
              0 12px 40px rgba(0, 0, 0, 0.25),
              0 0 30px color-mix(in srgb, ${t.color} 20%, transparent),
              inset 0 2px 0 rgba(255, 255, 255, 0.15)
            `},children:[!d&&e.jsx("div",{className:"training-hero-corners","aria-hidden":"true",children:[0,1,2,3].map(p=>e.jsx(I.div,{className:"corner-particle",style:{position:"absolute",width:"8px",height:"8px",borderRadius:"2px",background:`linear-gradient(135deg, ${t.color}, rgba(255, 255, 255, 0.8))`,boxShadow:`0 0 20px ${t.color}`,top:p<2?"12px":"auto",bottom:p>=2?"12px":"auto",left:p%2===0?"12px":"auto",right:p%2===1?"12px":"auto"},initial:{rotate:p%2===0?45:-45},animate:{scale:[1,1.3,1],opacity:[.6,1,.6],rotate:p%2===0?[45,60,45]:[-45,-60,-45]},transition:{duration:3,repeat:1/0,delay:p*.2,ease:[.4,0,.2,1]}},p))}),e.jsx("div",{className:`absolute inset-0 rounded-inherit pointer-events-none ${d?"":"urgent-forge-glow-css"}`,style:{background:`radial-gradient(circle at center, color-mix(in srgb, ${t.color} 8%, transparent) 0%, transparent 70%)`,filter:d?"blur(10px)":"blur(20px)",transform:"scale(1.2)",zIndex:-1}}),e.jsxs(u,{className:"w-24 h-24 mx-auto mb-6 rounded-full flex items-center justify-center relative",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, ${t.color} 35%, transparent), color-mix(in srgb, ${t.color} 25%, transparent))
              `,border:`2px solid color-mix(in srgb, ${t.color} 50%, transparent)`,boxShadow:d?`0 0 20px color-mix(in srgb, ${t.color} 20%, transparent)`:`0 0 40px color-mix(in srgb, ${t.color} 40%, transparent)`},initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:300,damping:25,delay:.2},children:[e.jsx(o,{Icon:t.status==="never_scanned"?n.Scan:t.status==="up_to_date"?n.Check:n.Timer,size:48,style:{color:t.color},variant:"pure"}),t.urgency==="high"&&!d&&e.jsx(I.div,{className:"absolute inset-0 rounded-full border-2",style:{borderColor:`color-mix(in srgb, ${t.color} 40%, transparent)`},animate:{scale:[1,1.2,1],opacity:[.3,.6,.3]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}}),t.urgency==="high"&&d&&e.jsx("div",{className:"absolute inset-0 rounded-full border-2",style:{borderColor:`color-mix(in srgb, ${t.color} 40%, transparent)`,opacity:.5}}),t.status==="up_to_date"&&!d&&e.jsx(e.Fragment,{children:[...Array(6)].map((p,j)=>{const x=j*360/6,h=60,S=Math.cos(x*Math.PI/180)*h,N=Math.sin(x*Math.PI/180)*h;return e.jsx("div",{className:`absolute w-2 h-2 rounded-full dynamic-particle-css dynamic-particle-css--${j+1}`,style:{background:t.color,boxShadow:`0 0 12px color-mix(in srgb, ${t.color} 70%, transparent)`,"--particle-x":`${S*.4}px`,"--particle-y":`${N*.4}px`,"--particle-x-end":`${S}px`,"--particle-y-end":`${N}px`}},j)})})]}),e.jsxs(u,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},className:"mb-8",children:[e.jsx("h3",{className:"text-3xl font-bold mb-3",style:{color:t.color},children:t.message}),e.jsx("p",{className:"text-white/80 text-lg leading-relaxed max-w-md mx-auto",children:t.subtitle})]}),e.jsxs(u,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.6},className:"mb-8 p-4 rounded-xl",style:{background:`color-mix(in srgb, ${t.color} 8%, transparent)`,border:`1px solid color-mix(in srgb, ${t.color} 20%, transparent)`,backdropFilter:"blur(12px) saturate(130%)"},children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx(o,{Icon:n.Info,size:16,style:{color:t.color}}),e.jsx("span",{className:"text-white font-medium text-sm",children:"Recommandation TwinForge"})]}),e.jsx("p",{className:"text-white/80 text-sm leading-relaxed",children:"Pour un suivi optimal de votre √©volution corporelle, nous recommandons un scan tous les 7 jours. Cela permet de d√©tecter les changements subtils et d'ajuster vos objectifs en cons√©quence."})]}),e.jsxs(u,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.8},className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsxs(u,{as:"button",onClick:v,className:"px-8 py-4 rounded-full font-bold text-lg text-white relative overflow-hidden min-h-[64px]",style:{background:`
                  linear-gradient(135deg,
                    color-mix(in srgb, ${t.color} 85%, transparent),
                    color-mix(in srgb, ${t.color} 70%, transparent)
                  )
                `,border:`2px solid ${t.color}`,boxShadow:`
                  0 12px 40px color-mix(in srgb, ${t.color} 40%, transparent),
                  0 0 60px color-mix(in srgb, ${t.color} 30%, transparent),
                  inset 0 3px 0 rgba(255, 255, 255, 0.4)
                `,backdropFilter:"blur(20px) saturate(160%)"},whileHover:{scale:1.02,y:-2,boxShadow:`
                  0 16px 50px color-mix(in srgb, ${t.color} 50%, transparent),
                  0 0 80px color-mix(in srgb, ${t.color} 40%, transparent),
                  inset 0 3px 0 rgba(255, 255, 255, 0.5)
                `},whileTap:{scale:.98},children:[!d&&e.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)",animation:"celebration-cta-shimmer-movement 2s ease-in-out infinite",borderRadius:"inherit"}}),e.jsxs("div",{className:"relative z-10 flex items-center justify-center gap-3",children:[e.jsx(o,{Icon:n.Scan,size:24,style:{color:"white",filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.3))"},variant:"pure"}),e.jsx("span",{style:{textShadow:"0 2px 4px rgba(0,0,0,0.3)"},children:t.status==="never_scanned"?"Cr√©er mon Avatar 3D":"Nouveau Scan"})]})]}),t.status!=="never_scanned"&&e.jsx(u,{as:"button",onClick:f,className:"px-6 py-4 rounded-full font-medium text-white/90 transition-all duration-200 min-h-[64px]",style:{background:`color-mix(in srgb, ${t.color} 8%, transparent)`,border:`1px solid color-mix(in srgb, ${t.color} 20%, transparent)`,backdropFilter:"blur(12px) saturate(130%)"},onMouseEnter:p=>{p.currentTarget.style.background=`color-mix(in srgb, ${t.color} 12%, transparent)`,p.currentTarget.style.borderColor=`color-mix(in srgb, ${t.color} 30%, transparent)`,p.currentTarget.style.transform="translateY(-1px) scale(1.02)"},onMouseLeave:p=>{p.currentTarget.style.background=`color-mix(in srgb, ${t.color} 8%, transparent)`,p.currentTarget.style.borderColor=`color-mix(in srgb, ${t.color} 20%, transparent)`,p.currentTarget.style.transform="translateY(0) scale(1)"},whileHover:{scale:1.02,y:-1},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(o,{Icon:n.Zap,size:20,color:"white",variant:"pure"}),e.jsx("span",{children:"Voir mes Insights"})]})})]})]})}),t.status!=="never_scanned"&&e.jsx(u,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3},children:e.jsxs(b,{className:"p-6",style:{background:`
                radial-gradient(circle at 30% 20%, color-mix(in srgb, var(--color-body-scan-primary) 8%, transparent) 0%, transparent 60%),
                var(--glass-opacity-base)
              `,borderColor:"color-mix(in srgb, var(--color-body-scan-primary) 25%, transparent)",boxShadow:`
                0 12px 40px rgba(0, 0, 0, 0.25),
                0 0 30px color-mix(in srgb, var(--color-body-scan-primary) 15%, transparent),
                inset 0 2px 0 rgba(255, 255, 255, 0.15)
              `},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"text-white font-semibold bodyscan-flex-center bodyscan-gap-sm text-xl",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                      radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                      linear-gradient(135deg, color-mix(in srgb, var(--color-body-scan-primary) 35%, transparent), color-mix(in srgb, var(--color-body-scan-primary) 25%, transparent))
                    `,border:"2px solid color-mix(in srgb, var(--color-body-scan-primary) 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, var(--color-body-scan-primary) 30%, transparent)"},children:e.jsx(o,{Icon:n.TrendingUp,size:20,style:{color:"var(--color-body-scan-primary)"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-sm",children:"Suivi de Progression"}),e.jsx("div",{className:"text-white/60 text-xs font-normal mt-0.5",children:"√âtat de votre √©volution corporelle"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"bodyscan-status-badge bodyscan-status-badge--active",children:[e.jsx("div",{className:"bodyscan-status-icon"}),e.jsx("span",{className:"bodyscan-status-text",children:t.urgency==="low"?"√Ä jour":t.urgency==="medium"?"Bient√¥t":"Urgent"})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl font-bold mb-2",style:{color:t.color},children:m===1/0?"‚àû":m}),e.jsx("div",{className:"text-white/70 text-sm",children:m===1/0?"Aucun scan effectu√©":m===1?"jour depuis le dernier scan":"jours depuis le dernier scan"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-full bg-white/10 rounded-full h-3 overflow-hidden",children:e.jsx(u,{className:"h-3 rounded-full relative overflow-hidden",style:{background:`linear-gradient(90deg, ${t.color}, color-mix(in srgb, ${t.color} 80%, white))`,boxShadow:`0 0 12px ${t.color}60, inset 0 1px 0 rgba(255,255,255,0.3)`},initial:{width:0},animate:{width:`${Math.min(100,Math.max(0,100-m/7*100))}%`},transition:{duration:1.2,ease:"easeOut",delay:.5},children:e.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:`linear-gradient(90deg,
                          transparent 0%,
                          rgba(255,255,255,0.4) 50%,
                          transparent 100%
                        )`,animation:"progressShimmer 2s ease-in-out infinite"}})})}),e.jsxs("div",{className:"flex justify-between mt-2 text-xs text-white/50",children:[e.jsx("span",{children:"Nouveau"}),e.jsx("span",{children:"7 jours"})]})]}),e.jsx("div",{className:"text-center p-3 rounded-xl",style:{background:`color-mix(in srgb, ${t.color} 6%, transparent)`,border:`1px solid color-mix(in srgb, ${t.color} 15%, transparent)`},children:e.jsx("p",{className:"text-white/80 text-sm",children:t.status==="up_to_date"?`Prochain scan recommand√© dans ${7-m} jour${7-m>1?"s":""}`:"Un nouveau scan est recommand√© pour suivre votre √©volution"})})]})]})}),e.jsx(u,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.5},children:e.jsxs(b,{className:"p-6",style:{background:`
              radial-gradient(circle at 30% 20%, color-mix(in srgb, var(--color-body-scan-accent) 6%, transparent) 0%, transparent 60%),
              var(--glass-opacity-base)
            `,borderColor:"color-mix(in srgb, var(--color-body-scan-accent) 20%, transparent)",boxShadow:`
              var(--glass-shadow-sm),
              0 0 12px color-mix(in srgb, var(--color-body-scan-accent) 8%, transparent)
            `},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                  linear-gradient(135deg, color-mix(in srgb, #8B5CF6 35%, transparent), color-mix(in srgb, #8B5CF6 25%, transparent))
                `,border:"2px solid color-mix(in srgb, #8B5CF6 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #8B5CF6 30%, transparent)"},children:e.jsx(o,{Icon:n.Info,size:20,style:{color:"#8B5CF6"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Pourquoi scanner r√©guli√®rement ?"}),e.jsx("div",{className:"text-white/60 text-xs font-normal mt-0.5",children:"Optimisez votre suivi corporel avec des scans r√©guliers"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(u,{className:"morphology-insight-item",style:{"--insight-color":"#22C55E"},initial:{opacity:0,y:15},animate:{opacity:1,y:0},transition:{duration:.4,delay:.1},whileHover:{y:-2},children:[e.jsx("div",{className:"morphology-insight-icon-container",children:e.jsx(o,{Icon:n.TrendingUp,size:20,style:{color:"#22C55E"},variant:"pure"})}),e.jsx("div",{className:"morphology-insight-value",children:"Suivi Pr√©cis"}),e.jsx("div",{className:"morphology-insight-title",children:"D√©tectez les changements subtils"})]}),e.jsxs(u,{className:"morphology-insight-item",style:{"--insight-color":"#3B82F6"},initial:{opacity:0,y:15},animate:{opacity:1,y:0},transition:{duration:.4,delay:.2},whileHover:{y:-2},children:[e.jsx("div",{className:"morphology-insight-icon-container",children:e.jsx(o,{Icon:n.Zap,size:20,style:{color:"#3B82F6"},variant:"pure"})}),e.jsx("div",{className:"morphology-insight-value",children:"Insights IA"}),e.jsx("div",{className:"morphology-insight-title",children:"Recommandations personnalis√©es"})]}),e.jsxs(u,{className:"morphology-insight-item",style:{"--insight-color":"#A855F7"},initial:{opacity:0,y:15},animate:{opacity:1,y:0},transition:{duration:.4,delay:.3},whileHover:{y:-2},children:[e.jsx("div",{className:"morphology-insight-icon-container",children:e.jsx(o,{Icon:n.Heart,size:20,style:{color:"#A855F7"},variant:"pure"})}),e.jsx("div",{className:"morphology-insight-value",children:"Motivation"}),e.jsx("div",{className:"morphology-insight-title",children:"Visualisez vos progr√®s"})]})]})]})})]})};function Ve(s){switch(s){case"scanCta":return{icon:"Scan",title:"Forge Corporelle",subtitle:"Capturez votre √©volution corporelle avec un nouveau scan 3D",circuit:"avatar",color:"#8B5CF6"};case"avatar":return{icon:"Eye",title:"Votre Avatar 3D",subtitle:"Visualisez et ajustez votre reflet num√©rique personnalis√©",circuit:"avatar",color:"#06B6D4"};case"insights":return{icon:"Zap",title:"Insights Avatar",subtitle:"Analyses IA personnalis√©es et recommandations bas√©es sur votre scan corporel",circuit:"avatar",color:"#F59E0B"};case"history":return{icon:"History",title:"Historique des Scans",subtitle:"Revivez vos transformations corporelles au fil du temps",circuit:"avatar",color:"#8B5CF6"};default:return{icon:"Eye",title:"Votre Avatar 3D",subtitle:"Visualisez et ajustez votre reflet num√©rique personnalis√©",circuit:"avatar",color:"#8B5CF6"}}}const as=()=>{const s=le(),r=D(),{click:i}=Y(),a=T.useMemo(()=>{const c=s.hash.replace("#","");return["scanCta","avatar","insights","history"].includes(c)?c:"scanCta"},[s.hash]);xe(`avatar:${a}`);const d=Ve(a),g=c=>{const l=c||"scanCta";i(),y.debug("AVATAR_PAGE","Changement d'onglet d√©clench√©",{nouvelOnglet:l}),r({pathname:s.pathname,search:s.search,hash:`#${l}`},{replace:!1})};return e.jsxs("div",{className:"space-y-6 w-full max-w-none",children:[e.jsx(me,{icon:d.icon,title:d.title,subtitle:d.subtitle,circuit:d.circuit,iconColor:d.color}),e.jsxs(M,{defaultValue:"scanCta",className:"w-full min-w-0 avatar-tabs",onValueChange:g,forgeContext:"avatar",children:[e.jsxs(M.List,{role:"tablist","aria-label":"Sections de l'avatar",className:"mb-4 md:mb-6 w-full",children:[e.jsx(M.Trigger,{value:"scanCta",icon:"Scan","aria-controls":"panel-scancta",children:e.jsx("span",{className:"tab-text",children:"Scanner"})}),e.jsx(M.Trigger,{value:"avatar",icon:"Eye","aria-controls":"panel-avatar",children:e.jsx("span",{className:"tab-text",children:"Avatar"})}),e.jsx(M.Trigger,{value:"insights",icon:"Zap","aria-controls":"panel-insights",children:e.jsx("span",{className:"tab-text",children:"Insights"})}),e.jsx(M.Trigger,{value:"history",icon:"History","aria-controls":"panel-history",children:e.jsx("span",{className:"tab-text",children:"Historique"})})]}),e.jsx(M.Panel,{id:"panel-scancta",value:"scanCta",children:e.jsx(qe,{})}),e.jsx(M.Panel,{id:"panel-avatar",value:"avatar",children:e.jsx(ve,{})}),e.jsx(M.Panel,{id:"panel-insights",value:"insights",children:e.jsx(Fe,{})}),e.jsx(M.Panel,{id:"panel-history",value:"history",children:e.jsx(De,{})})]})]})};export{as as default};
