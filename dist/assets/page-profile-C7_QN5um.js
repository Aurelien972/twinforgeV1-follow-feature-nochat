var qe=Object.defineProperty;var Ge=(t,s,r)=>s in t?qe(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r;var U=(t,s,r)=>Ge(t,typeof s!="symbol"?s+"":s,r);import{j as e,R as _,f as ue,r as T,h as Ue,u as he}from"./vendor-ZbFMzY-i.js";import{G as D,S as d,I as o,u as le,b as Se}from"./ui-components-OHztaiDj.js";import{u as J,l as f,c as $e,H as Ve,s as X,a as xe}from"./page-fridge-C1QVLxk9.js";import{m as R,A as ee}from"./motion-HGAT--uT.js";import{o as W,s as B,_ as Q,n as H,p as Ce,a as ge,b as $,c as V}from"./forms-CBZzt5O6.js";import{a as q,h as Y}from"./stores-ZZM8MTtI.js";import{u as We}from"./page-fridge-scan-C_CisW7P.js";import{b as Ye,a as Ke}from"./date-utils-BlBdbPk_.js";class Je{constructor(){U(this,"capabilities");U(this,"config");U(this,"performanceObserver",null);U(this,"frameRateHistory",[]);U(this,"lastFrameTime",performance.now());U(this,"rafId",null);this.capabilities=this.detectCapabilities(),this.config=this.generateConfig(),this.startMonitoring()}detectCapabilities(){const s=this.detectMobile(),r="ontouchstart"in window||navigator.maxTouchPoints>0,i=window.matchMedia("(prefers-reduced-motion: reduce)").matches,a=this.detectGPU(),l=navigator.deviceMemory||this.estimateRAM(),n=navigator.hardwareConcurrency||2,c=this.detectNetworkSpeed(),m=this.detectBatteryLevel(),u=this.detectLowPowerMode();return{performanceLevel:this.calculatePerformanceLevel(a,l,n,s),gpuAvailable:a,ram:l,cores:n,isMobile:s,hasTouch:r,prefersReducedMotion:i,networkSpeed:c,batteryLevel:m,isLowPowerMode:u}}detectMobile(){const s=navigator.userAgent,r=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(s),i=window.innerWidth<768;return r||i}detectGPU(){try{const s=document.createElement("canvas"),r=s.getContext("webgl")||s.getContext("experimental-webgl");if(!r)return!1;const i=r.getExtension("WEBGL_debug_renderer_info");if(i){const a=r.getParameter(i.UNMASKED_RENDERER_WEBGL);return!/Mali|Adreno [34]|PowerVR|VideoCore/i.test(a)}return!0}catch{return!1}}estimateRAM(){return this.detectMobile()?4:8}detectNetworkSpeed(){const s=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(!s)return"medium";const r=s.effectiveType;return r==="slow-2g"||r==="2g"?"slow":r==="3g"?"medium":"fast"}detectBatteryLevel(){}detectLowPowerMode(){return!1}calculatePerformanceLevel(s,r,i,a){let l=0;return s&&(l+=3),r>=8?l+=3:r>=4?l+=2:l+=1,i>=8?l+=3:i>=4?l+=2:l+=1,a||(l+=2),l>=11?"high":l>=7?"medium":"low"}generateConfig(){const s=this.capabilities.performanceLevel,r=this.capabilities.isMobile;return this.capabilities.prefersReducedMotion?{glassBlur:6,animationDuration:150,enableShimmer:!1,enablePulse:!1,enableGlow:!1,maxAnimations:2,useFramerMotion:!1,virtualizeThreshold:20}:s==="high"&&!r?{glassBlur:16,animationDuration:300,enableShimmer:!0,enablePulse:!0,enableGlow:!0,maxAnimations:8,useFramerMotion:!0,virtualizeThreshold:50}:s==="medium"||s==="high"&&r?{glassBlur:12,animationDuration:250,enableShimmer:!1,enablePulse:!0,enableGlow:!0,maxAnimations:4,useFramerMotion:!1,virtualizeThreshold:30}:{glassBlur:6,animationDuration:200,enableShimmer:!1,enablePulse:!1,enableGlow:!1,maxAnimations:2,useFramerMotion:!1,virtualizeThreshold:15}}startMonitoring(){if(this.monitorFrameRate(),"PerformanceObserver"in window)try{this.performanceObserver=new PerformanceObserver(s=>{for(const r of s.getEntries())r.duration>50&&(console.warn("[DeviceCapability] Long task detected:",r.duration,"ms"),this.degradePerformanceIfNeeded())}),this.performanceObserver.observe({entryTypes:["longtask"]})}catch{}"getBattery"in navigator&&navigator.getBattery().then(s=>{s.addEventListener("levelchange",()=>{s.level<.2&&this.enableLowPowerMode()})}),document.addEventListener("visibilitychange",()=>{document.hidden?this.pauseMonitoring():this.resumeMonitoring()})}monitorFrameRate(){let s=0;const r=5,i=()=>{const a=performance.now(),n=1e3/(a-this.lastFrameTime);this.frameRateHistory.push(n),this.frameRateHistory.length>120&&this.frameRateHistory.shift(),this.frameRateHistory.reduce((m,u)=>m+u,0)/this.frameRateHistory.length<45&&this.frameRateHistory.length>=120?(s++,s>=r&&(this.degradePerformanceIfNeeded(),s=0)):s=0,this.lastFrameTime=a,this.rafId=requestAnimationFrame(i)};this.rafId=requestAnimationFrame(i)}degradePerformanceIfNeeded(){const s=this.capabilities.performanceLevel;s==="high"?(this.capabilities.performanceLevel="medium",this.config=this.generateConfig(),this.applyConfigToDOM(),console.log("[DeviceCapability] Degraded to medium performance due to sustained low FPS")):s==="medium"&&(this.capabilities.performanceLevel="low",this.config=this.generateConfig(),this.applyConfigToDOM(),console.log("[DeviceCapability] Degraded to low performance due to sustained low FPS"))}enableLowPowerMode(){this.capabilities.isLowPowerMode=!0,this.capabilities.performanceLevel="low",this.config=this.generateConfig(),this.applyConfigToDOM(),console.info("[DeviceCapability] Low power mode enabled")}applyConfigToDOM(){document.documentElement.style.setProperty("--glass-blur-adaptive",`${this.config.glassBlur}px`),document.documentElement.style.setProperty("--animation-duration-adaptive",`${this.config.animationDuration}ms`),document.documentElement.classList.remove("perf-high","perf-medium","perf-low"),document.documentElement.classList.add(`perf-${this.capabilities.performanceLevel}`),this.config.enableShimmer||document.documentElement.classList.add("disable-shimmer"),this.config.enablePulse||document.documentElement.classList.add("disable-pulse"),this.config.enableGlow||document.documentElement.classList.add("disable-glow")}pauseMonitoring(){this.rafId!==null&&(cancelAnimationFrame(this.rafId),this.rafId=null)}resumeMonitoring(){this.rafId===null&&(this.lastFrameTime=performance.now(),this.monitorFrameRate())}getCapabilities(){return{...this.capabilities}}getConfig(){return{...this.config}}shouldUseFramerMotion(){return this.config.useFramerMotion}shouldVirtualize(s){return s>this.config.virtualizeThreshold}getGlassBlur(){return this.config.glassBlur}getAnimationDuration(){return this.config.animationDuration}canUseEffect(s){switch(s){case"shimmer":return this.config.enableShimmer;case"pulse":return this.config.enablePulse;case"glow":return this.config.enableGlow;default:return!1}}destroy(){this.pauseMonitoring(),this.performanceObserver&&this.performanceObserver.disconnect()}}const te=new Je;function Ze(){return{capabilities:te.getCapabilities(),config:te.getConfig(),shouldUseFramerMotion:te.shouldUseFramerMotion(),shouldVirtualize:t=>te.shouldVirtualize(t),canUseEffect:t=>te.canUseEffect(t),getGlassBlur:()=>te.getGlassBlur(),getAnimationDuration:()=>te.getAnimationDuration()}}function Xe(t,s,r){const i=typeof t=="number"&&!isNaN(t)&&t>0,a=typeof s=="number"&&!isNaN(s)&&s>0,l=r===void 0||typeof r=="number"&&!isNaN(r)&&r>0;return i&&a&&l}function Me(t,s){if(!t||!s||t<=0||s<=0)return 0;const r=s/100,i=t/(r*r);return!Number.isFinite(i)||Number.isNaN(i)?0:i}function Qe(t,s){const r=Me(t,s);return r===0?"--":r.toFixed(1)}function et(t,s){if(!t||!s||t<=0||s<=0)return"--";const r=t-s;return!Number.isFinite(r)||Number.isNaN(r)?"--":`${r>0?"+":""}${r.toFixed(1)} kg`}function tt(t){return!Number.isFinite(t)||Number.isNaN(t)||t<=0?"--":t<18.5?"Insuffisant":t<25?"Normal":t<30?"Surpoids":"Obésité"}const st=({percentage:t,title:s,subtitle:r,color:i="#60A5FA"})=>e.jsxs(D,{className:"p-6 mb-6",style:{background:`
        radial-gradient(circle at 30% 20%, color-mix(in srgb, ${i} 8%, transparent) 0%, transparent 60%),
        var(--glass-opacity)
      `,borderColor:`color-mix(in srgb, ${i} 20%, transparent)`},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{children:e.jsxs("h3",{className:"text-white font-semibold text-xl mb-1 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                  linear-gradient(135deg, color-mix(in srgb, ${i} 35%, transparent), color-mix(in srgb, ${i} 25%, transparent))
                `,border:`2px solid color-mix(in srgb, ${i} 50%, transparent)`,boxShadow:`0 0 20px color-mix(in srgb, ${i} 30%, transparent)`},children:e.jsx(d,{Icon:o.User,size:20,style:{color:i},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:s}),r&&e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:r})]})]})}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{background:i,boxShadow:`0 0 8px ${i}60`}}),e.jsxs("span",{className:"text-white font-bold text-lg",children:[t,"%"]})]}),e.jsx("span",{className:"text-white/60 text-xs",children:"Complété"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-full bg-white/10 rounded-full h-3 overflow-hidden",children:e.jsx(R.div,{className:"h-3 rounded-full relative overflow-hidden",style:{background:`linear-gradient(90deg, ${i}, color-mix(in srgb, ${i} 80%, white))`,boxShadow:`0 0 12px ${i}60, inset 0 1px 0 rgba(255,255,255,0.3)`},initial:{width:0},animate:{width:`${t}%`},transition:{duration:1.2,ease:"easeOut"},children:e.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:`linear-gradient(90deg, 
                  transparent 0%, 
                  rgba(255,255,255,0.4) 50%, 
                  transparent 100%
                )`,animation:"progressShimmer 2s ease-in-out infinite"}})})}),e.jsxs("div",{className:"flex justify-between mt-2 text-xs text-white/50",children:[e.jsx("span",{children:"0%"}),e.jsx("span",{children:"25%"}),e.jsx("span",{children:"50%"}),e.jsx("span",{children:"75%"}),e.jsx("span",{children:"100%"})]})]})]}),pe=({isDirty:t,isSaving:s,onSave:r,sectionName:i})=>{const{formSubmit:a}=J();return t?e.jsx(R.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex justify-end mt-4",children:e.jsx("button",{type:"button",onClick:()=>{a(),r()},disabled:s,className:"btn-glass px-4 py-2 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[s?e.jsx(d,{Icon:o.Loader2,size:14,className:"animate-spin"}):e.jsx(d,{Icon:o.Save,size:14}),e.jsx("span",{children:s?"Sauvegarde...":`Sauvegarder ${i}`})]})})}):null},it=({height:t,weight:s,targetWeight:r})=>e.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs(D,{className:"p-6",style:{background:`
          radial-gradient(circle at 30% 20%, rgba(52, 211, 153, 0.08) 0%, transparent 60%),
          var(--glass-opacity)
        `,borderColor:"rgba(52, 211, 153, 0.2)"},children:[e.jsxs("h3",{className:"text-white font-semibold text-xl mb-6 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, #10B981 35%, transparent), color-mix(in srgb, #10B981 25%, transparent))
              `,border:"2px solid color-mix(in srgb, #10B981 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #10B981 30%, transparent)"},children:e.jsx(d,{Icon:o.Activity,size:20,style:{color:"#10B981"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Calculs Automatiques"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"Métriques calculées en temps réel"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center p-6 rounded-xl bg-emerald-500/10 border border-emerald-400/20",children:[e.jsx("div",{className:"text-3xl font-bold text-emerald-400 mb-2",children:Qe(s,t)}),e.jsx("div",{className:"text-emerald-300 text-sm font-medium",children:"Indice de Masse Corporelle"})]}),e.jsxs("div",{className:"text-center p-6 rounded-xl bg-blue-500/10 border border-blue-400/20",children:[e.jsx("div",{className:"text-xl font-bold text-blue-400 mb-2",children:tt(Me(s,t))}),e.jsx("div",{className:"text-blue-300 text-sm font-medium",children:"Catégorie"})]}),e.jsxs("div",{className:"text-center p-6 rounded-xl bg-purple-500/10 border border-purple-400/20",children:[e.jsx("div",{className:"text-xl font-bold text-purple-400 mb-2",children:et(r,s)}),e.jsx("div",{className:"text-purple-300 text-sm font-medium",children:"Objectif"})]})]})]})}),rt=W({displayName:B().min(1,"Le nom est requis").max(50,"Le nom ne peut pas dépasser 50 caractères"),sex:Q(["male","female"],{required_error:"Le genre est requis"}),height_cm:Ce(t=>t===""||t===null||t===void 0?null:Number(t),H().nullable().refine(t=>t!==null&&t>0,{message:"La taille est requise et doit être supérieure à 0"}).refine(t=>t===null||t>=120&&t<=230,{message:"La taille doit être entre 120 et 230 cm"})),weight_kg:Ce(t=>t===""||t===null||t===void 0?null:Number(t),H().nullable().refine(t=>t!==null&&t>0,{message:"Le poids est requis et doit être supérieur à 0"}).refine(t=>t===null||t>=30&&t<=300,{message:"Le poids doit être entre 30 et 300 kg"})),birthdate:B().nullable().optional().transform(t=>!t||t===""?null:t),target_weight_kg:H().min(30,"Le poids cible doit être d'au moins 30 kg").max(300,"Le poids cible ne peut pas dépasser 300 kg").nullable().optional().transform(t=>t===0||!t?null:t),activity_level:Q(["sedentary","light","moderate","active","athlete"]).nullable().optional().transform(t=>!t||t===""?null:t),objective:Q(["fat_loss","recomp","muscle_gain"]).nullable().optional().transform(t=>!t||t===""?null:t),job_category:Q(["office","field","shift","manual","student","other"]).nullable().optional().transform(t=>!t||t===""?null:t),phone_number:B().nullable().optional().transform(t=>!t||t===""?null:t),country:B().nullable().optional().transform(t=>!t||t===""?null:t)});function at(){const{profile:t,updateProfile:s,saving:r}=q(),{showToast:i}=le(),{success:a,formSubmit:l}=J(),[n,c]=_.useState(null),m=ue({resolver:ge(rt),defaultValues:{displayName:t?.displayName||"",sex:t?.sex||"",height_cm:t?.height_cm??null,weight_kg:t?.weight_kg??null,birthdate:t?.birthdate||null,target_weight_kg:t?.target_weight_kg??null,activity_level:t?.activity_level||null,objective:t?.objective||null,job_category:t?.job_category||null,phone_number:t?.phoneNumber||null,country:t?.country||null},mode:"onChange"}),{register:u,handleSubmit:b,formState:N,watch:y,setValue:S,reset:h,trigger:x}=m,{errors:v,isValid:I,isDirty:g,dirtyFields:p}=N,j=y();_.useEffect(()=>{Y.getState().setTabDirty("identity",g)},[g]);const M=async()=>{c("required");try{if(!await x(["displayName","sex","height_cm","weight_kg"]))return;await s({displayName:j.displayName,sex:j.sex,height_cm:j.height_cm,weight_kg:j.weight_kg,updated_at:new Date().toISOString()}),h({displayName:j.displayName,sex:j.sex,height_cm:j.height_cm,weight_kg:j.weight_kg,birthdate:j.birthdate,target_weight_kg:j.target_weight_kg,activity_level:j.activity_level,objective:j.objective,job_category:j.job_category,phone_number:j.phone_number,country:j.country}),Y.getState().resetTabDirty("identity"),a(),i({type:"success",title:"Informations de base sauvegardées",message:"Vos informations essentielles ont été mises à jour",duration:3e3})}catch{i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder les informations de base",duration:4e3})}finally{c(null)}},w=async()=>{c("optional");try{f.jsonLog("PROFILE_IDENTITY_SAVE_OPTIONAL","Starting optional section save",{watchedValues:{birthdate:j.birthdate,target_weight_kg:j.target_weight_kg,activity_level:j.activity_level,objective:j.objective,job_category:j.job_category,phone_number:j.phone_number,country:j.country},timestamp:new Date().toISOString()}),await s({birthdate:j.birthdate||null,target_weight_kg:j.target_weight_kg||null,activity_level:j.activity_level||null,objective:j.objective||null,job_category:j.job_category||null,phoneNumber:j.phone_number||null,country:j.country||null,updated_at:new Date().toISOString()}),h({displayName:j.displayName,sex:j.sex,height_cm:j.height_cm,weight_kg:j.weight_kg,birthdate:j.birthdate,target_weight_kg:j.target_weight_kg,activity_level:j.activity_level,objective:j.objective,job_category:j.job_category,phone_number:j.phone_number,country:j.country}),Y.getState().resetTabDirty("identity"),f.jsonLog("PROFILE_IDENTITY_SAVE_OPTIONAL_SUCCESS","Optional section save completed",{timestamp:new Date().toISOString()}),a(),i({type:"success",title:"Informations complémentaires sauvegardées",message:"Vos préférences ont été mises à jour",duration:3e3})}catch{i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder les informations complémentaires",duration:4e3})}finally{c(null)}},C=async k=>{try{l(),f.info("PROFILE_IDENTITY","Submitting complete profile updates",{userId:t?.userId,philosophy:"complete_profile_submission"}),await s({displayName:k.displayName,sex:k.sex,height_cm:k.height_cm,weight_kg:k.weight_kg,birthdate:k.birthdate||null,target_weight_kg:k.target_weight_kg||null,activity_level:k.activity_level||null,objective:k.objective||null,job_category:k.job_category||null,phoneNumber:k.phone_number||null,country:k.country||null,updated_at:new Date().toISOString()}),a(),i({type:"success",title:"Profil complet sauvegardé",message:"Toutes vos informations ont été mises à jour",duration:4e3}),Y.getState().resetTabDirty("identity"),h({displayName:k.displayName||"",sex:k.sex||"",height_cm:k.height_cm||null,weight_kg:k.weight_kg||null,birthdate:k.birthdate||null,target_weight_kg:k.target_weight_kg||null,activity_level:k.activity_level||null,objective:k.objective||null,job_category:k.job_category||null,phone_number:k.phone_number||null,country:k.country||null})}catch(P){f.error("PROFILE_IDENTITY","Profile update failed",{error:P instanceof Error?P.message:"Unknown error",userId:t?.userId}),i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder votre profil",duration:4e3})}},A=!!(p.displayName||p.sex||p.height_cm||p.weight_kg),E=!!(p.birthdate||p.target_weight_kg||p.activity_level||p.objective||p.job_category||p.phone_number||p.country);return{form:{register:u,handleSubmit:b,errors:v,isValid:I,isDirty:g,dirtyFields:p,watchedValues:j,setValue:S,trigger:x},actions:{saveRequiredSection:M,saveOptionalSection:w,onSubmit:C},state:{saving:r,sectionSaving:n,hasRequiredChanges:A,hasOptionalChanges:E}}}function ie(){const{capabilities:t,shouldUseFramerMotion:s,shouldVirtualize:r,canUseEffect:i,getAnimationDuration:a}=Ze();return T.useMemo(()=>{const n=t.performanceLevel,c=t.isMobile,m=t.prefersReducedMotion;return{shouldUseFramerMotion:s,shouldUseStagger:n==="high"&&!c,shouldUseAnimatePresence:n==="high"&&!c&&!m,enableTransitions:!m,animationDuration:a(),staggerDelay:n==="high"?.05:n==="medium"?.03:0,enableGlassEffects:i("glow"),enableShadows:n==="high"&&!c,enableGradients:n!=="low",enableHoverEffects:!c||n==="high",shouldVirtualize:r,shouldLazyLoad:c||n==="low"||n==="medium",shouldDeferNonCritical:c||n!=="high",performanceLevel:n,isMobile:c}},[t.performanceLevel,t.isMobile,t.prefersReducedMotion,s,r,i,a])}function nt(t){return T.useMemo(()=>{const{shouldUseFramerMotion:s,shouldUseStagger:r,animationDuration:i,staggerDelay:a}=t;return s?{container:r?{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:a,delayChildren:.1}}}:{},item:{hidden:{opacity:0,y:10},visible:{opacity:1,y:0,transition:{duration:i/1e3,ease:"easeOut"}}},panel:{initial:{opacity:0,y:20},enter:{opacity:1,y:0,transition:{duration:i/1e3,ease:"easeOut"}},exit:{opacity:0,y:-20,transition:{duration:i/1e3*.8,ease:"easeIn"}}}}:{container:{},item:{},panel:{}}},[t])}const Re=({children:t,performanceConfig:s,variants:r,initial:i,animate:a,exit:l,className:n="",style:c,enableStagger:m=!1})=>{const{shouldUseFramerMotion:u,shouldUseStagger:b,enableTransitions:N}=s;if(u&&(!m||b))return e.jsx(R.div,{variants:r,initial:i,animate:a,exit:l,className:n,style:c,children:t});const y=N?`${n} profile-motion-fallback`:n;return e.jsx("div",{className:y,style:c,children:t})},Fe=t=>e.jsx(Re,{...t,enableStagger:!0}),K=({children:t,performanceConfig:s,className:r,style:i,direction:a="up",distance:l=20})=>{const c={hidden:{opacity:0,...(()=>{switch(a){case"up":return{y:l};case"down":return{y:-l};case"left":return{x:l};case"right":return{x:-l}}})()},visible:{opacity:1,x:0,y:0,transition:{duration:s.animationDuration/1e3,ease:"easeOut"}}};return e.jsx(Re,{performanceConfig:s,variants:c,initial:"hidden",animate:"visible",className:r,style:i,children:t})};function ne(t,s){const r=s.split(".");let i=t;for(const a of r){if(!i||i[a]===void 0||i[a]===null)return!1;i=i[a]}return s==="nutrition.allergies"?t?.nutrition?.noKnownAllergies===!0?!0:Array.isArray(i)&&i.length>0:s==="nutrition.intolerances"?Array.isArray(i):typeof i=="string"?i.trim()!=="":Array.isArray(i)?i.length>0:typeof i=="boolean"?!0:typeof i=="object"?Object.keys(i).length>0:typeof i=="number"?new Set(["householdDetails.children","sensoryPreferences.spiceTolerance"]).has(s)?Number.isFinite(i)&&i>=0:Number.isFinite(i)&&i>0:!0}function lt(t){if(!t)return 0;const s=["displayName","sex","height_cm","weight_kg","birthdate","target_weight_kg","activity_level","objective","job_category","phoneNumber"],r=s.filter(i=>ne(t,i));return Math.round(r.length/s.length*100)}function ot(t){if(!t)return 0;const s=["nutrition.diet","nutrition.budgetLevel","nutrition.allergies","nutrition.intolerances","householdDetails.adults","householdDetails.children","mealPrepPreferences.weekdayTimeMin","mealPrepPreferences.weekendTimeMin","mealPrepPreferences.cookingSkill","kitchenEquipment.oven","kitchenEquipment.stove","kitchenEquipment.microwave","foodPreferences.cuisines","foodPreferences.ingredients","sensoryPreferences.spiceTolerance","shoppingPreferences.frequencyPerWeek"];let r=0;const i=s.length;for(const l of s)ne(t,l)&&r++;return Math.max(0,Math.min(100,Math.round(r/i*100)))}function ct(t){if(!t)return 0;const s=["fastingWindow.protocol","fastingWindow.start","fastingWindow.end","fastingWindow.windowHours","fastingWindow.mealsPerDay","nutrition.proteinTarget_g","macroTargets.kcal"],r=s.filter(i=>ne(t,i));return Math.round(r.length/s.length*100)}function dt(t){if(!t)return 0;const s=t.health;if(!s)return 0;if(s.version==="2.0"){const a=["health.basic.bloodType","health.medical_history.conditions","health.medical_history.medications","health.medical_history.family_history","health.vital_signs.blood_pressure_systolic","health.vital_signs.resting_heart_rate","health.lifestyle.smoking_status","health.lifestyle.alcohol_frequency","health.lifestyle.sleep_hours_avg","health.lifestyle.stress_level","health.lifestyle.physical_activity_level","health.vaccinations.up_to_date","health.physical_limitations","health.last_checkup_date"],l=a.filter(n=>ne(t,n));return Math.round(l.length/a.length*100)}const r=["health.bloodType","health.conditions","health.medications","health.physicalLimitations","constraints"],i=r.filter(a=>ne(t,a));return Math.round(i.length/r.length*100)}const mt=_.memo(()=>{const{form:t,actions:s,state:r}=at(),{register:i,handleSubmit:a,errors:l,isValid:n,isDirty:c,watchedValues:m}=t,{saveRequiredSection:u,onSubmit:b}=s,{saving:N,sectionSaving:y,hasRequiredChanges:S,hasOptionalChanges:h}=r,{profile:x}=q(),v=ie();nt(v);const I=()=>{const p=document.getElementById("global-save-button-container");p&&p.scrollIntoView({behavior:"smooth"})},g=T.useMemo(()=>lt(x),[x?.displayName,x?.sex,x?.height_cm,x?.weight_kg]);return e.jsxs(K,{performanceConfig:v,direction:"up",distance:20,className:"space-y-6 profile-section",children:[e.jsx(st,{percentage:g,title:"Identité Personnelle",subtitle:"Vos informations de base et mesures corporelles",color:"#60A5FA"}),e.jsxs("form",{onSubmit:a(b),className:"space-y-6",children:[e.jsxs(D,{className:"p-6 profile-glass-card",style:{background:v.enableGradients?`
            radial-gradient(circle at 30% 20%, rgba(96, 165, 250, 0.08) 0%, transparent 60%),
            var(--glass-opacity)
          `:"var(--glass-opacity)",borderColor:"rgba(96, 165, 250, 0.2)","--fallback-solid-color":"rgba(96, 165, 250, 0.05)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 ${v.enableShadows?"profile-shadow":""}`,style:{background:v.enableGradients?`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, #60A5FA 35%, transparent), color-mix(in srgb, #60A5FA 25%, transparent))
                  `:"rgba(96, 165, 250, 0.2)",border:"2px solid color-mix(in srgb, #60A5FA 50%, transparent)",boxShadow:v.enableShadows?"0 0 20px color-mix(in srgb, #60A5FA 30%, transparent)":"none"},children:e.jsx(d,{Icon:o.User,size:20,style:{color:"#60A5FA"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Informations Essentielles"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"Vos données de base et mesures corporelles"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-400"}),e.jsx("span",{className:"text-red-300 text-sm font-medium",children:"Requis"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"displayName",className:"block text-white/90 text-sm font-medium mb-3",children:"Prénom *"}),e.jsx("input",{...i("displayName"),type:"text",id:"displayName",className:"glass-input",placeholder:"Votre prénom"}),l.displayName&&e.jsxs("p",{className:"text-red-300 text-xs mt-2 flex items-center gap-1",children:[e.jsx(d,{Icon:o.AlertCircle,size:12}),l.displayName.message]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sex",className:"block text-white/90 text-sm font-medium mb-3",children:"Genre *"}),e.jsxs("select",{...i("sex"),id:"sex",className:"glass-input",children:[e.jsx("option",{value:"",children:"Sélectionnez votre genre"}),e.jsx("option",{value:"male",children:"Homme"}),e.jsx("option",{value:"female",children:"Femme"})]}),l.sex&&e.jsxs("div",{className:"text-red-300 text-xs mt-2 flex items-center gap-1",children:[e.jsx(d,{Icon:o.AlertCircle,size:12}),l.sex.message]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"height_cm",className:"block text-white/90 text-sm font-medium mb-3",children:"Taille (cm) *"}),e.jsx("input",{...i("height_cm",{valueAsNumber:!0}),type:"number",id:"height_cm",min:"120",max:"230",step:"1",className:"glass-input",placeholder:"175"}),l.height_cm&&e.jsxs("div",{className:"text-red-300 text-xs mt-2 flex items-center gap-1",children:[e.jsx(d,{Icon:o.AlertCircle,size:12}),l.height_cm.message]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"weight_kg",className:"block text-white/90 text-sm font-medium mb-3",children:"Poids (kg) *"}),e.jsx("input",{...i("weight_kg",{valueAsNumber:!0}),type:"number",id:"weight_kg",min:"30",max:"300",step:"0.1",className:"glass-input",placeholder:"70"}),l.weight_kg&&e.jsxs("div",{className:"text-red-300 text-xs mt-2 flex items-center gap-1",children:[e.jsx(d,{Icon:o.AlertCircle,size:12}),l.weight_kg.message]})]})]}),e.jsx(pe,{isDirty:S,isSaving:y==="required",onSave:u,sectionName:"Essentielles"})]}),e.jsxs(D,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, rgba(96, 165, 250, 0.08) 0%, transparent 60%),
            var(--glass-opacity)
          `,borderColor:"rgba(96, 165, 250, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, #60A5FA 35%, transparent), color-mix(in srgb, #60A5FA 25%, transparent))
                  `,border:"2px solid color-mix(in srgb, #60A5FA 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #60A5FA 30%, transparent)"},children:e.jsx(d,{Icon:o.Calendar,size:20,style:{color:"#60A5FA"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Détails Personnels"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"Informations complémentaires et contexte"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-400"}),e.jsx("span",{className:"text-blue-300 text-sm font-medium",children:"Optionnel"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"birthdate",className:"block text-white/90 text-sm font-medium mb-3",children:"Date de naissance"}),e.jsx("input",{...i("birthdate"),type:"date",id:"birthdate",className:"glass-input"}),l.birthdate&&e.jsxs("div",{className:"text-red-300 text-xs mt-2 flex items-center gap-1",children:[e.jsx(d,{Icon:o.AlertCircle,size:12}),l.birthdate.message]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone_number",className:"block text-white/90 text-sm font-medium mb-3",children:"Numéro de téléphone"}),e.jsx("input",{...i("phone_number"),type:"tel",id:"phone_number",className:"glass-input",placeholder:"+33 6 12 34 56 78"}),l.phone_number&&e.jsxs("div",{className:"text-red-300 text-xs mt-2 flex items-center gap-1",children:[e.jsx(d,{Icon:o.AlertCircle,size:12}),l.phone_number.message]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"country",className:"block text-white/90 text-sm font-medium mb-3",children:"Pays"}),e.jsxs("select",{...i("country"),id:"country",className:"glass-input",children:[e.jsx("option",{value:"",children:"Sélectionnez votre pays"}),e.jsx("option",{value:"Belgique",children:"Belgique"}),e.jsx("option",{value:"Bénin",children:"Bénin"}),e.jsx("option",{value:"Burkina Faso",children:"Burkina Faso"}),e.jsx("option",{value:"Burundi",children:"Burundi"}),e.jsx("option",{value:"Cameroun",children:"Cameroun"}),e.jsx("option",{value:"Canada",children:"Canada"}),e.jsx("option",{value:"Centrafrique",children:"Centrafrique"}),e.jsx("option",{value:"Comores",children:"Comores"}),e.jsx("option",{value:"Congo",children:"Congo"}),e.jsx("option",{value:"Congo (RDC)",children:"Congo (RDC)"}),e.jsx("option",{value:"Côte d'Ivoire",children:"Côte d'Ivoire"}),e.jsx("option",{value:"Djibouti",children:"Djibouti"}),e.jsx("option",{value:"France",children:"France"}),e.jsx("option",{value:"Gabon",children:"Gabon"}),e.jsx("option",{value:"Guinée",children:"Guinée"}),e.jsx("option",{value:"Guinée équatoriale",children:"Guinée équatoriale"}),e.jsx("option",{value:"Guyane",children:"Guyane"}),e.jsx("option",{value:"Guadeloupe",children:"Guadeloupe"}),e.jsx("option",{value:"Haïti",children:"Haïti"}),e.jsx("option",{value:"Luxembourg",children:"Luxembourg"}),e.jsx("option",{value:"Madagascar",children:"Madagascar"}),e.jsx("option",{value:"Mali",children:"Mali"}),e.jsx("option",{value:"Maroc",children:"Maroc"}),e.jsx("option",{value:"Martinique",children:"Martinique"}),e.jsx("option",{value:"Maurice",children:"Maurice"}),e.jsx("option",{value:"Mauritanie",children:"Mauritanie"}),e.jsx("option",{value:"Mayotte",children:"Mayotte"}),e.jsx("option",{value:"Monaco",children:"Monaco"}),e.jsx("option",{value:"Niger",children:"Niger"}),e.jsx("option",{value:"Nouvelle-Calédonie",children:"Nouvelle-Calédonie"}),e.jsx("option",{value:"Polynésie française",children:"Polynésie française"}),e.jsx("option",{value:"Réunion",children:"Réunion"}),e.jsx("option",{value:"Rwanda",children:"Rwanda"}),e.jsx("option",{value:"Saint-Barthélemy",children:"Saint-Barthélemy"}),e.jsx("option",{value:"Saint-Martin",children:"Saint-Martin"}),e.jsx("option",{value:"Saint-Pierre-et-Miquelon",children:"Saint-Pierre-et-Miquelon"}),e.jsx("option",{value:"Sénégal",children:"Sénégal"}),e.jsx("option",{value:"Seychelles",children:"Seychelles"}),e.jsx("option",{value:"Suisse",children:"Suisse"}),e.jsx("option",{value:"Tchad",children:"Tchad"}),e.jsx("option",{value:"Togo",children:"Togo"}),e.jsx("option",{value:"Tunisie",children:"Tunisie"}),e.jsx("option",{value:"Vanuatu",children:"Vanuatu"}),e.jsx("option",{value:"Wallis-et-Futuna",children:"Wallis-et-Futuna"}),e.jsx("option",{value:"Afrique du Sud",children:"Afrique du Sud"}),e.jsx("option",{value:"Australie",children:"Australie"}),e.jsx("option",{value:"États-Unis",children:"États-Unis"}),e.jsx("option",{value:"Inde",children:"Inde"}),e.jsx("option",{value:"Irlande",children:"Irlande"}),e.jsx("option",{value:"Jamaïque",children:"Jamaïque"}),e.jsx("option",{value:"Kenya",children:"Kenya"}),e.jsx("option",{value:"Nigéria",children:"Nigéria"}),e.jsx("option",{value:"Nouvelle-Zélande",children:"Nouvelle-Zélande"}),e.jsx("option",{value:"Royaume-Uni",children:"Royaume-Uni"}),e.jsx("option",{value:"Singapour",children:"Singapour"})]}),l.country&&e.jsxs("div",{className:"text-red-300 text-xs mt-2 flex items-center gap-1",children:[e.jsx(d,{Icon:o.AlertCircle,size:12}),l.country.message]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"job_category",className:"block text-white/90 text-sm font-medium mb-3",children:"Catégorie professionnelle"}),e.jsxs("select",{...i("job_category"),id:"job_category",className:"glass-input",children:[e.jsx("option",{value:"",children:"Sélectionnez votre activité"}),e.jsx("option",{value:"office",children:"Bureau"}),e.jsx("option",{value:"field",children:"Terrain"}),e.jsx("option",{value:"shift",children:"Équipes"}),e.jsx("option",{value:"manual",children:"Manuel"}),e.jsx("option",{value:"student",children:"Étudiant"}),e.jsx("option",{value:"other",children:"Autre"})]}),l.job_category&&e.jsxs("div",{className:"text-red-300 text-xs mt-2 flex items-center gap-1",children:[e.jsx(d,{Icon:o.AlertCircle,size:12}),l.job_category.message]})]})]}),e.jsx(pe,{isDirty:h,isSaving:!1,onSave:I,sectionName:"Personnels"})]}),e.jsxs(D,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, rgba(96, 165, 250, 0.08) 0%, transparent 60%),
            var(--glass-opacity)
          `,borderColor:"rgba(96, 165, 250, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, #60A5FA 35%, transparent), color-mix(in srgb, #60A5FA 25%, transparent))
                  `,border:"2px solid color-mix(in srgb, #60A5FA 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #60A5FA 30%, transparent)"},children:e.jsx(d,{Icon:o.Target,size:20,style:{color:"#60A5FA"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Objectifs Fitness"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"Vos cibles et préférences d'entraînement"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-400"}),e.jsx("span",{className:"text-blue-300 text-sm font-medium",children:"Recommandé"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"target_weight_kg",className:"block text-white/90 text-sm font-medium mb-3",children:"Poids cible (kg)"}),e.jsx("input",{...i("target_weight_kg",{valueAsNumber:!0}),type:"number",id:"target_weight_kg",min:"30",max:"300",step:"0.1",className:"glass-input",placeholder:"65"}),l.target_weight_kg&&e.jsxs("div",{className:"text-red-300 text-xs mt-2 flex items-center gap-1",children:[e.jsx(d,{Icon:o.AlertCircle,size:12}),l.target_weight_kg.message]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"activity_level",className:"block text-white/90 text-sm font-medium mb-3",children:"Niveau d'activité"}),e.jsxs("select",{...i("activity_level"),id:"activity_level",className:"glass-input",children:[e.jsx("option",{value:"",children:"Sélectionnez votre niveau"}),e.jsx("option",{value:"sedentary",children:"Sédentaire"}),e.jsx("option",{value:"light",children:"Léger"}),e.jsx("option",{value:"moderate",children:"Modéré"}),e.jsx("option",{value:"active",children:"Actif"}),e.jsx("option",{value:"athlete",children:"Athlète"})]}),l.activity_level&&e.jsxs("div",{className:"text-red-300 text-xs mt-2 flex items-center gap-1",children:[e.jsx(d,{Icon:o.AlertCircle,size:12}),l.activity_level.message]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"objective",className:"block text-white/90 text-sm font-medium mb-3",children:"Objectif principal"}),e.jsxs("select",{...i("objective"),id:"objective",className:"glass-input",children:[e.jsx("option",{value:"",children:"Sélectionnez votre objectif"}),e.jsx("option",{value:"fat_loss",children:"Perte de graisse"}),e.jsx("option",{value:"recomp",children:"Recomposition corporelle"}),e.jsx("option",{value:"muscle_gain",children:"Prise de muscle"})]}),l.objective&&e.jsxs("div",{className:"text-red-300 text-xs mt-2 flex items-center gap-1",children:[e.jsx(d,{Icon:o.AlertCircle,size:12}),l.objective.message]})]})]}),e.jsx(pe,{isDirty:h,isSaving:!1,onSave:I,sectionName:"Fitness"})]}),Xe(m.height_cm,m.weight_kg,m.target_weight_kg)&&e.jsx(it,{height:m.height_cm,weight:m.weight_kg,targetWeight:m.target_weight_kg}),e.jsx("div",{id:"global-save-button-container",className:"flex justify-center pt-4",children:e.jsx("button",{type:"submit",disabled:N||!c||!n,className:`btn-glass--primary px-8 py-4 text-lg font-semibold ${!c||!n?"opacity-50 cursor-not-allowed":""}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[N?e.jsx(d,{Icon:o.Loader2,size:20,className:"animate-spin"}):e.jsx(d,{Icon:o.Save,size:20}),e.jsx("span",{children:N?"Sauvegarde globale...":n?c?"Sauvegarder Tout":"Aucun changement":`Erreurs (${Object.keys(l).length})`})]})})}),Object.keys(l).length>0&&e.jsxs(D,{className:"p-4",style:{background:"rgba(239, 68, 68, 0.1)",borderColor:"rgba(239, 68, 68, 0.3)"},children:[e.jsxs("h4",{className:"text-red-300 font-medium mb-3 flex items-center gap-2",children:[e.jsx(d,{Icon:o.AlertCircle,size:16}),"Erreurs de validation (",Object.keys(l).length,")"]}),e.jsx("div",{className:"space-y-2",children:Object.entries(l).map(([p,j])=>e.jsxs("div",{className:"text-red-200 text-sm flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-1 rounded-full bg-red-400"}),e.jsxs("strong",{children:[p,":"]})," ",j.message]},p))})]})]})]})});mt.displayName="ProfileIdentityTab";const fe=W({name:B().min(1,"Le nom est requis"),state:Q(["like","neutral","dislike","ban"]),intensity:H().min(1).max(5).optional()}),ut=W({adults:H().min(1).max(20).default(1),children:H().min(0).max(20).default(0),dietaryRestrictions:V(B()).default([])}),ht=W({weekdayTimeMin:H().min(5).max(180).default(30),weekendTimeMin:H().min(5).max(300).default(60),cookingSkill:Q(["beginner","intermediate","advanced"]).default("intermediate"),preferredMealTimes:W({breakfast:B().optional(),lunch:B().optional(),dinner:B().optional()}).optional()}),xt=W({oven:$().default(!0),stove:$().default(!0),microwave:$().default(!0),airFryer:$().default(!1),slowCooker:$().default(!1),blender:$().default(!1),foodProcessor:$().default(!1),standMixer:$().default(!1),riceCooker:$().default(!1),grill:$().default(!1),steamBasket:$().default(!1),pressureCooker:$().default(!1)}),gt=W({cuisines:V(fe).default([]),ingredients:V(fe).default([]),flavors:V(fe).default([])}),pt=W({spiceTolerance:H().min(0).max(3).default(1),textureAversions:V(B()).default([]),temperaturePreferences:V(B()).default([])}),ft=W({kcal:H().min(800).max(5e3).optional(),fiberMinG:H().min(0).max(100).optional(),sugarMaxG:H().min(0).max(200).optional(),saltMaxMg:H().min(0).max(1e4).optional(),carbsMaxG:H().min(0).max(1e3).optional(),fatMinG:H().min(0).max(300).optional()}),bt=W({frequencyPerWeek:H().min(1).max(7).default(2),defaultPortionsPerMeal:H().min(1).max(12).default(2),batchCooking:Q(["never","sometimes","often"]).default("sometimes"),bias:V(B()).default([]),preferredStores:V(B()).default([]),budgetPerWeek:H().min(0).max(1e3).optional()}),vt=W({diet:B().optional(),allergies:V(B()).default([]),intolerances:V(B()).default([]),budgetLevel:Q(["low","medium","high"]).optional(),noKnownAllergies:$().default(!1),householdDetails:ut.optional(),mealPrepPreferences:ht.optional(),kitchenEquipment:xt.optional(),foodPreferences:gt.optional(),sensoryPreferences:pt.optional(),macroTargets:ft.optional(),shoppingPreferences:bt.optional()});function jt(){const{profile:t,updateProfile:s,saving:r}=q(),{showToast:i}=le(),{success:a,formSubmit:l}=J(),[n,c]=_.useState(null),m=ue({resolver:ge(vt),defaultValues:{diet:t?.nutrition?.diet||"",allergies:t?.nutrition?.allergies||[],intolerances:t?.nutrition?.intolerances||[],budgetLevel:t?.nutrition?.budgetLevel||void 0,noKnownAllergies:t?.nutrition?.noKnownAllergies??!1,householdDetails:{adults:t?.householdDetails?.adults||1,children:t?.householdDetails?.children||0,dietaryRestrictions:t?.householdDetails?.dietaryRestrictions||[]},mealPrepPreferences:{weekdayTimeMin:t?.mealPrepPreferences?.weekdayTimeMin||30,weekendTimeMin:t?.mealPrepPreferences?.weekendTimeMin||60,cookingSkill:t?.mealPrepPreferences?.cookingSkill||"intermediate",preferredMealTimes:t?.mealPrepPreferences?.preferredMealTimes||{}},kitchenEquipment:{oven:t?.kitchenEquipment?.oven??!0,stove:t?.kitchenEquipment?.stove??!0,microwave:t?.kitchenEquipment?.microwave??!0,airFryer:t?.kitchenEquipment?.airFryer??!1,slowCooker:t?.kitchenEquipment?.slowCooker??!1,blender:t?.kitchenEquipment?.blender??!1,foodProcessor:t?.kitchenEquipment?.foodProcessor??!1,standMixer:t?.kitchenEquipment?.standMixer??!1,riceCooker:t?.kitchenEquipment?.riceCooker??!1,grill:t?.kitchenEquipment?.grill??!1,steamBasket:t?.kitchenEquipment?.steamBasket??!1,pressureCooker:t?.kitchenEquipment?.pressureCooker??!1},foodPreferences:{cuisines:t?.foodPreferences?.cuisines||[],ingredients:t?.foodPreferences?.ingredients||[],flavors:t?.foodPreferences?.flavors||[]},sensoryPreferences:{spiceTolerance:t?.sensoryPreferences?.spiceTolerance||1,textureAversions:t?.sensoryPreferences?.textureAversions||[],temperaturePreferences:t?.sensoryPreferences?.temperaturePreferences||[]},macroTargets:{kcal:t?.macroTargets?.kcal||void 0,fiberMinG:t?.macroTargets?.fiberMinG||void 0,sugarMaxG:t?.macroTargets?.sugarMaxG||void 0,saltMaxMg:t?.macroTargets?.saltMaxMg||void 0,carbsMaxG:t?.macroTargets?.carbsMaxG||void 0,fatMinG:t?.macroTargets?.fatMinG||void 0},shoppingPreferences:{frequencyPerWeek:t?.shoppingPreferences?.frequencyPerWeek||2,defaultPortionsPerMeal:t?.shoppingPreferences?.defaultPortionsPerMeal||2,batchCooking:t?.shoppingPreferences?.batchCooking||"sometimes",bias:t?.shoppingPreferences?.bias||[],preferredStores:t?.shoppingPreferences?.preferredStores||[],budgetPerWeek:t?.shoppingPreferences?.budgetPerWeek||void 0}},mode:"onChange"}),{register:u,handleSubmit:b,formState:N,watch:y,setValue:S,reset:h,trigger:x}=m,{errors:v,isDirty:I,dirtyFields:g}=N,p=y();_.useEffect(()=>{Y.getState().setTabDirty("nutrition",I)},[I]);const j=async()=>{c("diet");try{await s({nutrition:{...t?.nutrition,diet:p.diet,budgetLevel:p.budgetLevel},updated_at:new Date().toISOString()}),a(),i({type:"success",title:"Régime alimentaire sauvegardé",message:"Vos préférences alimentaires ont été mises à jour",duration:3e3})}catch{i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder le régime alimentaire",duration:4e3})}finally{c(null)}},M=async()=>{c("restrictions");try{f.debug("PROFILE_NUTRITION_RESTRICTIONS","Saving restrictions section",{allergies:p.allergies,intolerances:p.intolerances,noKnownAllergies:p.noKnownAllergies,userId:t?.userId,philosophy:"restrictions_save_debug"}),await s({nutrition:{...t?.nutrition,allergies:p.allergies,intolerances:p.intolerances,noKnownAllergies:p.noKnownAllergies??!1},updated_at:new Date().toISOString()}),a(),f.debug("PROFILE_NUTRITION_RESTRICTIONS","Restrictions section saved successfully",{userId:t?.userId,philosophy:"restrictions_save_success"}),i({type:"success",title:"Restrictions alimentaires sauvegardées",message:"Vos allergies et intolérances ont été mises à jour",duration:3e3})}catch(z){f.error("PROFILE_NUTRITION_RESTRICTIONS","Failed to save restrictions section",{error:z instanceof Error?z.message:"Unknown error",userId:t?.userId,philosophy:"restrictions_save_error"}),i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder les restrictions",duration:4e3})}finally{c(null)}},w=async()=>{c("essentials");try{await s({householdDetails:p.householdDetails,mealPrepPreferences:p.mealPrepPreferences,kitchenEquipment:p.kitchenEquipment,updated_at:new Date().toISOString()}),a(),i({type:"success",title:"Informations essentielles sauvegardées",message:"Votre foyer et préférences de cuisine ont été mis à jour",duration:3e3})}catch{i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder les informations essentielles",duration:4e3})}finally{c(null)}},C=async()=>{c("preferences");try{await s({foodPreferences:p.foodPreferences,sensoryPreferences:p.sensoryPreferences,updated_at:new Date().toISOString()}),a(),i({type:"success",title:"Préférences alimentaires sauvegardées",message:"Vos goûts et préférences ont été mis à jour",duration:3e3})}catch{i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder les préférences",duration:4e3})}finally{c(null)}},A=async()=>{c("nutrition");try{await s({macroTargets:p.macroTargets,updated_at:new Date().toISOString()}),a(),i({type:"success",title:"Objectifs nutritionnels sauvegardés",message:"Vos cibles nutritionnelles ont été mises à jour",duration:3e3})}catch{i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder les objectifs nutritionnels",duration:4e3})}finally{c(null)}},E=async()=>{c("shopping");try{await s({shoppingPreferences:p.shoppingPreferences,updated_at:new Date().toISOString()}),a(),i({type:"success",title:"Préférences de courses sauvegardées",message:"Vos habitudes de courses ont été mises à jour",duration:3e3})}catch{i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder les préférences de courses",duration:4e3})}finally{c(null)}},k=async z=>{try{l(),f.debug("PROFILE_NUTRITION_SUBMIT","Submitting complete nutrition form",{nutritionData:{diet:z.diet,allergies:z.allergies,intolerances:z.intolerances,noKnownAllergies:z.noKnownAllergies,budgetLevel:z.budgetLevel},userId:t?.userId,philosophy:"complete_nutrition_submit_debug"}),f.info("PROFILE_NUTRITION","Submitting complete enhanced nutrition updates",{userId:t?.userId,philosophy:"complete_enhanced_nutrition_submission"}),await s({nutrition:{...t?.nutrition,diet:z.diet,allergies:z.allergies,intolerances:z.intolerances,budgetLevel:z.budgetLevel,noKnownAllergies:z.noKnownAllergies??!1},householdDetails:z.householdDetails,mealPrepPreferences:z.mealPrepPreferences,kitchenEquipment:z.kitchenEquipment,foodPreferences:z.foodPreferences,sensoryPreferences:z.sensoryPreferences,macroTargets:z.macroTargets,shoppingPreferences:z.shoppingPreferences,updated_at:new Date().toISOString()}),a(),f.debug("PROFILE_NUTRITION_SUBMIT","Complete nutrition form submitted successfully",{userId:t?.userId,philosophy:"complete_nutrition_submit_success"}),i({type:"success",title:"Profil nutritionnel complet sauvegardé",message:"Toutes vos données nutritionnelles ont été mises à jour",duration:4e3}),Y.getState().resetTabDirty("nutrition")}catch(ce){f.error("PROFILE_NUTRITION_SUBMIT","Complete nutrition form submission failed",{error:ce instanceof Error?ce.message:"Unknown error",userId:t?.userId,philosophy:"complete_nutrition_submit_error"}),f.error("PROFILE_NUTRITION","Enhanced nutrition update failed",{error:ce instanceof Error?ce.message:"Unknown error",userId:t?.userId}),i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder votre profil nutritionnel",duration:4e3})}},P=!!(g.diet||g.budgetLevel),L=!!(g.allergies||g.intolerances||g.noKnownAllergies),O=!!(g.householdDetails?.adults||g.householdDetails?.children||g.householdDetails?.dietaryRestrictions||g.mealPrepPreferences?.weekdayTimeMin||g.mealPrepPreferences?.weekendTimeMin||g.mealPrepPreferences?.cookingSkill||g.mealPrepPreferences?.preferredMealTimes||g.kitchenEquipment?.oven||g.kitchenEquipment?.stove||g.kitchenEquipment?.microwave||g.kitchenEquipment?.airFryer||g.kitchenEquipment?.slowCooker||g.kitchenEquipment?.blender||g.kitchenEquipment?.foodProcessor||g.kitchenEquipment?.standMixer||g.kitchenEquipment?.riceCooker||g.kitchenEquipment?.grill||g.kitchenEquipment?.steamBasket||g.kitchenEquipment?.pressureCooker),F=!!(g.foodPreferences?.cuisines||g.foodPreferences?.ingredients||g.foodPreferences?.flavors||g.sensoryPreferences?.spiceTolerance||g.sensoryPreferences?.textureAversions||g.sensoryPreferences?.temperaturePreferences),G=!!(g.macroTargets?.kcal||g.macroTargets?.fiberMinG||g.macroTargets?.sugarMaxG||g.macroTargets?.saltMaxMg||g.macroTargets?.carbsMaxG||g.macroTargets?.fatMinG),Z=!!(g.shoppingPreferences?.frequencyPerWeek||g.shoppingPreferences?.defaultPortionsPerMeal||g.shoppingPreferences?.batchCooking||g.shoppingPreferences?.bias||g.shoppingPreferences?.preferredStores||g.shoppingPreferences?.budgetPerWeek),oe=_.useMemo(()=>({register:u,handleSubmit:b,errors:v,isDirty:I,dirtyFields:g,watchedValues:p,setValue:S,trigger:x}),[u,b,v,I,g,p,S,x]),Be=_.useMemo(()=>({saveDietSection:j,saveRestrictionsSection:M,saveEssentialsSection:w,savePreferencesSection:C,saveNutritionSection:A,saveShoppingSection:E,onSubmit:k}),[j,M,w,C,A,E,k]),He=_.useMemo(()=>({saving:r,sectionSaving:n,hasDietChanges:P,hasRestrictionsChanges:L,hasEssentialsChanges:O,hasPreferencesChanges:F,hasNutritionChanges:G,hasShoppingChanges:Z}),[r,n,P,L,O,F,G,Z]);return{form:oe,actions:Be,state:He}}const yt=({percentage:t,title:s,subtitle:r,color:i="#10B981"})=>e.jsxs(D,{className:"p-6 mb-6",style:{background:`
        radial-gradient(circle at 30% 20%, color-mix(in srgb, ${i} 8%, transparent) 0%, transparent 60%),
        var(--glass-opacity)
      `,borderColor:`color-mix(in srgb, ${i} 20%, transparent)`},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{children:e.jsxs("h3",{className:"text-white font-semibold text-xl mb-1 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                  linear-gradient(135deg, color-mix(in srgb, ${i} 35%, transparent), color-mix(in srgb, ${i} 25%, transparent))
                `,border:`2px solid color-mix(in srgb, ${i} 50%, transparent)`,boxShadow:`0 0 20px color-mix(in srgb, ${i} 30%, transparent)`},children:e.jsx(d,{Icon:o.Utensils,size:20,style:{color:i},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:s}),r&&e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:r})]})]})}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{background:i,boxShadow:`0 0 8px ${i}60`}}),e.jsxs("span",{className:"text-white font-bold text-lg",children:[t,"%"]})]}),e.jsx("span",{className:"text-white/60 text-xs",children:"Complété"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-full bg-white/10 rounded-full h-3 overflow-hidden",children:e.jsx(R.div,{className:"h-3 rounded-full relative overflow-hidden",style:{background:`linear-gradient(90deg, ${i}, color-mix(in srgb, ${i} 80%, white))`,boxShadow:`0 0 12px ${i}60, inset 0 1px 0 rgba(255,255,255,0.3)`},initial:{width:0},animate:{width:`${t}%`},transition:{duration:1.2,ease:"easeOut"},children:e.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:`linear-gradient(90deg, 
                  transparent 0%, 
                  rgba(255,255,255,0.4) 50%, 
                  transparent 100%
                )`,border:"2px solid color-mix(in srgb, #10B981 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #10B981 30%, transparent)"}})})}),e.jsxs("div",{className:"flex justify-between mt-2 text-xs text-white/50",children:[e.jsx("span",{children:"0%"}),e.jsx("span",{children:"25%"}),e.jsx("span",{children:"50%"}),e.jsx("span",{children:"75%"}),e.jsx("span",{children:"100%"})]})]})]}),re=({isDirty:t,isSaving:s,onSave:r,sectionName:i})=>{const{formSubmit:a}=J();return t?e.jsx(R.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex justify-end mt-4",children:e.jsx("button",{type:"button",onClick:()=>{a(),r()},disabled:s,className:"btn-glass px-4 py-2 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[s?e.jsx(d,{Icon:o.Loader2,size:14,className:"animate-spin"}):e.jsx(d,{Icon:o.Save,size:14}),e.jsx("span",{children:s?"Sauvegarde...":`Sauvegarder ${i}`})]})})}):null},de=_.memo(({items:t,newItem:s,setNewItem:r,onAdd:i,onRemove:a,placeholder:l,itemColor:n,itemLabel:c})=>{const{click:m}=J(),u=_.useRef(null),b=_.useRef(null),N=_.useRef(null),y=_.useRef(t.length);_.useEffect(()=>{t.length>y.current&&(m(),setTimeout(()=>{N.current&&N.current.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})},50),setTimeout(()=>{u.current&&u.current.focus()},100)),y.current=t.length},[t.length,m]);const S=_.useCallback(()=>{s.trim()&&i()},[s,i]),h=_.useCallback(x=>{x.key==="Enter"&&(x.preventDefault(),S())},[S]);return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{ref:u,type:"text",value:s,onChange:x=>r(x.target.value),className:"glass-input flex-1",placeholder:l,onKeyDown:h}),e.jsx("button",{type:"button",onClick:S,className:"btn-glass px-4",disabled:!s.trim(),children:e.jsx(d,{Icon:o.Plus,size:14})})]}),e.jsx("div",{ref:b,className:"flex flex-wrap gap-2",children:e.jsx(ee,{mode:"popLayout",children:t.map((x,v)=>e.jsxs(R.div,{ref:v===t.length-1?N:null,className:"chip chip--on flex items-center gap-2",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.2},style:{background:`color-mix(in srgb, ${n}, 0.15)`,borderColor:`color-mix(in srgb, ${n}, 0.30)`,color:n},children:[e.jsx("span",{children:x}),e.jsx("button",{type:"button",onClick:()=>a(v),className:"hover:opacity-80 transition-opacity",style:{color:n},"aria-label":`Retirer ${c} "${x}"`,children:e.jsx(d,{Icon:o.X,size:12})})]},`${x}-${v}`))})})]})},(t,s)=>{if(t.items.length!==s.items.length||t.newItem!==s.newItem||t.placeholder!==s.placeholder||t.itemColor!==s.itemColor||t.itemLabel!==s.itemLabel)return!1;for(let r=0;r<t.items.length;r++)if(t.items[r]!==s.items[r])return!1;return!0}),be=_.memo(({items:t,onUpdate:s,suggestions:r,placeholder:i,itemColor:a})=>{const[l,n]=_.useState(""),[c,m]=_.useState(!1),u=_.useCallback(h=>{if(h.trim()&&!t.find(x=>x.name===h.trim())){const x=[...t,{name:h.trim(),preference:"neutral"}];s(x),n(""),m(!1)}},[t,s]),b=_.useCallback((h,x)=>{const v=t[h];if(v&&v.preference!==x){const I=[...t];I[h]={...I[h],preference:x},s(I)}},[t,s]),N=_.useCallback(h=>{const x=t.filter((v,I)=>I!==h);s(x)},[t,s]),y=_.useCallback(h=>{switch(h){case"like":return"#10B981";case"neutral":return"#6B7280";case"dislike":return"#F59E0B";case"ban":return"#EF4444";default:return"#6B7280"}},[]),S=_.useCallback(h=>{switch(h){case"like":return o.Heart;case"neutral":return o.Minus;case"dislike":return o.X;case"ban":return o.Ban;default:return o.Minus}},[]);return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:l,onChange:h=>n(h.target.value),onFocus:()=>m(!0),className:"glass-input flex-1",placeholder:i,onKeyDown:h=>{h.key==="Enter"&&(h.preventDefault(),u(l))}}),e.jsx("button",{type:"button",onClick:()=>u(l),className:"btn-glass px-4",children:e.jsx(d,{Icon:o.Plus,size:14})})]}),c&&r.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-black/80 backdrop-blur-xl border border-white/20 rounded-xl p-2 z-10",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:r.filter(h=>!t.find(x=>x.name===h)).map(h=>e.jsx("button",{type:"button",onClick:()=>u(h),className:"text-xs px-2 py-1 rounded-lg bg-white/10 hover:bg-white/20 text-white/80 hover:text-white transition-colors",children:h},h))})})]}),e.jsx("div",{className:"space-y-2",children:t.map((h,x)=>e.jsxs(R.div,{className:"flex items-center gap-3 p-3 rounded-xl bg-white/5 border border-white/10",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},children:[e.jsx("span",{className:"flex-1 text-white",children:h.name}),e.jsx("div",{className:"flex items-center gap-1",children:["like","neutral","dislike","ban"].map(v=>e.jsx("button",{type:"button",onClick:()=>b(x,v),className:`w-8 h-8 rounded-lg flex items-center justify-center transition-colors ${h.preference===v?"bg-white/20 border border-white/30":"bg-white/5 hover:bg-white/10"}`,style:{color:h.preference===v?y(v):"#9CA3AF"},children:e.jsx(d,{Icon:S(v),size:14})},v))}),e.jsx("button",{type:"button",onClick:()=>N(x),className:"w-8 h-8 rounded-lg flex items-center justify-center bg-white/5 hover:bg-red-500/20 text-white/60 hover:text-red-400 transition-colors",children:e.jsx(d,{Icon:o.Trash2,size:14})})]},x))})]})},(t,s)=>{if(t.items.length!==s.items.length||t.placeholder!==s.placeholder||t.itemColor!==s.itemColor)return!1;for(let r=0;r<t.items.length;r++)if(t.items[r].name!==s.items[r].name||t.items[r].preference!==s.items[r].preference)return!1;if(t.suggestions.length!==s.suggestions.length)return!1;for(let r=0;r<t.suggestions.length;r++)if(t.suggestions[r]!==s.suggestions[r])return!1;return!0}),Nt=({register:t,isDirty:s,isSaving:r,onSave:i})=>e.jsxs(D,{className:"p-6",style:{background:`
        radial-gradient(circle at 30% 20%, rgba(16, 185, 129, 0.08) 0%, transparent 60%),
        var(--glass-opacity)
      `,borderColor:"rgba(16, 185, 129, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, #10B981 35%, transparent), color-mix(in srgb, #10B981 25%, transparent))
              `,border:"2px solid color-mix(in srgb, #10B981 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #10B981 30%, transparent)"},children:e.jsx(d,{Icon:o.Utensils,size:20,style:{color:"#10B981"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Régime & Budget"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"Vos préférences alimentaires et contraintes budgétaires"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400"}),e.jsx("span",{className:"text-green-300 text-sm font-medium",children:"Base"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"diet",className:"block text-white/90 text-sm font-medium mb-3",children:"Type de régime"}),e.jsxs("select",{...t("diet"),id:"diet",className:"glass-input",children:[e.jsx("option",{value:"",children:"Aucun régime spécifique"}),e.jsx("option",{value:"omnivore",children:"Omnivore"}),e.jsx("option",{value:"vegetarian",children:"Végétarien"}),e.jsx("option",{value:"vegan",children:"Végétalien"}),e.jsx("option",{value:"pescatarian",children:"Pescétarien"}),e.jsx("option",{value:"keto",children:"Cétogène"}),e.jsx("option",{value:"paleo",children:"Paléo"}),e.jsx("option",{value:"mediterranean",children:"Méditerranéen"}),e.jsx("option",{value:"low_carb",children:"Faible en glucides"}),e.jsx("option",{value:"intermittent_fasting",children:"Jeûne intermittent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"budgetLevel",className:"block text-white/90 text-sm font-medium mb-3",children:"Niveau de budget"}),e.jsxs("select",{...t("budgetLevel"),id:"budgetLevel",className:"glass-input",children:[e.jsx("option",{value:"",children:"Non spécifié"}),e.jsx("option",{value:"low",children:"Économique"}),e.jsx("option",{value:"medium",children:"Modéré"}),e.jsx("option",{value:"high",children:"Élevé"})]})]})]}),e.jsx(re,{isDirty:s,isSaving:r,onSave:i,sectionName:"Régime"})]}),wt=({register:t,name:s,label:r,description:i,checked:a,color:l="#06B6D4",icon:n,compact:c=!1})=>e.jsxs("label",{className:`flex items-center gap-3 rounded-xl bg-white/5 border border-white/10 cursor-pointer profile-checkbox-field profile-hover-effect ${c?"p-3":"p-4"}`,style:{transition:"background-color var(--animation-duration-adaptive, 200ms) ease-out"},children:[e.jsx("input",{...t(s),type:"checkbox",className:"sr-only"}),e.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center transition-colors ${a?"border-cyan-400":"border-white/30"}`,style:{backgroundColor:a?l:"transparent"},children:a&&e.jsx(d,{Icon:o.Check,size:12,className:"text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:`text-white font-medium flex items-center gap-2 ${c?"text-sm":""}`,children:[n&&e.jsx(d,{Icon:n,size:16,className:"text-white/60"}),r]}),i&&!c&&e.jsx("div",{className:"text-white/60 text-sm",children:i})]})]}),_t=({register:t,watchedValues:s})=>{const r=[{key:"oven",label:"Four",icon:o.Flame},{key:"stove",label:"Plaques",icon:o.Circle},{key:"microwave",label:"Micro-ondes",icon:o.Zap},{key:"dishwasher",label:"Lave-vaisselle",icon:o.Droplets},{key:"blender",label:"Mixeur",icon:o.Zap},{key:"airFryer",label:"Air Fryer",icon:o.Wind},{key:"slowCooker",label:"Mijoteuse",icon:o.Clock},{key:"pressureCooker",label:"Cocotte-minute",icon:o.Timer},{key:"foodProcessor",label:"Robot",icon:o.Settings},{key:"standMixer",label:"Batteur",icon:o.RotateCcw},{key:"grill",label:"Grill",icon:o.Flame},{key:"steamer",label:"Vapeur",icon:o.Cloud}];return e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:r.map(({key:i,label:a,icon:l})=>e.jsx(wt,{register:t,name:`kitchenEquipment.${i}`,label:a,description:"",checked:s.kitchenEquipment?.[i]||!1,color:"#06B6D4",icon:l,compact:!0},i))})},St=({register:t,watchedValues:s,isDirty:r,isSaving:i,onSave:a})=>e.jsxs(D,{className:"p-6",style:{background:`
        radial-gradient(circle at 30% 20%, rgba(16, 185, 129, 0.08) 0%, transparent 60%),
        var(--glass-opacity)
      `,borderColor:"rgba(16, 185, 129, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, #10B981 35%, transparent), color-mix(in srgb, #10B981 25%, transparent))
              `,border:"2px solid color-mix(in srgb, #10B981 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #10B981 30%, transparent)"},children:e.jsx(d,{Icon:o.Users,size:20,style:{color:"#10B981"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Informations Essentielles"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"Foyer, temps de cuisine et équipement disponible"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400"}),e.jsx("span",{className:"text-green-300 text-sm font-medium",children:"Essentiel"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-white/90 text-sm font-medium mb-4",children:"Composition du foyer"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"householdDetails.adults",className:"block text-white/80 text-sm mb-2",children:"Adultes"}),e.jsx("input",{...t("householdDetails.adults",{valueAsNumber:!0}),type:"number",id:"householdDetails.adults",min:"1",max:"20",className:"glass-input",placeholder:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"householdDetails.children",className:"block text-white/80 text-sm mb-2",children:"Enfants"}),e.jsx("input",{...t("householdDetails.children",{valueAsNumber:!0}),type:"number",id:"householdDetails.children",min:"0",max:"20",className:"glass-input",placeholder:"0"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white/90 text-sm font-medium mb-4",children:"Temps disponible par repas"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mealPrepPreferences.weekdayTimeMin",className:"block text-white/80 text-sm mb-2",children:"Semaine (minutes)"}),e.jsx("input",{...t("mealPrepPreferences.weekdayTimeMin",{valueAsNumber:!0}),type:"number",id:"mealPrepPreferences.weekdayTimeMin",min:"5",max:"180",className:"glass-input",placeholder:"30"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mealPrepPreferences.weekendTimeMin",className:"block text-white/80 text-sm mb-2",children:"Week-end (minutes)"}),e.jsx("input",{...t("mealPrepPreferences.weekendTimeMin",{valueAsNumber:!0}),type:"number",id:"mealPrepPreferences.weekendTimeMin",min:"5",max:"300",className:"glass-input",placeholder:"60"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mealPrepPreferences.cookingSkill",className:"block text-white/80 text-sm mb-2",children:"Niveau de cuisine"}),e.jsxs("select",{...t("mealPrepPreferences.cookingSkill"),id:"mealPrepPreferences.cookingSkill",className:"glass-input",children:[e.jsx("option",{value:"beginner",children:"🌱 Débutant"}),e.jsx("option",{value:"intermediate",children:"👨‍🍳 Intermédiaire"}),e.jsx("option",{value:"advanced",children:"👨‍🍳⭐ Confirmé"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white/90 text-sm font-medium mb-4",children:"Équipement de cuisine disponible"}),e.jsx(_t,{register:t,watchedValues:s})]})]}),e.jsx(re,{isDirty:r,isSaving:i,onSave:a,sectionName:"Essentiels"})]}),Ct={FR:"Française",IT:"Italienne",ES:"Espagnole",MX:"Mexicaine",IN:"Indienne",GR:"Grecque",JP:"Japonaise",TH:"Thaï",LB:"Libanaise",MA:"Marocaine",CN:"Chinoise",KR:"Coréenne",VN:"Vietnamienne",US:"Américaine",GB:"Britannique",DE:"Allemande",TR:"Turque",BR:"Brésilienne",AR:"Argentine",PE:"Péruvienne"},It=({register:t,watchedValues:s,setValue:r,isDirty:i,isSaving:a,onSave:l})=>{const{profile:n}=q(),[c,m]=_.useState(""),[u,b]=_.useState(!1);_.useEffect(()=>{if(u||!n?.country)return;if((s.foodPreferences?.cuisines||[]).length===0){const j=n.country.toUpperCase(),M=Ct[j];M&&r("foodPreferences.cuisines",[{name:M,preference:"neutral"}],{shouldDirty:!1})}b(!0)},[n?.country,s.foodPreferences?.cuisines,r,u]);const N=_.useCallback(()=>{if(c.trim()){const p=s.sensoryPreferences?.textureAversions||[],j=c.trim();p.includes(j)||(r("sensoryPreferences.textureAversions",[...p,j],{shouldDirty:!0}),m(""))}},[c,s.sensoryPreferences?.textureAversions,r]),y=_.useCallback(p=>{const j=s.sensoryPreferences?.textureAversions||[];r("sensoryPreferences.textureAversions",j.filter((M,w)=>w!==p),{shouldDirty:!0})},[s.sensoryPreferences?.textureAversions,r]),S=_.useCallback(p=>{r("foodPreferences.cuisines",p,{shouldDirty:!0})},[r]),h=_.useCallback(p=>{r("foodPreferences.ingredients",p,{shouldDirty:!0})},[r]),x=_.useCallback(p=>{r("foodPreferences.flavors",p,{shouldDirty:!0})},[r]),v=_.useMemo(()=>["Française","Italienne","Asiatique","Mexicaine","Indienne","Méditerranéenne","Japonaise","Thaï","Libanaise","Marocaine"],[]),I=_.useMemo(()=>["Légumes verts","Fruits rouges","Poissons gras","Légumineuses","Céréales complètes","Fromages","Épices","Herbes fraîches"],[]),g=_.useMemo(()=>["Sucré","Salé","Épicé","Acide","Amer","Umami","Fumé","Grillé","Crémeux","Croquant"],[]);return e.jsxs(D,{className:"p-6",style:{background:`
        radial-gradient(circle at 30% 20%, rgba(16, 185, 129, 0.08) 0%, transparent 60%),
        var(--glass-opacity)
      `,borderColor:"rgba(16, 185, 129, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, #10B981 35%, transparent), color-mix(in srgb, #10B981 25%, transparent))
              `,border:"2px solid color-mix(in srgb, #10B981 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #10B981 30%, transparent)"},children:e.jsx(d,{Icon:o.Heart,size:20,style:{color:"#10B981"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Préférences Alimentaires"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"Vos goûts et préférences culinaires détaillées"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400"}),e.jsx("span",{className:"text-green-300 text-sm font-medium",children:"Goûts"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-3",children:"Cuisines du monde"}),e.jsx(be,{items:s.foodPreferences?.cuisines||[],onUpdate:S,suggestions:v,placeholder:"Ajouter une cuisine...",itemColor:"#A855F7"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-3",children:"Ingrédients et familles d'aliments"}),e.jsx(be,{items:s.foodPreferences?.ingredients||[],onUpdate:h,suggestions:I,placeholder:"Ajouter un ingrédient...",itemColor:"#EC4899"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-3",children:"Saveurs et goûts"}),e.jsx(be,{items:s.foodPreferences?.flavors||[],onUpdate:x,suggestions:g,placeholder:"Ajouter une saveur...",itemColor:"#F59E0B"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white/90 text-sm font-medium mb-4",children:"Préférences sensorielles"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sensoryPreferences.spiceTolerance",className:"block text-white/80 text-sm mb-3",children:"Tolérance au piment (0-3)"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{...t("sensoryPreferences.spiceTolerance",{valueAsNumber:!0}),type:"range",id:"sensoryPreferences.spiceTolerance",min:"0",max:"3",step:"1",className:"w-full h-2 bg-white/10 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, 
                      #22C55E 0%, #F59E0B 33%, #EF4444 66%, #DC2626 100%
                    )`}}),e.jsxs("div",{className:"flex justify-between text-xs text-white/60",children:[e.jsx("span",{children:"Aucun"}),e.jsx("span",{children:"Doux"}),e.jsx("span",{children:"Moyen"}),e.jsx("span",{children:"Fort"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 text-sm mb-3",children:"Textures à éviter"}),e.jsx(de,{items:s.sensoryPreferences?.textureAversions||[],newItem:c,setNewItem:m,onAdd:N,onRemove:y,placeholder:"Ex: Gélatineux, Granuleux...",itemColor:"#A855F7",itemLabel:"texture"})]})]})]})]}),e.jsx(re,{isDirty:i,isSaving:a,onSave:l,sectionName:"Préférences"})]})},At=({register:t,watchedValues:s,setValue:r,isDirty:i,isSaving:a,onSave:l})=>{const[n,c]=_.useState(""),[m,u]=_.useState(""),b=_.useCallback(()=>{if(n.trim()){const x=s.allergies||[],v=n.trim();x.includes(v)||(r("allergies",[...x,v],{shouldDirty:!0}),c(""))}},[n,s.allergies,r]),N=_.useCallback(x=>{const v=s.allergies||[];r("allergies",v.filter((I,g)=>g!==x),{shouldDirty:!0})},[s.allergies,r]),y=_.useCallback(()=>{if(m.trim()){const x=s.intolerances||[],v=m.trim();x.includes(v)||(r("intolerances",[...x,v],{shouldDirty:!0}),u(""))}},[m,s.intolerances,r]),S=_.useCallback(x=>{const v=s.intolerances||[];r("intolerances",v.filter((I,g)=>g!==x),{shouldDirty:!0})},[s.intolerances,r]),h=_.useCallback(x=>{r("noKnownAllergies",x.target.checked,{shouldDirty:!0}),x.target.checked&&r("allergies",[],{shouldDirty:!0})},[r]);return e.jsxs(D,{className:"p-6",style:{background:`
        radial-gradient(circle at 30% 20%, rgba(239, 68, 68, 0.08) 0%, transparent 60%),
        var(--glass-opacity)
      `,borderColor:"rgba(239, 68, 68, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, #EF4444 35%, transparent), color-mix(in srgb, #EF4444 25%, transparent))
              `,border:"2px solid color-mix(in srgb, #EF4444 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #EF4444 30%, transparent)"},children:e.jsx(d,{Icon:o.AlertCircle,size:20,style:{color:"#EF4444"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Restrictions Alimentaires"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"Allergies et intolérances importantes"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-400"}),e.jsx("span",{className:"text-red-300 text-sm font-medium",children:"Critique"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-3",children:"Allergies alimentaires"}),e.jsx("div",{className:"mb-4",children:e.jsxs("label",{className:"flex items-center gap-3 p-3 rounded-xl bg-white/5 border border-white/10 cursor-pointer hover:bg-white/8 transition-colors",children:[e.jsx("input",{...t("noKnownAllergies"),type:"checkbox",onChange:h,className:"sr-only"}),e.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center transition-colors ${s.noKnownAllergies?"border-green-400 bg-green-500":"border-white/30"}`,children:s.noKnownAllergies&&e.jsx(d,{Icon:o.Check,size:12,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium",children:"Je n'ai pas d'allergies alimentaires connues"}),e.jsx("div",{className:"text-white/60 text-sm",children:"Cochez cette case si vous n'avez aucune allergie"})]})]})}),!s.noKnownAllergies&&e.jsx(de,{items:s.allergies||[],newItem:n,setNewItem:c,onAdd:b,onRemove:N,placeholder:"Ajouter une allergie...",itemColor:"#EF4444",itemLabel:"allergie"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-3",children:"Intolérances alimentaires"}),e.jsx(de,{items:s.intolerances||[],newItem:m,setNewItem:u,onAdd:y,onRemove:S,placeholder:"Ajouter une intolérance...",itemColor:"#F59E0B",itemLabel:"intolérance"})]})]}),e.jsx(re,{isDirty:i,isSaving:a,onSave:l,sectionName:"Restrictions"})]})},Ie={sedentary:1.2,lightly_active:1.375,moderately_active:1.55,very_active:1.725,extremely_active:1.9},Ae={lose_weight:-500,maintain:0,gain_weight:300,gain_muscle:500};function kt(t){try{const s=new Date(t),r=new Date;let i=r.getFullYear()-s.getFullYear();const a=r.getMonth()-s.getMonth();return(a<0||a===0&&r.getDate()<s.getDate())&&i--,i>0&&i<120?i:null}catch{return null}}function Et(t,s,r,i){const a=10*s+6.25*r-5*i;return t==="male"?a+5:a-161}function Tt(t){const{sex:s,weight_kg:r,height_cm:i,birthdate:a,activity_level:l,objective:n}=t;if(!s||!r||!i||!a||r<=0||i<=0)return null;const c=kt(a);if(!c)return null;const m=Et(s,r,i,c),u=l?Ie[l]:Ie.moderately_active,b=m*u,N=n?Ae[n]:Ae.maintain,y=b+N;return Math.round(y/50)*50}function Pt(t,s){if(!s)return"Complétez votre profil pour calculer vos besoins caloriques";const{sex:r,activity_level:i,objective:a}=t,l=r==="male"?"homme":"femme",n=i?{sedentary:"sédentaire",lightly_active:"légèrement actif",moderately_active:"modérément actif",very_active:"très actif",extremely_active:"extrêmement actif"}[i]:"activité modérée",c=a?{lose_weight:"perte de poids",maintain:"maintien",gain_weight:"prise de poids",gain_muscle:"prise de muscle"}[a]:"maintien";return`${s} kcal/jour (${l}, ${n}, objectif: ${c})`}function Dt(t){return!!(t.sex&&t.weight_kg&&t.height_cm&&t.birthdate)}const Mt=({register:t,watchedValues:s,setValue:r,isDirty:i,isSaving:a,onSave:l})=>{const{profile:n}=q(),[c,m]=_.useState(!1),u=_.useMemo(()=>n?Tt({sex:n.sex,weight_kg:n.weight_kg,height_cm:n.height_cm,birthdate:n.birthdate,activity_level:n.activity_level,objective:n.objective}):null,[n?.sex,n?.weight_kg,n?.height_cm,n?.birthdate,n?.activity_level,n?.objective]),b=_.useMemo(()=>n?Dt({sex:n.sex,weight_kg:n.weight_kg,height_cm:n.height_cm,birthdate:n.birthdate}):!1,[n?.sex,n?.weight_kg,n?.height_cm,n?.birthdate]),N=_.useMemo(()=>n?Pt({sex:n.sex,weight_kg:n.weight_kg,height_cm:n.height_cm,birthdate:n.birthdate,activity_level:n.activity_level,objective:n.objective},u):"",[n,u]);return _.useEffect(()=>{if(c||!u)return;const y=s.macroTargets?.kcal;(!y||y===0)&&r("macroTargets.kcal",u,{shouldDirty:!1}),m(!0)},[u,s.macroTargets?.kcal,r,c]),e.jsxs(D,{className:"p-6",style:{background:`
        radial-gradient(circle at 30% 20%, rgba(34, 197, 94, 0.08) 0%, transparent 60%),
        var(--glass-opacity)
      `,borderColor:"rgba(34, 197, 94, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, #22C55E 35%, transparent), color-mix(in srgb, #22C55E 25%, transparent))
              `,border:"2px solid color-mix(in srgb, #22C55E 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #22C55E 30%, transparent)"},children:e.jsx(d,{Icon:o.Target,size:20,style:{color:"#22C55E"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Objectifs Nutritionnels"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"Cibles nutritionnelles optionnelles pour l'IA"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400"}),e.jsx("span",{className:"text-green-300 text-sm font-medium",children:"Optionnel"})]})]}),b&&u&&e.jsx("div",{className:"mb-4 p-3 rounded-xl",style:{background:"rgba(34, 197, 94, 0.08)",border:"1px solid rgba(34, 197, 94, 0.2)"},children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(d,{Icon:o.Sparkles,size:14,className:"flex-shrink-0 mt-0.5",style:{color:"#22C55E"}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-green-300 text-xs font-medium mb-1",children:"Calcul automatique"}),e.jsx("p",{className:"text-white/70 text-xs",children:N})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"macroTargets.kcal",className:"flex items-center gap-2 text-white/80 text-sm mb-2",children:["Calories/jour",b&&e.jsxs("span",{className:"text-xs text-green-400 flex items-center gap-1",children:[e.jsx(d,{Icon:o.Sparkles,size:10}),"Auto"]})]}),e.jsx("input",{...t("macroTargets.kcal",{valueAsNumber:!0}),type:"number",id:"macroTargets.kcal",min:"800",max:"5000",step:"50",className:"glass-input",placeholder:u?.toString()||"2000"}),!b&&e.jsx("p",{className:"text-white/50 text-xs mt-1",children:"Complétez votre profil (sexe, poids, taille, date de naissance) pour le calcul automatique"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"macroTargets.fiberMinG",className:"block text-white/80 text-sm mb-2",children:"Fibres min (g)"}),e.jsx("input",{...t("macroTargets.fiberMinG",{valueAsNumber:!0}),type:"number",id:"macroTargets.fiberMinG",min:"0",max:"100",className:"glass-input",placeholder:"25"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"macroTargets.sugarMaxG",className:"block text-white/80 text-sm mb-2",children:"Sucre max (g)"}),e.jsx("input",{...t("macroTargets.sugarMaxG",{valueAsNumber:!0}),type:"number",id:"macroTargets.sugarMaxG",min:"0",max:"200",className:"glass-input",placeholder:"50"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"macroTargets.saltMaxMg",className:"block text-white/80 text-sm mb-2",children:"Sel max (mg)"}),e.jsx("input",{...t("macroTargets.saltMaxMg",{valueAsNumber:!0}),type:"number",id:"macroTargets.saltMaxMg",min:"0",max:"10000",step:"100",className:"glass-input",placeholder:"2300"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"macroTargets.carbsMaxG",className:"block text-white/80 text-sm mb-2",children:"Glucides max (g)"}),e.jsx("input",{...t("macroTargets.carbsMaxG",{valueAsNumber:!0}),type:"number",id:"macroTargets.carbsMaxG",min:"0",max:"1000",className:"glass-input",placeholder:"250"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"macroTargets.fatMinG",className:"block text-white/80 text-sm mb-2",children:"Lipides min (g)"}),e.jsx("input",{...t("macroTargets.fatMinG",{valueAsNumber:!0}),type:"number",id:"macroTargets.fatMinG",min:"0",max:"300",className:"glass-input",placeholder:"60"})]})]}),e.jsx(re,{isDirty:i,isSaving:a,onSave:l,sectionName:"Nutrition"})]})},Rt=({register:t,watchedValues:s,setValue:r,isDirty:i,isSaving:a,onSave:l})=>{const[n,c]=_.useState(""),m=_.useCallback(()=>{if(n.trim()){const b=s.shoppingPreferences?.bias||[],N=n.trim();b.includes(N)||(r("shoppingPreferences.bias",[...b,N],{shouldDirty:!0}),c(""))}},[n,s.shoppingPreferences?.bias,r]),u=_.useCallback(b=>{const N=s.shoppingPreferences?.bias||[];r("shoppingPreferences.bias",N.filter((y,S)=>S!==b),{shouldDirty:!0})},[s.shoppingPreferences?.bias,r]);return e.jsxs(D,{className:"p-6",style:{background:`
        radial-gradient(circle at 30% 20%, rgba(16, 185, 129, 0.08) 0%, transparent 60%),
        var(--glass-opacity)
      `,borderColor:"rgba(16, 185, 129, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, #10B981 35%, transparent), color-mix(in srgb, #10B981 25%, transparent))
              `,border:"2px solid color-mix(in srgb, #10B981 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #10B981 30%, transparent)"},children:e.jsx(d,{Icon:o.ShoppingCart,size:20,style:{color:"#10B981"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Habitudes de Courses"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"Fréquence, portions et préférences d'achat"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400"}),e.jsx("span",{className:"text-green-300 text-sm font-medium",children:"Courses"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"shoppingPreferences.frequencyPerWeek",className:"block text-white/80 text-sm mb-2",children:"Fréquence courses/semaine"}),e.jsx("input",{...t("shoppingPreferences.frequencyPerWeek",{valueAsNumber:!0}),type:"number",id:"shoppingPreferences.frequencyPerWeek",min:"1",max:"7",className:"glass-input",placeholder:"2"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"shoppingPreferences.defaultPortionsPerMeal",className:"block text-white/80 text-sm mb-2",children:"Portions par repas par défaut"}),e.jsx("input",{...t("shoppingPreferences.defaultPortionsPerMeal",{valueAsNumber:!0}),type:"number",id:"shoppingPreferences.defaultPortionsPerMeal",min:"1",max:"12",className:"glass-input",placeholder:"2"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"shoppingPreferences.batchCooking",className:"block text-white/80 text-sm mb-2",children:"Batch cooking"}),e.jsxs("select",{...t("shoppingPreferences.batchCooking"),id:"shoppingPreferences.batchCooking",className:"glass-input",children:[e.jsx("option",{value:"never",children:"❌ Jamais"}),e.jsx("option",{value:"sometimes",children:"🔄 Parfois"}),e.jsx("option",{value:"often",children:"✅ Souvent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"shoppingPreferences.budgetPerWeek",className:"block text-white/80 text-sm mb-2",children:"Budget/semaine (€)"}),e.jsx("input",{...t("shoppingPreferences.budgetPerWeek",{valueAsNumber:!0}),type:"number",id:"shoppingPreferences.budgetPerWeek",min:"0",max:"1000",step:"10",className:"glass-input",placeholder:"100"})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-3",children:"Biais d'achat (bio, local, format familial...)"}),e.jsx(de,{items:s.shoppingPreferences?.bias||[],newItem:n,setNewItem:c,onAdd:m,onRemove:u,placeholder:"Ex: Bio, Local, Format familial...",itemColor:"#EC4899",itemLabel:"préférence"})]}),e.jsx(re,{isDirty:i,isSaving:a,onSave:l,sectionName:"Courses"})]})},Ks=()=>{const{profile:t}=q(),s=Ue(),r=ie();T.useEffect(()=>{if(s.hash){const O=s.hash.replace("#",""),F=(G=0)=>{const Z=document.getElementById(O);Z?Z.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}):G<10&&setTimeout(()=>F(G+1),100)};setTimeout(()=>F(),500)}},[s.hash]);const i=$e(t),{form:a,actions:l,state:n}=jt();Y(O=>O.setTabDirty);const c=T.useMemo(()=>ot(t),[t?.diet,t?.allergies,t?.food_preferences]),{register:m,handleSubmit:u,errors:b,isDirty:N,watchedValues:y,setValue:S}=a,{saveDietSection:h,saveRestrictionsSection:x,saveEssentialsSection:v,savePreferencesSection:I,saveNutritionSection:g,saveShoppingSection:p,onSubmit:j}=l,{saving:M,sectionSaving:w,hasDietChanges:C,hasRestrictionsChanges:A,hasEssentialsChanges:E,hasPreferencesChanges:k,hasNutritionChanges:P,hasShoppingChanges:L}=n;return e.jsxs(K,{performanceConfig:r,direction:"up",distance:20,className:"space-y-6 profile-section",children:[r.shouldUseAnimatePresence?e.jsx(ee,{children:!i.isSufficient&&e.jsx(Se,{completion:i,variant:"banner",showDismiss:!1})}):!i.isSufficient&&e.jsx(Se,{completion:i,variant:"banner",showDismiss:!1}),e.jsx(yt,{percentage:c,title:"Forge Nutritionnelle",subtitle:"Configurez vos préférences alimentaires pour une personnalisation optimale",color:"#10B981"}),e.jsxs("form",{onSubmit:u(j),className:"space-y-6",children:[e.jsx("div",{id:"diet-section",children:e.jsx(Nt,{register:m,isDirty:C,isSaving:w==="diet",onSave:h})}),e.jsx("div",{id:"restrictions-section",children:e.jsx(At,{register:m,watchedValues:y,setValue:S,isDirty:A,isSaving:w==="restrictions",onSave:x})}),e.jsx("div",{id:"essentials-section",children:e.jsx(St,{register:m,watchedValues:y,isDirty:E,isSaving:w==="essentials",onSave:v})}),e.jsx("div",{id:"preferences-section",children:e.jsx(It,{register:m,watchedValues:y,setValue:S,isDirty:k,isSaving:w==="preferences",onSave:I})}),e.jsx("div",{id:"macros-section",children:e.jsx(Mt,{register:m,watchedValues:y,setValue:S,isDirty:P,isSaving:w==="nutrition",onSave:g})}),e.jsx("div",{id:"shopping-section",children:e.jsx(Rt,{register:m,watchedValues:y,setValue:S,isDirty:L,isSaving:w==="shopping",onSave:p})}),e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx("button",{type:"submit",disabled:M||!N,className:`btn-glass--primary px-8 py-4 text-lg font-semibold ${N?"":"opacity-50 cursor-not-allowed"}`,onClick:()=>Ve.tap(),children:e.jsxs("div",{className:"flex items-center gap-3",children:[M?e.jsx(d,{Icon:o.Loader2,size:20,className:"animate-spin"}):e.jsx(d,{Icon:o.Save,size:20}),e.jsx("span",{children:M?"Sauvegarde...":"Sauvegarder Tout"})]})})}),Object.keys(b).length>0&&e.jsxs(D,{className:"p-4",style:{background:"rgba(239, 68, 68, 0.1)",borderColor:"rgba(239, 68, 68, 0.3)"},children:[e.jsxs("h4",{className:"text-red-300 font-medium mb-3 flex items-center gap-2",children:[e.jsx(d,{Icon:o.AlertCircle,size:16}),"Erreurs de validation"]}),e.jsx("div",{className:"space-y-2",children:Object.entries(b).map(([O,F])=>e.jsxs("p",{className:"text-red-200 text-sm flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-1 rounded-full bg-red-400"}),F?.message]},O))})]})]})]})},Ft=W({bloodType:Q(["A+","A-","B+","B-","AB+","AB-","O+","O-"]).optional(),conditions:V(B()).default([]),medications:V(B()).default([]),constraints:V(B()).default([]),physicalLimitations:V(B()).default([]),declaredNoIssues:$().default(!1)});function Ot(){const{profile:t,updateProfile:s,saving:r}=q(),{showToast:i}=le(),{success:a,formSubmit:l}=J(),[n,c]=_.useState(null),m=ue({resolver:ge(Ft),defaultValues:{bloodType:t?.health?.bloodType||void 0,conditions:t?.health?.conditions||[],medications:t?.health?.medications||[],constraints:t?.constraints?Object.values(t.constraints):[],physicalLimitations:t?.health?.physicalLimitations||[],declaredNoIssues:t?.health?.declaredNoIssues||!1},mode:"onChange"}),{register:u,handleSubmit:b,formState:N,watch:y,setValue:S,reset:h,trigger:x}=m,{errors:v,isDirty:I,dirtyFields:g}=N,p=y();_.useEffect(()=>{Y.getState().setTabDirty("health",I)},[I]);const j=async()=>{c("basic");try{await s({health:{...t?.health,bloodType:p.bloodType},updated_at:new Date().toISOString()}),a(),i({type:"success",title:"Informations de base sauvegardées",message:"Vos données médicales de base ont été mises à jour",duration:3e3})}catch{i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder les informations de base",duration:4e3})}finally{c(null)}},M=async()=>{c("medical");try{await s({health:{...t?.health,conditions:p.conditions,medications:p.medications,physicalLimitations:p.physicalLimitations,declaredNoIssues:p.declaredNoIssues},updated_at:new Date().toISOString()}),a(),i({type:"success",title:"Données médicales sauvegardées",message:"Vos conditions et médicaments ont été mis à jour",duration:3e3})}catch{i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder les données médicales",duration:4e3})}finally{c(null)}},w=async()=>{c("constraints");try{const P=(p.constraints||[]).reduce((L,O,F)=>(L[`constraint_${F}`]=O,L),{});await s({constraints:P,updated_at:new Date().toISOString()}),a(),i({type:"success",title:"Contraintes sauvegardées",message:"Vos contraintes alimentaires ont été mises à jour",duration:3e3})}catch{i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder les contraintes",duration:4e3})}finally{c(null)}},C=async P=>{try{l(),f.info("PROFILE_HEALTH","Submitting complete health updates",{userId:t?.userId,philosophy:"complete_health_submission"});const L=(P.constraints||[]).reduce((O,F,G)=>(O[`constraint_${G}`]=F,O),{});await s({health:{...t?.health,bloodType:P.bloodType,conditions:P.conditions,medications:P.medications,physicalLimitations:P.physicalLimitations,declaredNoIssues:P.declaredNoIssues},constraints:L,updated_at:new Date().toISOString()}),a(),i({type:"success",title:"Profil santé sauvegardé",message:"Toutes vos données de santé ont été mises à jour",duration:4e3}),Y.getState().resetTabDirty("health")}catch(L){f.error("PROFILE_HEALTH","Health update failed",{error:L instanceof Error?L.message:"Unknown error",userId:t?.userId}),i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder votre profil santé",duration:4e3})}},A=!!g.bloodType,E=!!(g.conditions||g.medications||g.physicalLimitations),k=!!g.constraints;return{form:{register:u,handleSubmit:b,errors:v,isDirty:I,dirtyFields:g,watchedValues:p,setValue:S,trigger:x},actions:{saveBasicHealthSection:j,saveMedicalSection:M,saveConstraintsSection:w,onSubmit:C},state:{saving:r,sectionSaving:n,hasBasicChanges:A,hasMedicalChanges:E,hasConstraintsChanges:k}}}const Lt=({percentage:t,title:s,subtitle:r,color:i="#EF4444"})=>e.jsxs(D,{className:"p-6 mb-6",style:{background:`
        radial-gradient(circle at 30% 20%, color-mix(in srgb, ${i} 8%, transparent) 0%, transparent 60%),
        var(--glass-opacity)
      `,borderColor:`color-mix(in srgb, ${i} 20%, transparent)`},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{children:e.jsxs("h3",{className:"text-white font-semibold text-xl mb-1 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                  linear-gradient(135deg, color-mix(in srgb, ${i} 35%, transparent), color-mix(in srgb, ${i} 25%, transparent))
                `,border:`2px solid color-mix(in srgb, ${i} 50%, transparent)`,boxShadow:`0 0 20px color-mix(in srgb, ${i} 30%, transparent)`},children:e.jsx(d,{Icon:o.Heart,size:20,style:{color:i},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:s}),r&&e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:r})]})]})}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{background:i,boxShadow:`0 0 8px ${i}60`}}),e.jsxs("span",{className:"text-white font-bold text-lg",children:[t,"%"]})]}),e.jsx("span",{className:"text-white/60 text-xs",children:"Complété"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-full bg-white/10 rounded-full h-3 overflow-hidden",children:e.jsx(R.div,{className:"h-3 rounded-full relative overflow-hidden",style:{background:`linear-gradient(90deg, ${i}, color-mix(in srgb, ${i} 80%, white))`,boxShadow:`0 0 12px ${i}60, inset 0 1px 0 rgba(255,255,255,0.3)`},initial:{width:0},animate:{width:`${t}%`},transition:{duration:1.2,ease:"easeOut"},children:e.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:`linear-gradient(90deg, 
                  transparent 0%, 
                  rgba(255,255,255,0.4) 50%, 
                  transparent 100%
                )`,animation:"progressShimmer 2s ease-in-out infinite"}})})}),e.jsxs("div",{className:"flex justify-between mt-2 text-xs text-white/50",children:[e.jsx("span",{children:"0%"}),e.jsx("span",{children:"25%"}),e.jsx("span",{children:"50%"}),e.jsx("span",{children:"75%"}),e.jsx("span",{children:"100%"})]})]})]}),zt=({isDirty:t,isSaving:s,onSave:r,sectionName:i})=>{const{formSubmit:a}=J();return t?e.jsx(R.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex justify-end mt-4",children:e.jsx("button",{type:"button",onClick:()=>{a(),r()},disabled:s,className:"btn-glass px-4 py-2 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[s?e.jsx(d,{Icon:o.Loader2,size:14,className:"animate-spin"}):e.jsx(d,{Icon:o.Save,size:14}),e.jsx("span",{children:s?"Sauvegarde...":`Sauvegarder ${i}`})]})})}):null},Oe=({items:t,newItem:s,setNewItem:r,onAdd:i,onRemove:a,placeholder:l,itemColor:n,itemLabel:c})=>{const{click:m}=J(),u=_.useRef(null),b=_.useRef(null),N=_.useRef(null),y=_.useRef(t.length);_.useEffect(()=>{t.length>y.current&&(m(),setTimeout(()=>{N.current&&N.current.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})},50),setTimeout(()=>{u.current&&u.current.focus()},100)),y.current=t.length},[t.length,m]);const S=()=>{s.trim()&&i()};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{ref:u,type:"text",value:s,onChange:h=>r(h.target.value),className:"glass-input flex-1",placeholder:l,onKeyDown:h=>{h.key==="Enter"&&(h.preventDefault(),S())}}),e.jsx("button",{type:"button",onClick:S,className:"btn-glass px-4",disabled:!s.trim(),children:e.jsx(d,{Icon:o.Plus,size:14})})]}),e.jsx("div",{ref:b,className:"flex flex-wrap gap-2",children:e.jsx(ee,{mode:"popLayout",children:t.map((h,x)=>e.jsxs(R.div,{ref:x===t.length-1?N:null,className:"chip chip--on flex items-center gap-2",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.2},style:{background:`${n}15`,borderColor:`${n}30`,color:n},children:[e.jsx("span",{children:h}),e.jsx("button",{type:"button",onClick:()=>a(x),className:"hover:opacity-80 transition-opacity",style:{color:n},"aria-label":`Retirer ${c} "${h}"`,children:e.jsx(d,{Icon:o.X,size:12})})]},`${h}-${x}`))})})]})},Bt=({physicalLimitations:t,newPhysicalLimitation:s,setNewPhysicalLimitation:r,onAddPhysicalLimitation:i,onRemovePhysicalLimitation:a,onSave:l,isSaving:n,isDirty:c})=>e.jsxs(D,{className:"p-6",style:{background:`
          radial-gradient(circle at 30% 20%, rgba(239, 68, 68, 0.08) 0%, transparent 60%),
          var(--glass-opacity)
        `,borderColor:"rgba(239, 68, 68, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, #EF4444 35%, transparent), color-mix(in srgb, #EF4444 25%, transparent))
              `,border:"2px solid color-mix(in srgb, #EF4444 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #EF4444 30%, transparent)"},children:e.jsx(d,{Icon:o.AlertTriangle,size:20,style:{color:"#EF4444"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Blessures et Limitations"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"Douleurs, blessures et limitations physiques"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-400"}),e.jsx("span",{className:"text-red-300 text-sm font-medium",children:"Important"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 rounded-xl bg-red-500/10 border border-red-400/20",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(d,{Icon:o.Info,size:16,className:"text-red-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-200 text-sm leading-relaxed mb-2",children:"Indiquez vos blessures passées, douleurs chroniques ou limitations physiques pour adapter vos programmes d'entraînement et éviter les mouvements à risque."}),e.jsxs("div",{className:"text-red-300 text-xs",children:[e.jsx("strong",{children:"Exemples :"}),' "Douleur au genou gauche", "Problème de dos", "Épaule fragile", "Tendinite du coude", "Entorse cheville droite"']})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-3",children:"Limitations physiques et blessures"}),e.jsx(Oe,{items:t,newItem:s,setNewItem:r,onAdd:i,onRemove:a,placeholder:"Ex: Douleur au genou, problème de dos...",itemColor:"rgba(239, 68, 68",itemLabel:"limitation"})]})]}),c&&l&&e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("button",{type:"button",onClick:l,disabled:n,className:"btn-glass px-4 py-2 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[n?e.jsx(d,{Icon:o.Loader2,size:14,className:"animate-spin"}):e.jsx(d,{Icon:o.Save,size:14}),e.jsx("span",{children:n?"Sauvegarde...":"Sauvegarder"})]})})})]}),Ht=({vaccinations:t,countryData:s,onAddVaccination:r,onUpdateVaccination:i,onRemoveVaccination:a,onToggleUpToDate:l,upToDate:n,onSave:c,isSaving:m,isDirty:u})=>{const[b,N]=_.useState(!1),[y,S]=_.useState(""),[h,x]=_.useState(""),[v,I]=_.useState(""),g=_.useMemo(()=>{if(!s?.vaccination_requirements)return[];const A=s.vaccination_requirements.required||[],E=s.vaccination_requirements.recommended||[];return[...new Set([...A,...E])]},[s]),p=A=>{const E=t.find(k=>k.name.toLowerCase()===A.toLowerCase());if(!E)return"missing";if(E.next_due){const k=new Date(E.next_due),P=new Date;if(k<P)return"overdue";if(Math.floor((k.getTime()-P.getTime())/(1e3*60*60*24))<=90)return"due_soon"}return"up_to_date"},j=()=>{if(!y||!h)return;const A={name:y,date:h,next_due:v||void 0,required:g.some(E=>E.toLowerCase()===y.toLowerCase())};r(A),S(""),x(""),I(""),N(!1)},M=A=>{switch(A){case"up_to_date":return{bg:"bg-green-500/10",border:"border-green-400/20",text:"text-green-300",dot:"bg-green-400"};case"due_soon":return{bg:"bg-yellow-500/10",border:"border-yellow-400/20",text:"text-yellow-300",dot:"bg-yellow-400"};case"overdue":return{bg:"bg-red-500/10",border:"border-red-400/20",text:"text-red-300",dot:"bg-red-400"};default:return{bg:"bg-gray-500/10",border:"border-gray-400/20",text:"text-gray-300",dot:"bg-gray-400"}}},w=_.useMemo(()=>{if(g.length===0)return"unknown";const A=g.map(p);return A.some(E=>E==="overdue")?"overdue":A.some(E=>E==="due_soon")?"due_soon":A.some(E=>E==="missing")?"incomplete":"complete"},[g,t]),C={complete:{color:"#10B981",label:"À jour",icon:o.CheckCircle},incomplete:{color:"#F59E0B",label:"Incomplet",icon:o.AlertCircle},due_soon:{color:"#F59E0B",label:"Rappels à prévoir",icon:o.Clock},overdue:{color:"#EF4444",label:"En retard",icon:o.AlertTriangle},unknown:{color:"#6B7280",label:"Non défini",icon:o.Info}}[w];return e.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs(D,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, rgba(239, 68, 68, 0.08) 0%, transparent 60%),
            var(--glass-opacity)
          `,borderColor:"rgba(239, 68, 68, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                  linear-gradient(135deg, rgba(239, 68, 68, 0.4), rgba(239, 68, 68, 0.2))
                `,border:"2px solid rgba(239, 68, 68, 0.5)",boxShadow:"0 0 20px rgba(239, 68, 68, 0.4)"},children:e.jsx(d,{Icon:o.Shield,size:24,style:{color:"#EF4444"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-semibold text-xl",children:"Vaccinations"}),e.jsx("p",{className:"text-white/60 text-sm mt-1",children:s?`Recommandations pour ${s.country_name}`:"Gestion de vos vaccinations"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{background:C.color,boxShadow:`0 0 8px ${C.color}66`}}),e.jsx("span",{className:"text-white/80 text-sm font-medium",children:C.label})]})]}),e.jsx("div",{className:"mb-6 p-4 rounded-xl bg-white/5 border border-white/10",children:e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:n,onChange:A=>l(A.target.checked),className:"glass-checkbox"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-white/90 font-medium text-sm group-hover:text-white transition-colors",children:"Mes vaccinations sont à jour"}),e.jsx("p",{className:"text-white/50 text-xs mt-0.5",children:"Cochez si tous vos vaccins obligatoires et recommandés sont à jour"})]})]})}),g.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"text-white/90 font-medium text-sm mb-3 flex items-center gap-2",children:[e.jsx(d,{Icon:o.MapPin,size:16,className:"text-cyan-400"}),"Vaccins recommandés dans votre pays"]}),e.jsx("div",{className:"space-y-2",children:g.map((A,E)=>{const k=p(A),P=M(k),L=t.find(O=>O.name.toLowerCase()===A.toLowerCase());return e.jsx("div",{className:`p-3 rounded-lg border ${P.bg} ${P.border}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${P.dot}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-white font-medium text-sm",children:A}),L&&e.jsxs("div",{className:"text-white/50 text-xs mt-0.5",children:["Dernière dose: ",new Date(L.date).toLocaleDateString("fr-FR"),L.next_due&&` • Prochain rappel: ${new Date(L.next_due).toLocaleDateString("fr-FR")}`]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[k==="missing"&&e.jsx("button",{type:"button",onClick:()=>{S(A),N(!0)},className:"px-3 py-1 rounded-lg bg-green-500/20 hover:bg-green-500/30 border border-green-400/30 transition-colors",children:e.jsx("span",{className:`text-xs ${P.text}`,children:"Ajouter"})}),k==="overdue"&&e.jsx("span",{className:"px-2 py-1 rounded text-xs bg-red-500/20 text-red-300",children:"Rappel en retard"}),k==="due_soon"&&e.jsx("span",{className:"px-2 py-1 rounded text-xs bg-yellow-500/20 text-yellow-300",children:"Rappel bientôt"}),k==="up_to_date"&&e.jsx(d,{Icon:o.Check,size:16,className:"text-green-400"})]})]})},E)})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-white/90 font-medium text-sm",children:"Vaccinations additionnelles"}),e.jsxs("button",{type:"button",onClick:()=>N(!b),className:"text-sm text-cyan-400 hover:text-cyan-300 transition-colors flex items-center gap-1",children:[e.jsx(d,{Icon:b?o.X:o.Plus,size:14}),b?"Annuler":"Ajouter"]})]}),e.jsx(ee,{children:b&&e.jsx(R.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-4 p-4 rounded-xl bg-white/5 border border-white/10",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 text-xs mb-2",children:"Nom du vaccin *"}),e.jsx("input",{type:"text",value:y,onChange:A=>S(A.target.value),className:"glass-input text-sm",placeholder:"Ex: COVID-19, Tétanos, Grippe..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 text-xs mb-2",children:"Date d'administration *"}),e.jsx("input",{type:"date",value:h,onChange:A=>x(A.target.value),className:"glass-input text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 text-xs mb-2",children:"Prochain rappel"}),e.jsx("input",{type:"date",value:v,onChange:A=>I(A.target.value),className:"glass-input text-sm"})]})]}),e.jsxs("button",{type:"button",onClick:j,disabled:!y||!h,className:"btn-glass w-full py-2 text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(d,{Icon:o.Plus,size:14,className:"inline mr-2"}),"Ajouter la vaccination"]})]})})}),t.filter(A=>!g.some(E=>E.toLowerCase()===A.name.toLowerCase())).length>0&&e.jsx("div",{className:"space-y-2",children:t.filter(A=>!g.some(E=>E.toLowerCase()===A.name.toLowerCase())).map((A,E)=>e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 border border-white/10 flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-white font-medium text-sm",children:A.name}),e.jsxs("div",{className:"text-white/50 text-xs mt-0.5",children:[new Date(A.date).toLocaleDateString("fr-FR"),A.next_due&&` • Rappel: ${new Date(A.next_due).toLocaleDateString("fr-FR")}`]})]}),e.jsx("button",{type:"button",onClick:()=>a(t.indexOf(A)),className:"text-red-400 hover:text-red-300 transition-colors p-2",children:e.jsx(d,{Icon:o.Trash2,size:16})})]},E))}),t.length===0&&!b&&e.jsxs("div",{className:"text-center py-8 text-white/50 text-sm",children:[e.jsx(d,{Icon:o.Shield,size:32,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Aucune vaccination enregistrée"}),e.jsx("p",{className:"text-xs mt-1",children:"Ajoutez vos vaccinations pour un suivi complet"})]})]}),e.jsx(ee,{children:u&&e.jsx(R.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.2},className:"flex justify-end mt-6",children:e.jsx("button",{type:"button",onClick:c,disabled:m,className:"btn-glass px-6 py-2.5 text-sm",style:{background:"rgba(239, 68, 68, 0.2)",borderColor:"rgba(239, 68, 68, 0.4)"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[m?e.jsx(d,{Icon:o.Loader2,size:16,className:"animate-spin"}):e.jsx(d,{Icon:o.Save,size:16}),e.jsx("span",{children:m?"Sauvegarde...":"Sauvegarder"})]})})})}),e.jsx("div",{className:"mt-4 p-3 rounded-lg bg-blue-500/10 border border-blue-400/20",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(d,{Icon:o.Info,size:14,className:"text-blue-400 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-white/70 text-xs leading-relaxed",children:"Les vaccinations recommandées sont basées sur votre pays de résidence. Consultez votre médecin pour un calendrier vaccinal personnalisé."})]})})]})})},qt=["Diabète Type 1","Diabète Type 2","Hypertension","Asthme","Arthrite","Migraine chronique","Apnée du sommeil","Cholestérol élevé","Thyroïde","Reflux gastro-oesophagien"],Gt=({conditions:t,newCondition:s,setNewCondition:r,onAddCondition:i,onRemoveCondition:a,onDeclareNoConditions:l,hasDeclaredNoConditions:n,onSave:c,isSaving:m,isDirty:u})=>{const[b,N]=_.useState(!1),y=qt.filter(h=>h.toLowerCase().includes(s.toLowerCase())&&!t.includes(h)),S=h=>{r(h),N(!1)};return e.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs(D,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, rgba(239, 68, 68, 0.08) 0%, transparent 60%),
            var(--glass-opacity)
          `,borderColor:"rgba(239, 68, 68, 0.2)"},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, rgba(239, 68, 68, 0.4), rgba(239, 68, 68, 0.2))
              `,border:"2px solid rgba(239, 68, 68, 0.5)",boxShadow:"0 0 20px rgba(239, 68, 68, 0.4)"},children:e.jsx(d,{Icon:o.AlertCircle,size:24,style:{color:"#EF4444"},variant:"pure"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-white font-semibold text-xl",children:"Conditions Médicales"}),e.jsx("p",{className:"text-white/60 text-sm mt-1",children:"Maladies chroniques et conditions actuelles"})]}),t.length>0&&e.jsx("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-red-500/20",children:e.jsx("span",{className:"text-red-300 font-bold text-sm",children:t.length})})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-3",children:"Ajouter une condition médicale"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"relative flex-1",children:e.jsx("input",{type:"text",value:s,onChange:h=>{r(h.target.value),N(!0)},onFocus:()=>N(!0),onBlur:()=>setTimeout(()=>N(!1),200),className:"glass-input w-full",placeholder:"Ex: Diabète Type 2, Asthme..."})}),e.jsxs("button",{type:"button",onClick:i,disabled:!s.trim(),className:"btn-glass py-2 px-4 text-sm disabled:opacity-50 disabled:cursor-not-allowed flex-shrink-0",children:[e.jsx(d,{Icon:o.Plus,size:14,className:"inline mr-1"}),"Ajouter"]})]}),b&&s.length>0&&y.length>0&&e.jsx(R.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"absolute z-10 mt-2 w-full max-h-60 overflow-y-auto rounded-xl bg-gray-900/95 border border-white/10 backdrop-blur-xl shadow-2xl",children:e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"text-white/50 text-xs px-3 py-2",children:"Suggestions courantes:"}),y.map((h,x)=>e.jsx("button",{type:"button",onClick:()=>S(h),className:"w-full text-left px-3 py-2 rounded-lg hover:bg-white/10 transition-colors text-white text-sm",children:h},x))]})})]}),t.length>0&&e.jsx("div",{className:"space-y-2",children:t.map((h,x)=>e.jsxs(R.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:x*.05},className:"flex items-center justify-between p-3 rounded-lg bg-red-500/10 border border-red-400/20",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-400"}),e.jsx("span",{className:"text-white font-medium text-sm",children:h})]}),e.jsx("button",{type:"button",onClick:()=>a(x),className:"text-red-400 hover:text-red-300 transition-colors p-2",children:e.jsx(d,{Icon:o.X,size:16})})]},x))}),t.length===0&&!n&&e.jsxs("div",{className:"text-center py-6 text-white/50 text-sm",children:[e.jsx(d,{Icon:o.AlertCircle,size:32,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Aucune condition médicale ajoutée"})]}),e.jsx(ee,{children:u&&c&&e.jsx(R.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.2},className:"flex justify-end mt-6",children:e.jsx("button",{type:"button",onClick:c,disabled:m,className:"btn-glass px-6 py-2.5 text-sm",style:{background:"rgba(239, 68, 68, 0.2)",borderColor:"rgba(239, 68, 68, 0.4)"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[m?e.jsx(d,{Icon:o.Loader2,size:16,className:"animate-spin"}):e.jsx(d,{Icon:o.Save,size:16}),e.jsx("span",{children:m?"Sauvegarde...":"Sauvegarder"})]})})})}),e.jsx("div",{className:"mt-4 p-3 rounded-lg bg-cyan-500/10 border border-cyan-400/20",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(d,{Icon:o.Info,size:14,className:"text-cyan-400 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-white/70 text-xs leading-relaxed",children:"Ces informations permettent de personnaliser vos programmes d'entraînement et d'éviter les exercices contre-indiqués."})]})})]})})},Ut=["Metformine","Lisinopril","Atorvastatine","Levothyroxine","Oméprazole","Amlodipine","Aspirine","Ibuprofène","Paracétamol","Ventoline (Salbutamol)"],$t=({medications:t,newMedication:s,setNewMedication:r,onAddMedication:i,onRemoveMedication:a,onSave:l,isSaving:n,isDirty:c})=>{const[m,u]=_.useState(!1),b=Ut.filter(y=>y.toLowerCase().includes(s.toLowerCase())&&!t.includes(y)),N=y=>{r(y),u(!1)};return e.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},children:e.jsxs(D,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, rgba(239, 68, 68, 0.08) 0%, transparent 60%),
            var(--glass-opacity)
          `,borderColor:"rgba(239, 68, 68, 0.2)"},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, rgba(239, 68, 68, 0.4), rgba(239, 68, 68, 0.2))
              `,border:"2px solid rgba(239, 68, 68, 0.5)",boxShadow:"0 0 20px rgba(239, 68, 68, 0.4)"},children:e.jsx(d,{Icon:o.Pill,size:24,style:{color:"#EF4444"},variant:"pure"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-white font-semibold text-xl",children:"Médicaments Actuels"}),e.jsx("p",{className:"text-white/60 text-sm mt-1",children:"Traitements en cours et suppléments"})]}),t.length>0&&e.jsx("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-blue-500/20",children:e.jsx("span",{className:"text-blue-300 font-bold text-sm",children:t.length})})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-3",children:"Ajouter un médicament"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"relative flex-1",children:e.jsx("input",{type:"text",value:s,onChange:y=>{r(y.target.value),u(!0)},onFocus:()=>u(!0),onBlur:()=>setTimeout(()=>u(!1),200),className:"glass-input w-full",placeholder:"Ex: Metformine, Aspirine..."})}),e.jsxs("button",{type:"button",onClick:i,disabled:!s.trim(),className:"btn-glass py-2 px-4 text-sm disabled:opacity-50 disabled:cursor-not-allowed flex-shrink-0",children:[e.jsx(d,{Icon:o.Plus,size:14,className:"inline mr-1"}),"Ajouter"]})]}),m&&s.length>0&&b.length>0&&e.jsx(R.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"absolute z-10 mt-2 w-full max-h-60 overflow-y-auto rounded-xl bg-gray-900/95 border border-white/10 backdrop-blur-xl shadow-2xl",children:e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"text-white/50 text-xs px-3 py-2",children:"Médicaments courants:"}),b.map((y,S)=>e.jsx("button",{type:"button",onClick:()=>N(y),className:"w-full text-left px-3 py-2 rounded-lg hover:bg-white/10 transition-colors text-white text-sm",children:y},S))]})})]}),t.length>0&&e.jsx("div",{className:"space-y-2",children:t.map((y,S)=>e.jsxs(R.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:S*.05},className:"flex items-center justify-between p-3 rounded-lg bg-blue-500/10 border border-blue-400/20",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-400"}),e.jsx("span",{className:"text-white font-medium text-sm",children:y})]}),e.jsx("button",{type:"button",onClick:()=>a(S),className:"text-blue-400 hover:text-blue-300 transition-colors p-2",children:e.jsx(d,{Icon:o.X,size:16})})]},S))}),t.length===0&&e.jsxs("div",{className:"text-center py-6 text-white/50 text-sm",children:[e.jsx(d,{Icon:o.Pill,size:32,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Aucun médicament ajouté"}),e.jsx("p",{className:"text-xs mt-1",children:"Incluez les traitements et suppléments réguliers"})]}),e.jsx(ee,{children:c&&l&&e.jsx(R.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.2},className:"flex justify-end mt-6",children:e.jsx("button",{type:"button",onClick:l,disabled:n,className:"btn-glass px-6 py-2.5 text-sm",style:{background:"rgba(239, 68, 68, 0.2)",borderColor:"rgba(239, 68, 68, 0.4)"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[n?e.jsx(d,{Icon:o.Loader2,size:16,className:"animate-spin"}):e.jsx(d,{Icon:o.Save,size:16}),e.jsx("span",{children:n?"Sauvegarde...":"Sauvegarder"})]})})})}),e.jsx("div",{className:"mt-4 p-3 rounded-lg bg-amber-500/10 border border-amber-400/20",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(d,{Icon:o.AlertTriangle,size:14,className:"text-amber-400 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-white/70 text-xs leading-relaxed",children:"Important: Incluez tous vos médicaments prescrits et en vente libre. Ces informations peuvent influencer les recommandations nutritionnelles et sportives."})]})})]})})},Vt=["Arachides","Fruits à coque","Lait","Œufs","Soja","Blé/Gluten","Poisson","Fruits de mer","Sésame"],Wt=["Pénicilline","Aspirine","Ibuprofène","Codéine","Morphine","Sulfamides"],Yt=["Pollen","Acariens","Poils de chat","Poils de chien","Moisissures","Latex","Piqûres d'insectes"],ke={mild:{label:"Légère",color:"#10B981",icon:o.Info},moderate:{label:"Modérée",color:"#F59E0B",icon:o.AlertCircle},severe:{label:"Sévère",color:"#EF4444",icon:o.AlertTriangle},anaphylaxis:{label:"Anaphylaxie",color:"#991B1B",icon:o.AlertTriangle}},Kt=({allergies:t,onAddAllergy:s,onRemoveAllergy:r,onSave:i,isSaving:a,isDirty:l})=>{const[n,c]=_.useState(!1),[m,u]=_.useState(""),[b,N]=_.useState("food"),[y,S]=_.useState("mild"),[h,x]=_.useState(!1),I=(()=>{switch(b){case"food":return Vt;case"medication":return Wt;case"environmental":return Yt}})().filter(w=>w.toLowerCase().includes(m.toLowerCase())&&!t.some(C=>C.name===w&&C.category===b)),g=()=>{m.trim()&&(s({name:m.trim(),category:b,severity:y}),u(""),S("mild"),c(!1))},p=w=>{switch(w){case"food":return{label:"Alimentaire",icon:o.Apple,color:"#F59E0B"};case"medication":return{label:"Médicament",icon:o.Pill,color:"#EF4444"};case"environmental":return{label:"Environnement",icon:o.Wind,color:"#10B981"};default:return{label:"Autre",icon:o.AlertCircle,color:"#6B7280"}}},j={food:t.filter(w=>w.category==="food"),medication:t.filter(w=>w.category==="medication"),environmental:t.filter(w=>w.category==="environmental")},M=t.some(w=>w.severity==="anaphylaxis");return e.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs(D,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, rgba(239, 68, 68, 0.08) 0%, transparent 60%),
            var(--glass-opacity)
          `,borderColor:"rgba(239, 68, 68, 0.2)"},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, rgba(239, 68, 68, 0.4), rgba(239, 68, 68, 0.2))
              `,border:"2px solid rgba(239, 68, 68, 0.5)",boxShadow:"0 0 20px rgba(239, 68, 68, 0.4)"},children:e.jsx(d,{Icon:o.AlertTriangle,size:24,style:{color:"#EF4444"},variant:"pure"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-white font-semibold text-xl",children:"Allergies"}),e.jsx("p",{className:"text-white/60 text-sm mt-1",children:"Allergies alimentaires, médicamenteuses et environnementales"})]}),t.length>0&&e.jsx("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-orange-500/20",children:e.jsx("span",{className:"text-orange-300 font-bold text-sm",children:t.length})})]}),M&&e.jsx(R.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mb-6 p-4 rounded-xl bg-red-900/30 border-2 border-red-500/50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(d,{Icon:o.AlertTriangle,size:20,className:"text-red-400 mt-0.5 flex-shrink-0 animate-pulse"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-red-300 font-bold text-sm mb-1",children:"RISQUE D'ANAPHYLAXIE"}),e.jsx("p",{className:"text-white/70 text-xs",children:"Vous avez déclaré des allergies pouvant causer une réaction anaphylactique. Assurez-vous d'avoir toujours votre EpiPen accessible."})]})]})}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-3",children:"Ajouter une allergie"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"text",value:m,onChange:w=>{u(w.target.value),x(!0)},onFocus:()=>x(!0),onBlur:()=>setTimeout(()=>x(!1),200),className:"glass-input w-full",placeholder:"Ex: Arachides, Pénicilline..."}),h&&m.length>0&&I.length>0&&e.jsx("div",{className:"absolute z-10 mt-2 w-full max-h-48 overflow-y-auto rounded-lg bg-gray-900/95 border border-white/10 backdrop-blur-xl shadow-2xl",children:e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"text-white/50 text-xs px-3 py-2",children:"Suggestions courantes:"}),I.map((w,C)=>e.jsx("button",{type:"button",onClick:()=>{u(w),x(!1)},className:"w-full text-left px-3 py-2 rounded-lg hover:bg-white/10 transition-colors text-white text-sm",children:w},C))]})})]}),e.jsxs("button",{type:"button",onClick:()=>c(!n),className:"btn-glass py-2 px-4 text-sm flex-shrink-0",children:[e.jsx(d,{Icon:n?o.ChevronUp:o.ChevronDown,size:14,className:"inline mr-1"}),n?"Masquer":"Options"]})]})]}),e.jsx(ee,{children:n&&e.jsx(R.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-4 p-4 rounded-xl bg-white/5 border border-white/10",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 text-sm mb-2",children:"Catégorie"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:["food","medication","environmental"].map(w=>{const C=p(w);return e.jsxs("button",{type:"button",onClick:()=>N(w),className:`p-3 rounded-lg border-2 transition-all ${b===w?"bg-white/10 border-white/30":"bg-white/5 border-white/10 hover:bg-white/10"}`,children:[e.jsx(d,{Icon:C.icon,size:20,style:{color:C.color},className:"mx-auto mb-1"}),e.jsx("div",{className:"text-white text-xs",children:C.label})]},w)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 text-sm mb-2",children:"Sévérité"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:Object.entries(ke).map(([w,C])=>e.jsx("button",{type:"button",onClick:()=>S(w),className:`p-2 rounded-lg border-2 transition-all ${y===w?"border-white/30":"border-white/10 hover:border-white/20"}`,style:{background:y===w?`${C.color}20`:"transparent"},children:e.jsx("div",{className:"text-xs font-medium",style:{color:C.color},children:C.label})},w))})]}),e.jsxs("button",{type:"button",onClick:g,disabled:!m.trim(),className:"btn-glass w-full py-2 text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(d,{Icon:o.Plus,size:14,className:"inline mr-2"}),"Ajouter avec ces options"]})]})})}),e.jsx("div",{className:"space-y-6",children:["food","medication","environmental"].map(w=>{const C=j[w];if(C.length===0)return null;const A=p(w);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(d,{Icon:A.icon,size:16,style:{color:A.color}}),e.jsxs("h4",{className:"text-white/90 font-medium text-sm",children:[A.label,"s"]}),e.jsxs("span",{className:"text-white/50 text-xs",children:["(",C.length,")"]})]}),e.jsx("div",{className:"space-y-2",children:C.map((E,k)=>{const P=ke[E.severity];return e.jsxs(R.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"flex items-center justify-between p-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{background:P.color}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-white font-medium text-sm",children:E.name}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:e.jsx("span",{className:"px-2 py-0.5 rounded text-xs font-medium",style:{background:`${P.color}20`,color:P.color},children:P.label})})]})]}),e.jsx("button",{type:"button",onClick:()=>r(t.indexOf(E)),className:"text-red-400 hover:text-red-300 transition-colors p-2",children:e.jsx(d,{Icon:o.Trash2,size:16})})]},k)})})]},w)})}),t.length===0&&!n&&e.jsxs("div",{className:"text-center py-8 text-white/50 text-sm",children:[e.jsx(d,{Icon:o.Shield,size:32,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Aucune allergie enregistrée"}),e.jsx("p",{className:"text-xs mt-1",children:"Ajoutez vos allergies pour une meilleure personnalisation"})]}),l&&e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx("button",{type:"button",onClick:i,disabled:a,className:"btn-glass px-4 py-2 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[a?e.jsx(d,{Icon:o.Loader2,size:14,className:"animate-spin"}):e.jsx(d,{Icon:o.Save,size:14}),e.jsx("span",{children:a?"Sauvegarde...":"Sauvegarder"})]})})}),e.jsx("div",{className:"mt-6 p-3 rounded-lg bg-red-500/10 border border-red-400/20",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(d,{Icon:o.Info,size:14,className:"text-red-400 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-white/70 text-xs leading-relaxed",children:"Ces informations sont essentielles pour votre sécurité. Elles seront utilisées pour adapter vos plans nutritionnels et alerter en cas d'urgence médicale."})]})})]})})};function Le(t,s){const{formName:r,userId:i,data:a}=s;return f.error(`HEALTH_SAVE_ERROR_${r}`,"Save operation failed",{error:t instanceof Error?t.message:String(t),stack:t instanceof Error?t.stack:void 0,userId:i,dataKeys:a?Object.keys(a):[],timestamp:new Date().toISOString()}),t instanceof Error&&(t.name==="QuotaExceededError"||t.message.includes("QuotaExceededError")||t.message.includes("quota")||t.message.includes("exceeded the quota"))?{type:"DATABASE",message:"Espace de stockage insuffisant",originalError:t,retryable:!0,userMessage:"Mémoire locale saturée. Un nettoyage automatique a été effectué. Veuillez réessayer."}:t instanceof Error&&(t.message.includes("fetch")||t.message.includes("network")||t.message.includes("timeout")||t.message.includes("Network request failed"))?{type:"NETWORK",message:"Erreur réseau lors de la sauvegarde",originalError:t,retryable:!0,userMessage:"Problème de connexion. Veuillez vérifier votre connexion internet et réessayer."}:t instanceof Error&&(t.message.includes("permission")||t.message.includes("policy")||t.message.includes("RLS")||t.message.includes("JWT"))?{type:"PERMISSION",message:"Erreur de permissions",originalError:t,retryable:!1,userMessage:"Vous n'avez pas les permissions nécessaires. Veuillez vous reconnecter."}:t instanceof Error&&(t.message.includes("constraint")||t.message.includes("duplicate")||t.message.includes("foreign key")||t.message.includes("null value"))?{type:"DATABASE",message:"Erreur de base de données",originalError:t,details:{constraint:t.message},retryable:!1,userMessage:"Données invalides. Veuillez vérifier les informations saisies."}:t instanceof Error&&(t.name==="ZodError"||t.message.includes("validation")||t.message.includes("invalid"))?{type:"VALIDATION",message:"Erreur de validation",originalError:t,retryable:!1,userMessage:"Certains champs contiennent des erreurs. Veuillez les corriger."}:{type:"UNKNOWN",message:t instanceof Error?t.message:"Erreur inconnue",originalError:t instanceof Error?t:void 0,retryable:!0,userMessage:"Une erreur inattendue s'est produite. Veuillez réessayer."}}const Jt={maxAttempts:3,baseDelay:1e3,maxDelay:5e3};async function Zt(t,s,r=Jt){let i,a=0;for(;a<r.maxAttempts;){a++;try{f.debug(`HEALTH_SAVE_RETRY_${s.formName}`,`Attempt ${a}/${r.maxAttempts}`,{userId:s.userId,timestamp:new Date().toISOString()});const l=await t();return a>1&&f.info(`HEALTH_SAVE_RETRY_${s.formName}`,`Succeeded on attempt ${a}`,{userId:s.userId,timestamp:new Date().toISOString()}),l}catch(l){i=l;const n=Le(l,{...s,data:void 0});if(!n.retryable)throw f.error(`HEALTH_SAVE_RETRY_${s.formName}`,"Non-retryable error, aborting",{errorType:n.type,attempt:a,userId:s.userId,timestamp:new Date().toISOString()}),l;if(a>=r.maxAttempts)throw f.error(`HEALTH_SAVE_RETRY_${s.formName}`,"Max retry attempts reached",{attempts:a,userId:s.userId,timestamp:new Date().toISOString()}),l;const c=Math.min(r.baseDelay*Math.pow(2,a-1),r.maxDelay);f.info(`HEALTH_SAVE_RETRY_${s.formName}`,`Retrying after ${c}ms`,{attempt:a,nextAttempt:a+1,maxAttempts:r.maxAttempts,userId:s.userId,timestamp:new Date().toISOString()}),await new Promise(m=>setTimeout(m,c))}}throw i}function Xt(t,s){const r=[];return s.formName==="ALLERGIES"&&t.allergies&&!Array.isArray(t.allergies)&&r.push("Allergies must be an array"),s.formName==="VACCINATIONS"&&t.vaccinations&&!Array.isArray(t.vaccinations)&&r.push("Vaccinations must be an array"),s.formName==="MEDICAL_CONDITIONS"&&(t.conditions&&!Array.isArray(t.conditions)&&r.push("Conditions must be an array"),t.medications&&!Array.isArray(t.medications)&&r.push("Medications must be an array")),{valid:r.length===0,errors:r}}function Ne(){const{profile:t,updateProfile:s,saving:r}=q(),{showToast:i}=le(),{success:a}=J(),[l,n]=T.useState(null),[c,m]=T.useState([]),u=T.useRef(!1),b=T.useCallback(async S=>{const{section:h,data:x,onSuccess:v,onError:I}=S;if(u.current){f.warn("HEALTH_PROFILE_SAVE","Save already in progress, queuing operation",{section:h,userId:t?.userId}),m(g=>[...g,S]);return}u.current=!0,n(h);try{f.info("HEALTH_PROFILE_SAVE",`Starting save for section: ${h}`,{section:h,userId:t?.userId,dataKeys:Object.keys(x),timestamp:new Date().toISOString()});const g=Xt(x,{formName:h.toUpperCase()});if(!g.valid)throw new Error(`Validation failed: ${g.errors.join(", ")}`);await Zt(async()=>{const p=t?.health;let j;switch(h){case"basic":j={...p,version:"2.0",basic:{...p?.basic,...x}};break;case"allergies":j={...p,version:"2.0",medical_history:{...p?.medical_history,conditions:p?.medical_history?.conditions||[],medications:p?.medical_history?.medications||[],allergies:x.allergies||[]}};break;case"vaccinations":j={...p,version:"2.0",vaccinations:{up_to_date:x.up_to_date||!1,records:x.records||[],last_reviewed:new Date().toISOString()}};break;case"medical_conditions":j={...p,version:"2.0",medical_history:{...p?.medical_history,conditions:x.conditions||[],medications:x.medications||[],allergies:p?.medical_history?.allergies||[]},declaredNoIssues:x.declaredNoIssues||!1};break;case"family_history":j={...p,version:"2.0",family_history:x};break;case"lifestyle":j={...p,version:"2.0",lifestyle:x};break;case"vital_signs":j={...p,version:"2.0",vital_signs:x};break;case"intimacy":j={...p,version:"2.0",intimacy:x};break;case"geographic":await s({country:x.country,updated_at:new Date().toISOString()});return;default:throw new Error(`Unknown health section: ${h}`)}await s({health:j,updated_at:new Date().toISOString()}),f.info("HEALTH_PROFILE_SAVE",`Successfully saved section: ${h}`,{section:h,userId:t?.userId,timestamp:new Date().toISOString()})},{formName:h.toUpperCase(),userId:t?.userId}),a(),i({type:"success",title:"Sauvegardé",message:Qt(h),duration:3e3}),v&&v()}catch(g){f.error("HEALTH_PROFILE_SAVE",`Failed to save section: ${h}`,{error:g instanceof Error?g.message:String(g),stack:g instanceof Error?g.stack:void 0,section:h,userId:t?.userId,timestamp:new Date().toISOString()});const p=Le(g,{formName:h.toUpperCase(),userId:t?.userId,data:x});throw i({type:"error",title:es(p.type),message:p.userMessage,duration:5e3}),I&&I(p),g}finally{u.current=!1,n(null),m(g=>{if(g.length>0){const[p,...j]=g;return setTimeout(()=>b(p),100),j}return g})}},[t,s,i,a]),N=T.useCallback(S=>l===S||r,[l,r]),y=T.useCallback(()=>l!==null||r||c.length>0,[l,r,c.length]);return{saveSection:b,isSectionSaving:N,isAnySectionSaving:y,savingSection:l,pendingOperationsCount:c.length}}function Qt(t){return{basic:"Informations de base sauvegardées",allergies:"Allergies sauvegardées",vaccinations:"Vaccinations sauvegardées",medical_conditions:"Conditions médicales sauvegardées",family_history:"Antécédents familiaux sauvegardés",lifestyle:"Informations de vie sauvegardées",vital_signs:"Signes vitaux sauvegardés",intimacy:"Informations intimes sauvegardées",geographic:"Données géographiques sauvegardées"}[t]||"Informations sauvegardées"}function es(t){return{VALIDATION:"Erreur de validation",NETWORK:"Erreur réseau",PERMISSION:"Erreur de permissions",DATABASE:"Erreur de base de données",UNKNOWN:"Erreur inconnue"}[t]||"Erreur"}function me(t,s){if(t===s)return!0;if(t==null||s==null||typeof t!="object"||typeof s!="object")return t===s;if(Array.isArray(t)!==Array.isArray(s))return!1;if(Array.isArray(t))return t.length!==s.length?!1:t.every((a,l)=>me(a,s[l]));const r=Object.keys(t),i=Object.keys(s);return r.length!==i.length?!1:r.every(a=>me(t[a],s[a]))}function ae(t){if(t===""||t===null||t===void 0)return null;if(Array.isArray(t))return t.length===0?null:t.map(ae);if(typeof t=="object"&&t!==null){const s={};for(const r in t){const i=ae(t[r]);i!==null&&(s[r]=i)}return Object.keys(s).length===0?null:s}return t}function we({currentValues:t,initialValues:s,formName:r,enabled:i=!0}){const[a,l]=T.useState(!1),[n,c]=T.useState([]),[m,u]=T.useState(!1),b=T.useRef(null),N=T.useRef(!1);T.useEffect(()=>{!m&&s&&(b.current=ae(s),u(!0),N.current||(f.debug(`HEALTH_FORM_DIRTY_${r}`,"Form initialized with values",{initialValues:b.current,timestamp:new Date().toISOString()}),N.current=!0))},[s,m,r]),T.useEffect(()=>{if(!i||!m||!b.current)return;const h=ae(t),x=b.current,v=me(h,x),I=a,g=!v;if(I!==g)if(l(g),g){const p=[];for(const j in h)me(h[j],x[j])||p.push(j);c(p),f.info(`HEALTH_FORM_DIRTY_${r}`,"Form became dirty",{changedFields:p,currentValues:h,initialValues:x,timestamp:new Date().toISOString()})}else c([]),f.info(`HEALTH_FORM_DIRTY_${r}`,"Form became clean",{timestamp:new Date().toISOString()})},[t,i,m,a,r]);const y=T.useCallback(h=>{const x=h||t;b.current=ae(x),l(!1),c([]),f.info(`HEALTH_FORM_DIRTY_${r}`,"Dirty state reset",{newInitialValues:b.current,timestamp:new Date().toISOString()})},[t,r]),S=T.useCallback(h=>{l(h),f.info(`HEALTH_FORM_DIRTY_${r}`,"Dirty state set manually",{isDirty:h,timestamp:new Date().toISOString()})},[r]);return{isDirty:i?a:!1,changedFields:n,isInitialized:m,resetDirtyState:y,setDirtyManually:S,changedFieldsCount:n.length}}function ts(t){const{profile:s}=q(),{saveSection:r,isSectionSaving:i}=Ne(),a=s?.health,[l,n]=_.useState([]),[c,m]=_.useState(!1),[u,b]=_.useState({vaccinations:[],upToDate:!1}),N=p=>{n(j=>[...j,p]),f.info("VACCINATIONS_FORM","Added vaccination",{name:p.name})},y=(p,j)=>{n(M=>{const w=[...M];return w[p]=j,w}),f.info("VACCINATIONS_FORM","Updated vaccination",{index:p,name:j.name})},S=p=>{n(j=>j.filter((M,w)=>w!==p)),f.info("VACCINATIONS_FORM","Removed vaccination",{index:p})};_.useEffect(()=>{const p=a?.vaccinations?.records||[],j=a?.vaccinations?.up_to_date||!1;n(p),m(j),b({vaccinations:p,upToDate:j}),f.debug("VACCINATIONS_FORM","Initialized vaccinations from database",{recordsCount:p.length,upToDate:j,timestamp:new Date().toISOString()})},[a?.vaccinations?.records,a?.vaccinations?.up_to_date]);const{isDirty:h,changedFieldsCount:x,resetDirtyState:v}=we({currentValues:{vaccinations:l,upToDate:c},initialValues:u,formName:"VACCINATIONS"});return{vaccinations:l,upToDate:c,onAddVaccination:N,onUpdateVaccination:y,onRemoveVaccination:S,onToggleUpToDate:p=>{m(p),f.info("VACCINATIONS_FORM","Toggled up to date status",{checked:p})},onSave:async()=>{try{f.info("VACCINATIONS_FORM","Saving vaccinations",{userId:s?.userId,count:l.length,upToDate:c}),await r({section:"vaccinations",data:{up_to_date:c,records:l},onSuccess:()=>{b({vaccinations:l,upToDate:c}),v({vaccinations:l,upToDate:c}),f.info("VACCINATIONS_FORM","Successfully saved and reset dirty state",{recordsCount:l.length,upToDate:c})}})}catch(p){f.error("VACCINATIONS_FORM","Save failed (already handled by saveSection)",{error:p instanceof Error?p.message:"Unknown error"})}},isSaving:i("vaccinations"),isDirty:h,changedFieldsCount:x}}function ss(){const{profile:t}=q(),{saveSection:s,isSectionSaving:r}=Ne(),i=t?.health,[a,l]=T.useState([]),[n,c]=T.useState([]),[m,u]=T.useState(""),[b,N]=T.useState(""),[y,S]=T.useState(!1),[h,x]=T.useState({conditions:[],medications:[],hasDeclaredNoIssues:!1});T.useEffect(()=>{const E=i?.medical_history?.conditions||[],k=i?.medical_history?.medications||[],P=i?.declaredNoIssues||!1;l(E),c(k),S(P),x({conditions:E,medications:k,hasDeclaredNoIssues:P}),f.debug("MEDICAL_CONDITIONS_FORM","Initialized from database",{conditionsCount:E.length,medicationsCount:k.length,declaredNoIssues:P,timestamp:new Date().toISOString()})},[i?.medical_history?.conditions,i?.medical_history?.medications,i?.declaredNoIssues]);const{isDirty:v,changedFieldsCount:I,resetDirtyState:g}=we({currentValues:{conditions:a,medications:n,hasDeclaredNoIssues:y},initialValues:h,formName:"MEDICAL_CONDITIONS"}),p=T.useCallback(()=>{m.trim()&&(l(E=>[...E,m.trim()]),u(""),y&&S(!1),f.info("MEDICAL_CONDITIONS_FORM","Added condition",{condition:m.trim()}))},[m,y]),j=T.useCallback(E=>{l(k=>k.filter((P,L)=>L!==E)),f.info("MEDICAL_CONDITIONS_FORM","Removed condition",{index:E})},[]),M=T.useCallback(()=>{b.trim()&&(c(E=>[...E,b.trim()]),N(""),y&&S(!1),f.info("MEDICAL_CONDITIONS_FORM","Added medication",{medication:b.trim()}))},[b,y]),w=T.useCallback(E=>{c(k=>k.filter((P,L)=>L!==E)),f.info("MEDICAL_CONDITIONS_FORM","Removed medication",{index:E})},[]),C=T.useCallback(async()=>{try{f.info("MEDICAL_CONDITIONS_FORM","Declaring no health issues"),await s({section:"medical_conditions",data:{conditions:[],medications:[],declaredNoIssues:!0},onSuccess:()=>{l([]),c([]),S(!0),x({conditions:[],medications:[],hasDeclaredNoIssues:!0}),g({conditions:[],medications:[],hasDeclaredNoIssues:!0}),f.info("MEDICAL_CONDITIONS_FORM","Successfully declared no issues")}})}catch(E){f.error("MEDICAL_CONDITIONS_FORM","Failed to declare no issues",{error:E instanceof Error?E.message:"Unknown error"})}},[s,g]),A=T.useCallback(async()=>{try{f.info("MEDICAL_CONDITIONS_FORM","Saving medical conditions and medications",{conditionsCount:a.length,medicationsCount:n.length,declaredNoIssues:y}),await s({section:"medical_conditions",data:{conditions:a,medications:n,declaredNoIssues:a.length===0&&n.length===0?y:!1},onSuccess:()=>{x({conditions:a,medications:n,hasDeclaredNoIssues:y}),g({conditions:a,medications:n,hasDeclaredNoIssues:y}),f.info("MEDICAL_CONDITIONS_FORM","Successfully saved and reset dirty state",{conditionsCount:a.length,medicationsCount:n.length})}})}catch(E){f.error("MEDICAL_CONDITIONS_FORM","Save failed (already handled by saveSection)",{error:E instanceof Error?E.message:"Unknown error"})}},[a,n,y,s,g]);return{conditions:a,medications:n,newCondition:m,newMedication:b,setNewCondition:u,setNewMedication:N,addCondition:p,removeCondition:j,addMedication:M,removeMedication:w,declareNoIssues:C,hasDeclaredNoIssues:y,saveChanges:A,saving:r("medical_conditions"),isDirty:v,changedFieldsCount:I}}function is(){const{profile:t}=q(),{saveSection:s,isSectionSaving:r}=Ne(),i=t?.health,[a,l]=_.useState([]),[n,c]=_.useState([]);_.useEffect(()=>{const x=(i?.medical_history?.allergies||[]).map(v=>({name:v,category:"food",severity:"mild"}));l(x),c(x),f.debug("ALLERGIES_FORM","Initialized allergies from database",{count:x.length,allergies:x,timestamp:new Date().toISOString()})},[i?.medical_history?.allergies]);const{isDirty:m,changedFieldsCount:u,resetDirtyState:b}=we({currentValues:{allergies:a},initialValues:{allergies:n},formName:"ALLERGIES"});return{allergies:a,onAddAllergy:h=>{l(x=>[...x,h]),f.info("ALLERGIES_FORM","Added allergy",{name:h.name,category:h.category,severity:h.severity})},onRemoveAllergy:h=>{l(x=>x.filter((v,I)=>I!==h)),f.info("ALLERGIES_FORM","Removed allergy",{index:h})},onSave:async()=>{try{f.info("ALLERGIES_FORM","Saving allergies",{userId:t?.userId,count:a.length,allergies:a.map(x=>x.name)});const h=a.map(x=>x.name);await s({section:"allergies",data:{allergies:h},onSuccess:()=>{c(a),b({allergies:a}),f.info("ALLERGIES_FORM","Successfully saved and reset dirty state",{count:a.length})}})}catch(h){f.error("ALLERGIES_FORM","Save failed (already handled by saveSection)",{error:h instanceof Error?h.message:"Unknown error"})}},isSaving:r("allergies"),isDirty:m,changedFieldsCount:u}}function rs(t){const[s,r]=_.useState(null);return _.useEffect(()=>{if(!t){r(null);return}(async()=>{try{f.info("COUNTRY_HEALTH","Fetching country health data",{countryCode:t});const{data:a,error:l}=await X.from("country_health_data").select("*").eq("country_code",t).maybeSingle();if(l){f.error("COUNTRY_HEALTH","Failed to fetch country health data",{error:l.message,countryCode:t});return}a&&(r(a),f.info("COUNTRY_HEALTH","Country health data loaded",{countryCode:t,countryName:a.country_name}))}catch(a){f.error("COUNTRY_HEALTH","Error fetching country health data",{error:a instanceof Error?a.message:"Unknown error",countryCode:t})}})()},[t]),s}const Js=()=>{const{profile:t}=q(),{form:s,actions:r,state:i}=Ot(),{handleSubmit:a,errors:l,isDirty:n,watchedValues:c,setValue:m}=s,{saveMedicalSection:u,saveConstraintsSection:b,onSubmit:N}=r,{saving:y,sectionSaving:S,hasConstraintsChanges:h}=i,x=ie(),[v,I]=_.useState(""),[g,p]=_.useState(""),j=T.useMemo(()=>dt(t),[t?.constraints,t?.medical_conditions,t?.current_medications]),M=rs(t?.country),w=ts(),C=ss(),A=is(),E=()=>{if(v.trim()){const O=c.constraints||[];m("constraints",[...O,v.trim()],{shouldDirty:!0}),I("")}},k=O=>{const F=c.constraints||[];m("constraints",F.filter((G,Z)=>Z!==O),{shouldDirty:!0})},P=()=>{if(g.trim()){const O=c.physicalLimitations||[];m("physicalLimitations",[...O,g.trim()],{shouldDirty:!0}),p("")}},L=O=>{const F=c.physicalLimitations||[];m("physicalLimitations",F.filter((G,Z)=>Z!==O),{shouldDirty:!0})};return e.jsxs(K,{performanceConfig:x,direction:"up",distance:20,className:"space-y-6 profile-section",children:[e.jsx(Lt,{percentage:j,title:"Profil Santé & Médical",subtitle:"Configurez vos informations médicales et contraintes",color:"#EF4444"}),e.jsxs("form",{onSubmit:a(N),className:"space-y-6",children:[e.jsxs(D,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, rgba(239, 68, 68, 0.08) 0%, transparent 60%),
            var(--glass-opacity)
          `,borderColor:"rgba(239, 68, 68, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, #EF4444 35%, transparent), color-mix(in srgb, #EF4444 25%, transparent))
                  `,border:"2px solid color-mix(in srgb, #EF4444 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #EF4444 30%, transparent)"},children:e.jsx(d,{Icon:o.Lock,size:20,style:{color:"#EF4444"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Contraintes Alimentaires"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"Restrictions spécifiques et contraintes médicales"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-400"}),e.jsx("span",{className:"text-red-300 text-sm font-medium",children:"Spécifique"})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-3",children:"Contraintes spécifiques (ex: faible en sodium, sans gluten)"}),e.jsx(Oe,{items:c.constraints||[],newItem:v,setNewItem:I,onAdd:E,onRemove:k,placeholder:"Ajouter une contrainte...",itemColor:"rgba(139, 92, 246",itemLabel:"contrainte"})]})}),e.jsx(zt,{isDirty:h,isSaving:S==="constraints",onSave:b,sectionName:"Contraintes"})]}),e.jsx(Ht,{vaccinations:w.vaccinations,countryData:M,onAddVaccination:w.onAddVaccination,onUpdateVaccination:w.onUpdateVaccination,onRemoveVaccination:w.onRemoveVaccination,onToggleUpToDate:w.onToggleUpToDate,upToDate:w.upToDate,onSave:w.onSave,isSaving:w.isSaving,isDirty:w.isDirty}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(Gt,{conditions:C.conditions,newCondition:C.newCondition,setNewCondition:C.setNewCondition,onAddCondition:C.addCondition,onRemoveCondition:C.removeCondition,onSave:C.saveChanges,isSaving:C.saving,isDirty:C.isDirty}),e.jsx(Kt,{allergies:A.allergies,onAddAllergy:A.onAddAllergy,onRemoveAllergy:A.onRemoveAllergy,onSave:A.onSave,isSaving:A.isSaving,isDirty:A.isDirty})]}),e.jsx($t,{medications:C.medications,newMedication:C.newMedication,setNewMedication:C.setNewMedication,onAddMedication:C.addMedication,onRemoveMedication:C.removeMedication,onSave:C.saveChanges,isSaving:C.saving,isDirty:C.isDirty}),e.jsx(Bt,{physicalLimitations:c.physicalLimitations||[],newPhysicalLimitation:g,setNewPhysicalLimitation:p,onAddPhysicalLimitation:P,onRemovePhysicalLimitation:L,onSave:u,isSaving:S==="medical",isDirty:h}),e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx("button",{type:"submit",disabled:y||!n,className:`btn-glass--primary px-8 py-4 text-lg font-semibold ${n?"":"opacity-50 cursor-not-allowed"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[y?e.jsx(d,{Icon:o.Loader2,size:20,className:"animate-spin"}):e.jsx(d,{Icon:o.Save,size:20}),e.jsx("span",{children:y?"Sauvegarde globale...":"Sauvegarder Tout"})]})})}),Object.keys(l).length>0&&e.jsxs(D,{className:"p-4",style:{background:"rgba(239, 68, 68, 0.1)",borderColor:"rgba(239, 68, 68, 0.3)"},children:[e.jsxs("h4",{className:"text-red-300 font-medium mb-3 flex items-center gap-2",children:[e.jsx(d,{Icon:o.AlertCircle,size:16}),"Erreurs de validation"]}),e.jsx("div",{className:"space-y-2",children:Object.entries(l).map(([O,F])=>e.jsxs("p",{className:"text-red-200 text-sm flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-1 rounded-full bg-red-400"}),F.message]},O))})]})]})]})};function as(t){const s={recommended:120,min:100,max:150,reasoning:"Estimation basée sur un adulte moyen",formula:"Valeur par défaut"};if(!t?.weight_kg||t.weight_kg<=0)return s;const r=t.weight_kg;let i=1.6,a="";t.objective==="muscle_gain"?(i=2.2,a="Prise de muscle - besoins élevés pour la synthèse protéique"):t.objective==="fat_loss"?(i=2,a="Perte de graisse - protéines élevées pour préserver la masse musculaire"):t.objective==="recomp"?(i=1.8,a="Recomposition - équilibre entre maintien et développement musculaire"):(i=1.6,a="Maintenance - besoins standards pour un adulte actif"),t.activity_level==="athlete"?(i+=.2,a+=" + bonus athlète"):t.activity_level==="active"?(i+=.1,a+=" + bonus actif"):t.activity_level==="sedentary"&&(i-=.1,a+=" - ajustement sédentaire");const l=Math.round(r*i),n=Math.round(r*(i-.2)),c=Math.round(r*(i+.3));return{recommended:l,min:n,max:c,reasoning:a,formula:`${r}kg × ${i.toFixed(1)}g/kg = ${l}g`}}function ns(t){return!!(t?.weight_kg&&t.weight_kg>0)}const je=[{id:"16:8",name:"16:8 (Classique)",description:"16h de jeûne, 8h d'alimentation - Le plus populaire et accessible",windowHours:16,eatingHours:8,difficulty:"beginner",benefits:["Facile à maintenir","Améliore la sensibilité à l'insuline","Favorise la perte de graisse"],suggestedTimes:{morning:{start:"20:00",end:"12:00"},evening:{start:"22:00",end:"14:00"},intermediate:{start:"21:00",end:"13:00"}}},{id:"18:6",name:"18:6 (Intermédiaire)",description:"18h de jeûne, 6h d'alimentation - Plus strict, résultats accélérés",windowHours:18,eatingHours:6,difficulty:"intermediate",benefits:["Autophagie renforcée","Perte de graisse accélérée","Clarté mentale"],suggestedTimes:{morning:{start:"19:00",end:"13:00"},evening:{start:"21:00",end:"15:00"},intermediate:{start:"20:00",end:"14:00"}}},{id:"20:4",name:"20:4 (Warrior)",description:`20h de jeûne, 4h d'alimentation - Protocole avancé type "Warrior Diet"`,windowHours:20,eatingHours:4,difficulty:"advanced",benefits:["Autophagie maximale","Discipline mentale","Optimisation hormonale"],suggestedTimes:{morning:{start:"18:00",end:"14:00"},evening:{start:"20:00",end:"16:00"},intermediate:{start:"19:00",end:"15:00"}}},{id:"14:10",name:"14:10 (Débutant)",description:"14h de jeûne, 10h d'alimentation - Idéal pour commencer en douceur",windowHours:14,eatingHours:10,difficulty:"beginner",benefits:["Introduction douce","Facile à adapter","Moins de contraintes"],suggestedTimes:{morning:{start:"21:00",end:"11:00"},evening:{start:"23:00",end:"13:00"},intermediate:{start:"22:00",end:"12:00"}}}];function ls(t){return je.find(s=>s.id===t)||null}function os(t,s){const r=s||"intermediate";return t.suggestedTimes[r]}const cs=W({fastingWindow:W({start:B().optional(),end:B().optional(),windowHours:H().min(8).max(24).optional(),mealsPerDay:H().min(1).max(8).optional(),protocol:B().optional()}).optional(),proteinTarget_g:H().min(0).max(300).optional(),caloriesTarget:H().min(800).max(5e3).optional()});function ds(){const{profile:t,updateProfile:s,saving:r}=q(),{showToast:i}=le(),{success:a,formSubmit:l}=J(),[n,c]=_.useState(null),m=_.useMemo(()=>ns(t)?as(t):null,[t?.weight_kg,t?.objective,t?.activity_level]),[u,b]=_.useState(""),N=ue({resolver:ge(cs),defaultValues:{fastingWindow:{start:t?.fastingWindow?.start||"",end:t?.fastingWindow?.end||"",windowHours:t?.fastingWindow?.windowHours||void 0,mealsPerDay:t?.fastingWindow?.mealsPerDay||void 0,protocol:t?.fastingWindow?.protocol||""},proteinTarget_g:t?.nutrition?.proteinTarget_g||m?.recommended||void 0,caloriesTarget:t?.macroTargets?.kcal||void 0},mode:"onChange"}),{register:y,handleSubmit:S,formState:h,watch:x,setValue:v,reset:I,trigger:g}=N,{errors:p,isDirty:j,dirtyFields:M}=h,w=x();_.useEffect(()=>{Y.getState().setTabDirty("fasting",j)},[j]),_.useEffect(()=>{t&&!j&&I({fastingWindow:{start:t.fastingWindow?.start||"",end:t.fastingWindow?.end||"",windowHours:t.fastingWindow?.windowHours||void 0,mealsPerDay:t.fastingWindow?.mealsPerDay||void 0,protocol:t.fastingWindow?.protocol||""},proteinTarget_g:t.nutrition?.proteinTarget_g||m?.recommended||void 0,caloriesTarget:t.macroTargets?.kcal||void 0})},[t,j,I]),_.useEffect(()=>{w.fastingWindow?.protocol!==void 0&&b(w.fastingWindow.protocol)},[w.fastingWindow?.protocol]);const C=F=>{if(b(F),F==="custom"){v("fastingWindow.protocol",F,{shouldDirty:!0});return}if(F===""){v("fastingWindow.protocol","",{shouldDirty:!0}),v("fastingWindow.windowHours",void 0,{shouldDirty:!0}),v("fastingWindow.start","",{shouldDirty:!0}),v("fastingWindow.end","",{shouldDirty:!0});return}const G=ls(F);if(G){v("fastingWindow.protocol",F,{shouldDirty:!0}),v("fastingWindow.windowHours",G.windowHours,{shouldDirty:!0});const Z=t?.emotions?.chronotype,oe=os(G,Z);v("fastingWindow.start",oe.start,{shouldDirty:!0}),v("fastingWindow.end",oe.end,{shouldDirty:!0})}},A=()=>{m&&v("proteinTarget_g",m.recommended,{shouldDirty:!0})},E=async()=>{c("fasting");try{await s({fastingWindow:w.fastingWindow,updated_at:new Date().toISOString()}),I({fastingWindow:w.fastingWindow,proteinTarget_g:w.proteinTarget_g,caloriesTarget:w.caloriesTarget}),Y.getState().resetTabDirty("fasting"),a(),i({type:"success",title:"Protocole de jeûne sauvegardé",message:"Votre fenêtre de jeûne a été mise à jour",duration:3e3})}catch{i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder le protocole de jeûne",duration:4e3})}finally{c(null)}},k=async()=>{c("objectives");try{await s({nutrition:{...t?.nutrition,proteinTarget_g:w.proteinTarget_g},macroTargets:{...t?.macroTargets,kcal:w.caloriesTarget},updated_at:new Date().toISOString()}),I({fastingWindow:w.fastingWindow,proteinTarget_g:w.proteinTarget_g,caloriesTarget:w.caloriesTarget}),Y.getState().resetTabDirty("fasting"),a(),i({type:"success",title:"Objectifs nutritionnels sauvegardés",message:"Vos cibles ont été mises à jour",duration:3e3})}catch{i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder les objectifs",duration:4e3})}finally{c(null)}},P=async F=>{try{l(),f.info("PROFILE_FASTING","Submitting complete fasting updates",{userId:t?.userId,philosophy:"complete_fasting_submission"}),await s({fastingWindow:F.fastingWindow,nutrition:{...t?.nutrition,proteinTarget_g:F.proteinTarget_g},macroTargets:{...t?.macroTargets,kcal:F.caloriesTarget},updated_at:new Date().toISOString()}),a(),i({type:"success",title:"Profil de jeûne sauvegardé",message:"Toutes vos données de jeûne ont été mises à jour",duration:4e3}),Y.getState().resetTabDirty("fasting")}catch(G){f.error("PROFILE_FASTING","Fasting update failed",{error:G instanceof Error?G.message:"Unknown error",userId:t?.userId}),i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder votre profil de jeûne",duration:4e3})}},L=!!M.fastingWindow,O=!!(M.proteinTarget_g||M.caloriesTarget);return{form:{register:y,handleSubmit:S,errors:p,isDirty:j,dirtyFields:M,watchedValues:w,setValue:v,trigger:g},actions:{saveFastingSection:E,saveObjectivesSection:k,onSubmit:P},state:{saving:r,sectionSaving:n,hasFastingChanges:L,hasObjectivesChanges:O},helpers:{proteinCalculation:m,selectedFastingProtocol:u,handleFastingProtocolChange:C,resetProteinTarget:A}}}const ms=({percentage:t,title:s,subtitle:r,color:i="#F59E0B"})=>e.jsxs(D,{className:"p-6 mb-6",style:{background:`
        radial-gradient(circle at 30% 20%, color-mix(in srgb, ${i} 8%, transparent) 0%, transparent 60%),
        var(--glass-opacity)
      `,borderColor:`color-mix(in srgb, ${i} 20%, transparent)`},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{children:e.jsxs("h3",{className:"text-white font-semibold text-xl mb-1 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                  linear-gradient(135deg, color-mix(in srgb, ${i} 35%, transparent), color-mix(in srgb, ${i} 25%, transparent))
                `,border:`2px solid color-mix(in srgb, ${i} 50%, transparent)`,boxShadow:`0 0 20px color-mix(in srgb, ${i} 30%, transparent)`},children:e.jsx(d,{Icon:o.Timer,size:20,style:{color:i},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:s}),r&&e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:r})]})]})}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{background:i,boxShadow:`0 0 8px ${i}60`}}),e.jsxs("span",{className:"text-white font-bold text-lg",children:[t,"%"]})]}),e.jsx("span",{className:"text-white/60 text-xs",children:"Complété"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-full bg-white/10 rounded-full h-3 overflow-hidden",children:e.jsx(R.div,{className:"h-3 rounded-full relative overflow-hidden",style:{background:`linear-gradient(90deg, ${i}, color-mix(in srgb, ${i} 80%, white))`,boxShadow:`0 0 12px ${i}60, inset 0 1px 0 rgba(255,255,255,0.3)`},initial:{width:0},animate:{width:`${t}%`},transition:{duration:1.2,ease:"easeOut"},children:e.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:`linear-gradient(90deg, 
                  transparent 0%, 
                  rgba(255,255,255,0.4) 50%, 
                  transparent 100%
                )`,animation:"progressShimmer 2s ease-in-out infinite"}})})}),e.jsxs("div",{className:"flex justify-between mt-2 text-xs text-white/50",children:[e.jsx("span",{children:"0%"}),e.jsx("span",{children:"25%"}),e.jsx("span",{children:"50%"}),e.jsx("span",{children:"75%"}),e.jsx("span",{children:"100%"})]})]})]}),Ee=({isDirty:t,isSaving:s,onSave:r,sectionName:i})=>{const{formSubmit:a}=J();return t?e.jsx(R.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex justify-end mt-4",children:e.jsx("button",{type:"button",onClick:()=>{a(),r()},disabled:s,className:"btn-glass px-4 py-2 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[s?e.jsx(d,{Icon:o.Loader2,size:14,className:"animate-spin"}):e.jsx(d,{Icon:o.Save,size:14}),e.jsx("span",{children:s?"Sauvegarde...":`Sauvegarder ${i}`})]})})}):null},Zs=()=>{const{profile:t}=q(),{form:s,actions:r,state:i,helpers:a}=ds(),{register:l,handleSubmit:n,errors:c,isDirty:m,watchedValues:u}=s,{saveFastingSection:b,saveObjectivesSection:N,onSubmit:y}=r,{saving:S,sectionSaving:h,hasFastingChanges:x,hasObjectivesChanges:v}=i,{proteinCalculation:I,selectedFastingProtocol:g,handleFastingProtocolChange:p,resetProteinTarget:j}=a,M=ie(),w=T.useMemo(()=>ct(t),[t?.fastingWindow,t?.proteinTarget_g,t?.caloriesTarget]);return e.jsxs(K,{performanceConfig:M,direction:"up",distance:20,className:"space-y-6 profile-section",children:[e.jsx(ms,{percentage:w,title:"Jeûne Intermittent",subtitle:"Configurez vos protocoles de jeûne et objectifs nutritionnels",color:"#F59E0B"}),e.jsxs("form",{onSubmit:n(y),className:"space-y-6",children:[e.jsxs(D,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, rgba(245, 158, 11, 0.08) 0%, transparent 60%),
            var(--glass-opacity)
          `,borderColor:"rgba(245, 158, 11, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, #F59E0B 35%, transparent), color-mix(in srgb, #F59E0B 25%, transparent))
                  `,border:"2px solid color-mix(in srgb, #F59E0B 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #F59E0B 30%, transparent)"},children:e.jsx(d,{Icon:o.Timer,size:20,style:{color:"#F59E0B"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Protocoles de Jeûne"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"Configurez votre fenêtre de jeûne intermittent"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-orange-400"}),e.jsx("span",{className:"text-orange-300 text-sm font-medium",children:"Temporel"})]})]}),e.jsx("div",{className:"mb-6 p-4 rounded-xl bg-orange-500/10 border border-orange-400/20",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(d,{Icon:o.Info,size:16,className:"text-orange-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-orange-300 font-medium text-sm mb-2",children:"Qu'est-ce que le jeûne intermittent ?"}),e.jsx("p",{className:"text-orange-200 text-sm leading-relaxed",children:"Le jeûne intermittent alterne entre des périodes de jeûne et d'alimentation. Il peut améliorer la composition corporelle, la sensibilité à l'insuline et favoriser l'autophagie cellulaire."})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"fastingWindow.protocol",className:"block text-white/90 text-sm font-medium mb-3",children:"Protocole de jeûne"}),e.jsxs("select",{value:g,onChange:C=>p(C.target.value),className:"glass-input",id:"fastingWindow.protocol",children:[e.jsx("option",{value:"",children:"Aucun jeûne"}),je.map(C=>e.jsxs("option",{value:C.id,children:[C.name," - ",C.description]},C.id)),e.jsx("option",{value:"custom",children:"Personnalisé"})]}),g==="custom"&&e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{htmlFor:"fastingWindow.windowHours",className:"block text-white/90 text-sm font-medium mb-2",children:"Fenêtre de jeûne personnalisée (heures)"}),e.jsx("input",{...l("fastingWindow.windowHours",{valueAsNumber:!0}),type:"number",id:"fastingWindow.windowHours",min:"8",max:"24",step:"1",className:"glass-input",placeholder:"16"})]}),g&&g!=="custom"&&e.jsx("div",{className:"mt-3 p-3 rounded-xl bg-orange-500/10 border border-orange-400/20",children:(()=>{const C=je.find(A=>A.id===g);return C?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${C.difficulty==="beginner"?"bg-green-400":C.difficulty==="intermediate"?"bg-orange-400":"bg-red-400"}`}),e.jsx("span",{className:"text-orange-300 text-sm font-medium",children:C.difficulty==="beginner"?"Débutant":C.difficulty==="intermediate"?"Intermédiaire":"Avancé"})]}),e.jsxs("div",{className:"text-orange-200 text-xs",children:[e.jsx("strong",{children:"Bénéfices :"})," ",C.benefits.slice(0,2).join(", ")]})]}):null})()})]}),(g||u.fastingWindow?.windowHours)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"fastingWindow.start",className:"block text-white/90 text-sm font-medium mb-3",children:["Début du jeûne",e.jsx("span",{className:"text-orange-300 text-xs ml-2",children:"(dernière prise alimentaire)"})]}),e.jsx("input",{...l("fastingWindow.start"),type:"time",id:"fastingWindow.start",className:"glass-input"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"fastingWindow.end",className:"block text-white/90 text-sm font-medium mb-3",children:["Fin du jeûne",e.jsx("span",{className:"text-orange-300 text-xs ml-2",children:"(première prise alimentaire)"})]}),e.jsx("input",{...l("fastingWindow.end"),type:"time",id:"fastingWindow.end",className:"glass-input"})]})]}),(g||u.fastingWindow?.windowHours)&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{htmlFor:"fastingWindow.mealsPerDay",className:"block text-white/90 text-sm font-medium mb-3",children:["Nombre de repas par jour",e.jsx("span",{className:"text-orange-300 text-xs ml-2",children:"(pendant la fenêtre d'alimentation)"})]}),e.jsxs("select",{...l("fastingWindow.mealsPerDay",{valueAsNumber:!0}),id:"fastingWindow.mealsPerDay",className:"glass-input",children:[e.jsx("option",{value:"",children:"Flexible"}),e.jsx("option",{value:1,children:"1 repas (OMAD)"}),e.jsx("option",{value:2,children:"2 repas"}),e.jsx("option",{value:3,children:"3 repas"}),e.jsx("option",{value:4,children:"4 repas"}),e.jsx("option",{value:5,children:"5 repas"}),e.jsx("option",{value:6,children:"6 repas"})]})]})]}),(g||u.fastingWindow?.windowHours)&&u.fastingWindow?.start&&u.fastingWindow?.end&&e.jsxs("div",{className:"mt-6 p-4 rounded-xl bg-orange-500/10 border border-orange-400/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(d,{Icon:o.Clock,size:14,className:"text-orange-400"}),e.jsx("span",{className:"text-orange-300 font-medium text-sm",children:"Résumé de votre jeûne"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60",children:"Fenêtre :"}),e.jsxs("div",{className:"text-orange-200 font-medium",children:[u.fastingWindow.windowHours||0,"h de jeûne"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60",children:"Alimentation :"}),e.jsxs("div",{className:"text-orange-200 font-medium",children:[u.fastingWindow.end," - ",u.fastingWindow.start]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60",children:"Repas :"}),e.jsxs("div",{className:"text-orange-200 font-medium",children:[u.fastingWindow.mealsPerDay||"Flexible"," par jour"]})]})]})]}),e.jsx(Ee,{isDirty:x,isSaving:h==="fasting",onSave:b,sectionName:"Jeûne"})]}),e.jsxs(D,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, rgba(245, 158, 11, 0.08) 0%, transparent 60%),
            var(--glass-opacity)
          `,borderColor:"rgba(245, 158, 11, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, #F59E0B 35%, transparent), color-mix(in srgb, #F59E0B 25%, transparent))
                  `,border:"2px solid color-mix(in srgb, #F59E0B 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #F59E0B 30%, transparent)"},children:e.jsx(d,{Icon:o.Target,size:20,style:{color:"#F59E0B"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Objectifs Nutritionnels"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"Cibles nutritionnelles et macronutriments"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-orange-400"}),e.jsx("span",{className:"text-orange-300 text-sm font-medium",children:"Cibles"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{htmlFor:"proteinTarget_g",className:"text-white/90 text-sm font-medium",children:"Cible protéines (g/jour)"}),I&&e.jsxs("button",{type:"button",onClick:j,className:"text-orange-400 text-xs hover:text-orange-300 transition-colors flex items-center gap-1",title:`Calculé: ${I.recommended}g (${I.formula})`,children:[e.jsx(d,{Icon:o.RotateCcw,size:12}),"Auto (",I.recommended,"g)"]})]}),e.jsx("input",{...l("proteinTarget_g",{valueAsNumber:!0}),type:"number",id:"proteinTarget_g",min:"0",max:"300",step:"1",className:"glass-input",placeholder:I?.recommended?.toString()||"120"}),I&&e.jsxs("p",{className:"text-orange-300 text-xs mt-2 leading-relaxed",children:["🔥 ",I.reasoning]}),c.proteinTarget_g&&e.jsxs("p",{className:"text-red-300 text-xs mt-2 flex items-center gap-1",children:[e.jsx(d,{Icon:o.AlertCircle,size:12}),c.proteinTarget_g.message]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"caloriesTarget",className:"block text-white/90 text-sm font-medium mb-3",children:"Cible calories (kcal/jour)"}),e.jsx("input",{...l("caloriesTarget",{valueAsNumber:!0}),type:"number",id:"caloriesTarget",min:"800",max:"5000",step:"50",className:"glass-input",placeholder:"2000"}),c.caloriesTarget&&e.jsxs("p",{className:"text-red-300 text-xs mt-2 flex items-center gap-1",children:[e.jsx(d,{Icon:o.AlertCircle,size:12}),c.caloriesTarget.message]})]})]}),e.jsx(Ee,{isDirty:v,isSaving:h==="objectives",onSave:N,sectionName:"Objectifs"})]}),e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx("button",{type:"submit",disabled:S||!m,className:`btn-glass--primary px-8 py-4 text-lg font-semibold ${m?"":"opacity-50 cursor-not-allowed"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[S?e.jsx(d,{Icon:o.Loader2,size:20,className:"animate-spin"}):e.jsx(d,{Icon:o.Save,size:20}),e.jsx("span",{children:S?"Sauvegarde globale...":"Sauvegarder Tout"})]})})}),Object.keys(c).length>0&&e.jsxs(D,{className:"p-4",style:{background:"rgba(239, 68, 68, 0.1)",borderColor:"rgba(239, 68, 68, 0.3)"},children:[e.jsxs("h4",{className:"text-red-300 font-medium mb-3 flex items-center gap-2",children:[e.jsx(d,{Icon:o.AlertCircle,size:16}),"Erreurs de validation"]}),e.jsx("div",{className:"space-y-2",children:Object.entries(c).map(([C,A])=>e.jsxs("p",{className:"text-red-200 text-sm flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-1 rounded-full bg-red-400"}),A.message]},C))})]})]})]})},us=()=>{const t=he(),{click:s}=J(),{hasConnectedWearable:r,connectedDevicesCount:i,loading:a}=We(),l=()=>{s(),t("/settings")};return a?e.jsx("div",{className:"p-4 rounded-xl",style:{background:`
            radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.08) 0%, transparent 60%),
            linear-gradient(145deg, rgba(255, 255, 255, 0.06), rgba(255, 255, 255, 0.02))
          `,border:"2px solid rgba(255, 255, 255, 0.15)",backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 min-w-12 min-h-12 flex-shrink-0 rounded-full flex items-center justify-center",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.25) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, #94A3B8 35%, transparent), color-mix(in srgb, #94A3B8 25%, transparent))
              `,border:"2px solid color-mix(in srgb, #94A3B8 50%, transparent)",boxShadow:`
                0 4px 12px color-mix(in srgb, #94A3B8 40%, transparent),
                inset 0 2px 0 rgba(255, 255, 255, 0.3)
              `},children:e.jsx(d,{Icon:o.Loader2,size:24,className:"text-white/60 animate-spin",variant:"pure"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-semibold text-base",children:"Vérification..."}),e.jsx("p",{className:"text-white/60 text-sm",children:"Chargement des appareils"})]})]})}):r?e.jsx("button",{onClick:l,className:"w-full text-left p-4 rounded-xl transition-all duration-300",style:{background:`
          radial-gradient(circle at 30% 30%, rgba(34, 197, 94, 0.15) 0%, transparent 60%),
          linear-gradient(145deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.04))
        `,border:"2px solid color-mix(in srgb, #22C55E 40%, transparent)",backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)",boxShadow:"0 0 20px color-mix(in srgb, #22C55E 20%, transparent)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-12 h-12 min-w-12 min-h-12 flex-shrink-0 rounded-full flex items-center justify-center relative",style:{background:`
              radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.25) 0%, transparent 60%),
              linear-gradient(135deg, color-mix(in srgb, #22C55E 35%, transparent), color-mix(in srgb, #22C55E 25%, transparent))
            `,border:"2px solid color-mix(in srgb, #22C55E 50%, transparent)",boxShadow:`
              0 4px 12px color-mix(in srgb, #22C55E 40%, transparent),
              inset 0 2px 0 rgba(255, 255, 255, 0.3)
            `},children:[e.jsx(d,{Icon:o.Watch,size:24,style:{color:"rgba(255, 255, 255, 0.9)"},variant:"pure"}),e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 rounded-full bg-green-400 border-2 border-white/20",style:{boxShadow:"0 0 12px rgba(34, 197, 94, 0.6)"}})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"text-white font-semibold text-base",children:[i," appareil",i>1?"s":""," connecté",i>1?"s":""]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400 animate-pulse"}),e.jsx("p",{className:"text-green-300 text-sm font-medium",children:"Synchronisation active"})]})]}),e.jsx(d,{Icon:o.ChevronRight,size:20,className:"text-white/40 flex-shrink-0"})]})}):e.jsx("button",{onClick:l,className:"w-full text-left p-4 rounded-xl transition-all duration-300",style:{background:`
            radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.08) 0%, transparent 60%),
            linear-gradient(145deg, rgba(255, 255, 255, 0.06), rgba(255, 255, 255, 0.02))
          `,border:"2px solid rgba(255, 255, 255, 0.15)",backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 min-w-12 min-h-12 flex-shrink-0 rounded-full flex items-center justify-center",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.25) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, #F59E0B 35%, transparent), color-mix(in srgb, #F59E0B 25%, transparent))
              `,border:"2px solid color-mix(in srgb, #F59E0B 50%, transparent)",boxShadow:`
                0 4px 12px color-mix(in srgb, #F59E0B 40%, transparent),
                inset 0 2px 0 rgba(255, 255, 255, 0.3)
              `},children:e.jsx(d,{Icon:o.Watch,size:24,style:{color:"rgba(255, 255, 255, 0.8)"},variant:"pure"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-white font-semibold text-base",children:"Aucune montre connectée"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Connectez un appareil pour suivre vos performances"})]}),e.jsx(d,{Icon:o.ChevronRight,size:20,className:"text-white/40 flex-shrink-0"})]})})},Xs=()=>{const t=ie();return e.jsxs(K,{performanceConfig:t,direction:"up",distance:20,className:"space-y-6 profile-section",children:[e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:{background:"rgba(255, 255, 255, 0.12)",border:"2px solid rgba(6, 182, 212, 0.5)"},children:e.jsx(d,{Icon:o.Dumbbell,size:24,style:{color:"#06B6D4"}})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-semibold text-xl",children:"Profil Sportif"}),e.jsx("p",{className:"text-white/60 text-sm mt-1",children:"Configuration de vos préférences d'entraînement"})]})]}),e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-white/40 mb-4",children:e.jsx(d,{Icon:o.Settings,size:48,className:"mx-auto mb-4"})}),e.jsx("h4",{className:"text-white/70 text-lg font-medium mb-2",children:"Section en construction"}),e.jsx("p",{className:"text-white/50 text-sm max-w-md mx-auto",children:"Les préférences d'entraînement seront bientôt disponibles."})]})]}),e.jsx(us,{})]})};class hs{constructor(){U(this,"name","Météo-France");U(this,"priority",10);U(this,"FRENCH_TERRITORIES",["FR","GP","MQ","GF","RE","YT","PM","BL","MF","WF","PF","NC"])}supportsRegion(s){return this.FRENCH_TERRITORIES.includes(s)}async fetchWeather(s,r){try{const i=`https://api.open-meteo.com/v1/meteofrance?latitude=${s}&longitude=${r}&current=temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,weather_code,cloud_cover,wind_speed_10m,wind_direction_10m,pressure_msl&timezone=auto`;f.info("METEO_FRANCE","Fetching weather data via Météo-France model",{lat:s,lon:r});const a=await fetch(i);if(!a.ok){const m=new Error(`Météo-France API error: ${a.statusText}`);throw m.provider=this.name,m.statusCode=a.status,m.retryable=a.status>=500,m}const n=(await a.json()).current,c={0:"Ciel dégagé",1:"Principalement dégagé",2:"Partiellement nuageux",3:"Couvert",45:"Brouillard",48:"Brouillard givrant",51:"Bruine légère",53:"Bruine modérée",55:"Bruine dense",61:"Pluie faible",63:"Pluie modérée",65:"Pluie forte",66:"Pluie verglaçante légère",67:"Pluie verglaçante forte",71:"Chute de neige faible",73:"Chute de neige modérée",75:"Chute de neige forte",77:"Grains de neige",80:"Averses faibles",81:"Averses modérées",82:"Averses fortes",85:"Averses de neige faibles",86:"Averses de neige fortes",95:"Orage",96:"Orage avec grêle légère",99:"Orage avec grêle forte"};return{temperature_celsius:n.temperature_2m,feels_like_celsius:n.apparent_temperature,humidity_percent:n.relative_humidity_2m,wind_speed_ms:n.wind_speed_10m,wind_direction:n.wind_direction_10m,precipitation_mm:n.precipitation,cloud_cover_percent:n.cloud_cover,pressure_hpa:n.pressure_msl,weather_condition:c[n.weather_code]||"Conditions variables",last_updated:new Date().toISOString()}}catch(i){if(i&&typeof i=="object"&&"provider"in i)throw i;const a=new Error(`Météo-France weather fetch failed: ${i instanceof Error?i.message:"Unknown error"}`);throw a.provider=this.name,a.retryable=!0,a}}async fetchAirQuality(s,r){try{const i=`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${s}&longitude=${r}&current=european_aqi,pm10,pm2_5,carbon_monoxide,nitrogen_dioxide,sulphur_dioxide,ozone&timezone=auto`;f.info("METEO_FRANCE","Fetching air quality data (via fallback)",{lat:s,lon:r});const a=await fetch(i);if(!a.ok){const c=new Error(`Air quality API error: ${a.statusText}`);throw c.provider=this.name,c.statusCode=a.status,c.retryable=a.status>=500,c}const n=(await a.json()).current;return{aqi:n.european_aqi||50,pm2_5:n.pm2_5,pm10:n.pm10,co:n.carbon_monoxide,no2:n.nitrogen_dioxide,o3:n.ozone,so2:n.sulphur_dioxide}}catch(i){if(i&&typeof i=="object"&&"provider"in i)throw i;const a=new Error(`Air quality fetch failed: ${i instanceof Error?i.message:"Unknown error"}`);throw a.provider=this.name,a.retryable=!0,a}}}class xs{constructor(){U(this,"name","Open-Meteo");U(this,"priority",90)}supportsRegion(s){return!0}async fetchWeather(s,r){try{const i=`https://api.open-meteo.com/v1/forecast?latitude=${s}&longitude=${r}&current=temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,weather_code,cloud_cover,wind_speed_10m,wind_direction_10m,pressure_msl,visibility&timezone=auto`;f.info("OPEN_METEO","Fetching weather data",{lat:s,lon:r});const a=await fetch(i);if(!a.ok){const m=new Error(`Open-Meteo API error: ${a.statusText}`);throw m.provider=this.name,m.statusCode=a.status,m.retryable=a.status>=500,m}const n=(await a.json()).current,c={0:"Dégagé",1:"Principalement dégagé",2:"Partiellement nuageux",3:"Couvert",45:"Brouillard",48:"Brouillard givrant",51:"Bruine légère",53:"Bruine modérée",55:"Bruine dense",61:"Pluie légère",63:"Pluie modérée",65:"Pluie forte",71:"Chute de neige légère",73:"Chute de neige modérée",75:"Chute de neige forte",80:"Averses légères",81:"Averses modérées",82:"Averses fortes",95:"Orage",96:"Orage avec grêle légère",99:"Orage avec grêle forte"};return{temperature_celsius:n.temperature_2m,feels_like_celsius:n.apparent_temperature,humidity_percent:n.relative_humidity_2m,wind_speed_ms:n.wind_speed_10m,wind_direction:n.wind_direction_10m,precipitation_mm:n.precipitation,cloud_cover_percent:n.cloud_cover,pressure_hpa:n.pressure_msl,visibility_km:n.visibility?n.visibility/1e3:void 0,weather_condition:c[n.weather_code]||"Inconnu",last_updated:new Date().toISOString()}}catch(i){if(i&&typeof i=="object"&&"provider"in i)throw i;const a=new Error(`Open-Meteo weather fetch failed: ${i instanceof Error?i.message:"Unknown error"}`);throw a.provider=this.name,a.retryable=!0,a}}async fetchAirQuality(s,r){try{const i=`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${s}&longitude=${r}&current=european_aqi,pm10,pm2_5,carbon_monoxide,nitrogen_dioxide,sulphur_dioxide,ozone&timezone=auto`;f.info("OPEN_METEO","Fetching air quality data",{lat:s,lon:r});const a=await fetch(i);if(!a.ok){const c=new Error(`Open-Meteo Air Quality API error: ${a.statusText}`);throw c.provider=this.name,c.statusCode=a.status,c.retryable=a.status>=500,c}const n=(await a.json()).current;return{aqi:n.european_aqi||50,pm2_5:n.pm2_5,pm10:n.pm10,co:n.carbon_monoxide,no2:n.nitrogen_dioxide,o3:n.ozone,so2:n.sulphur_dioxide}}catch(i){if(i&&typeof i=="object"&&"provider"in i)throw i;const a=new Error(`Open-Meteo air quality fetch failed: ${i instanceof Error?i.message:"Unknown error"}`);throw a.provider=this.name,a.retryable=!0,a}}}class gs{constructor(){U(this,"providers");this.providers=[new hs,new xs],this.providers.sort((s,r)=>s.priority-r.priority)}getBestProvider(s){return this.providers.filter(r=>r.supportsRegion(s)).sort((r,i)=>r.priority-i.priority)}async fetchWeather(s,r,i){const a=this.getBestProvider(s),l=[];f.info("WEATHER_MANAGER","Fetching weather data",{countryCode:s,lat:r,lon:i,availableProviders:a.length});for(const n of a)try{f.info("WEATHER_MANAGER",`Trying provider: ${n.name}`,{priority:n.priority});const c=await n.fetchWeather(r,i);return f.info("WEATHER_MANAGER",`Successfully fetched weather from ${n.name}`,{countryCode:s}),{data:c,provider:n.name}}catch(c){const m=c instanceof Error?c.message:"Unknown error",u=c.retryable!==!1;if(f.warn("WEATHER_MANAGER",`Provider ${n.name} failed`,{error:m,retryable:u,countryCode:s}),l.push({provider:n.name,error:m}),!u)continue}throw f.error("WEATHER_MANAGER","All weather providers failed",{countryCode:s,errors:l}),new Error(`Impossible de récupérer les données météo. Tous les fournisseurs ont échoué: ${l.map(n=>n.provider).join(", ")}`)}async fetchAirQuality(s,r,i){const a=this.getBestProvider(s),l=[];f.info("WEATHER_MANAGER","Fetching air quality data",{countryCode:s,lat:r,lon:i,availableProviders:a.length});for(const n of a)try{f.info("WEATHER_MANAGER",`Trying provider: ${n.name} for air quality`,{priority:n.priority});const c=await n.fetchAirQuality(r,i);return f.info("WEATHER_MANAGER",`Successfully fetched air quality from ${n.name}`,{countryCode:s}),{data:c,provider:n.name}}catch(c){const m=c instanceof Error?c.message:"Unknown error",u=c.retryable!==!1;if(f.warn("WEATHER_MANAGER",`Provider ${n.name} failed for air quality`,{error:m,retryable:u,countryCode:s}),l.push({provider:n.name,error:m}),!u)continue}throw f.error("WEATHER_MANAGER","All air quality providers failed",{countryCode:s,errors:l}),new Error(`Impossible de récupérer les données de qualité de l'air. Tous les fournisseurs ont échoué: ${l.map(n=>n.provider).join(", ")}`)}getAvailableProviders(s){return this.getBestProvider(s).map(r=>r.name)}}const _e=new gs,ps=1,ze={FR:{lat:48.8566,lon:2.3522,city:"Paris"},GP:{lat:16.265,lon:-61.551,city:"Basse-Terre"},MQ:{lat:14.6415,lon:-61.0242,city:"Fort-de-France"},GF:{lat:4.9227,lon:-52.3269,city:"Cayenne"},RE:{lat:-20.8823,lon:55.4504,city:"Saint-Denis"},YT:{lat:-12.8275,lon:45.1662,city:"Mamoudzou"},PM:{lat:46.7738,lon:-56.1815,city:"Saint-Pierre"},BL:{lat:17.9,lon:-62.8333,city:"Gustavia"},MF:{lat:18.0731,lon:-63.0822,city:"Marigot"},WF:{lat:-13.2829,lon:-176.1745,city:"Mata-Utu"},PF:{lat:-17.5516,lon:-149.5585,city:"Papeete"},NC:{lat:-22.2758,lon:166.4572,city:"Nouméa"},BE:{lat:50.8503,lon:4.3517,city:"Bruxelles"},CH:{lat:46.948,lon:7.4474,city:"Berne"},LU:{lat:49.6116,lon:6.1319,city:"Luxembourg"},MC:{lat:43.7384,lon:7.4246,city:"Monaco"},DZ:{lat:36.7538,lon:3.0588,city:"Alger"},MA:{lat:34.0209,lon:-6.8416,city:"Rabat"},TN:{lat:36.8065,lon:10.1815,city:"Tunis"},SN:{lat:14.6928,lon:-17.4467,city:"Dakar"},CI:{lat:6.827,lon:-5.2893,city:"Yamoussoukro"},CM:{lat:3.848,lon:11.5021,city:"Yaoundé"},CD:{lat:-4.3217,lon:15.3125,city:"Kinshasa"},CG:{lat:-4.2634,lon:15.2429,city:"Brazzaville"},GA:{lat:.4162,lon:9.4673,city:"Libreville"},ML:{lat:12.6392,lon:-8.0029,city:"Bamako"},BJ:{lat:6.4969,lon:2.6289,city:"Porto-Novo"},NE:{lat:13.5127,lon:2.1128,city:"Niamey"},BF:{lat:12.3714,lon:-1.5197,city:"Ouagadougou"},TG:{lat:6.1256,lon:1.2116,city:"Lomé"},TD:{lat:12.1348,lon:15.0557,city:"N'Djamena"},CF:{lat:4.3947,lon:18.5582,city:"Bangui"},GN:{lat:9.6412,lon:-13.5784,city:"Conakry"},RW:{lat:-1.9536,lon:30.0606,city:"Kigali"},BI:{lat:-3.3614,lon:29.3599,city:"Bujumbura"},DJ:{lat:11.5721,lon:43.1456,city:"Djibouti"},MG:{lat:-18.8792,lon:47.5079,city:"Antananarivo"},MU:{lat:-20.1609,lon:57.5012,city:"Port-Louis"},SC:{lat:-4.6796,lon:55.492,city:"Victoria"},KM:{lat:-11.7172,lon:43.2473,city:"Moroni"},CA:{lat:45.4215,lon:-75.6972,city:"Ottawa"},HT:{lat:18.5944,lon:-72.3074,city:"Port-au-Prince"},LB:{lat:33.8886,lon:35.4955,city:"Beyrouth"},VN:{lat:21.0285,lon:105.8542,city:"Hanoï"},KH:{lat:11.5564,lon:104.9282,city:"Phnom Penh"},LA:{lat:17.9757,lon:102.6331,city:"Vientiane"},VU:{lat:-17.7333,lon:168.3273,city:"Port-Vila"},US:{lat:38.9072,lon:-77.0369,city:"Washington D.C."},GB:{lat:51.5074,lon:-.1278,city:"London"},DE:{lat:52.52,lon:13.405,city:"Berlin"},ES:{lat:40.4168,lon:-3.7038,city:"Madrid"},IT:{lat:41.9028,lon:12.4964,city:"Rome"},PT:{lat:38.7223,lon:-9.1393,city:"Lisbonne"},NL:{lat:52.3676,lon:4.9041,city:"Amsterdam"},AT:{lat:48.2082,lon:16.3738,city:"Vienne"},GR:{lat:37.9838,lon:23.7275,city:"Athènes"},AU:{lat:-35.2809,lon:149.13,city:"Canberra"},JP:{lat:35.6762,lon:139.6503,city:"Tokyo"},CN:{lat:39.9042,lon:116.4074,city:"Beijing"},BR:{lat:-15.8267,lon:-47.9218,city:"Brasília"},IN:{lat:28.6139,lon:77.209,city:"New Delhi"},MX:{lat:19.4326,lon:-99.1332,city:"Mexico City"},RU:{lat:55.7558,lon:37.6173,city:"Moscow"},ZA:{lat:-25.7479,lon:28.2293,city:"Pretoria"},AR:{lat:-34.6037,lon:-58.3816,city:"Buenos Aires"},CL:{lat:-33.4489,lon:-70.6693,city:"Santiago"},CO:{lat:4.711,lon:-74.0721,city:"Bogotá"},PE:{lat:-12.0464,lon:-77.0428,city:"Lima"},EG:{lat:30.0444,lon:31.2357,city:"Le Caire"},KE:{lat:-1.2921,lon:36.8219,city:"Nairobi"},NG:{lat:9.0765,lon:7.3986,city:"Abuja"},ET:{lat:9.032,lon:38.7469,city:"Addis-Abeba"},GH:{lat:5.6037,lon:-.187,city:"Accra"},TH:{lat:13.7563,lon:100.5018,city:"Bangkok"},MY:{lat:3.139,lon:101.6869,city:"Kuala Lumpur"},SG:{lat:1.3521,lon:103.8198,city:"Singapour"},ID:{lat:-6.2088,lon:106.8456,city:"Jakarta"},PH:{lat:14.5995,lon:120.9842,city:"Manille"},KR:{lat:37.5665,lon:126.978,city:"Séoul"},TR:{lat:39.9334,lon:32.8597,city:"Ankara"},SA:{lat:24.7136,lon:46.6753,city:"Riyad"},AE:{lat:24.4539,lon:54.3773,city:"Abu Dhabi"},IL:{lat:31.7683,lon:35.2137,city:"Jérusalem"},PL:{lat:52.2297,lon:21.0122,city:"Varsovie"},CZ:{lat:50.0755,lon:14.4378,city:"Prague"},HU:{lat:47.4979,lon:19.0402,city:"Budapest"},RO:{lat:44.4268,lon:26.1025,city:"Bucarest"},BG:{lat:42.6977,lon:23.3219,city:"Sofia"},SE:{lat:59.3293,lon:18.0686,city:"Stockholm"},NO:{lat:59.9139,lon:10.7522,city:"Oslo"},DK:{lat:55.6761,lon:12.5683,city:"Copenhague"},FI:{lat:60.1699,lon:24.9384,city:"Helsinki"},IE:{lat:53.3498,lon:-6.2603,city:"Dublin"},NZ:{lat:-41.2865,lon:174.7762,city:"Wellington"}};function fs(t){return t<=50?"good":t<=100?"moderate":t<=150?"unhealthy_sensitive":t<=200?"unhealthy":t<=300?"very_unhealthy":"hazardous"}function bs(t){switch(t){case"good":return["Qualité de l'air excellente. Activités en extérieur recommandées."];case"moderate":return["Qualité de l'air acceptable.","Personnes sensibles: limitez les efforts intenses prolongés en extérieur."];case"unhealthy_sensitive":return["Qualité de l'air nocive pour les groupes sensibles.","Réduisez les efforts physiques prolongés en extérieur.","Personnes à risque: restez à l'intérieur autant que possible."];case"unhealthy":return["Qualité de l'air malsaine.","Évitez les efforts physiques en extérieur.","Portez un masque si vous devez sortir.","Gardez les fenêtres fermées."];case"very_unhealthy":return["Qualité de l'air très malsaine.","Restez à l'intérieur.","Utilisez un purificateur d'air.","Évitez tout exercice physique."];case"hazardous":return["Alerte pollution: risque sanitaire majeur.","Ne sortez pas sauf urgence absolue.","Portez un masque FFP2 si vous devez sortir.","Consultez un médecin en cas de symptômes."]}}async function vs(t,s,r){try{const{data:i,provider:a}=await _e.fetchWeather(t,s,r);return f.info("GEOGRAPHIC_SERVICE","Weather data fetched successfully",{provider:a,countryCode:t,lat:s,lon:r}),{...i,provider:a}}catch(i){throw f.error("GEOGRAPHIC_SERVICE","Failed to fetch weather data from all providers",{error:i instanceof Error?i.message:"Unknown error",countryCode:t,lat:s,lon:r}),i}}async function js(t,s,r){try{const{data:i,provider:a}=await _e.fetchAirQuality(t,s,r),l=i.aqi,n=fs(l),c={"PM2.5":i.pm2_5,PM10:i.pm10,CO:i.co,NO2:i.no2,O3:i.o3,SO2:i.so2},m=Object.entries(c).filter(([,u])=>u!==void 0&&u>0).sort(([,u],[,b])=>(b||0)-(u||0))[0]?.[0]||"PM2.5";return f.info("GEOGRAPHIC_SERVICE","Air quality data fetched successfully",{provider:a,countryCode:t,aqi:l,level:n}),{aqi:l,level:n,pm2_5:i.pm2_5,pm10:i.pm10,co:i.co,no2:i.no2,o3:i.o3,so2:i.so2,dominant_pollutant:m,health_recommendations:bs(n),last_updated:new Date().toISOString()}}catch(i){throw f.error("GEOGRAPHIC_SERVICE","Failed to fetch air quality data from all providers",{error:i instanceof Error?i.message:"Unknown error",countryCode:t,lat:s,lon:r}),i}}function Te(t,s,r){const i=s?s*.033:2;let a=0;t.temperature_celsius>25&&(a=(t.temperature_celsius-25)/5*.5);let l=0;t.humidity_percent<30?l=.3:t.humidity_percent>80&&(l=.2);const n=a+l,m=r?{sedentary:0,light:.3,moderate:.6,active:1,athlete:1.5}[r]:0,u=Math.round((i+n+m)*10)/10,b=[`Objectif d'hydratation: ${u}L par jour`];t.temperature_celsius>30&&b.push("⚠️ Température élevée: augmentez votre consommation d'eau"),t.humidity_percent<30&&b.push("🌵 Air sec: hydratez-vous régulièrement"),r&&["active","athlete"].includes(r)&&b.push("🏃 Activité intense: buvez avant, pendant et après l'exercice");const N=[];return u>4&&N.push("Conditions extrêmes détectées. Surveillez votre hydratation attentivement."),{base_amount_liters:Math.round(i*10)/10,weather_adjustment_liters:Math.round(n*10)/10,activity_adjustment_liters:Math.round(m*10)/10,total_recommended_liters:u,factors:{temperature:t.temperature_celsius,humidity:t.humidity_percent,physical_activity_level:r||"non renseigné",user_weight_kg:s},recommendations:b,alerts:N}}function ys(t){const s=t.level==="good"||t.level==="moderate"?"low":t.level==="unhealthy_sensitive"?"moderate":t.level==="unhealthy"?"high":"severe",r=[];t.pm2_5&&t.pm2_5>25&&r.push("Particules fines (PM2.5)"),t.pm10&&t.pm10>50&&r.push("Particules (PM10)"),t.no2&&t.no2>40&&r.push("Dioxyde d'azote (NO2)"),t.o3&&t.o3>100&&r.push("Ozone (O3)");const i=[];return(s==="moderate"||s==="high")&&(i.push("Limitez les activités extérieures intenses"),i.push("Fermez les fenêtres pendant les pics de pollution")),(s==="high"||s==="severe")&&(i.push("Portez un masque lors des sorties"),i.push("Utilisez un purificateur d'air intérieur")),{air_quality:t,pollution_sources:r,exposure_level:s,protective_measures:i}}function Pe(){return Object.keys(ze)}async function Ns(t,s,r,i){try{const a=ze[s];if(!a)throw f.warn("GEOGRAPHIC_SERVICE","Country not supported for geographic data",{countryCode:s,userId:t,supportedCountries:Pe().length}),new Error(`Le pays "${s}" n'est pas encore supporté pour les données géographiques. ${Pe().length} pays disponibles.`);const l=`${s}_${a.city.replace(/\s/g,"")}`,{data:n,error:c}=await X.from("geographic_data_cache").select("*").eq("user_id",t).eq("location_key",l).gt("expires_at",new Date().toISOString()).maybeSingle();if(n&&!c){f.info("GEOGRAPHIC_SERVICE","Using cached geographic data",{userId:t,locationKey:l});const h=n.weather_data,x=Te(h,r,i);return{user_id:t,country_code:s,city:a.city,latitude:a.lat,longitude:a.lon,weather:h,air_quality:n.air_quality_data,environmental_exposure:n.environmental_data,hydration_recommendation:x,last_updated:n.created_at,next_update_due:n.expires_at}}f.info("GEOGRAPHIC_SERVICE","Fetching fresh geographic data",{userId:t,countryCode:s,city:a.city,availableProviders:_e.getAvailableProviders(s)});const[m,u]=await Promise.all([vs(s,a.lat,a.lon),js(s,a.lat,a.lon)]),b=ys(u),N=Te(m,r,i),y=new Date;y.setHours(y.getHours()+ps);const{error:S}=await X.from("geographic_data_cache").upsert({user_id:t,country_code:s,city:a.city,location_key:l,weather_data:m,air_quality_data:u,environmental_data:b,hydration_data:N,expires_at:y.toISOString()},{onConflict:"user_id,location_key"});return S&&f.error("GEOGRAPHIC_SERVICE","Failed to cache geographic data",{error:S.message,userId:t}),await ws(t,s,a,m,u,b,N),{user_id:t,country_code:s,city:a.city,latitude:a.lat,longitude:a.lon,weather:m,air_quality:u,environmental_exposure:b,hydration_recommendation:N,last_updated:new Date().toISOString(),next_update_due:y.toISOString()}}catch(a){const l=a instanceof Error?a.message:"Unknown error";throw l.includes("pas encore supporté")?f.warn("GEOGRAPHIC_SERVICE","Unsupported country requested",{error:l,userId:t,countryCode:s}):f.error("GEOGRAPHIC_SERVICE","Failed to get geographic data",{error:l,userId:t,countryCode:s}),a}}async function ws(t,s,r,i,a,l,n){try{const c=new Date;c.setHours(0,0,0,0);const m=new Date(c);m.setDate(m.getDate()+1);const{data:u}=await X.from("geographic_data_history").select("id").eq("user_id",t).gte("recorded_at",c.toISOString()).lt("recorded_at",m.toISOString()).maybeSingle();if(u){f.debug("GEOGRAPHIC_SERVICE","Geographic data already saved for today",{userId:t});return}const{error:b}=await X.from("geographic_data_history").insert({user_id:t,country_code:s,city:r.city,latitude:r.lat,longitude:r.lon,weather:i,air_quality:a,hydration_recommendation:n,environmental_exposure:l,recorded_at:new Date().toISOString()});b?f.error("GEOGRAPHIC_SERVICE","Failed to save geographic data history",{error:b.message,userId:t}):f.info("GEOGRAPHIC_SERVICE","Saved geographic data history",{userId:t,date:c.toISOString()})}catch(c){f.error("GEOGRAPHIC_SERVICE","Failed to save geographic data history",{error:c instanceof Error?c.message:"Unknown error",userId:t})}}const De={France:"FR",Guadeloupe:"GP",Martinique:"MQ",Guyane:"GF",Réunion:"RE",Mayotte:"YT","Saint-Pierre-et-Miquelon":"PM","Saint-Barthélemy":"BL","Saint-Martin":"MF","Wallis-et-Futuna":"WF","Polynésie française":"PF","Nouvelle-Calédonie":"NC",Belgique:"BE",Suisse:"CH",Luxembourg:"LU",Monaco:"MC",Algérie:"DZ",Maroc:"MA",Tunisie:"TN",Sénégal:"SN","Côte d'Ivoire":"CI",Mali:"ML",Bénin:"BJ",Niger:"NE","Burkina Faso":"BF",Togo:"TG",Guinée:"GN",Mauritanie:"MR",Cameroun:"CM","Congo (RDC)":"CD",Congo:"CG",Gabon:"GA",Tchad:"TD",Centrafrique:"CF","Guinée équatoriale":"GQ",Rwanda:"RW",Burundi:"BI",Djibouti:"DJ",Madagascar:"MG",Maurice:"MU",Seychelles:"SC",Comores:"KM",Canada:"CA",Haïti:"HT",Liban:"LB","Viêt Nam":"VN",Cambodge:"KH",Laos:"LA",Vanuatu:"VU","États-Unis":"US","Royaume-Uni":"GB",Australie:"AU","Nouvelle-Zélande":"NZ","Afrique du Sud":"ZA",Inde:"IN",Irlande:"IE",Jamaïque:"JM",Kenya:"KE",Nigéria:"NG",Singapour:"SG",Allemagne:"DE",Espagne:"ES",Italie:"IT",Portugal:"PT","Pays-Bas":"NL",Autriche:"AT",Grèce:"GR",Japon:"JP",Chine:"CN",Brésil:"BR",Mexique:"MX",Russie:"RU",Argentine:"AR",Chili:"CL",Colombie:"CO",Pérou:"PE",Égypte:"EG",Éthiopie:"ET",Ghana:"GH",Thaïlande:"TH",Malaisie:"MY",Indonésie:"ID",Philippines:"PH","Corée du Sud":"KR",Turquie:"TR","Arabie Saoudite":"SA","Émirats Arabes Unis":"AE",Israël:"IL",Pologne:"PL","République Tchèque":"CZ",Hongrie:"HU",Roumanie:"RO",Bulgarie:"BG",Suède:"SE",Norvège:"NO",Danemark:"DK",Finlande:"FI"};function _s(t){if(!t)return null;const s=De[t];if(s)return s;const r=t.trim(),i=Object.entries(De).find(([a])=>a.toLowerCase()===r.toLowerCase());return i?i[1]:null}function Ss(){const{profile:t}=q(),[s,r]=T.useState(null),[i,a]=T.useState(!0),[l,n]=T.useState(null),[c,m]=T.useState(null),u=T.useCallback(async()=>{if(!t?.userId||!t?.country){a(!1),n(new Error("User profile or country not available"));return}try{a(!0),n(null);const N=_s(t.country);if(!N)throw new Error(`Le pays "${t.country}" n'est pas encore supporté pour les données météo.`);f.info("USE_GEOGRAPHIC_DATA","Fetching geographic data",{userId:t.userId,countryName:t.country,countryCode:N});const y=t?.weight_kg||t?.health?.basic?.weight_kg,S=t?.health?.lifestyle?.physical_activity_level||t?.training?.physical_activity_level,h=await Ns(t.userId,N,y,S);r(h),m(h.last_updated),f.info("USE_GEOGRAPHIC_DATA","Geographic data loaded successfully",{userId:t.userId,countryName:t.country,countryCode:N})}catch(N){const y=N instanceof Error?N:new Error("Failed to fetch geographic data");n(y),f.error("USE_GEOGRAPHIC_DATA","Failed to fetch geographic data",{error:y.message,userId:t?.userId,countryName:t?.country})}finally{a(!1)}},[t?.userId,t?.country]),b=T.useCallback(async()=>{await u()},[u]);return T.useEffect(()=>{u()},[u]),{data:s,loading:i,error:l,refresh:b,lastUpdated:c}}const Cs=({countryData:t,loading:s=!1})=>s?e.jsx(D,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(d,{Icon:o.Loader2,size:20,className:"animate-spin text-cyan-400"}),e.jsx("span",{className:"text-white/90",children:"Chargement des données sanitaires du pays..."})]})}):t?e.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"space-y-4",children:e.jsxs(D,{className:"p-6",style:{background:`
          radial-gradient(circle at 30% 20%, rgba(6, 182, 212, 0.08) 0%, transparent 60%),
          var(--glass-opacity)
        `,borderColor:"rgba(6, 182, 212, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                  linear-gradient(135deg, color-mix(in srgb, #06B6D4 35%, transparent), color-mix(in srgb, #06B6D4 25%, transparent))
                `,border:"2px solid color-mix(in srgb, #06B6D4 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #06B6D4 30%, transparent)"},children:e.jsx(d,{Icon:o.Globe,size:20,style:{color:"#06B6D4"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-semibold text-lg",children:t.country_name}),e.jsx("p",{className:"text-white/60 text-sm",children:"Contexte sanitaire local"})]})]}),e.jsxs("div",{className:"text-xs text-white/50",children:["Mis à jour: ",new Date(t.last_updated).toLocaleDateString("fr-FR")]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.endemic_diseases&&t.endemic_diseases.length>0&&e.jsxs("div",{className:"p-4 rounded-xl bg-orange-500/10 border border-orange-400/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(d,{Icon:o.Biohazard,size:16,className:"text-orange-400"}),e.jsx("h4",{className:"text-white/90 font-medium text-sm",children:"Maladies Endémiques"})]}),e.jsx("div",{className:"space-y-1",children:t.endemic_diseases.slice(0,5).map((r,i)=>e.jsxs("div",{className:"flex items-center gap-2 text-white/70 text-sm",children:[e.jsx("div",{className:"w-1 h-1 rounded-full bg-orange-400"}),r]},i))})]}),t.vaccination_requirements&&e.jsxs("div",{className:"p-4 rounded-xl bg-green-500/10 border border-green-400/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(d,{Icon:o.Syringe,size:16,className:"text-green-400"}),e.jsx("h4",{className:"text-white/90 font-medium text-sm",children:"Vaccinations Recommandées"})]}),e.jsx("div",{className:"space-y-1",children:t.vaccination_requirements.recommended?.slice(0,5).map((r,i)=>e.jsxs("div",{className:"flex items-center gap-2 text-white/70 text-sm",children:[e.jsx("div",{className:"w-1 h-1 rounded-full bg-green-400"}),r]},i))})]}),t.common_deficiencies&&t.common_deficiencies.length>0&&e.jsxs("div",{className:"p-4 rounded-xl bg-yellow-500/10 border border-yellow-400/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(d,{Icon:o.Pill,size:16,className:"text-yellow-400"}),e.jsx("h4",{className:"text-white/90 font-medium text-sm",children:"Carences Communes"})]}),e.jsx("div",{className:"space-y-1",children:t.common_deficiencies.map((r,i)=>e.jsxs("div",{className:"flex items-center gap-2 text-white/70 text-sm",children:[e.jsx("div",{className:"w-1 h-1 rounded-full bg-yellow-400"}),r]},i))})]}),t.climate_data&&e.jsxs("div",{className:"p-4 rounded-xl bg-blue-500/10 border border-blue-400/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(d,{Icon:o.Cloud,size:16,className:"text-blue-400"}),e.jsx("h4",{className:"text-white/90 font-medium text-sm",children:"Climat"})]}),e.jsxs("div",{className:"space-y-2 text-white/70 text-sm",children:[t.climate_data.climate_zones&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Zone:"}),e.jsx("span",{className:"font-medium text-white/90",children:t.climate_data.climate_zones.join(", ")})]}),t.climate_data.avg_temperature_celsius&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Temp. moyenne:"}),e.jsxs("span",{className:"font-medium text-white/90",children:[t.climate_data.avg_temperature_celsius,"°C"]})]}),t.climate_data.avg_humidity_percent&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Humidité:"}),e.jsxs("span",{className:"font-medium text-white/90",children:[t.climate_data.avg_humidity_percent,"%"]})]})]})]})]}),t.health_risks&&e.jsxs("div",{className:"mt-4 p-4 rounded-xl bg-red-500/10 border border-red-400/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(d,{Icon:o.Bug,size:16,className:"text-red-400"}),e.jsx("h4",{className:"text-white/90 font-medium text-sm",children:"Risques Sanitaires Spécifiques"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[t.health_risks.vector_borne_diseases&&t.health_risks.vector_borne_diseases.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-xs mb-1",children:"Maladies vectorielles:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.health_risks.vector_borne_diseases.map((r,i)=>e.jsx("span",{className:"text-xs px-2 py-1 rounded bg-red-500/20 text-red-300",children:r},i))})]}),t.health_risks.waterborne_diseases&&t.health_risks.waterborne_diseases.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-xs mb-1",children:"Maladies hydriques:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.health_risks.waterborne_diseases.map((r,i)=>e.jsx("span",{className:"text-xs px-2 py-1 rounded bg-blue-500/20 text-blue-300",children:r},i))})]})]})]})]})}):e.jsx(D,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(d,{Icon:o.AlertCircle,size:20,className:"text-orange-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/90 font-medium",children:"Données pays non disponibles"}),e.jsx("p",{className:"text-white/60 text-sm mt-1",children:"Sélectionnez votre pays dans l'onglet Identité pour voir les risques sanitaires locaux."})]})]})}),Is="https://restcountries.com/v3.1",As=30,se=class se{constructor(){}static getInstance(){return se.instance||(se.instance=new se),se.instance}async enrichCountryData(s){try{f.info("COUNTRY_HEALTH_ENRICHMENT","Starting enrichment",{countryName:s});const r=await this.getCachedCountryData(s);if(r&&this.isCacheValid(r.last_updated))return f.info("COUNTRY_HEALTH_ENRICHMENT","Using cached data",{countryName:s}),r;const i=await this.getCountryCode(s);if(!i)return f.warn("COUNTRY_HEALTH_ENRICHMENT","Country code not found",{countryName:s}),this.getStaticCountryData(s);const a=await this.fetchRestCountriesData(s),l={country_code:i,country_name:s,endemic_diseases:this.getEndemicDiseasesByRegion(a?.region||""),vaccination_requirements:this.getVaccinationRequirements(i),health_risks:this.getHealthRisksByRegion(a?.region||"",a?.subregion||""),common_deficiencies:this.getCommonDeficiencies(a?.region||""),climate_data:this.inferClimateData(a?.latlng),last_updated:new Date().toISOString(),data_source:"rest_countries_api"};return await this.saveCountryData(l),f.info("COUNTRY_HEALTH_ENRICHMENT","Enrichment completed",{countryName:s,countryCode:i}),l}catch(r){return f.error("COUNTRY_HEALTH_ENRICHMENT","Enrichment failed",{countryName:s,error:r instanceof Error?r.message:"Unknown error"}),this.getStaticCountryData(s)}}async getCachedCountryData(s){try{const{data:r,error:i}=await X.from("country_health_data").select("*").eq("country_name",s).maybeSingle();return i?i.code==="PGRST205"||i.message?.includes("does not exist")?(f.warn("COUNTRY_HEALTH_CACHE","Table does not exist yet",{countryName:s}),null):(f.error("COUNTRY_HEALTH_CACHE","Cache read error",{error:i.message}),null):r}catch(r){return f.error("COUNTRY_HEALTH_CACHE","Cache read exception",{error:r instanceof Error?r.message:"Unknown"}),null}}isCacheValid(s){const r=new Date(s);return(new Date().getTime()-r.getTime())/(1e3*60*60*24)<As}async getCountryCode(s){return{France:"FR",Belgique:"BE",Suisse:"CH",Canada:"CA",Maroc:"MA",Tunisie:"TN",Algérie:"DZ",Sénégal:"SN","Côte d'Ivoire":"CI",Mali:"ML","Burkina Faso":"BF",Niger:"NE",Tchad:"TD",Cameroun:"CM",Congo:"CG","Congo (RDC)":"CD",Gabon:"GA",Madagascar:"MG",Maurice:"MU",Réunion:"RE",Luxembourg:"LU",Monaco:"MC",Haïti:"HT","États-Unis":"US","Royaume-Uni":"GB",Australie:"AU","Nouvelle-Zélande":"NZ","Afrique du Sud":"ZA",Inde:"IN",Singapour:"SG",Martinique:"MQ",Guadeloupe:"GP",Guyane:"GF","Guyane française":"GF",Mayotte:"YT","Saint-Martin":"MF","Saint-Barthélemy":"BL","Saint-Pierre-et-Miquelon":"PM","Wallis-et-Futuna":"WF","Polynésie française":"PF","Nouvelle-Calédonie":"NC",Bénin:"BJ",Togo:"TG",Guinée:"GN",Centrafrique:"CF","République centrafricaine":"CF",Rwanda:"RW",Burundi:"BI",Djibouti:"DJ",Comores:"KM",Seychelles:"SC",Vanuatu:"VU",Liban:"LB",Mauritanie:"MR","Guinée équatoriale":"GQ"}[s]||null}async fetchRestCountriesData(s){try{const r=await fetch(`${Is}/name/${encodeURIComponent(s)}?fullText=false`);return r.ok?(await r.json())[0]||null:(f.warn("REST_COUNTRIES_API","API request failed",{status:r.status,countryName:s}),null)}catch(r){return f.error("REST_COUNTRIES_API","Fetch failed",{error:r instanceof Error?r.message:"Unknown",countryName:s}),null}}getEndemicDiseasesByRegion(s){return{Africa:["Malaria","Yellow Fever","Dengue","Ebola (specific regions)","Tuberculosis","HIV/AIDS","Schistosomiasis","Trypanosomiasis"],Asia:["Dengue","Japanese Encephalitis","Malaria (specific regions)","Tuberculosis","Hepatitis B","Typhoid"],Europe:["Lyme Disease","Tick-borne Encephalitis","Influenza (seasonal)"],Americas:["Dengue","Zika","Chikungunya","Chagas Disease (Latin America)","Lyme Disease (North America)"],Oceania:["Dengue","Ross River Virus","Influenza (seasonal)"]}[s]||[]}getVaccinationRequirements(s){const r=["SN","CI","ML","BF","NE","TD","CM","CG","CD","GA","MG"];return{required:[],recommended:["Hepatitis A","Hepatitis B","Tetanus-Diphtheria","Measles-Mumps-Rubella (MMR)",...["SN","CI","ML","BF","NE","TD","CM","CG","CD","GA"].includes(s)?["Yellow Fever"]:[],...r.includes(s)?["Typhoid","Meningococcal"]:[]],seasonal:[]}}getHealthRisksByRegion(s,r){const i=["Africa"],a=["Western Africa","Middle Africa","Eastern Africa","South-Eastern Asia"];return{vector_borne_diseases:i.includes(s)||a.includes(r)?["Malaria","Dengue","Yellow Fever","Chikungunya"]:["Lyme Disease","Tick-borne Encephalitis"],waterborne_diseases:i.includes(s)?["Cholera","Typhoid","Hepatitis A","Schistosomiasis"]:["Giardiasis","Cryptosporidiosis"],foodborne_risks:["Traveler's Diarrhea","Food Poisoning","Hepatitis A"],environmental_hazards:[]}}getCommonDeficiencies(s){return{Africa:["Iron","Vitamin A","Iodine","Zinc","Vitamin D"],Asia:["Iron","Vitamin A","Iodine","Vitamin D"],Europe:["Vitamin D","Iodine (specific regions)","Iron (women)"],Americas:["Vitamin D","Iron","Calcium"],Oceania:["Vitamin D","Iron","Iodine"]}[s]||["Vitamin D","Iron"]}getStaticCountryData(s){return f.info("COUNTRY_HEALTH_ENRICHMENT","Using static fallback data",{countryName:s}),{country_code:"UNKNOWN",country_name:s,endemic_diseases:[],vaccination_requirements:{required:[],recommended:["Hepatitis A","Hepatitis B","Tetanus-Diphtheria"],seasonal:[]},health_risks:{vector_borne_diseases:[],waterborne_diseases:[],foodborne_risks:["Traveler's Diarrhea","Food Poisoning"],environmental_hazards:[]},common_deficiencies:["Vitamin D","Iron"],climate_data:{},last_updated:new Date().toISOString(),data_source:"static_fallback"}}inferClimateData(s){if(!s)return{};const[r]=s;return Math.abs(r)<23.5?{climate_zones:["Tropical"],avg_temperature_celsius:27,avg_humidity_percent:75}:Math.abs(r)<35?{climate_zones:["Subtropical"],avg_temperature_celsius:20,avg_humidity_percent:65}:Math.abs(r)<60?{climate_zones:["Temperate"],avg_temperature_celsius:12,avg_humidity_percent:70}:{climate_zones:["Cold"],avg_temperature_celsius:2,avg_humidity_percent:75}}async saveCountryData(s){try{const{error:r}=await X.from("country_health_data").upsert({country_code:s.country_code,country_name:s.country_name,climate_data:s.climate_data||{},endemic_diseases:s.endemic_diseases||[],vaccination_requirements:s.vaccination_requirements||{},health_risks:s.health_risks||{},common_deficiencies:s.common_deficiencies||[],last_updated:s.last_updated,data_source:s.data_source},{onConflict:"country_code"});if(r){if(r.code==="PGRST205"||r.message?.includes("does not exist")){f.warn("COUNTRY_HEALTH_SAVE","Table does not exist, skipping global save",{country:s.country_name});return}if(r.code==="42501"||r.message?.includes("policy")){f.info("COUNTRY_HEALTH_SAVE","RLS prevented global save, data cached in user profile",{country:s.country_name,code:r.code});return}f.warn("COUNTRY_HEALTH_SAVE","Global save failed, continuing with user cache",{error:r.message,country:s.country_name})}else f.info("COUNTRY_HEALTH_SAVE","Successfully saved to global cache",{country:s.country_name})}catch(r){f.warn("COUNTRY_HEALTH_SAVE","Save exception, continuing with user cache",{error:r instanceof Error?r.message:"Unknown"})}}async updateUserCountryCache(s,r){try{const i=await this.enrichCountryData(r);if(!i)return;const{error:a}=await X.from("user_profile").update({country_health_cache:i,health_enriched_at:new Date().toISOString()}).eq("user_id",s);a&&f.error("USER_COUNTRY_CACHE","Update failed",{error:a.message,userId:s})}catch(i){f.error("USER_COUNTRY_CACHE","Update exception",{error:i instanceof Error?i.message:"Unknown",userId:s})}}async getUserCountryHealthData(s){try{const{data:r,error:i}=await X.from("user_profile").select("country, country_health_cache, health_enriched_at").eq("user_id",s).maybeSingle();return i||!r?null:r.country_health_cache&&r.health_enriched_at&&this.isCacheValid(r.health_enriched_at)?r.country_health_cache:r.country?await this.enrichCountryData(r.country):null}catch(r){return f.error("USER_COUNTRY_DATA","Fetch failed",{error:r instanceof Error?r.message:"Unknown",userId:s}),null}}};U(se,"instance");let ye=se;const ve=ye.getInstance();function ks(){const{profile:t}=q(),[s,r]=T.useState(null),[i,a]=T.useState(!1),[l,n]=T.useState(null),c=async()=>{if(!t?.userId){f.warn("COUNTRY_HEALTH_HOOK","No user ID available");return}if(!t.country){f.info("COUNTRY_HEALTH_HOOK","No country selected",{userId:t.userId}),r(null);return}try{a(!0),n(null),f.info("COUNTRY_HEALTH_HOOK","Fetching country health data",{userId:t.userId,country:t.country});const u=await ve.getUserCountryHealthData(t.userId);u?(r(u),f.info("COUNTRY_HEALTH_HOOK","Country data loaded",{country:u.country_name,lastUpdated:u.last_updated,source:u.data_source})):(r(null),f.info("COUNTRY_HEALTH_HOOK","No country data available",{country:t.country}))}catch(u){const b=u instanceof Error?u:new Error("Unknown error");n(b),f.error("COUNTRY_HEALTH_HOOK","Failed to fetch country data",{error:b.message,userId:t.userId,country:t.country}),r(null)}finally{a(!1)}},m=async()=>{if(!(!t?.userId||!t.country))try{a(!0),n(null),f.info("COUNTRY_HEALTH_HOOK","Refreshing country health data",{userId:t.userId,country:t.country}),await ve.updateUserCountryCache(t.userId,t.country);const u=await ve.getUserCountryHealthData(t.userId);r(u)}catch(u){const b=u instanceof Error?u:new Error("Unknown error");n(b),f.error("COUNTRY_HEALTH_HOOK","Failed to refresh country data",{error:b.message})}finally{a(!1)}};return T.useEffect(()=>{c()},[t?.userId,t?.country]),{countryData:s,loading:i,error:l,refresh:m}}const Es={good:{bg:"rgba(16, 185, 129, 0.08)",border:"rgba(16, 185, 129, 0.3)",text:"#10B981",label:"Bonne"},moderate:{bg:"rgba(245, 158, 11, 0.08)",border:"rgba(245, 158, 11, 0.3)",text:"#F59E0B",label:"Moyenne"},unhealthy_sensitive:{bg:"rgba(251, 146, 60, 0.08)",border:"rgba(251, 146, 60, 0.3)",text:"#FB923C",label:"Sensible"},unhealthy:{bg:"rgba(239, 68, 68, 0.08)",border:"rgba(239, 68, 68, 0.3)",text:"#EF4444",label:"Malsaine"},very_unhealthy:{bg:"rgba(190, 18, 60, 0.08)",border:"rgba(190, 18, 60, 0.3)",text:"#BE123C",label:"Très Malsaine"},hazardous:{bg:"rgba(127, 29, 29, 0.08)",border:"rgba(127, 29, 29, 0.3)",text:"#7F1D1D",label:"Dangereuse"}},Ts=({airQuality:t})=>{const s=Es[t.level],{isPerformanceMode:r}=xe(),i=r?"div":R.div;return e.jsx(i,{...!r&&{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5}},children:e.jsxs(D,{className:"p-6",style:r?{background:`linear-gradient(145deg, ${s.bg}, transparent)`,borderColor:s.border}:{background:`radial-gradient(circle at 30% 20%, ${s.bg} 0%, transparent 60%), var(--glass-opacity)`,borderColor:s.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:r?{background:`linear-gradient(135deg, ${s.text}66, ${s.text}33)`,border:`2px solid ${s.text}80`,boxShadow:"0 2px 12px rgba(0, 0, 0, 0.4)"}:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                  linear-gradient(135deg, ${s.text}66, ${s.text}33)
                `,border:`2px solid ${s.text}80`,boxShadow:`0 0 30px ${s.text}66`},children:e.jsx(d,{Icon:o.Wind,size:24,style:{color:s.text},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-semibold text-xl",children:"Qualité de l'Air"}),e.jsx("p",{className:"text-white/70 text-sm",children:"Indice AQI en temps réel"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-3xl font-bold",style:{color:s.text},children:t.aqi}),e.jsx("div",{className:"text-sm font-medium",style:{color:s.text},children:s.label})]})]}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"w-full bg-white/10 rounded-full h-3 overflow-hidden",children:e.jsx(i,{className:"h-3 rounded-full",style:{background:`linear-gradient(90deg, ${s.text}, ${s.text}cc)`,boxShadow:r?"none":`0 0 12px ${s.text}99`,width:r?`${Math.min(t.aqi/300*100,100)}%`:void 0},...!r&&{initial:{width:0},animate:{width:`${Math.min(t.aqi/300*100,100)}%`},transition:{duration:1,ease:"easeOut"}}})})}),t.dominant_pollutant&&e.jsxs("div",{className:"mb-4 p-3 rounded-lg bg-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(d,{Icon:o.AlertCircle,size:14,style:{color:s.text}}),e.jsx("span",{className:"text-white/90 text-sm font-medium",children:"Polluant dominant"})]}),e.jsx("p",{className:"text-white/70 text-sm ml-6",children:t.dominant_pollutant})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-4",children:[t.pm2_5!==void 0&&e.jsxs("div",{className:"p-3 rounded-lg bg-white/5",children:[e.jsx("div",{className:"text-white/60 text-xs mb-1",children:"PM2.5"}),e.jsxs("div",{className:"text-white font-semibold",children:[t.pm2_5.toFixed(1)," µg/m³"]})]}),t.pm10!==void 0&&e.jsxs("div",{className:"p-3 rounded-lg bg-white/5",children:[e.jsx("div",{className:"text-white/60 text-xs mb-1",children:"PM10"}),e.jsxs("div",{className:"text-white font-semibold",children:[t.pm10.toFixed(1)," µg/m³"]})]}),t.no2!==void 0&&e.jsxs("div",{className:"p-3 rounded-lg bg-white/5",children:[e.jsx("div",{className:"text-white/60 text-xs mb-1",children:"NO₂"}),e.jsxs("div",{className:"text-white font-semibold",children:[t.no2.toFixed(1)," µg/m³"]})]}),t.o3!==void 0&&e.jsxs("div",{className:"p-3 rounded-lg bg-white/5",children:[e.jsx("div",{className:"text-white/60 text-xs mb-1",children:"O₃"}),e.jsxs("div",{className:"text-white font-semibold",children:[t.o3.toFixed(1)," µg/m³"]})]}),t.co!==void 0&&e.jsxs("div",{className:"p-3 rounded-lg bg-white/5",children:[e.jsx("div",{className:"text-white/60 text-xs mb-1",children:"CO"}),e.jsxs("div",{className:"text-white font-semibold",children:[t.co.toFixed(0)," µg/m³"]})]}),t.so2!==void 0&&e.jsxs("div",{className:"p-3 rounded-lg bg-white/5",children:[e.jsx("div",{className:"text-white/60 text-xs mb-1",children:"SO₂"}),e.jsxs("div",{className:"text-white font-semibold",children:[t.so2.toFixed(1)," µg/m³"]})]})]}),t.health_recommendations&&t.health_recommendations.length>0&&e.jsxs("div",{className:"p-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(d,{Icon:o.Shield,size:16,className:"text-white/80"}),e.jsx("span",{className:"text-white/90 text-sm font-medium",children:"Recommandations santé"})]}),e.jsx("div",{className:"space-y-2",children:t.health_recommendations.map((a,l)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full mt-1.5 flex-shrink-0",style:{background:s.text}}),e.jsx("span",{className:"text-white/70 text-sm",children:a})]},l))})]})]})})},Ps=({weather:t,city:s})=>{const{isPerformanceMode:r}=xe(),i=r?"div":R.div;return e.jsx(i,{...!r&&{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1}},children:e.jsxs(D,{className:"p-6",style:r?{background:"linear-gradient(145deg, color-mix(in srgb, #3B82F6 10%, #1e293b), color-mix(in srgb, #3B82F6 5%, #0f172a))",borderColor:"rgba(59, 130, 246, 0.2)"}:{background:`
          radial-gradient(circle at 30% 20%, rgba(59, 130, 246, 0.08) 0%, transparent 60%),
          var(--glass-opacity)
        `,borderColor:"rgba(59, 130, 246, 0.2)"},children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:r?{background:"linear-gradient(135deg, rgba(59, 130, 246, 0.4), rgba(59, 130, 246, 0.2))",border:"2px solid rgba(59, 130, 246, 0.5)",boxShadow:"0 2px 12px rgba(0, 0, 0, 0.4)"}:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                  linear-gradient(135deg, rgba(59, 130, 246, 0.4), rgba(59, 130, 246, 0.2))
                `,border:"2px solid rgba(59, 130, 246, 0.5)",boxShadow:"0 0 30px rgba(59, 130, 246, 0.4)"},children:e.jsx(d,{Icon:o.Cloud,size:24,style:{color:"#3B82F6"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-semibold text-xl",children:"Météo"}),s&&e.jsx("p",{className:"text-white/70 text-sm",children:s})]})]})}),e.jsxs("div",{className:"flex items-end gap-4 mb-6",children:[e.jsxs("div",{className:"text-6xl font-bold text-white",children:[Math.round(t.temperature_celsius),"°"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"text-white/90 text-lg mb-1",children:t.weather_condition}),t.feels_like_celsius!==void 0&&e.jsxs("div",{className:"text-white/60 text-sm",children:["Ressenti: ",Math.round(t.feels_like_celsius),"°C"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 flex items-center gap-3",children:[e.jsx(d,{Icon:o.Droplet,size:18,className:"text-blue-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white/60 text-xs mb-1",children:"Humidité"}),e.jsxs("div",{className:"text-white font-semibold",children:[t.humidity_percent,"%"]})]})]}),t.wind_speed_ms!==void 0&&e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 flex items-center gap-3",children:[e.jsx(d,{Icon:o.Wind,size:18,className:"text-blue-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white/60 text-xs mb-1",children:"Vent"}),e.jsxs("div",{className:"text-white font-semibold",children:[t.wind_speed_ms.toFixed(1)," m/s"]})]})]}),t.precipitation_mm!==void 0&&e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 flex items-center gap-3",children:[e.jsx(d,{Icon:o.CloudRain,size:18,className:"text-blue-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white/60 text-xs mb-1",children:"Précipitations"}),e.jsxs("div",{className:"text-white font-semibold",children:[t.precipitation_mm.toFixed(1)," mm"]})]})]}),t.cloud_cover_percent!==void 0&&e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 flex items-center gap-3",children:[e.jsx(d,{Icon:o.Cloud,size:18,className:"text-blue-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white/60 text-xs mb-1",children:"Nuages"}),e.jsxs("div",{className:"text-white font-semibold",children:[t.cloud_cover_percent,"%"]})]})]}),t.pressure_hpa!==void 0&&e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 flex items-center gap-3",children:[e.jsx(d,{Icon:o.Gauge,size:18,className:"text-blue-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white/60 text-xs mb-1",children:"Pression"}),e.jsxs("div",{className:"text-white font-semibold",children:[t.pressure_hpa," hPa"]})]})]}),t.visibility_km!==void 0&&e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 flex items-center gap-3",children:[e.jsx(d,{Icon:o.Eye,size:18,className:"text-blue-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white/60 text-xs mb-1",children:"Visibilité"}),e.jsxs("div",{className:"text-white font-semibold",children:[t.visibility_km.toFixed(1)," km"]})]})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-white/10",children:e.jsxs("div",{className:"flex items-center justify-between text-white/50 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{Icon:o.Clock,size:12}),e.jsxs("span",{children:["Mis à jour: ",new Date(t.last_updated).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})]})]}),t.provider&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-full bg-white/5",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-400"}),e.jsx("span",{className:"text-white/60",children:t.provider})]})]})})]})})},Ds=({hydration:t})=>{const{isPerformanceMode:s}=xe(),r=s?"div":R.div;return e.jsx(r,{...!s&&{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2}},children:e.jsxs(D,{className:"p-6",style:s?{background:"linear-gradient(145deg, color-mix(in srgb, #06B6D4 10%, #1e293b), color-mix(in srgb, #06B6D4 5%, #0f172a))",borderColor:"rgba(6, 182, 212, 0.2)"}:{background:`
          radial-gradient(circle at 30% 20%, rgba(6, 182, 212, 0.08) 0%, transparent 60%),
          var(--glass-opacity)
        `,borderColor:"rgba(6, 182, 212, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:s?{background:"linear-gradient(135deg, rgba(6, 182, 212, 0.4), rgba(6, 182, 212, 0.2))",border:"2px solid rgba(6, 182, 212, 0.5)",boxShadow:"0 2px 12px rgba(0, 0, 0, 0.4)"}:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                  linear-gradient(135deg, rgba(6, 182, 212, 0.4), rgba(6, 182, 212, 0.2))
                `,border:"2px solid rgba(6, 182, 212, 0.5)",boxShadow:"0 0 30px rgba(6, 182, 212, 0.4)"},children:e.jsx(d,{Icon:o.Droplet,size:24,style:{color:"#06B6D4"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-semibold text-xl",children:"Hydratation"}),e.jsx("p",{className:"text-white/70 text-sm",children:"Recommandations personnalisées"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-3xl font-bold text-cyan-400",children:[t.total_recommended_liters,"L"]}),e.jsx("div",{className:"text-white/60 text-sm",children:"par jour"})]})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{Icon:o.User,size:14,className:"text-cyan-400"}),e.jsx("span",{className:"text-white/80 text-sm",children:"Base (poids)"})]}),e.jsxs("span",{className:"text-white font-semibold",children:[t.base_amount_liters,"L"]})]}),t.weather_adjustment_liters>0&&e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{Icon:o.Sun,size:14,className:"text-orange-400"}),e.jsx("span",{className:"text-white/80 text-sm",children:"Ajustement météo"})]}),e.jsxs("span",{className:"text-orange-400 font-semibold",children:["+",t.weather_adjustment_liters,"L"]})]}),t.activity_adjustment_liters>0&&e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{Icon:o.Dumbbell,size:14,className:"text-green-400"}),e.jsx("span",{className:"text-white/80 text-sm",children:"Ajustement activité"})]}),e.jsxs("span",{className:"text-green-400 font-semibold",children:["+",t.activity_adjustment_liters,"L"]})]})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-white/5 border border-white/10 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(d,{Icon:o.Info,size:14,className:"text-white/80"}),e.jsx("span",{className:"text-white/90 text-sm font-medium",children:"Facteurs considérés"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60",children:"Température:"}),e.jsxs("span",{className:"text-white ml-2 font-medium",children:[t.factors.temperature,"°C"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60",children:"Humidité:"}),e.jsxs("span",{className:"text-white ml-2 font-medium",children:[t.factors.humidity,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60",children:"Activité:"}),e.jsx("span",{className:"text-white ml-2 font-medium capitalize",children:t.factors.physical_activity_level})]}),t.factors.user_weight_kg&&e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60",children:"Poids:"}),e.jsxs("span",{className:"text-white ml-2 font-medium",children:[t.factors.user_weight_kg," kg"]})]})]})]}),t.recommendations&&t.recommendations.length>0&&e.jsxs("div",{className:"p-4 rounded-lg bg-cyan-500/10 border border-cyan-400/20 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(d,{Icon:o.Lightbulb,size:16,className:"text-cyan-400"}),e.jsx("span",{className:"text-cyan-200 text-sm font-medium",children:"Conseils d'hydratation"})]}),e.jsx("div",{className:"space-y-2",children:t.recommendations.map((i,a)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-cyan-400 mt-1.5 flex-shrink-0"}),e.jsx("span",{className:"text-white/80 text-sm",children:i})]},a))})]}),t.alerts&&t.alerts.length>0&&e.jsxs("div",{className:"p-4 rounded-lg bg-orange-500/10 border border-orange-400/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(d,{Icon:o.AlertTriangle,size:16,className:"text-orange-400"}),e.jsx("span",{className:"text-orange-200 text-sm font-medium",children:"Alertes"})]}),e.jsx("div",{className:"space-y-2",children:t.alerts.map((i,a)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-orange-400 mt-1.5 flex-shrink-0"}),e.jsx("span",{className:"text-white/80 text-sm",children:i})]},a))})]})]})})},Ms={low:{bg:"rgba(16, 185, 129, 0.08)",border:"rgba(16, 185, 129, 0.3)",text:"#10B981",label:"Faible"},moderate:{bg:"rgba(245, 158, 11, 0.08)",border:"rgba(245, 158, 11, 0.3)",text:"#F59E0B",label:"Modérée"},high:{bg:"rgba(239, 68, 68, 0.08)",border:"rgba(239, 68, 68, 0.3)",text:"#EF4444",label:"Élevée"},severe:{bg:"rgba(127, 29, 29, 0.08)",border:"rgba(127, 29, 29, 0.3)",text:"#7F1D1D",label:"Sévère"}},Rs=({exposure:t})=>{const s=Ms[t.exposure_level],{isPerformanceMode:r}=xe(),i=r?"div":R.div;return e.jsx(i,{...!r&&{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3}},children:e.jsxs(D,{className:"p-6",style:r?{background:`linear-gradient(145deg, ${s.bg}, transparent)`,borderColor:s.border}:{background:`radial-gradient(circle at 30% 20%, ${s.bg} 0%, transparent 60%), var(--glass-opacity)`,borderColor:s.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:r?{background:`linear-gradient(135deg, ${s.text}66, ${s.text}33)`,border:`2px solid ${s.text}80`,boxShadow:"0 2px 12px rgba(0, 0, 0, 0.4)"}:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                  linear-gradient(135deg, ${s.text}66, ${s.text}33)
                `,border:`2px solid ${s.text}80`,boxShadow:`0 0 30px ${s.text}66`},children:e.jsx(d,{Icon:o.Shield,size:24,style:{color:s.text},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-semibold text-xl",children:"Exposition Environnementale"}),e.jsx("p",{className:"text-white/70 text-sm",children:"Risques et protections"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-medium mb-1",style:{color:s.text},children:["Niveau ",s.label]}),e.jsx("div",{className:"text-xs text-white/60",children:"d'exposition"})]})]}),t.pollution_sources&&t.pollution_sources.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(d,{Icon:o.AlertCircle,size:16,className:"text-white/80"}),e.jsx("span",{className:"text-white/90 text-sm font-medium",children:"Sources de pollution"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.pollution_sources.map((a,l)=>e.jsx("span",{className:"px-3 py-1.5 rounded-full text-xs font-medium",style:{background:`${s.text}22`,color:s.text,border:`1px solid ${s.text}44`},children:a},l))})]}),t.environmental_hazards&&t.environmental_hazards.length>0&&e.jsxs("div",{className:"mb-4 p-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(d,{Icon:o.AlertTriangle,size:16,className:"text-orange-400"}),e.jsx("span",{className:"text-white/90 text-sm font-medium",children:"Dangers environnementaux"})]}),e.jsx("div",{className:"space-y-2",children:t.environmental_hazards.map((a,l)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-orange-400 mt-1.5 flex-shrink-0"}),e.jsx("span",{className:"text-white/70 text-sm",children:a})]},l))})]}),t.protective_measures&&t.protective_measures.length>0&&e.jsxs("div",{className:"p-4 rounded-lg bg-green-500/10 border border-green-400/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(d,{Icon:o.Shield,size:16,className:"text-green-400"}),e.jsx("span",{className:"text-green-200 text-sm font-medium",children:"Mesures de protection"})]}),e.jsx("div",{className:"space-y-2",children:t.protective_measures.map((a,l)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(d,{Icon:o.Check,size:14,className:"text-green-400 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-white/80 text-sm",children:a})]},l))})]}),t.time_outdoors_recommended&&e.jsxs("div",{className:"mt-4 p-4 rounded-lg bg-blue-500/10 border border-blue-400/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(d,{Icon:o.Clock,size:16,className:"text-blue-400"}),e.jsx("span",{className:"text-blue-200 text-sm font-medium",children:"Heures recommandées en extérieur"})]}),t.time_outdoors_recommended.safe_hours.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"text-green-400 text-xs font-medium",children:"Heures sûres: "}),e.jsx("span",{className:"text-white/70 text-xs",children:t.time_outdoors_recommended.safe_hours.join(", ")})]}),t.time_outdoors_recommended.avoid_hours.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-red-400 text-xs font-medium",children:"Heures à éviter: "}),e.jsx("span",{className:"text-white/70 text-xs",children:t.time_outdoors_recommended.avoid_hours.join(", ")})]})]})]})})},Qs=()=>{const{profile:t}=q(),{data:s,loading:r,error:i,refresh:a}=Ss(),{countryData:l,loading:n,error:c,refresh:m}=ks(),u=ie(),b=!!t?.country,N=i?.message?.includes("pas encore supporté");return b?e.jsxs(Fe,{performanceConfig:u,className:"space-y-6 profile-section",children:[e.jsx(K,{performanceConfig:u,direction:"up",distance:10,children:e.jsxs(D,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, rgba(236, 72, 153, 0.08) 0%, transparent 60%),
            var(--glass-opacity)
          `,borderColor:"rgba(236, 72, 153, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, #EC4899 35%, transparent), color-mix(in srgb, #EC4899 25%, transparent))
                  `,border:"2px solid color-mix(in srgb, #EC4899 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #EC4899 30%, transparent)"},children:e.jsx(d,{Icon:o.MapPin,size:20,style:{color:"#EC4899"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Environnement Géographique"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:s?.city&&s?.country_code?`${s.city}, ${s.country_code}`:t?.country||"Non configuré"})]})]}),b&&s&&e.jsx("button",{onClick:a,disabled:r,className:"btn-glass px-4 py-2",title:"Rafraîchir les données",children:e.jsx(d,{Icon:o.RefreshCw,size:16,className:r?"animate-spin":""})})]}),b&&i&&N&&e.jsx("div",{className:"p-4 rounded-xl bg-amber-500/10 border border-amber-400/20 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(d,{Icon:o.AlertTriangle,size:20,className:"text-amber-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-amber-300 font-semibold mb-2",children:"Pays non encore supporté"}),e.jsxs("p",{className:"text-amber-200 text-sm mb-3",children:["Les données géographiques ne sont pas encore disponibles pour ",e.jsx("strong",{children:t?.country}),". Nous couvrons actuellement plus de 130 pays, incluant la France métropolitaine, tous les DOM-TOM, et les pays majeurs."]}),e.jsx("p",{className:"text-amber-200 text-sm mb-4",children:"Le contexte sanitaire local reste disponible ci-dessous. Les données météo et qualité de l'air seront ajoutées prochainement."}),e.jsx("button",{onClick:()=>window.location.href="/profile?tab=identity",className:"btn-glass text-sm px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{Icon:o.MapPin,size:14}),e.jsx("span",{children:"Changer de pays"})]})})]})]})}),b&&i&&!N&&e.jsx("div",{className:"p-4 rounded-xl bg-red-500/10 border border-red-400/20 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(d,{Icon:o.AlertCircle,size:20,className:"text-red-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-red-300 font-semibold mb-1",children:"Erreur de chargement"}),e.jsx("p",{className:"text-red-200 text-sm mb-3",children:i.message}),e.jsx("button",{onClick:a,className:"btn-glass text-sm px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{Icon:o.RefreshCw,size:14}),e.jsx("span",{children:"Réessayer"})]})})]})]})}),b&&r&&!s&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(d,{Icon:o.Loader2,size:32,className:"animate-spin text-pink-400 mx-auto mb-4"}),e.jsx("p",{className:"text-white/70",children:"Chargement des données environnementales..."})]}),b&&s&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ps,{weather:s.weather,city:s.city}),e.jsx(Ts,{airQuality:s.air_quality}),e.jsx(Ds,{hydration:s.hydration_recommendation}),e.jsx(Rs,{exposure:s.environmental_exposure})]})]})}),b&&e.jsx(K,{performanceConfig:u,direction:"up",distance:10,children:e.jsxs(D,{className:"p-6",style:{background:`
              radial-gradient(circle at 30% 20%, rgba(236, 72, 153, 0.08) 0%, transparent 60%),
              var(--glass-opacity)
            `,borderColor:"rgba(236, 72, 153, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                      radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                      linear-gradient(135deg, color-mix(in srgb, #EC4899 35%, transparent), color-mix(in srgb, #EC4899 25%, transparent))
                    `,border:"2px solid color-mix(in srgb, #EC4899 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #EC4899 30%, transparent)"},children:e.jsx(d,{Icon:o.Globe,size:20,style:{color:"#EC4899"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Contexte Sanitaire Local"}),e.jsxs("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:["Risques et recommandations pour ",t?.country]})]})]}),l&&e.jsx("button",{onClick:m,disabled:n,className:"btn-glass px-3 py-2 text-sm",title:"Rafraîchir les données sanitaires",children:e.jsx(d,{Icon:o.RefreshCw,size:16,className:n?"animate-spin":""})})]}),c&&e.jsx("div",{className:"p-4 rounded-xl bg-red-500/10 border border-red-400/20 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(d,{Icon:o.AlertCircle,size:18,className:"text-red-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-300 text-sm font-medium mb-1",children:"Erreur de chargement"}),e.jsx("p",{className:"text-red-200 text-xs",children:c.message})]})]})}),e.jsx(Cs,{countryData:l,loading:n})]})}),b&&s&&e.jsx(K,{performanceConfig:u,direction:"up",distance:10,children:e.jsx(D,{className:"p-4",style:{background:"rgba(236, 72, 153, 0.05)",borderColor:"rgba(236, 72, 153, 0.2)"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(d,{Icon:o.Info,size:16,className:"text-pink-400 mt-0.5 flex-shrink-0"}),e.jsx("div",{children:e.jsxs("p",{className:"text-pink-300 text-sm leading-relaxed",children:[e.jsx("strong",{children:"Sources de données:"})," Les informations météorologiques et de qualité de l'air proviennent d'Open-Meteo, un service open source fournissant des données en temps réel. Les données sont mises à jour toutes les heures automatiquement."]})})]})})})]}):e.jsx(K,{performanceConfig:u,className:"space-y-6 profile-section",children:e.jsx("div",{children:e.jsxs(D,{className:"p-8 text-center",style:{background:`
              radial-gradient(circle at 30% 20%, rgba(236, 72, 153, 0.12) 0%, transparent 60%),
              var(--glass-opacity)
            `,borderColor:"rgba(236, 72, 153, 0.3)"},children:[e.jsx("div",{className:"w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                  linear-gradient(135deg, rgba(236, 72, 153, 0.4), rgba(236, 72, 153, 0.2))
                `,border:"2px solid rgba(236, 72, 153, 0.5)",boxShadow:"0 0 30px rgba(236, 72, 153, 0.4)"},children:e.jsx(d,{Icon:o.MapPin,size:32,style:{color:"#EC4899"},variant:"pure"})}),e.jsx("h2",{className:"text-white font-bold text-2xl mb-3",children:"Pays non renseigné"}),e.jsx("p",{className:"text-white/70 text-base leading-relaxed mb-6",children:"Pour accéder aux données géographiques, météorologiques et de qualité de l'air, veuillez d'abord renseigner votre pays dans l'onglet Identité."}),e.jsx("button",{onClick:()=>{window.location.href="/profile?tab=identity"},className:"btn-glass--primary px-6 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{Icon:o.User,size:18}),e.jsx("span",{children:"Aller à l'onglet Identité"})]})})]})})})};function Fs(){const{user:t}=q(),[s,r]=T.useState({hasBodyScan:!1,hasFaceScan:!1,latestBodyScan:null,latestFaceScan:null,bodyScanCount:0,faceScanCount:0,lastScanDate:null,completionPercentage:0}),[i,a]=T.useState(!0),[l,n]=T.useState(null);return T.useEffect(()=>{if(!t?.id){a(!1);return}async function m(){try{a(!0),n(null),f.info("AVATAR_DATA","Fetching latest body scan",{userId:t.id,philosophy:"avatar_data_fetch_start"});const{data:u,error:b}=await X.from("body_scans").select("*").eq("user_id",t.id).order("created_at",{ascending:!1}).limit(1);if(b)throw f.error("AVATAR_DATA","Error fetching body scan",{userId:t.id,error:b.message,philosophy:"body_scan_fetch_error"}),b;const{count:N,error:y}=await X.from("body_scans").select("*",{count:"exact",head:!0}).eq("user_id",t.id);if(y)throw y;let S=null;if(u&&u.length>0){const v=u[0],I=v.metrics||{},g=v.morph_values||v.morph3d||I.final_shape_params||null,p=v.limb_masses||I.final_limb_masses||null,j=v.skin_tone_map_v2||I.skin_tone||v.skin_tone||null,M=v.resolved_gender||I.resolved_gender||null,w=I.estimate_result?.extracted_data||{},C=v.raw_measurements||w.raw_measurements||{},A=v.weight||C.weight_kg||w.weight_kg||null,E=v.body_fat_percentage||w.estimated_body_fat_perc||null,k=v.bmi||w.estimated_bmi||null,P=v.waist_circumference||C.waist_cm||null;S={id:v.id,created_at:v.created_at,timestamp:v.timestamp,user_id:v.user_id,morph_values:g,limb_masses:p,skin_tone:j,skin_tone_map_v2:v.skin_tone_map_v2,resolved_gender:M,weight:A,body_fat_percentage:E,bmi:k,waist_circumference:P,raw_measurements:C,avatar_version:v.avatar_version||I.avatar_version||null,gltf_model_id:v.gltf_model_id||I.gltf_model_id||null,material_config_version:v.material_config_version||null,mapping_version:v.mapping_version||null,metrics:v.metrics},f.info("AVATAR_DATA","Body scan data extracted and enriched",{userId:t.id,scanId:v.id,hasMorphValues:!!g&&Object.keys(g).length>0,morphValuesCount:g?Object.keys(g).length:0,morphValuesSource:v.morph_values?"direct_column":I.final_shape_params?"metrics_jsonb":"none",hasLimbMasses:!!p&&Object.keys(p).length>0,limbMassesCount:p?Object.keys(p).length:0,limbMassesSource:v.limb_masses?"direct_column":I.final_limb_masses?"metrics_jsonb":"none",hasSkinTone:!!j,skinToneSource:v.skin_tone_map_v2?"v2_direct_column":I.skin_tone?"metrics_jsonb":v.skin_tone?"legacy_column":"none",hasResolvedGender:!!M,resolvedGenderValue:M,hasWeight:!!A,weight:A,hasBMI:!!k,bmi:k,avatarVersion:S.avatar_version,philosophy:"body_scan_enriched"})}const h=S?new Date(S.created_at):null,x=S?100:0;r({hasBodyScan:!!S,hasFaceScan:!1,latestBodyScan:S,latestFaceScan:null,bodyScanCount:N||0,faceScanCount:0,lastScanDate:h,completionPercentage:x}),f.info("AVATAR_DATA","Avatar data fetch completed successfully",{userId:t.id,hasBodyScan:!!S,bodyScanCount:N,completionPercentage:x,philosophy:"avatar_data_fetch_complete"})}catch(u){const b=u instanceof Error?u:new Error("Failed to fetch avatar data");n(b),f.error("AVATAR_DATA","Error fetching avatar data",{userId:t?.id,error:b.message,errorStack:b.stack,philosophy:"avatar_data_fetch_error"})}finally{a(!1)}}m()},[t?.id]),{data:s,loading:i,error:l,refresh:()=>{t?.id&&(a(!0),n(null),r({hasBodyScan:!1,hasFaceScan:!1,latestBodyScan:null,latestFaceScan:null,bodyScanCount:0,faceScanCount:0,lastScanDate:null,completionPercentage:0}))}}}const Os=({data:t})=>{const s=he();return e.jsxs(D,{className:"p-6",style:{background:`
          radial-gradient(circle at 30% 20%, rgba(168, 85, 247, 0.08) 0%, transparent 60%),
          var(--glass-opacity)
        `,borderColor:"rgba(168, 85, 247, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, #A855F7 35%, transparent), color-mix(in srgb, #A855F7 25%, transparent))
              `,border:"2px solid color-mix(in srgb, #A855F7 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #A855F7 30%, transparent)"},children:e.jsx(d,{Icon:o.Eye,size:20,style:{color:"#A855F7"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Statut Avatar"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"État de votre reflet numérique 3D"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${t.completionPercentage===100?"bg-green-400":t.completionPercentage>0?"bg-purple-400":"bg-gray-400"}`}),e.jsx("span",{className:`text-sm font-medium ${t.completionPercentage===100?"text-green-300":t.completionPercentage>0?"text-purple-300":"text-gray-400"}`,children:t.completionPercentage===100?"Complet":t.completionPercentage>0?"Partiel":"Vide"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(R.div,{className:`w-12 h-12 rounded-full flex items-center justify-center border-2 ${t.completionPercentage===100?"bg-green-500/20 border-green-400/40":t.completionPercentage>0?"bg-purple-500/20 border-purple-400/40":"bg-gray-500/20 border-gray-400/40"}`,initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:300,damping:25},children:e.jsx(d,{Icon:t.completionPercentage===100?o.CheckCircle:t.completionPercentage>0?o.Circle:o.XCircle,size:24,className:t.completionPercentage===100?"text-green-400":t.completionPercentage>0?"text-purple-400":"text-gray-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-semibold",children:t.completionPercentage===100?"Avatar Complet":t.completionPercentage>0?"Avatar Partiel":"Aucun Avatar"}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[t.hasBodyScan&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-purple-300",children:[e.jsx(d,{Icon:o.User,size:12}),e.jsx("span",{children:"Corps 3D"})]}),!t.hasBodyScan&&e.jsx("span",{className:"text-xs text-gray-400",children:"Aucun scan disponible"})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-white mb-1",children:[t.completionPercentage,"%"]}),e.jsx("div",{className:"text-purple-300 text-xs",children:"Complété"})]})]}),t.completionPercentage<100&&e.jsx("button",{onClick:()=>s("/body-scan"),className:"btn-glass--primary mt-6 w-full",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(d,{Icon:o.Scan,size:16}),e.jsx("span",{children:"Scanner mon corps"})]})})]})},Ls=({data:t})=>{const s=he();if(!t.lastScanDate)return e.jsxs(D,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, rgba(168, 85, 247, 0.08) 0%, transparent 60%),
            var(--glass-opacity)
          `,borderColor:"rgba(168, 85, 247, 0.2)"},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, #A855F7 35%, transparent), color-mix(in srgb, #A855F7 25%, transparent))
              `,border:"2px solid color-mix(in srgb, #A855F7 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #A855F7 30%, transparent)"},children:e.jsx(d,{Icon:o.Clock,size:20,style:{color:"#A855F7"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl text-white font-semibold",children:"Dernier Scan"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"Aucun scan disponible"})]})]}),e.jsx("div",{className:"p-4 rounded-xl bg-purple-500/10 border border-purple-400/20",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(d,{Icon:o.Info,size:16,className:"text-purple-400 mt-0.5 flex-shrink-0"}),e.jsx("div",{children:e.jsx("p",{className:"text-purple-200 text-sm leading-relaxed",children:"Vous n'avez pas encore effectué de scan corporel. Commencez par scanner votre corps pour créer votre avatar numérique 3D."})})]})}),e.jsx("button",{onClick:()=>s("/body-scan"),className:"btn-glass--primary mt-4 w-full",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(d,{Icon:o.Scan,size:16}),e.jsx("span",{children:"Commencer un scan"})]})})]});const r=Ye(t.lastScanDate,{locale:Ke,addSuffix:!0});return e.jsxs(D,{className:"p-6",style:{background:`
          radial-gradient(circle at 30% 20%, rgba(168, 85, 247, 0.08) 0%, transparent 60%),
          var(--glass-opacity)
        `,borderColor:"rgba(168, 85, 247, 0.2)"},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
              radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
              linear-gradient(135deg, color-mix(in srgb, #A855F7 35%, transparent), color-mix(in srgb, #A855F7 25%, transparent))
            `,border:"2px solid color-mix(in srgb, #A855F7 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #A855F7 30%, transparent)"},children:e.jsx(d,{Icon:o.Clock,size:20,style:{color:"#A855F7"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl text-white font-semibold",children:"Dernier Scan"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:r})]})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-white/5 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(d,{Icon:o.User,size:14,className:"text-purple-400"}),e.jsx("span",{className:"text-white font-medium text-sm",children:"Scans Corporels"})]}),e.jsx("div",{className:"text-white/60 text-xs",children:t.hasBodyScan?`${t.bodyScanCount} scan${t.bodyScanCount>1?"s":""}`:"Aucun scan"})]})]})},zs=({data:t})=>{const s=he();return e.jsxs(D,{className:"p-6",style:{background:`
          radial-gradient(circle at 30% 20%, rgba(168, 85, 247, 0.08) 0%, transparent 60%),
          var(--glass-opacity)
        `,borderColor:"rgba(168, 85, 247, 0.2)"},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
              radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
              linear-gradient(135deg, color-mix(in srgb, #A855F7 35%, transparent), color-mix(in srgb, #A855F7 25%, transparent))
            `,border:"2px solid color-mix(in srgb, #A855F7 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #A855F7 30%, transparent)"},children:e.jsx(d,{Icon:o.Zap,size:20,style:{color:"#A855F7"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl text-white font-semibold",children:"Actions Rapides"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"Gérez votre avatar"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx("button",{onClick:()=>s("/body-scan"),className:"btn-glass p-4 text-left hover:bg-white/5 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(d,{Icon:o.Scan,size:18,className:"text-purple-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium text-sm mb-1",children:"Scanner mon corps"}),e.jsx("div",{className:"text-white/60 text-xs",children:"Créer ou mettre à jour votre scan corporel"})]})]})}),t.hasBodyScan&&e.jsx("button",{onClick:()=>s("/avatar"),className:"btn-glass p-4 text-left hover:bg-white/5 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(d,{Icon:o.Eye,size:18,className:"text-purple-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium text-sm mb-1",children:"Voir mon avatar"}),e.jsx("div",{className:"text-white/60 text-xs",children:"Visualiser votre reflet numérique 3D"})]})]})}),t.hasBodyScan&&e.jsx("button",{onClick:()=>s("/avatar?tab=projection"),className:"btn-glass p-4 text-left hover:bg-white/5 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(d,{Icon:o.TrendingUp,size:18,className:"text-purple-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium text-sm mb-1",children:"Projections"}),e.jsx("div",{className:"text-white/60 text-xs",children:"Visualiser l'évolution possible"})]})]})})]})]})},ei=()=>{const{data:t,loading:s,error:r}=Fs(),i=ie();return s?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs(D,{className:"p-8 text-center",children:[e.jsx(d,{Icon:o.Loader2,size:32,className:"animate-spin text-purple-400 mx-auto mb-4"}),e.jsx("p",{className:"text-white/70",children:"Chargement des données avatar..."})]})}):r?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(D,{className:"p-6",style:{background:"rgba(239, 68, 68, 0.1)",borderColor:"rgba(239, 68, 68, 0.3)"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(d,{Icon:o.AlertCircle,size:20,className:"text-red-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-red-300 font-semibold mb-1",children:"Erreur de chargement"}),e.jsx("p",{className:"text-red-200 text-sm",children:r.message})]})]})})}):e.jsxs(Fe,{performanceConfig:i,className:"space-y-6 profile-section",children:[e.jsx(K,{performanceConfig:i,direction:"up",distance:10,children:e.jsx(Os,{data:t})}),e.jsx(K,{performanceConfig:i,direction:"up",distance:10,children:e.jsx(Ls,{data:t})}),e.jsx(K,{performanceConfig:i,direction:"up",distance:10,children:e.jsx(zs,{data:t})})]})};export{je as F,mt as P,Ks as a,Js as b,Xs as c,te as d,Zs as e,Qs as f,ei as g,ls as h};
