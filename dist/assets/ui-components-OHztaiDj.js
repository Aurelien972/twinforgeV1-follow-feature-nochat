const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/voiceConnectionDiagnostics-CGIO5UCm.js","assets/page-fridge-C1QVLxk9.js","assets/vendor-ZbFMzY-i.js","assets/utils-CUtLAp28.js","assets/supabase-8_3juhcZ.js","assets/stores-ZZM8MTtI.js","assets/motion-HGAT--uT.js","assets/date-utils-BlBdbPk_.js","assets/page-fridge-scan-C_CisW7P.js","assets/page-fridge-scan-DAz6gEg3.css"])))=>i.map(i=>d[i]);
var rt=Object.defineProperty;var it=(s,t,a)=>t in s?rt(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a;var k=(s,t,a)=>it(s,typeof t!="symbol"?t+"":t,a);import{R as _,r as E,j as e,X as st,B as nt,A as ot,D as ct,i as lt,S as dt,W as pt,F as ut,k as ke,l as mt,H as ht,T as gt,m as xt,L as bt,G as ft,n as Re,o as yt,Z as _e,p as vt,q as wt,t as Ct,v as jt,w as Et,C as It,N as St,M as Nt,x as Tt,y as At,z as kt,E as Rt,I as _t,J as Mt,K as Ot,O as Ft,P as Dt,Q as $t,U as Pt,V as Lt,Y as Bt,_ as Ht,$ as zt,a0 as Ut,a1 as Wt,a2 as Vt,a3 as qt,a4 as Gt,a5 as Jt,a6 as Xt,a7 as Kt,a8 as Yt,a9 as Zt,aa as Qt,ab as ea,ac as ta,ad as Me,ae as aa,af as ra,ag as ia,ah as sa,ai as na,aj as oa,ak as ca,al as la,am as da,an as pa,ao as ua,ap as ma,aq as ha,ar as ga,as as xa,at as ba,au as fa,av as ya,aw as va,ax as wa,ay as Ca,az as ja,aA as Ea,aB as Ia,aC as Sa,aD as Na,aE as Ta,aF as Aa,aG as ka,aH as Ra,aI as _a,aJ as Ma,aK as Oa,aL as Fa,aM as Da,aN as $a,aO as Pa,aP as La,aQ as Ba,aR as Ha,aS as za,aT as Ua,aU as Wa,aV as Va,aW as qa,aX as Oe,aY as Ga,aZ as Ja,a_ as Xa,a$ as Ka,b0 as Ya,b1 as Za,b2 as Qa,b3 as er,b4 as tr,b5 as ar,b6 as rr,b7 as ir,b8 as sr,b9 as nr,ba as or,bb as cr,bc as lr,bd as dr,be as pr,bf as ur,bg as mr,bh as hr,bi as gr,bj as xr,bk as br,bl as fr,bm as yr,bn as vr,bo as wr,bp as Cr,bq as jr,br as Er,bs as Ir,bt as Sr,bu as Nr,bv as Tr,bw as Ar,bx as kr,by as Rr,bz as _r,bA as Mr,bB as Or,bC as Fr,bD as Dr,bE as $r,bF as Pr,bG as Lr,bH as Br,bI as Hr,bJ as zr,bK as Ur,bL as Wr,bM as Vr,bN as qr,bO as Gr,bP as Jr,bQ as Xr,bR as Kr,bS as Yr,bT as Zr,bU as Qr,bV as ei,bW as ti,bX as we,bY as qe,bZ as Ce,b_ as ai,b$ as Ge,c0 as Je,c1 as ri,c2 as ii,c3 as si,c4 as ni,c5 as oi,c6 as ci,c7 as li,c8 as di,c9 as pi,ca as ui,cb as mi,cc as hi,cd as gi,ce as xi,cf as bi,cg as fi,ch as Fe,ci as yi,cj as vi,ck as wi,cl as Ci,cm as De,cn as ji,co as Ei,cp as Ii,cq as Si,cr as Ni,cs as Ti,ct as Ai,cu as ki,cv as Ri,cw as _i,cx as Mi,cy as Oi,cz as Fi,cA as Di,cB as $i,cC as Pi,cD as Li,cE as Bi,cF as Hi,cG as zi,cH as Ui,cI as Wi,cJ as Vi,cK as qi,cL as Gi,cM as Ji,e as Xi,u as ae,cN as Ki,h as pe,c as fe}from"./vendor-ZbFMzY-i.js";import{l as n,a as X,u as G,s as B,H as Q,_ as Yi}from"./page-fridge-C1QVLxk9.js";import{m as w,u as Zi,A as H}from"./motion-HGAT--uT.js";import{a as oe,i as xe,Z as be,c as Qi,j as de,k as z}from"./stores-ZZM8MTtI.js";import{a as es}from"./page-fridge-scan-C_CisW7P.js";import{a as ts,n as as}from"./utils-CUtLAp28.js";function rs(){const s=navigator.userAgent.toLowerCase();return/android/.test(s)?"android":/iphone|ipad|ipod/.test(s)?"ios":window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0?"desktop":"unknown"}function $e(){return!!(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||window.matchMedia("(display-mode: minimal-ui)").matches)}function is(){const[s,t]=_.useState(null),[a,r]=_.useState(!1),[i,o]=_.useState(!1),[l,c]=_.useState("unknown");E.useEffect(()=>{const m=rs(),u=$e();c(m),o(u),n.info("PWA_INSTALL","PWA state initialized",{platform:m,isInstalled:u,userAgent:navigator.userAgent.substring(0,100),displayMode:window.matchMedia("(display-mode: standalone)").matches?"standalone":"browser",timestamp:new Date().toISOString()})},[]),E.useEffect(()=>{const m=f=>{const g=f;f.preventDefault(),t(g),r(!0),n.info("PWA_INSTALL","beforeinstallprompt event captured",{platforms:g.platforms,canPrompt:!0,timestamp:new Date().toISOString()})},u=()=>{o(!0),r(!1),t(null),n.info("PWA_INSTALL","PWA installed successfully",{platform:l,timestamp:new Date().toISOString()})};return window.addEventListener("beforeinstallprompt",m),window.addEventListener("appinstalled",u),()=>{window.removeEventListener("beforeinstallprompt",m),window.removeEventListener("appinstalled",u)}},[l]),E.useEffect(()=>{const m=window.matchMedia("(display-mode: standalone)"),u=f=>{const g=f.matches||window.navigator.standalone===!0;o(g),n.info("PWA_INSTALL","Display mode changed",{isStandalone:f.matches,isInstalled:g,timestamp:new Date().toISOString()})};return m.addEventListener("change",u),()=>{m.removeEventListener("change",u)}},[]);const d=async()=>{if(!s)return n.warn("PWA_INSTALL","No install prompt event available",{platform:l,isInstallable:a,timestamp:new Date().toISOString()}),!1;try{n.info("PWA_INSTALL","Showing install prompt",{platform:l,timestamp:new Date().toISOString()}),await s.prompt();const m=await s.userChoice;return n.info("PWA_INSTALL","User install choice",{outcome:m.outcome,platform:m.platform,timestamp:new Date().toISOString()}),m.outcome==="accepted"?(r(!1),t(null),!0):!1}catch(m){return n.error("PWA_INSTALL","Install prompt failed",{error:m instanceof Error?m.message:"Unknown error",platform:l,timestamp:new Date().toISOString()}),!1}},p=()=>{r(!1),t(null),n.info("PWA_INSTALL","Install prompt dismissed by user",{platform:l,timestamp:new Date().toISOString()})},h=()=>{const m=$e();o(m),n.debug("PWA_INSTALL","Install status checked",{isInstalled:m,platform:l,timestamp:new Date().toISOString()})};return{isInstallable:a,isInstalled:i,isStandalone:window.matchMedia("(display-mode: standalone)").matches,platform:l,canShowPrompt:!!s,installPromptEvent:s,showInstallPrompt:d,dismissInstallPrompt:p,checkInstallStatus:h}}function ss(s,t,a=250){E.useEffect(()=>{const r=s.current;if(!r||t.length===0)return;r.style.willChange=t.join(", ");const i=setTimeout(()=>{r&&(r.style.willChange="auto")},a);return()=>{clearTimeout(i),r&&(r.style.willChange="auto")}},[s,t,a])}const Se=E.createContext({preferredMotion:"full",hasTouch:!1,isMobile:!1}),ns=()=>E.useContext(Se).preferredMotion,os=()=>E.useContext(Se).hasTouch,wn=({children:s})=>{const t=window.matchMedia("(prefers-reduced-motion: reduce)").matches?"reduced":"full",a="ontouchstart"in window||navigator.maxTouchPoints>0,r=window.innerWidth<768||a,i={preferredMotion:t,hasTouch:a,isMobile:r};return e.jsx(Se.Provider,{value:i,children:s})},Pe={gentle:[.25,.1,.25,1],smooth:[.16,1,.3,1]};function cs(s){return s<=24?2:s>=24?2.5:2}function ls(s){return s<=20?8:s<=32?10:s<=48?12:14}const I=({Icon:s,size:t=24,className:a="",animate:r=!0,color:i,glowColor:o,variant:l="default",shape:c="round",style:d,animate:p,transition:h,"aria-label":m,"aria-hidden":u,"aria-describedby":f,role:g,tabIndex:x,onClick:b,onKeyDown:y})=>{const C=ns(),j=os(),{isPerformanceMode:S}=X(),N=E.useRef(null),T=!C&&r&&window.innerWidth>768&&!S,R=i??"var(--text-icon-idle)",$="var(--text-icon-active)",P=cs(t),A=ls(t);ss(N,T&&r?["transform"]:[],100);const K={initial:{scale:1,transition:{duration:0}},hover:T&&!j?{scale:1.03,transition:{duration:.1,ease:Pe.gentle}}:{},tap:T?{scale:.98,transition:{duration:.08,ease:Pe.smooth}}:{}},Y=()=>{if(!(!T||j||l==="pure"||S)&&N.current){const ee=getComputedStyle(document.documentElement).getPropertyValue("--color-plasma-cyan").trim()||"#18E3FF";N.current.style.filter=`drop-shadow(0 0 ${A}px ${ee}15)`,N.current.style.color=$}},Z=()=>{!T||j||l==="pure"||S||N.current&&(N.current.style.filter="",N.current.style.color=R)},D=ee=>{y?.(ee),b&&(ee.key==="Enter"||ee.key===" ")&&(ee.preventDefault(),b())},F=!!b,O=F?x!==void 0?x:0:void 0,V=u!==void 0?u:!F&&!m&&!g,L=l==="pure"?`inline-flex items-center justify-center spatial-icon icon-container ${F?"cursor-pointer focus-ring":""} ${window.innerWidth<=768?"mobile-static-icon":""} ${T?"will-change-transform-important":"will-change-auto-important"} ${a}`:`inline-flex items-center justify-center spatial-icon icon-container gpu-only-transform ${F?"cursor-pointer focus-ring":""} ${window.innerWidth<=768?"mobile-static-icon":""} ${T?"will-change-transform-important":"will-change-auto-important"} ${a}`,U=()=>c==="square"?`${Math.max(4,t*.15)}px`:"50%",re=l==="pure"?{transform:"translateZ(0)",alignItems:"center",justifyContent:"center",position:"relative"}:{transform:"translateZ(0)",alignItems:"center",justifyContent:"center",position:"relative",background:F?"color-mix(in srgb, var(--brand-primary) 8%, transparent)":"transparent",borderRadius:U(),padding:`${Math.max(4,t*.15)}px`,border:F?"1px solid color-mix(in srgb, var(--color-plasma-cyan) 10%, transparent)":"none"},ce=e.jsxs(e.Fragment,{children:[!S&&(l==="default"||l==="pure"&&o)&&e.jsx("div",{className:"absolute inset-0 pointer-events-none transition-opacity duration-200",style:{background:`radial-gradient(circle, color-mix(in srgb, ${o||"var(--color-plasma-cyan)"} 6%, transparent) 0%, transparent 70%)`,opacity:o?1:0,transform:`scale(${1+A/t})`,filter:`blur(${Math.max(2,A/4)}px)`,borderRadius:U(),zIndex:-1},ref:ee=>{ee&&N.current&&(N.current._haloNode=ee)}}),s?e.jsx(s,{size:t,color:R,strokeWidth:P,style:{filter:S?o?`drop-shadow(0 0 8px ${o}60)`:`drop-shadow(0 0 4px ${R}40)`:o?`drop-shadow(0 0 12px ${o}80) drop-shadow(0 0 24px ${o}60) drop-shadow(0 0 36px color-mix(in srgb, ${o} 40%, transparent))`:l==="pure"?`drop-shadow(0 0 6px ${R}40)`:"drop-shadow(0 1px 2px rgba(0,0,0,0.2))",transition:S?"none":"color 200ms ease, filter 200ms ease",transform:"translateZ(0)",strokeLinecap:"round",strokeLinejoin:"round",...d}}):e.jsx("span",{style:{fontSize:t,color:R,transform:"none"},children:"⚠️"})]});return S?e.jsx("div",{ref:N,className:L,style:{...re,...d},onClick:b,onKeyDown:F?D:void 0,role:g||(F?"button":void 0),tabIndex:O,"aria-label":m,"aria-hidden":V,"aria-describedby":f,"data-performance-mode":"static",children:ce}):e.jsx(w.div,{ref:N,className:L,style:re,variants:K,initial:"initial",whileHover:"hover",whileTap:F?T?{scale:.98,transition:{duration:.08,ease:[.16,1,.3,1]}}:{}:{},animate:p,transition:h,onMouseEnter:Y,onMouseLeave:Z,onClick:b,onKeyDown:F?D:void 0,role:g||(F?"button":void 0),tabIndex:O,"aria-label":m,"aria-hidden":V,"aria-describedby":f,children:ce})},v={Home:Ji,Target:Gi,Timer:qi,Utensils:Vi,Activity:Re,Smile:Wi,Scan:Ui,ScanLine:zi,ScanFace:Hi,ScanBarcode:Bi,Barcode:Li,Refrigerator:Pi,Users:$i,ChefHat:Di,Archive:Fi,LayoutDashboard:Oi,Phone:Mi,Menu:_i,X:Ri,Plus:ki,PlusCircle:Ai,Minus:Ti,MinusCircle:Ni,Edit:Si,Triangle:Ii,Minimize2:Ei,Circle:ji,BarChart3:De,BarChart:De,List:Ci,ListChecks:wi,GitCompare:vi,LineChart:yi,History:Fe,Timeline:Fe,Trash2:fi,Save:bi,Settings:xi,Sliders:gi,Palette:hi,RotateCcw:mi,Dumbbell:ui,Mic:pi,MicOff:di,Square:li,Wrench:ci,User:oi,LogIn:ni,LogOut:si,UserPlus:ii,Check:ri,CheckCircle:Je,AlertCircle:Ge,AlertTriangle:Ce,AlertOctagon:ai,TriangleAlert:Ce,Info:qe,Loader:we,Loader2:we,ChevronLeft:ti,ChevronRight:ei,ChevronDown:Qr,ChevronUp:Zr,ArrowLeft:Yr,ArrowRight:Kr,ArrowDown:Xr,ArrowUp:Jr,Heart:Gr,HeartPulse:qr,Moon:Vr,Zap:_e,TrendingUp:Wr,Calendar:Ur,CalendarDays:zr,CalendarRange:Hr,Clock:Br,Bookmark:Lr,MessageCircle:Pr,MessageSquare:$r,Bell:Dr,Mail:Fr,Volume2:Or,Send:Mr,Camera:_r,Image:Rr,ShoppingCart:kr,Flag:Ar,FileText:Tr,Download:Nr,Upload:Sr,PlayCircle:Ir,Clapperboard:Er,PlaySquare:jr,Coffee:Cr,Droplet:wr,CookingPot:vr,Wifi:yr,WifiOff:fr,Smartphone:br,Monitor:xr,HelpCircle:gr,Shield:hr,Lock:mr,Globe:ur,Eye:pr,EyeOff:dr,Lightbulb:lr,Construction:cr,Search:or,Star:nr,Copy:sr,RefreshCw:ir,Package:rr,Tag:ar,Sparkles:tr,Filter:er,Database:Qa,Server:Za,Ruler:Ya,Scale:Ka,Maximize2:Xa,Calculator:Ja,Hammer:Ga,Fire:Oe,Flame:Oe,Wind:qa,Cloud:Va,Sun:Wa,TreePine:Ua,Ban:za,Droplets:Ha,Waves:Ba,Radio:La,PhoneCall:Pa,Apple:$a,Milk:Da,Grid3X3:Fa,DollarSign:Oa,CreditCard:Ma,Coins:_a,Syringe:Ra,Bug:ka,Stethoscope:Aa,Microscope:Ta,Biohazard:Na,Cigarette:Sa,Wine:Ia,Pill:Ea,Baby:ja,TestTube:Ca,TestTubes:wa,Play:va,MapPin:ya,Map:fa,MapPinOff:ba,Building:xa,Box:ga,GripHorizontal:ha,TrendingDown:ma,Watch:ua,Bike:pa,Link:da,Link2:la,Unlink:ca,CloudOff:oa,Bluetooth:na,RectangleHorizontal:sa,Cylinder:ia,Cable:ra,Mountain:aa,TreePalm:Me,Palmtree:Me,TreeDeciduous:ta,Footprints:ea,LayoutGrid:Qt,CircleDot:Zt,Weight:Yt,Flower2:Kt,BoxSelect:Xt,Skull:Jt,Shuffle:Gt,CheckCircle2:qt,Armchair:Vt,Sprout:Wt,Trophy:Ut,Medal:zt,Crown:Ht,Award:Bt,ThumbsUp:Lt,ThumbsDown:Pt,Pause:$t,StopCircle:Dt,SkipForward:Ft,Repeat:Ot,Hash:Mt,Sunrise:_t,Sunset:Rt,Brain:kt,Route:At,Gauge:Tt,Move:Nt,Navigation:St,Compass:It,Radar:Et,Webhook:jt,FastForward:Ct,Rewind:wt,Rocket:vt,Zap2:_e,BarChart2:yt,Activity2:Re,GitBranch:ft,Layers:bt,Disc:xt,Type:gt,Hourglass:ht,BadgeCheck:mt,Beef:ke,Drumstick:ke,Fish:ut,Wheat:pt,Salad:dt,BatteryCharging:lt,Dna:ct,Atom:ot,Bolt:nt,XCircle:st};function ds(){const s=navigator.deviceMemory||4,t=navigator.hardwareConcurrency||4,a=window.innerWidth<768||"ontouchstart"in window,r=window.matchMedia("(hover: hover)").matches;let i="medium";return s>=8&&t>=8?i="ultra":s>=6&&t>=6?i="high":s>=4&&t>=4?i="medium":i="low",{performanceLevel:i,supportsHover:r,isMobile:a,memoryGB:s,cores:t}}function ps(s){const t=s.getBoundingClientRect(),a=Math.max(t.width,t.height);return a<200?"small":a<400?"medium":"large"}function us(){switch(ds().performanceLevel){case"low":return"low";case"high":case"ultra":return"high";default:return"medium"}}function Xe(){const s=window.matchMedia("(hover: hover)").matches,t=window.matchMedia("(pointer: fine)").matches;return s&&t}const ne=class ne{constructor(){k(this,"performanceLevel");k(this,"supportsHover");k(this,"isMobile");this.performanceLevel=us(),this.supportsHover=Xe(),this.isMobile=window.innerWidth<768||"ontouchstart"in window}static getInstance(){return ne.instance||(ne.instance=new ne),ne.instance}getEffectClass(t){if(!this.supportsHover||this.isMobile)return null;const a=ps(t);return`${this.performanceLevel}-${a}`}shouldEnableEffect(){return this.supportsHover&&!this.isMobile}getPerformanceLevel(){return this.performanceLevel}};k(ne,"instance");let je=ne;const ms=[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1],hs="0px 0px -10% 0px",gs=()=>typeof window>"u"?!1:window.matchMedia("(prefers-reduced-motion: reduce)").matches,xs=()=>{if(typeof navigator>"u")return!1;const s=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return s&&s.saveData?!0:(navigator.hardwareConcurrency||4)<4},bs=(s={})=>{const{threshold:t=ms,rootMargin:a=hs,enabled:r=!0,intensity:i="medium"}=s,o=E.useRef(null),[l,c]=E.useState({isVisible:!1,scrollProgress:0,centerProximity:0}),d=E.useRef(null),p=E.useRef(0),h=gs(),m=xs(),u=E.useCallback(x=>{const b=x.boundingClientRect,y=window.innerHeight,C=b.top+b.height/2,j=y/2,S=Math.abs(C-j),N=y/2;return Math.max(0,1-S/N)},[]),f=E.useCallback(x=>{const b=performance.now();b-p.current<16||(p.current=b,d.current&&cancelAnimationFrame(d.current),d.current=requestAnimationFrame(()=>{const y=x.isIntersecting,C=x.intersectionRatio,j=u(x);if(c({isVisible:y,scrollProgress:C,centerProximity:j}),o.current){const S=o.current;S.style.setProperty("--scroll-progress",String(C)),S.style.setProperty("--scroll-proximity",String(j));const N=j*C;if(S.style.setProperty("--scroll-tint-intensity",String(N)),!m&&!h){const T=20-j*4;S.style.setProperty("--scroll-blur-amount",`${T}px`);const R=j*.3;S.style.setProperty("--scroll-glow-opacity",String(R))}}}))},[u,m,h]);E.useEffect(()=>{if(!r||h||!o.current)return;const x=o.current,b=new IntersectionObserver(y=>{y.forEach(C=>{f(C)})},{threshold:t,rootMargin:a});return b.observe(x),()=>{d.current&&cancelAnimationFrame(d.current),b.disconnect()}},[r,t,a,f,h]);const g=E.useCallback(()=>{switch(i){case"subtle":return .5;case"intense":return 1.5;default:return 1}},[i]);return{ref:o,state:l,isLowEnd:m,reduceMotion:h,intensityModifier:g()}},ye=()=>typeof window<"u"&&window.matchMedia("(hover: hover) and (pointer: fine)").matches,q=E.forwardRef(({className:s,as:t="div",interactive:a=!0,elevation:r="md",children:i,disabled:o=!1,size:l="base",spotlight:c=!1,sheen:d=!0,scrollReveal:p=!0,scrollRevealIntensity:h="medium",onPointerDown:m,style:u,...f},g)=>{const x=w[t]??w.div,b=Zi(),{glassClick:y}=G(),{isPerformanceMode:C}=X(),j=bs({enabled:p&&!b,intensity:h}),S=E.useRef(null),N=j.ref;E.useEffect(()=>{g&&typeof g=="function"?g(S.current):g&&"current"in g&&(g.current=S.current),N&&(N.current=S.current)},[g,N]);const[T,R]=E.useState(null);E.useEffect(()=>{if(S.current&&Xe()){const O=je.getInstance().getEffectClass(S.current);R(O)}},[]);const $=O=>{!o&&a&&y(),m?.(O)},P=typeof window<"u"&&window.innerWidth<=768,A=typeof window<"u"&&("ontouchstart"in window||navigator.maxTouchPoints>0),M=!b&&!P&&!A&&!C,K=E.useCallback(O=>{if(!a||!ye()||o||!d||P||A||C)return;const V=O.currentTarget,L=V.getBoundingClientRect(),U=(O.clientX-L.left)/L.width,re=(O.clientY-L.top)/L.height;V.style.setProperty("--mx",String(U)),V.style.setProperty("--my",String(re)),V.style.setProperty("--sheen-size","var(--glass-sheen-size)")},[a,o,d,P,A,C]),Y=E.useCallback(O=>{if(!a||!ye()||o||!d||P||A||C)return;O.currentTarget.style.setProperty("--sheen-visible","1")},[a,o,d,P,A,C]),Z=E.useCallback(O=>{if(!a||o||!d||P||A||C)return;const V=O.currentTarget;V.style.removeProperty("--sheen-visible"),V.style.removeProperty("--mx"),V.style.removeProperty("--my")},[a,o,d,P,A,C]);a&&ye();const D={sm:"p-3",base:"p-4",lg:"p-6"},F={sm:"glass-elev-sm",md:"glass-elev-md",lg:"glass-elev-lg"};return e.jsxs(x,{ref:S,onMouseMove:K,onMouseEnter:Y,onMouseLeave:Z,onPointerDown:$,"data-hover-effect":T,"data-scroll-visible":p?j.state.isVisible:void 0,"data-scroll-active":p?j.state.isVisible:void 0,"data-intensity":p?h:void 0,"data-low-end":p?j.isLowEnd:void 0,whileTap:!o&&!b&&!P&&!A&&!C?{scale:.98,opacity:.95,transition:{duration:.08,ease:"easeOut"}}:{},className:ts("glass-base glass-card relative will-transform group","rounded-3xl",p&&"glass-card-scroll-reveal",D[l],F[r],a&&"transform-gpu preserve-3d",a&&!o&&"cursor-pointer glass-focus",o&&"opacity-50 cursor-not-allowed","z-0",s),style:{"--spotlight-opacity":c&&!P&&!A?.6:0,"--glass-sheen-size":P||A?"0px":"420px",position:"relative",isolation:"isolate",...u},...t==="button"?{disabled:o}:{},...f,children:[d&&!P&&!A&&!C&&e.jsx("div",{"aria-hidden":!0,className:"glass-sheen pointer-events-none absolute rounded-[inherit] overflow-hidden",style:{inset:"-1px"}}),e.jsx("div",{className:"relative z-10 pointer-events-auto",children:i})]})});q.displayName="GlassCard";const fs=({toast:s,onDismiss:t})=>{const{id:a,type:r,title:i,message:o,duration:l=4e3}=s;_.useEffect(()=>{if(l<=0)return;const p=setTimeout(()=>{t(a)},l);return()=>clearTimeout(p)},[a,l,t]);const c=()=>{switch(r){case"success":return v.Check;case"error":return v.AlertCircle;case"warning":return v.AlertCircle;default:return v.Info}},d=()=>{switch(r){case"success":return"text-green-400 border-green-500/20 bg-green-500/10";case"error":return"text-red-400 border-red-500/20 bg-red-500/10";case"warning":return"text-yellow-400 border-yellow-500/20 bg-yellow-500/10";default:return"text-blue-400 border-blue-500/20 bg-blue-500/10"}};return e.jsx(w.div,{initial:{opacity:0,y:50,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.95},transition:{type:"spring",stiffness:300,damping:30},className:"pointer-events-auto",children:e.jsx(q,{className:`p-4 ${d()} border`,children:e.jsxs("div",{className:"flex items-start gap-3 visionos-grid-sm",children:[e.jsx(I,{Icon:c(),size:20,className:"mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-white text-visionos-body",children:i}),o&&e.jsx("p",{className:"text-white/70 text-sm mt-1 text-visionos-body",children:o})]}),e.jsx("button",{onClick:()=>t(a),className:"p-1 rounded-glass hover:bg-white/10 transition-colors","aria-label":"Fermer la notification",children:e.jsx(I,{Icon:v.X,size:14,className:"text-white/60"})})]})})})},Ke=E.createContext(void 0),Ye=()=>{const s=E.useContext(Ke);if(!s)throw new Error("useToast must be used within ToastProvider");return s},Cn=({children:s})=>{const[t,a]=E.useState([]),{success:r,error:i,notif:o}=G(),l=E.useCallback(h=>{try{const m=as(),u={...h,id:m,duration:h.duration??4e3};try{h.type==="success"?r():h.type==="error"?i():o()}catch(f){n.error("TOAST_FEEDBACK_ERROR","Toast feedback audio failed",{toastType:h.type,error:f instanceof Error?f.message:"Unknown error",timestamp:new Date().toISOString()})}a(f=>{try{return[...f.slice(-3),u]}catch(g){return n.error("TOAST_STATE_ERROR","Failed to update toast state",{error:g instanceof Error?g.message:"Unknown error",toastId:m,timestamp:new Date().toISOString()}),f}})}catch(m){n.error("TOAST_PROVIDER_ERROR","Complete toast creation failed",{toastType:h.type,toastTitle:h.title,error:m instanceof Error?m.message:"Unknown error",timestamp:new Date().toISOString()})}},[r,i,o]),c=E.useCallback(h=>{a(m=>m.filter(u=>u.id!==h))},[]),d=E.useCallback(()=>{a([])},[]),p={showToast:l,dismissToast:c,clearAll:d};return e.jsxs(Ke.Provider,{value:p,children:[s,e.jsx("div",{className:"fixed top-4 right-4 space-y-2",style:{zIndex:9999},children:e.jsx(H,{children:t.map(h=>e.jsx(fs,{toast:h,onDismiss:c},h.id))})})]})};function ys(s){switch(s){case"ios":return{title:"Installer TwinForge sur iOS",instructions:["Appuyez sur l'icône Partager en bas de l'écran",`Faites défiler et sélectionnez "Sur l'écran d'accueil"`,'Appuyez sur "Ajouter" pour confirmer'],icon:"Smartphone"};case"android":return{title:"Installer TwinForge sur Android",instructions:['Appuyez sur "Installer" dans la bannière',`Ou utilisez le menu ⋮ > "Installer l'application"`,"Confirmez l'installation"],icon:"Smartphone"};case"desktop":return{title:"Installer TwinForge sur Desktop",instructions:["Cliquez sur l'icône d'installation dans la barre d'adresse",'Ou utilisez le menu ⋮ > "Installer TwinForge"',"Confirmez l'installation"],icon:"Monitor"};default:return{title:"Installer TwinForge",instructions:[`Recherchez l'option "Installer" dans votre navigateur`,"Suivez les instructions de votre appareil","Profitez de l'expérience native"],icon:"Download"}}}const jn=({className:s="",variant:t="card",autoShow:a=!0,onInstallSuccess:r,onDismiss:i})=>{const{isInstallable:o,isInstalled:l,platform:c,canShowPrompt:d,showInstallPrompt:p,dismissInstallPrompt:h}=is(),{success:m,click:u}=G(),{showToast:f}=Ye(),[g,x]=E.useState(!1),[b,y]=E.useState(!1),[C,j]=E.useState(!1);if(l||!o||C&&!a)return null;const S=ys(c),N=async()=>{if(!d){y(!0);return}x(!0);try{n.info("PWA_INSTALL_PROMPT","User initiated installation",{platform:c,variant:t,timestamp:new Date().toISOString()}),await p()?(m(),f({type:"success",title:"Installation réussie !",message:"TwinForge a été ajouté à votre écran d'accueil",duration:4e3}),r?.(),n.info("PWA_INSTALL_PROMPT","Installation completed successfully",{platform:c,timestamp:new Date().toISOString()})):f({type:"info",title:"Installation annulée",message:"Vous pouvez installer TwinForge plus tard depuis le menu du navigateur",duration:3e3})}catch($){n.error("PWA_INSTALL_PROMPT","Installation failed",{error:$ instanceof Error?$.message:"Unknown error",platform:c,timestamp:new Date().toISOString()}),f({type:"error",title:"Erreur d'installation",message:"Impossible d'installer l'application. Réessayez plus tard.",duration:4e3})}finally{x(!1)}},T=()=>{u(),j(!0),h(),i?.(),n.info("PWA_INSTALL_PROMPT","Install prompt dismissed",{platform:c,variant:t,timestamp:new Date().toISOString()})},R=()=>{y(!1)};return t==="banner"?e.jsx(w.div,{initial:{opacity:0,y:-50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},className:`fixed top-20 left-4 right-4 z-50 ${s}`,children:e.jsx(q,{className:"p-4",style:{background:`
              radial-gradient(circle at 30% 20%, color-mix(in srgb, var(--brand-primary) 12%, transparent) 0%, transparent 60%),
              var(--glass-opacity)
            `,borderColor:"color-mix(in srgb, var(--brand-primary) 25%, transparent)",backdropFilter:"blur(16px) saturate(150%)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:"color-mix(in srgb, var(--brand-primary) 20%, transparent)",border:"1px solid color-mix(in srgb, var(--brand-primary) 30%, transparent)"},children:e.jsx(I,{Icon:v.Download,size:18,style:{color:"var(--brand-primary)"}})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-semibold text-sm",children:"Installer TwinForge"}),e.jsx("p",{className:"text-white/70 text-xs",children:"Accès rapide depuis votre écran d'accueil"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:N,disabled:g,className:"btn-glass--primary px-4 py-2 text-sm",children:g?"Installation...":"Installer"}),e.jsx("button",{onClick:T,className:"p-2 rounded-full hover:bg-white/10 transition-colors",children:e.jsx(I,{Icon:v.X,size:14,className:"text-white/60"})})]})]})})}):t==="floating"?e.jsx(w.div,{initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:20},className:`fixed bottom-24 right-4 z-40 ${s}`,children:e.jsx("button",{onClick:N,disabled:g,className:"w-14 h-14 rounded-full flex items-center justify-center",style:{background:`
              radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
              linear-gradient(135deg, color-mix(in srgb, var(--brand-primary) 80%, transparent), color-mix(in srgb, var(--brand-accent) 60%, transparent))
            `,border:"2px solid color-mix(in srgb, var(--brand-primary) 60%, transparent)",backdropFilter:"blur(16px) saturate(150%)",boxShadow:`
              0 8px 32px rgba(0, 0, 0, 0.25),
              0 0 20px color-mix(in srgb, var(--brand-primary) 20%, transparent)
            `},title:"Installer TwinForge",children:e.jsx(I,{Icon:g?v.Loader2:v.Download,size:20,className:`text-white ${g?"animate-spin":""}`})})}):e.jsxs(e.Fragment,{children:[e.jsx(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},className:s,children:e.jsx(q,{className:"p-6",style:{background:`
              radial-gradient(circle at 30% 20%, color-mix(in srgb, var(--brand-primary) 12%, transparent) 0%, transparent 60%),
              radial-gradient(circle at 70% 80%, color-mix(in srgb, var(--brand-accent) 8%, transparent) 0%, transparent 50%),
              var(--glass-opacity)
            `,borderColor:"color-mix(in srgb, var(--brand-primary) 25%, transparent)",boxShadow:`
              0 12px 40px rgba(0, 0, 0, 0.25),
              0 0 30px color-mix(in srgb, var(--brand-primary) 15%, transparent),
              inset 0 2px 0 rgba(255, 255, 255, 0.15)
            `},children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15) 0%, transparent 60%),
                  linear-gradient(135deg, color-mix(in srgb, var(--brand-primary) 30%, transparent), color-mix(in srgb, var(--brand-accent) 25%, transparent))
                `,border:"2px solid color-mix(in srgb, var(--brand-primary) 40%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, var(--brand-primary) 30%, transparent)"},children:e.jsx(I,{Icon:v[S.icon],size:20,style:{color:"var(--brand-primary)"}})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-white font-bold text-lg mb-2",children:"Installer TwinForge"}),e.jsx("p",{className:"text-white/70 text-sm mb-4 leading-relaxed",children:"Installez TwinForge sur votre appareil pour un accès rapide et une expérience optimisée."}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx("button",{onClick:N,disabled:g,className:"btn-glass--primary px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[g?e.jsx(I,{Icon:v.Loader2,size:16,className:"animate-spin"}):e.jsx(I,{Icon:v.Download,size:16}),e.jsx("span",{children:g?"Installation...":"Installer"})]})}),e.jsx("button",{onClick:()=>y(!0),className:"btn-glass--secondary-nav px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{Icon:v.Info,size:16}),e.jsx("span",{children:"Instructions"})]})}),e.jsx("button",{onClick:T,className:"btn-glass--secondary-nav px-3 py-2",title:"Fermer",children:e.jsx(I,{Icon:v.X,size:16})})]})]})]})})}),e.jsx(H,{children:b&&e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",style:{background:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(16px)",WebkitBackdropFilter:"blur(16px)"},onClick:$=>{$.target===$.currentTarget&&R()},children:e.jsx(w.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{type:"spring",stiffness:300,damping:30},className:"w-full max-w-md",onClick:$=>$.stopPropagation(),children:e.jsxs(q,{className:"p-6",style:{background:`
                    radial-gradient(circle at 30% 20%, color-mix(in srgb, var(--brand-accent) 12%, transparent) 0%, transparent 60%),
                    var(--glass-opacity)
                  `,borderColor:"color-mix(in srgb, var(--brand-accent) 30%, transparent)",backdropFilter:"blur(24px) saturate(160%)"},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center",style:{background:`
                        radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                        linear-gradient(135deg, color-mix(in srgb, var(--brand-accent) 35%, transparent), color-mix(in srgb, var(--brand-accent) 25%, transparent))
                      `,border:"2px solid color-mix(in srgb, var(--brand-accent) 50%, transparent)",boxShadow:"0 0 30px color-mix(in srgb, var(--brand-accent) 40%, transparent)"},children:e.jsx(I,{Icon:v[S.icon],size:28,style:{color:"var(--brand-accent)"}})}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-3",children:S.title}),e.jsxs("p",{className:"text-white/70 text-sm",children:["Suivez ces étapes pour installer TwinForge sur votre ",c==="ios"?"iPhone/iPad":c==="android"?"appareil Android":"ordinateur"]})]}),e.jsx("div",{className:"space-y-4 mb-6",children:S.instructions.map(($,P)=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",style:{background:"color-mix(in srgb, var(--brand-accent) 20%, transparent)",border:"1px solid color-mix(in srgb, var(--brand-accent) 30%, transparent)",color:"var(--brand-accent)",fontSize:"12px",fontWeight:"bold"},children:P+1}),e.jsx("p",{className:"text-white/80 text-sm leading-relaxed",children:$})]},P))}),e.jsxs("div",{className:"flex gap-3",children:[d&&e.jsx("button",{onClick:N,disabled:g,className:"flex-1 btn-glass--primary py-3",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[g?e.jsx(I,{Icon:v.Loader2,size:16,className:"animate-spin"}):e.jsx(I,{Icon:v.Download,size:16}),e.jsx("span",{children:g?"Installation...":"Installer Maintenant"})]})}),e.jsx("button",{onClick:R,className:"btn-glass--secondary-nav px-4 py-3",children:e.jsx("span",{children:"Fermer"})})]})]})})})})]})},En=({isVisible:s,onUpdate:t,onDismiss:a,updateInfo:r})=>{const{success:i,click:o}=G(),[l,c]=E.useState(!1),d=async()=>{c(!0);try{n.info("PWA_UPDATE","User initiated app update",{version:r?.version,isRequired:r?.isRequired,timestamp:new Date().toISOString()}),i(),await t(),n.info("PWA_UPDATE","App update completed",{timestamp:new Date().toISOString()})}catch(h){n.error("PWA_UPDATE","App update failed",{error:h instanceof Error?h.message:"Unknown error",timestamp:new Date().toISOString()})}finally{c(!1)}},p=()=>{o(),a(),n.info("PWA_UPDATE","Update notification dismissed",{version:r?.version,timestamp:new Date().toISOString()})};return e.jsx(H,{children:s&&e.jsx(w.div,{initial:{opacity:0,y:50,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:50,scale:.95},className:"fixed bottom-4 left-4 right-4 z-50 max-w-md mx-auto",children:e.jsx(q,{className:"p-5",style:{background:`
                radial-gradient(circle at 30% 20%, color-mix(in srgb, var(--brand-accent) 15%, transparent) 0%, transparent 60%),
                radial-gradient(circle at 70% 80%, color-mix(in srgb, var(--brand-primary) 10%, transparent) 0%, transparent 50%),
                var(--glass-opacity)
              `,borderColor:"color-mix(in srgb, var(--brand-accent) 35%, transparent)",boxShadow:`
                0 16px 48px rgba(0, 0, 0, 0.3),
                0 0 40px color-mix(in srgb, var(--brand-accent) 25%, transparent),
                inset 0 2px 0 rgba(255, 255, 255, 0.2)
              `,backdropFilter:"blur(24px) saturate(170%)"},children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, var(--brand-accent) 40%, transparent), color-mix(in srgb, var(--brand-accent) 30%, transparent))
                  `,border:"2px solid color-mix(in srgb, var(--brand-accent) 50%, transparent)",boxShadow:"0 0 25px color-mix(in srgb, var(--brand-accent) 40%, transparent)"},children:e.jsx(w.div,{animate:{scale:[1,1.1,1],rotate:[0,5,-5,0]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:e.jsx(I,{Icon:v.Download,size:20,style:{color:"var(--brand-accent)"}})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-white font-bold text-lg mb-2",children:"Nouvelle Version Disponible"}),e.jsx("p",{className:"text-white/80 text-sm mb-3 leading-relaxed",children:"Une mise à jour de TwinForge est disponible avec de nouvelles fonctionnalités et améliorations."}),r?.features&&r.features.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-white/60 text-xs mb-2",children:"Nouveautés :"}),e.jsx("div",{className:"space-y-1",children:r.features.slice(0,3).map((h,m)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-1 rounded-full bg-cyan-400"}),e.jsx("span",{className:"text-white/70 text-xs",children:h})]},m))})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:d,disabled:l,className:"btn-glass--primary px-4 py-2 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[l?e.jsx(I,{Icon:v.Loader2,size:14,className:"animate-spin"}):e.jsx(I,{Icon:v.Download,size:14}),e.jsx("span",{children:l?"Mise à jour...":"Mettre à jour"})]})}),!r?.isRequired&&e.jsx("button",{onClick:p,className:"btn-glass--secondary-nav px-3 py-2 text-sm",children:"Plus tard"})]})]})]})})})})},J=_.forwardRef(({children:s,as:t="div",className:a="",whileHover:r,whileTap:i,animate:o,initial:l,exit:c,variants:d,transition:p,...h},m)=>{const{mode:u,isPerformanceMode:f}=X();if(f){const x=t,b=[a,r&&"motion-hover-mobile",i&&"motion-tap-mobile",o&&typeof o=="object"&&"animate"in o&&"motion-fade-in-mobile"].filter(Boolean).join(" ");return e.jsx(x,{ref:m,className:b,...h,children:s})}if(u==="balanced"){const x=w[t],b=p?{...p,duration:p.duration?p.duration*.6:.3}:{duration:.3,ease:"easeOut"};return e.jsx(x,{ref:m,className:a,whileHover:r,whileTap:i,animate:o,initial:l,exit:c,variants:d,transition:b,...h,children:s})}const g=w[t];return e.jsx(g,{ref:m,className:a,whileHover:r,whileTap:i,animate:o,initial:l,exit:c,variants:d,transition:p,...h,children:s})});J.displayName="ConditionalMotion";const In=({children:s,mode:t,initial:a=!0,...r})=>{const{mode:i,isPerformanceMode:o}=X();return o?e.jsx(e.Fragment,{children:s}):e.jsx(H,{mode:t,initial:a,...r,children:s})},Ze=({size:s=32,variant:t="normal",className:a="",withGlow:r=!0,customColor:i})=>{const l=(()=>{if(i){const m=(u=>{const f=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(u);return f?{r:parseInt(f[1],16),g:parseInt(f[2],16),b:parseInt(f[3],16)}:{r:255,g:107,b:53}})(i);return{gradientStart:i,gradientMid:i,gradientEnd:i,borderColor:`rgba(${m.r}, ${m.g}, ${m.b}, 0.5)`,glowColor:`rgba(${m.r}, ${m.g}, ${m.b}, 0.4)`}}switch(t){case"critical":return{gradientStart:"#EF4444",gradientMid:"#F87171",gradientEnd:"#FCA5A5",borderColor:"rgba(239, 68, 68, 0.5)",glowColor:"rgba(239, 68, 68, 0.4)"};case"warning":return{gradientStart:"#F59E0B",gradientMid:"#FBBF24",gradientEnd:"#FCD34D",borderColor:"rgba(245, 158, 11, 0.5)",glowColor:"rgba(245, 158, 11, 0.4)"};case"success":return{gradientStart:"#10B981",gradientMid:"#34D399",gradientEnd:"#6EE7B7",borderColor:"rgba(16, 185, 129, 0.5)",glowColor:"rgba(16, 185, 129, 0.4)"};default:return{gradientStart:"#FF6B35",gradientMid:"#F7931E",gradientEnd:"#FDC830",borderColor:"rgba(247, 147, 30, 0.5)",glowColor:"rgba(253, 200, 48, 0.4)"}}})(),c=100,d=c/2,p=42;return e.jsxs("svg",{width:s,height:s,viewBox:`0 0 ${c} ${c}`,xmlns:"http://www.w3.org/2000/svg",className:a,style:{filter:r?`drop-shadow(0 0 ${s/4}px ${l.glowColor})`:"none"},children:[e.jsxs("defs",{children:[e.jsx("style",{children:`
            @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@800&display=swap');
            .token-text {
              font-family: 'Montserrat', sans-serif;
              font-weight: 800;
              font-style: normal;
              text-anchor: middle;
              dominant-baseline: central;
            }
          `}),e.jsxs("linearGradient",{id:`tokenGradient-${t}-${i||"default"}`,x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:l.gradientStart}),e.jsx("stop",{offset:"50%",stopColor:l.gradientMid}),e.jsx("stop",{offset:"100%",stopColor:l.gradientEnd})]}),e.jsxs("linearGradient",{id:`borderGradient-${t}-${i||"default"}`,x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:l.gradientStart,stopOpacity:"0.8"}),e.jsx("stop",{offset:"50%",stopColor:l.gradientMid,stopOpacity:"0.9"}),e.jsx("stop",{offset:"100%",stopColor:l.gradientEnd,stopOpacity:"0.8"})]}),e.jsxs("filter",{id:`innerGlow-${t}-${i||"default"}`,children:[e.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("radialGradient",{id:`shine-${t}-${i||"default"}`,cx:"30%",cy:"30%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgba(255, 255, 255, 0.3)"}),e.jsx("stop",{offset:"60%",stopColor:"rgba(255, 255, 255, 0.1)"}),e.jsx("stop",{offset:"100%",stopColor:"rgba(255, 255, 255, 0)"})]})]}),e.jsx("circle",{cx:d,cy:d,r:p,fill:`url(#shine-${t}-${i||"default"})`,opacity:"0.6"}),e.jsx("circle",{cx:d,cy:d,r:p,fill:"rgba(0, 0, 0, 0.25)",stroke:`url(#borderGradient-${t}-${i||"default"})`,strokeWidth:"3",filter:`url(#innerGlow-${t}-${i||"default"})`}),e.jsx("text",{x:d,y:d+2,className:"token-text",fontSize:"48",fill:`url(#tokenGradient-${t}-${i||"default"})`,filter:`url(#innerGlow-${t}-${i||"default"})`,children:"T"})]})};class ge{static async getTokenBalance(){try{const{data:{user:t}}=await B.auth.getUser();if(!t)return null;const{data:a,error:r}=await B.from("user_token_balance").select("available_tokens, last_monthly_reset").eq("user_id",t.id).single();return r?(console.error("Error fetching token balance:",r),null):{balance:a.available_tokens,lastResetAt:a.last_monthly_reset}}catch(t){return console.error("Unexpected error fetching token balance:",t),null}}static async getTokenTransactions(t=50){try{const{data:{user:a}}=await B.auth.getUser();if(!a)return[];const{data:r,error:i}=await B.from("token_transactions").select("*").eq("user_id",a.id).order("created_at",{ascending:!1}).limit(t);return i?(console.error("Error fetching token transactions:",i),[]):r.map(o=>({id:o.id,userId:o.user_id,transactionType:o.transaction_type,amount:o.token_amount,balanceAfter:o.balance_after,source:o.metadata?.source||null,edgeFunctionName:o.edge_function_name,operationType:o.operation_type,openaiModel:o.openai_model_used,openaiInputTokens:o.openai_tokens_input,openaiOutputTokens:o.openai_tokens_output,openaiCostUsd:o.openai_cost_usd,metadata:o.metadata,createdAt:o.created_at}))}catch(a){return console.error("Unexpected error fetching token transactions:",a),[]}}static async getPricingConfig(){try{const{data:t,error:a}=await B.from("token_pricing_config").select("subscription_plans, token_packs").eq("is_active",!0).single();return a?(console.error("Error fetching pricing config:",a),null):{subscriptionPlans:t.subscription_plans,tokenPacks:t.token_packs}}catch(t){return console.error("Unexpected error fetching pricing config:",t),null}}static async getUserSubscription(){try{const{data:{user:t}}=await B.auth.getUser();if(!t)return null;const{data:a,error:r}=await B.from("user_subscriptions").select("*").eq("user_id",t.id).single();return r?(r.code==="PGRST116"||console.error("Error fetching user subscription:",r),null):{id:a.id,userId:a.user_id,status:a.status,planType:a.plan_type,stripeCustomerId:a.stripe_customer_id,stripeSubscriptionId:a.stripe_subscription_id,currentPeriodStart:a.current_period_start,currentPeriodEnd:a.current_period_end,cancelAtPeriodEnd:a.cancel_at_period_end,createdAt:a.created_at,updatedAt:a.updated_at}}catch(t){return console.error("Unexpected error fetching user subscription:",t),null}}static async createCheckoutSession(t,a,r){try{const{data:{session:i}}=await B.auth.getSession();if(!i)throw new Error("Not authenticated");const o=await fetch("https://kwipydbtjagypocpvbwn.supabase.co/functions/v1/create-checkout-session",{method:"POST",headers:{Authorization:`Bearer ${i.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({mode:t,plan_type:a,token_pack_id:r,success_url:`${window.location.origin}/settings?tab=subscription&success=true`,cancel_url:`${window.location.origin}/settings?tab=subscription&canceled=true`})});if(!o.ok){const c=await o.json();return console.error("Error creating checkout session:",c),null}return{url:(await o.json()).url}}catch(i){return console.error("Unexpected error creating checkout session:",i),null}}static async createPortalSession(){try{const{data:{session:t}}=await B.auth.getSession();if(!t)throw new Error("Not authenticated");const a=await fetch("https://kwipydbtjagypocpvbwn.supabase.co/functions/v1/create-portal-session",{method:"POST",headers:{Authorization:`Bearer ${t.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({return_url:`${window.location.origin}/settings?tab=subscription`})});if(!a.ok){const i=await a.json();return console.error("Error creating portal session:",i),null}return{url:(await a.json()).url}}catch(t){return console.error("Unexpected error creating portal session:",t),null}}static formatTokenAmount(t){return t==null||isNaN(t)?"0":t>=1e3?`${(t/1e3).toFixed(1)}k`:t.toString()}static formatCurrency(t){return new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(t)}static getOperationTypeLabel(t){return{"chat-completion":"Assistant conversationnel","image-generation":"Génération d'illustration","audio-transcription":"Transcription audio","voice-realtime":"Coach vocal en temps réel","body-scan-analysis":"Analyse corporelle","meal-analysis":"Analyse nutritionnelle","training-analysis":"Analyse d'entraînement","recipe-generation":"Génération de recette","insight-generation":"Génération d'insights"}[t]||t}static subscribeToPricingConfig(t){const a=B.channel("pricing-config-changes").on("postgres_changes",{event:"*",schema:"public",table:"token_pricing_config"},async()=>{const r=await this.getPricingConfig();t(r)}).subscribe();return()=>{B.removeChannel(a)}}static subscribeToTokenBalance(t,a){const r=B.channel(`token-balance-${t}`).on("postgres_changes",{event:"*",schema:"public",table:"user_token_balance",filter:`user_id=eq.${t}`},async()=>{const i=await this.getTokenBalance();a(i)}).subscribe();return()=>{B.removeChannel(r)}}}const Sn=({onDismiss:s})=>{const[t,a]=E.useState(!1),[r,i]=E.useState(15e3);E.useEffect(()=>{o()},[]);const o=async()=>{try{const{data:{user:c}}=await B.auth.getUser();if(!c)return;if(localStorage.getItem(`welcome_tokens_shown_${c.id}`)){n.info("WELCOME_TOKENS","User has already seen welcome notification",{userId:c.id});return}const{data:p}=await B.from("token_transactions").select("*").eq("user_id",c.id).eq("transaction_type","bonus").or("metadata->>reason.eq.welcome_bonus,metadata->>reason.eq.backfill_welcome_bonus").order("created_at",{ascending:!1}).limit(1);if(p&&p.length>0){const h=p[0],m=new Date(h.created_at),f=(new Date().getTime()-m.getTime())/(1e3*60);f<5&&(i(h.token_amount),a(!0),n.info("WELCOME_TOKENS","Showing welcome tokens notification",{userId:c.id,tokenAmount:h.token_amount,transactionAge:f}),setTimeout(()=>{l()},1e4))}}catch(c){n.error("WELCOME_TOKENS","Error checking for welcome tokens",{error:c instanceof Error?c.message:"Unknown error"})}},l=async()=>{a(!1);const{data:{user:c}}=await B.auth.getUser();c&&(localStorage.setItem(`welcome_tokens_shown_${c.id}`,"true"),n.info("WELCOME_TOKENS","Welcome notification dismissed",{userId:c.id})),s&&s()};return t?e.jsx(J,{initial:{opacity:0,y:-20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.95},transition:{duration:.3,ease:[.4,0,.2,1]},className:"fixed top-20 left-1/2 -translate-x-1/2 z-[9999] max-w-md w-full mx-4",children:e.jsxs("div",{className:"glass-card-premium p-6 rounded-2xl shadow-2xl border border-white/20",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(J,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:260,damping:20,delay:.1},children:e.jsx(Ze,{size:48,variant:"success",withGlow:!0})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-1",children:"Bienvenue sur TwinForgeFit !"}),e.jsxs("p",{className:"text-sm text-white/80 mb-3",children:["Vous avez reçu ",e.jsxs("span",{className:"font-bold text-emerald-400",children:[ge.formatTokenAmount(r)," tokens"]})," pour commencer votre aventure. Utilisez-les pour analyser vos repas, créer des programmes d'entraînement personnalisés et bien plus encore."]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-white/60",children:[e.jsx(I,{Icon:v.Info,size:14,className:"flex-shrink-0"}),e.jsx("span",{children:"Vos tokens se rechargent chaque mois avec votre abonnement"})]})]}),e.jsx("button",{onClick:l,className:"flex-shrink-0 p-1 rounded-lg hover:bg-white/10 transition-colors","aria-label":"Fermer",children:e.jsx(I,{Icon:v.X,size:20,className:"text-white/60 hover:text-white"})})]}),e.jsx(J,{initial:{scaleX:1},animate:{scaleX:0},transition:{duration:10,ease:"linear"},className:"absolute bottom-0 left-0 h-1 bg-gradient-to-r from-emerald-500 to-cyan-500 rounded-b-2xl origin-left",style:{width:"100%"}})]})}):null},vs={inventory:{colors:{primary:"#06B6D4",secondary:"#0891B2",glow:"rgba(6, 182, 212, 0.4)"},icon:"Package",defaultTitle:"Analyse de votre inventaire",defaultSubtitle:"Traitement des données en cours..."},recipes:{colors:{primary:"#EC4899",secondary:"#F472B6",glow:"rgba(236, 72, 153, 0.4)"},icon:"ChefHat",defaultTitle:"Création de recettes",defaultSubtitle:"La Forge Spatiale travaille..."},plan:{colors:{primary:"#8B5CF6",secondary:"#A78BFA",glow:"rgba(139, 92, 246, 0.4)"},icon:"Calendar",defaultTitle:"Génération du plan hebdomadaire",defaultSubtitle:"Optimisation nutritionnelle en cours..."},shopping:{colors:{primary:"#10B981",secondary:"#34D399",glow:"rgba(16, 185, 129, 0.4)"},icon:"ShoppingCart",defaultTitle:"Génération de la liste de courses",defaultSubtitle:"Organisation des achats..."},training:{colors:{primary:"#10B981",secondary:"#34D399",glow:"rgba(16, 185, 129, 0.4)"},icon:"Activity",defaultTitle:"Ton Coach Prépare Ton Plan...",defaultSubtitle:"Analyse de tes capacités et génération d'un programme personnalisé"},default:{colors:{primary:"#60A5FA",secondary:"#93C5FD",glow:"rgba(96, 165, 250, 0.4)"},icon:"Sparkles",defaultTitle:"Chargement",defaultSubtitle:"Traitement en cours..."}},Nn=({variant:s="default",title:t,subtitle:a,progress:r,showProgressBar:i=!0,showSteps:o=!1,onCancel:l,showCancelButton:c=!1,elapsedTime:d=0,customColor:p})=>{const h=vs[s],m=v[h.icon],u=p||h.colors.primary,f=p?`color-mix(in srgb, ${p} 80%, white)`:h.colors.secondary,g=p?`color-mix(in srgb, ${p} 40%, transparent)`:h.colors.glow,x=y=>{const C=Math.floor(y/60),j=y%60;return C>0?`${C}m ${j}s`:`${j}s`},b=(()=>{if(r==null)return 0;const y=Number(r);return isNaN(y)?0:Math.max(0,Math.min(100,y))})();return e.jsx(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.5},className:"loader-optimized",children:e.jsxs(q,{className:"p-8 text-center relative loader-isolate",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, ${u} 15%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, color-mix(in srgb, ${f} 10%, transparent) 0%, transparent 60%),
            rgba(255, 255, 255, 0.06)
          `,borderColor:`color-mix(in srgb, ${u} 30%, transparent)`,backdropFilter:"blur(24px) saturate(180%)",boxShadow:`
            0 12px 48px rgba(0, 0, 0, 0.3),
            0 0 40px color-mix(in srgb, ${u} 20%, transparent),
            0 0 80px color-mix(in srgb, ${u} 10%, transparent),
            inset 0 2px 0 rgba(255, 255, 255, 0.2),
            inset 0 -2px 0 rgba(0, 0, 0, 0.1)
          `,borderRadius:"1.5rem",overflow:"hidden"},children:[[...Array(12)].map((y,C)=>e.jsx("div",{className:"loader-particle",style:{color:C%3===0?f:u,top:`${15+Math.random()*70}%`,left:`${5+C*8}%`,"--tx":`${(Math.random()-.5)*120}px`,"--ty":`${-60-Math.random()*120}px`,"--duration":`${3.5+Math.random()*2.5}s`,"--delay":`${C*.25}s`,width:C%4===0?"6px":"4px",height:C%4===0?"6px":"4px"}},C)),e.jsxs("div",{className:"space-y-6 relative z-10",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(w.div,{className:"w-32 h-32 rounded-full flex items-center justify-center loader-breathing-border",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.3) 0%, transparent 60%),
                  radial-gradient(circle at 70% 70%, color-mix(in srgb, ${f} 15%, transparent) 0%, transparent 70%),
                  linear-gradient(135deg, color-mix(in srgb, ${u} 45%, transparent), color-mix(in srgb, ${u} 30%, transparent))
                `,border:`3px solid color-mix(in srgb, ${u} 70%, transparent)`,color:u,boxShadow:`
                  0 0 50px ${g},
                  0 0 25px ${g},
                  0 0 80px color-mix(in srgb, ${u} 20%, transparent),
                  inset 0 0 25px color-mix(in srgb, ${u} 18%, transparent),
                  inset 0 2px 0 rgba(255, 255, 255, 0.3)
                `},animate:{scale:[1,1.08,1],rotate:[0,180,360],boxShadow:[`0 0 50px ${g}, 0 0 25px ${g}, 0 0 80px color-mix(in srgb, ${u} 20%, transparent), inset 0 0 25px color-mix(in srgb, ${u} 18%, transparent), inset 0 2px 0 rgba(255, 255, 255, 0.3)`,`0 0 70px ${g}, 0 0 35px ${g}, 0 0 100px color-mix(in srgb, ${u} 30%, transparent), inset 0 0 35px color-mix(in srgb, ${u} 28%, transparent), inset 0 2px 0 rgba(255, 255, 255, 0.4)`,`0 0 50px ${g}, 0 0 25px ${g}, 0 0 80px color-mix(in srgb, ${u} 20%, transparent), inset 0 0 25px color-mix(in srgb, ${u} 18%, transparent), inset 0 2px 0 rgba(255, 255, 255, 0.3)`]},transition:{duration:3,repeat:1/0,ease:"easeInOut"},children:e.jsx(I,{Icon:m,size:64,className:"text-white loader-icon-pulse",motionAnimate:{scale:[1,1.1,1]},motionTransition:{repeat:1/0,duration:2,ease:"easeInOut"},style:{filter:`drop-shadow(0 0 16px ${g}) drop-shadow(0 0 8px white)`}})})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w.h3,{className:"text-2xl font-bold text-white",style:{textShadow:`0 0 24px ${g}, 0 0 48px color-mix(in srgb, ${u} 35%, transparent), 0 2px 4px rgba(0, 0, 0, 0.3)`},animate:{opacity:[.95,1,.95]},transition:{duration:2.5,repeat:1/0,ease:"easeInOut"},children:t||h.defaultTitle}),e.jsx(w.p,{className:"text-white/85 text-lg",style:{textShadow:`0 0 12px color-mix(in srgb, ${f} 35%, transparent), 0 1px 2px rgba(0, 0, 0, 0.2)`},animate:{opacity:[.9,1,.9]},transition:{duration:2,repeat:1/0,ease:"easeInOut",delay:.3},children:a||h.defaultSubtitle})]}),e.jsx("div",{className:"flex justify-center gap-2",children:[0,1,2].map(y=>e.jsx("div",{className:"w-3 h-3 bg-white/80 rounded-full loader-dot",style:{"--delay":`${y*.2}s`}},y))}),i&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-center",children:e.jsxs("span",{className:"text-4xl font-bold text-white",style:{textShadow:`0 0 20px ${g}`},children:[Math.round(b),"%"]})}),e.jsx("div",{className:"w-full max-w-xs mx-auto h-2 bg-white/10 rounded-full overflow-hidden relative",children:e.jsx(w.div,{className:"h-full rounded-full relative",style:{background:`linear-gradient(90deg, ${u}, ${f})`,width:`${b}%`,boxShadow:`0 0 12px ${g}`},initial:{width:0},animate:{width:`${b}%`},transition:{duration:.4,ease:"easeOut"},children:b<95&&e.jsx("div",{className:"loader-progress-shimmer"})})})]}),d>0&&e.jsxs(w.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"text-white/60 text-sm",children:["Temps écoulé: ",x(d)]}),c&&l&&e.jsx(w.button,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},onClick:l,className:"mt-4 px-6 py-2.5 rounded-xl text-white/80 text-sm font-medium transition-all",style:{background:"rgba(255, 255, 255, 0.08)",border:"2px solid rgba(255, 255, 255, 0.15)",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.2)"},whileHover:{background:"rgba(255, 255, 255, 0.12)",scale:1.02,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.25)"},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[e.jsx(I,{Icon:v.X,size:16}),e.jsx("span",{children:"Annuler"})]})})]})]})})},ue=({to:s,children:t,prefetch:a=!0,className:r="",onMouseEnter:i,onPointerDown:o,...l})=>{_.useEffect(()=>{n.trace("LINK","Component rendered for route",{to:s,prefetch:a})},[s,a]),Xi();const{session:c}=oe(),{click:d}=G();ae();const p=async u=>{i?.(u)},h=u=>{if(n.trace("LINK","PointerDown captured for route",{to:s,eventType:u.type}),n.trace("LINK","PointerDown event triggered",{to:s,isSidebarLink:!!u.currentTarget.closest(".sidebar-item")}),u.currentTarget.closest(".sidebar.item")){const{sidebarClick:g}=G();n.trace("LINK","Triggering sidebar click sound"),g()}else n.trace("LINK","Triggering regular click sound"),d();o?.(u)},m=u=>{if(n.trace("LINK","Click captured",{to:s,eventType:u.type}),n.trace("LINK","Click event triggered",{to:s,currentPath:window.location.pathname,defaultPrevented:u.defaultPrevented}),u.defaultPrevented){n.debug("🔍 [Link] Navigation blocked by router guard, respecting block");return}n.trace("LINK","Proceeding with navigation to",{to:s})};return _.useEffect(()=>(n.trace("LINK","Component mounted for route",{to:s}),()=>{n.trace("LINK","Component unmounted for route",{to:s})}),[s]),e.jsx(Ki,{to:s,className:`${r} inline-flex items-center`,onMouseEnter:p,onPointerDown:h,onClick:m,onMouseDown:u=>{n.trace("LINK","MouseDown captured",{to:s,button:u.button})},onTouchStart:u=>{n.trace("LINK","TouchStart captured",{to:s,touches:u.touches.length})},...l,children:t})};function ws(){return[{title:"",type:"primary",items:[{to:"/",icon:"Home",label:"Coeur de la Forge",subtitle:"Tableau de Bord",isPrimary:!0,circuitColor:"#FDC830",actionLabel:void 0}]},{title:"",type:"twin",items:[{to:"/avatar",icon:"User",label:"Mon Twin",subtitle:"Avatar 3D",isTwin:!0,circuitColor:"#A855F7",tabs:["Scanner","Avatar","Projection","Insights","Historique"]}]},{title:"Alimentation",type:"forge-category",items:[{to:"/meals",icon:"Utensils",label:"Forge Nutritionnelle",subtitle:"Scanner de Repas",isForge:!0,circuitColor:"#10B981",tabs:["Scanner","Insights","Progression","Historique"],subItems:[{to:"/meals#daily",icon:"ScanLine",label:"Scanner de Repas & Code",isPrimarySubMenu:!0},{to:"/meals#insights",icon:"TrendingUp",label:"Insights"},{to:"/meals#progression",icon:"BarChart3",label:"Progression"},{to:"/meals#history",icon:"History",label:"Historique"}]},{to:"/fridge",icon:"ChefHat",label:"Forge Culinaire",subtitle:"Scanner de Frigo",isForge:!0,circuitColor:"#EC4899",tabs:["Scanner","Inventaire","Recettes","Plan","Courses"],subItems:[{to:"/fridge#scanner",icon:"ScanLine",label:"Scanner de Frigo",isPrimarySubMenu:!0},{to:"/fridge#inventaire",icon:"Refrigerator",label:"Inventaire"},{to:"/fridge#recipes",icon:"ChefHat",label:"Recettes"},{to:"/fridge#plan",icon:"Calendar",label:"Plan"},{to:"/fridge#courses",icon:"ShoppingCart",label:"Courses"}]}]},{title:"Activité",type:"forge-category",items:[{to:"/activity",icon:"Activity",label:"Forge Énergétique",subtitle:"Tracker d'Activités",isForge:!0,circuitColor:"#3B82F6",tabs:["Tracker","Insights","Progression","Historique"],subItems:[{to:"/activity#daily",icon:"Activity",label:"Tracker d'Activités",isPrimarySubMenu:!0},{to:"/activity#insights",icon:"BarChart3",label:"Insights",color:"#10B981"},{to:"/activity#progression",icon:"TrendingUp",label:"Progression",color:"#10B981"},{to:"/activity#history",icon:"History",label:"Historique"}]},{to:"/training",icon:"Dumbbell",label:"Forge Corporelle",subtitle:"Coaching live",isForge:!0,circuitColor:"#18E3FF",tabs:["Coaching","Conseils","Progression","Records","Historique"],subItems:[{to:"/training#aujourd hui",icon:"Home",label:"Coaching Live",isPrimarySubMenu:!0},{to:"/training#conseils",icon:"Lightbulb",label:"Conseils"},{to:"/training#progression",icon:"TrendingUp",label:"Progression"},{to:"/training#records",icon:"Trophy",label:"Records"},{to:"/training#historique",icon:"History",label:"Historique"}]}]},{title:"Santé",type:"forge-category",items:[{to:"/fasting",icon:"Timer",label:"Forge du Temps",subtitle:"Jeûne Intermittent",isForge:!0,circuitColor:"#F59E0B",tabs:["Tracker","Insights","Progression","Historique"],subItems:[{to:"/fasting#daily",icon:"Timer",label:"Tracker de Jeûne",isPrimarySubMenu:!0},{to:"/fasting#insights",icon:"TrendingUp",label:"Insights",color:"#10B981"},{to:"/fasting#progression",icon:"BarChart3",label:"Progression"},{to:"/fasting#history",icon:"History",label:"Historique"}]},{to:"/vital",icon:"HeartPulse",label:"Forge Vitale",subtitle:"Médecine Préventive",isForge:!0,circuitColor:"#EF4444",tabs:["Dossier","Analyses","Suivi","Prévention"],subItems:[{to:"/vital#dossier",icon:"FileText",label:"Dossier",isPrimarySubMenu:!0},{to:"/vital#analyses",icon:"Activity",label:"Analyses"},{to:"/vital#suivi",icon:"TrendingUp",label:"Suivi"},{to:"/vital#prevention",icon:"Shield",label:"Prévention"}]}]}]}const Cs=()=>{const[s,t]=E.useState(null),[a,r]=E.useState(!0),[i,o]=E.useState(0),l=ae(),{sidebarClick:c}=G(),{close:d}=xe(),p=E.useCallback(async(b=!1)=>{try{const y=await ge.getTokenBalance();if(y)t(y),o(0),b&&n.info("TOKEN_BALANCE_WIDGET","Token balance loaded successfully after retry",{retryCount:i,balance:y.balance});else if(i<3){const C=Math.min(1e3*Math.pow(2,i),5e3);n.warn("TOKEN_BALANCE_WIDGET","Token balance not found, scheduling retry",{retryCount:i+1,delayMs:C}),setTimeout(()=>{o(j=>j+1),p(!0)},C)}else n.error("TOKEN_BALANCE_WIDGET","Failed to load token balance after retries",{maxRetriesReached:!0})}catch(y){n.error("TOKEN_BALANCE_WIDGET","Error loading token balance",{error:y instanceof Error?y.message:"Unknown error",retryCount:i})}finally{r(!1)}},[i]);E.useEffect(()=>{p();const b=async()=>{const{data:{user:C}}=await B.auth.getUser();return C?.id||""};let y;return b().then(C=>{C&&(y=ge.subscribeToTokenBalance(C,j=>{j&&(t(j),o(0),n.info("TOKEN_BALANCE_WIDGET","Token balance updated via subscription",{balance:j.balance}))}))}),()=>{y&&y()}},[p]);const h=()=>{c(),d(),l("/settings?tab=account")};if(a||!s)return null;const u=s.balance<50?"critical":s.balance<200?"warning":"success",f=s.balance<200,g=s.balance<50,x=()=>{const b="sidebar-token-widget";return g?`${b} sidebar-token-widget--critical`:f?`${b} sidebar-token-widget--low`:b};return e.jsx("button",{onClick:h,className:x(),children:e.jsxs("div",{className:"sidebar-token-widget-content",children:[e.jsx("div",{className:"sidebar-token-widget-icon",children:e.jsx(Ze,{size:24,variant:u,withGlow:f})}),e.jsxs("div",{className:"sidebar-token-widget-info",children:[e.jsx("div",{className:"sidebar-token-widget-balance",children:ge.formatTokenAmount(s.balance)}),e.jsx("div",{className:"sidebar-token-widget-label",children:f?"Recharger mes tokens":"Tokens disponibles"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[f&&e.jsx("div",{className:"sidebar-token-widget-alert",children:e.jsx(I,{Icon:v.AlertCircle,size:12,className:"opacity-70",style:{color:g?"#EF4444":"#F59E0B"}})}),e.jsx("div",{className:"sidebar-token-widget-arrow",children:e.jsx(I,{Icon:v.ChevronRight,size:12,className:"opacity-40"})})]})]})})},Qe=_.memo(({title:s,children:t,type:a})=>{const r=a==="forge-category",i=s==="Alimentation"||s==="Activité"||s==="Santé";return e.jsxs("div",{className:r?"mt-4":"",children:[s&&e.jsxs(e.Fragment,{children:[i&&e.jsx("div",{className:"sidebar-category-separator"}),e.jsx("h3",{className:"sidebar-section-title text-white/50 text-xs uppercase tracking-wider font-semibold mb-1 px-1",children:s})]}),e.jsx("div",{className:"space-y-0.5",children:t})]})});Qe.displayName="Section";const js=_.memo(()=>{const{isOpen:s,close:t}=xe(),a=s("mobileDrawer"),r=pe(),i=ae(),o=_.useRef(null),{profile:l}=oe(),[c,d]=_.useState({}),p=E.useCallback(f=>r.pathname===f,[r.pathname]);E.useEffect(()=>{if(a){const f=document.body.style.overflow,g=document.body.style.position;return document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%",document.body.style.height="100%",()=>{document.body.style.overflow=f,document.body.style.position=g,document.body.style.width="",document.body.style.height=""}}},[a]);const h=E.useMemo(()=>ws(),[]);_.useEffect(()=>{const f=r.pathname,g={};h.forEach(x=>{x.items.forEach(b=>{b.subItems&&b.subItems.length>0&&(b.subItems.some(C=>{const j=C.to.split("#")[0];return f===j})?g[b.to]=!0:g[b.to]=!1)})}),d(g)},[r.pathname,h]);const m=E.useCallback(f=>{d(g=>{if(g[f])return{...g,[f]:!1};const b={};return Object.keys(g).forEach(y=>{b[y]=!1}),b[f]=!0,b})},[]),u=E.useCallback(async()=>{try{await B.auth.signOut(),oe.getState().setSession(null),oe.getState().setProfile(null),t(),i("/",{replace:!0})}catch(f){console.error("Logout error:",f),t(),i("/",{replace:!0})}},[i,t]);return e.jsx(H,{children:a&&e.jsxs(e.Fragment,{children:[e.jsx(w.div,{className:"fixed inset-0 bg-black/60 backdrop-blur-sm",style:{zIndex:be.BACKDROP},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},onClick:()=>{n.debug("MOBILE_DRAWER","Backdrop clicked - closing drawer"),t()}}),e.jsx(w.nav,{ref:o,className:"mobile-drawer fixed top-0 left-0 h-full w-[85vw] max-w-[340px] overflow-y-auto",style:{zIndex:be.MOBILE_DRAWER,scrollbarWidth:"none",msOverflowStyle:"none"},initial:{x:"-100%"},animate:{x:0},exit:{x:"-100%"},transition:{type:"spring",stiffness:300,damping:30},role:"navigation","aria-label":"Navigation mobile",children:e.jsxs("div",{className:"py-3 pl-3 pr-2.5 space-y-2",children:[h.map((f,g)=>e.jsxs(_.Fragment,{children:[e.jsx(Qe,{title:f.title,type:f.type,children:f.items.map(x=>{const b=x.subItems&&x.subItems.length>0,y=b&&x.subItems.some(j=>{const S=j.to.split("#")[0],N=j.to.split("#")[1],T=r.pathname,R=r.hash.replace("#","")||"daily";return T===S&&(!N||R===N)}),C=j=>{b?(j.preventDefault(),m(x.to)):t()};return e.jsxs("div",{className:"relative sidebar-nav-item-container",children:[e.jsxs(ue,{to:x.to,className:`
                            sidebar-item
                            ${x.isPrimary?"sidebar-item--primary":""}
                            ${x.isTwin?"sidebar-item--twin":""}
                            ${x.isForge?"sidebar-item--forge":""}
                            ${b?"sidebar-item--with-submenu":""}
                            group focus-ring
                            ${p(x.to)||y?"text-white shadow-sm":"text-white/70 hover:text-white"}
                          `,onClick:C,style:{"--item-circuit-color":x.circuitColor},children:[e.jsx("div",{className:`sidebar-item-icon-container ${p(x.to)||y?"sidebar-item-icon-container--active":""}`,children:e.jsx(I,{Icon:v[x.icon],size:16,className:`sidebar-item-icon ${p(x.to)||y?"":"opacity-80 group-hover:opacity-100"}`,color:p(x.to)||y?x.circuitColor:void 0,style:p(x.to)||y?{color:x.circuitColor,filter:`drop-shadow(0 0 8px ${x.circuitColor}60)`}:void 0})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:`sidebar-item-label font-medium text-xs truncate ${p(x.to)||y?"text-white":"text-white/82"}`,children:x.label}),e.jsx("div",{className:`sidebar-item-subtitle text-xxs truncate mt-0 ${p(x.to)||y?"text-white/70":"text-white/50"}`,children:x.subtitle})]})]}),b&&e.jsx("div",{className:`sidebar-submenu ${c[x.to]?"sidebar-submenu--expanded":""}`,role:"group","aria-label":`Sous-menu ${x.label}`,children:e.jsx("div",{className:"sidebar-submenu-inner",children:x.subItems.map(j=>{const S=v[j.icon],N=j.to.split("#")[0],T=j.to.split("#")[1],R=r.pathname,$=r.hash.replace("#","")||"daily",P=R===N&&(!T||$===T),A=j.isPrimarySubMenu&&R===N;return e.jsxs(ue,{to:j.to,className:`
                                      sidebar-submenu-item
                                      ${j.isPrimarySubMenu?"sidebar-submenu-item--primary":"sidebar-submenu-item--secondary"}
                                      ${P||A?"sidebar-submenu-item--active":""}
                                      focus-ring
                                    `,onClick:()=>t(),"aria-current":P?"page":void 0,style:{"--item-circuit-color":j.color||x.circuitColor},children:[e.jsx("div",{className:`sidebar-submenu-item-icon-container ${P||A?"sidebar-submenu-item-icon-container--active":""}`,children:e.jsx(I,{Icon:S,size:j.isPrimarySubMenu?16:14,className:"sidebar-submenu-item-icon"})}),e.jsx("span",{className:"sidebar-submenu-item-label",children:j.label})]},j.to)})})})]},x.to)})}),f.type==="primary"&&e.jsx("div",{className:"sidebar-primary-separator","aria-hidden":"true"})]},g)),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"sidebar-category-separator mb-3"}),e.jsx("div",{className:"px-1.5 mb-1.5",children:e.jsx("h3",{className:"text-white/50 text-xs uppercase tracking-wider font-semibold",children:"Compte"})}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("div",{className:"mb-2 px-0.5",children:e.jsx(Cs,{})}),e.jsxs(ue,{to:"/profile",className:`
                      sidebar-item group focus-ring
                      ${p("/profile")?"text-white shadow-sm":"text-white/70 hover:text-white"}
                    `,onClick:()=>t(),style:{"--item-circuit-color":"#FDC830"},children:[e.jsx("div",{className:`sidebar-item-icon-container ${p("/profile")?"sidebar-item-icon-container--active":""}`,children:e.jsx(I,{Icon:v.User,size:16,className:`sidebar-item-icon ${p("/profile")?"":"opacity-80 group-hover:opacity-100"}`,style:p("/profile")?{color:"#FDC830",filter:"drop-shadow(0 0 8px rgba(253, 200, 48, 0.6))"}:void 0})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:`sidebar-item-label font-medium text-xs truncate ${p("/profile")?"text-white":"text-white/82"}`,children:"Mon Profil"}),e.jsx("div",{className:`sidebar-item-subtitle text-xxs truncate mt-0 ${p("/profile")?"text-white/70":"text-white/50"}`,children:"Infos personnelles"})]})]}),e.jsxs(ue,{to:"/settings",className:`
                      sidebar-item group focus-ring
                      ${p("/settings")?"text-white shadow-sm":"text-white/70 hover:text-white"}
                    `,onClick:()=>t(),style:{"--item-circuit-color":"#FDC830"},children:[e.jsx("div",{className:`sidebar-item-icon-container ${p("/settings")?"sidebar-item-icon-container--active":""}`,children:e.jsx(I,{Icon:v.Settings,size:16,className:`sidebar-item-icon ${p("/settings")?"":"opacity-80 group-hover:opacity-100"}`,style:p("/settings")?{color:"#FDC830",filter:"drop-shadow(0 0 8px rgba(253, 200, 48, 0.6))"}:void 0})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:`sidebar-item-label font-medium text-xs truncate ${p("/settings")?"text-white":"text-white/82"}`,children:"Paramètres"}),e.jsx("div",{className:`sidebar-item-subtitle text-xxs truncate mt-0 ${p("/settings")?"text-white/70":"text-white/50"}`,children:"Configuration"})]})]})]}),e.jsx("div",{className:"sidebar-category-separator my-2"}),e.jsxs("button",{onClick:u,className:"sidebar-item group focus-ring text-white/70 hover:text-white w-full",style:{"--item-circuit-color":"#FF6B35",textAlign:"left"},children:[e.jsx("div",{className:"sidebar-item-icon-container",style:{background:"linear-gradient(135deg, rgba(255, 107, 53, 0.2), rgba(247, 147, 30, 0.15))",border:"1.5px solid rgba(255, 107, 53, 0.35)",boxShadow:"0 0 16px rgba(255, 107, 53, 0.18), inset 0 1px 0 rgba(255, 255, 255, 0.15)"},children:e.jsx(I,{Icon:v.LogOut,size:16,className:"sidebar-item-icon opacity-80 group-hover:opacity-100",style:{color:"#FF6B35",filter:"drop-shadow(0 0 6px rgba(255, 107, 53, 0.4))"}})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"sidebar-item-label font-medium text-xs truncate text-white/82 text-left",children:"Déconnexion"}),e.jsx("div",{className:"sidebar-item-subtitle text-xxs truncate mt-0 text-white/50 text-left",children:"Se déconnecter"})]})]})]})]})})]})})});js.displayName="MobileDrawer";const Es=({width:s=85,height:t=70,className:a="",isHovered:r=!1})=>{const{isPerformanceMode:i}=X(),o=_.useId(),l=`forgeGrad-${o}`,c=`forgeGradHover-${o}`,d=`hammerGlow-${o}`;return e.jsxs("svg",{viewBox:"0 0 85 70",width:s,height:t,className:a,xmlns:"http://www.w3.org/2000/svg",style:{filter:i?"none":r?"drop-shadow(0 0 12px rgba(253, 200, 48, 0.5))":"drop-shadow(0 0 6px rgba(247, 147, 30, 0.3))"},children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:l,x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",style:{stopColor:"#FF6B35",stopOpacity:1}}),e.jsx("stop",{offset:"50%",style:{stopColor:"#F7931E",stopOpacity:1}}),e.jsx("stop",{offset:"100%",style:{stopColor:"#FDC830",stopOpacity:1}})]}),e.jsxs("linearGradient",{id:c,x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",style:{stopColor:"#FF8C00",stopOpacity:1}}),e.jsx("stop",{offset:"50%",style:{stopColor:"#FFA500",stopOpacity:1}}),e.jsx("stop",{offset:"100%",style:{stopColor:"#FFD700",stopOpacity:1}})]}),e.jsxs("filter",{id:d,children:[e.jsx("feGaussianBlur",{stdDeviation:"2.5",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),e.jsx("path",{d:"M 20 10 L 85 10 L 85 28 L 65 28 L 65 70 L 40 70 L 40 28 L 20 28 Z",fill:i?`url(#${l})`:r?`url(#${c})`:`url(#${l})`,filter:i?"none":`url(#${d})`,stroke:"rgba(15, 23, 42, 0.8)",strokeWidth:"2.5"}),e.jsx("path",{d:"M 23 13 L 82 13 L 82 25 L 65 25 L 65 67 L 40 67 L 40 25 L 23 25 Z",fill:"none",stroke:"rgba(255, 255, 255, 0.3)",strokeWidth:"1.5",opacity:"0.6"}),e.jsx("circle",{cx:"80",cy:"18",r:"3",fill:"#FDC830",opacity:r?1:.9}),e.jsx("circle",{cx:"25",cy:"16",r:"2.5",fill:"#FF6B35",opacity:r?.9:.8}),e.jsx("circle",{cx:"75",cy:"24",r:"2",fill:"#FDC830",opacity:r?.8:.7}),e.jsx("circle",{cx:"52",cy:"12",r:"2.5",fill:"#F7931E",opacity:r?.9:.75})]})},Tn=({variant:s="desktop",isHovered:t=!1,className:a=""})=>{const r=s==="desktop",{mode:i}=X(),o=i==="high-performance",l="#FF8C42",c="linear-gradient(135deg, #FF6B35 0%, #F7931E 50%, #FDC830 100%)";return r?e.jsx("div",{className:`flex items-center ${a}`,style:{transition:"none",height:"100%"},children:e.jsxs("div",{style:{display:"inline-flex",alignItems:"baseline",gap:"0"},children:[e.jsx("span",{style:{fontFamily:"'Montserrat', sans-serif",fontSize:"25px",fontWeight:800,letterSpacing:"1.2px",color:"#E5E7EB",lineHeight:1,textTransform:"uppercase",filter:"none",transition:"none"},children:"TWIN"}),e.jsx("span",{style:{fontFamily:"'Montserrat', sans-serif",fontSize:"25px",fontWeight:800,letterSpacing:"1.2px",color:o?l:"transparent",background:o?"none":c,WebkitBackgroundClip:o?"unset":"text",WebkitTextFillColor:o?l:"transparent",backgroundClip:o?"unset":"text",lineHeight:1,textTransform:"uppercase",filter:"none",transition:"none"},children:"FØRGE"})]})}):e.jsxs("div",{className:`flex items-center ${a}`,style:{transition:"none",gap:"8px",position:"relative"},children:[e.jsx("div",{style:{position:"relative",display:"flex",alignItems:"center"},children:e.jsx(Es,{width:42,height:50,isHovered:t})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2px",alignItems:"flex-start",justifyContent:"center",transform:"translateY(2px)"},children:[e.jsx("span",{style:{fontFamily:"'Montserrat', sans-serif",fontSize:"15px",fontWeight:800,letterSpacing:"0.8px",color:"#E5E7EB",lineHeight:1,textTransform:"uppercase",filter:"none",transition:"none"},children:"TWIN"}),e.jsx("span",{style:{fontFamily:"'Montserrat', sans-serif",fontSize:"15px",fontWeight:800,letterSpacing:"0.8px",color:o?l:"transparent",background:o?"none":c,WebkitBackgroundClip:o?"unset":"text",WebkitTextFillColor:o?l:"transparent",backgroundClip:o?"unset":"text",lineHeight:1,textTransform:"uppercase",filter:"none",transition:"none"},children:"FØRGE"})]})]})},An=({className:s="",showOnHome:t=!1})=>{const a=ae(),r=pe(),{click:i}=G(),o=_.useMemo(()=>r.pathname==="/"&&!t?!1:r.pathname!=="/",[r.pathname,t]),l=_.useCallback(()=>{try{i(),n.debug("BACK_BUTTON","Back navigation triggered",{currentPath:r.pathname,timestamp:new Date().toISOString()}),a(-1)}catch(c){n.warn("BACK_BUTTON","Back navigation failed, redirecting to home",{error:c instanceof Error?c.message:"Unknown error",currentPath:r.pathname}),a("/")}},[a,r.pathname,i]);return o?e.jsx(w.button,{onClick:l,className:s,style:{width:"48px",height:"48px",borderRadius:"50%",position:"relative",overflow:"visible",padding:0,display:"flex",alignItems:"center",justifyContent:"center",background:`
          radial-gradient(circle at 30% 30%, rgba(255,255,255,0.18) 0%, transparent 50%),
          rgba(255, 255, 255, 0.10)
        `,border:"1px solid rgba(255,255,255,0.2)",backdropFilter:"blur(16px) saturate(140%)",WebkitBackdropFilter:"blur(16px) saturate(140%)",boxShadow:`
          0 8px 24px rgba(0, 0, 0, 0.25),
          0 2px 12px rgba(0, 0, 0, 0.18),
          inset 0 1px 0 rgba(255, 255, 255, 0.12)
        `,transition:"transform 280ms cubic-bezier(0.25, 0.1, 0.25, 1), background 180ms cubic-bezier(0.16, 1, 0.3, 1), box-shadow 180ms cubic-bezier(0.16, 1, 0.3, 1), border-color 180ms cubic-bezier(0.16, 1, 0.3, 1)",transform:"translateZ(0)",willChange:"transform, filter",cursor:"pointer"},onMouseEnter:c=>{window.matchMedia("(hover: hover)").matches&&(c.currentTarget.style.background=`
            radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
            rgba(255, 255, 255, 0.10)
          `,c.currentTarget.style.borderColor="rgba(255,255,255,0.3)",c.currentTarget.style.boxShadow=`
            0 8px 24px rgba(0, 0, 0, 0.25),
            0 2px 12px rgba(0, 0, 0, 0.18),
            inset 0 1px 0 rgba(255, 255, 255, 0.12),
            0 0 20px rgba(255,255,255,0.15),
            0 4px 16px rgba(0,0,0,0.2)
          `)},onMouseLeave:c=>{window.matchMedia("(hover: hover)").matches&&(c.currentTarget.style.background=`
            radial-gradient(circle at 30% 30%, rgba(255,255,255,0.18) 0%, transparent 50%),
            rgba(255, 255, 255, 0.10)
          `,c.currentTarget.style.borderColor="rgba(255,255,255,0.2)",c.currentTarget.style.boxShadow=`
            0 8px 24px rgba(0, 0, 0, 0.25),
            0 2px 12px rgba(0, 0, 0, 0.18),
            inset 0 1px 0 rgba(255, 255, 255, 0.12)
          `)},whileHover:{scale:1.08},whileTap:{scale:.95},initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},transition:{duration:.3,ease:[.25,.1,.25,1]},"aria-label":"Retour à la page précédente",title:"Retour",children:e.jsx(I,{Icon:v.ArrowLeft,size:18,style:{color:"rgba(255,255,255,0.9)",filter:"drop-shadow(0 0 8px rgba(24, 227, 255, 0.3))"},"aria-hidden":"true"})}):null},ie={home:"var(--color-plasma-cyan)",track:"var(--color-plasma-cyan)",fasting:"var(--circuit-fasting)",activity:"var(--circuit-activity)",training:"var(--circuit-training)",emotions:"var(--circuit-emotions)",videos:"var(--circuit-videos)",health:"var(--circuit-health)",preferences:"var(--circuit-fridge)","coach-videos":"var(--circuit-videos)","coach-clients":"var(--brand-accent)","coach-branding":"var(--brand-accent)"};function Is(s){return s.replace(/^\//,"").replace(/\/.*$/,"")}function kn(s){if(s==="/")return ie.home;if(s.startsWith("/coach/")){const a=s.replace("/coach/","");return ie[`coach-${a}`]||ie["coach-clients"]}const t=Is(s);return s.includes("coach-")?ie[t]||ie["coach-clients"]:ie[t]||ie.home}const Rn=()=>{const{isOpen:s,title:t,message:a,processName:r,dirtyFields:i,confirmExit:o,cancelExit:l,saveAndExit:c,onSaveAndExit:d}=Qi(),{click:p,error:h,success:m}=G(),[u,f]=_.useState(!1);_.useEffect(()=>{s&&console.log("🚨 GLOBAL_EXIT_MODAL: Rendering modal immediately",{isOpen:s,title:t,processName:r,timestamp:new Date().toISOString(),bodyExists:!!document.body,modalRootExists:!!document.getElementById("modal-root")})},[s,t,r]);const g=()=>{console.log("🚨 GLOBAL_EXIT_MODAL: Confirm clicked",{timestamp:new Date().toISOString()}),h(),o()},x=()=>{console.log("🚨 GLOBAL_EXIT_MODAL: Cancel clicked",{timestamp:new Date().toISOString()}),p(),l()},b=async()=>{console.log("🚨 GLOBAL_EXIT_MODAL: Save and exit clicked",{timestamp:new Date().toISOString()}),f(!0);try{await c(),m()}catch(y){console.error("🚨 GLOBAL_EXIT_MODAL: Save failed",y),h()}finally{f(!1)}};return _.useEffect(()=>{if(!s)return;const y=C=>{C.key==="Escape"&&x()};return document.addEventListener("keydown",y),()=>document.removeEventListener("keydown",y)},[s]),fe.createPortal(e.jsx(H,{children:s&&e.jsx("div",{className:"global-exit-modal",style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:999999,background:"rgba(0, 0, 0, 0.9)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},onClick:y=>{y.target===y.currentTarget&&x()},role:"dialog","aria-modal":"true","aria-labelledby":"global-exit-modal-title",children:e.jsx(w.div,{initial:{opacity:0,scale:.8,y:50},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:50},transition:{type:"spring",stiffness:400,damping:25,mass:.8},className:"p-4 md:p-8 text-center",style:{width:"100%",maxWidth:"28rem",position:"relative",zIndex:1e6},onClick:y=>y.stopPropagation(),children:e.jsxs(q,{className:"p-8 text-center",style:{background:`
                  radial-gradient(circle at 30% 20%, color-mix(in srgb, #EF4444 20%, transparent) 0%, transparent 60%),
                  radial-gradient(circle at 70% 80%, color-mix(in srgb, #F59E0B 15%, transparent) 0%, transparent 50%),
                  linear-gradient(145deg, rgba(255,255,255,0.15), rgba(255,255,255,0.10)),
                  rgba(11, 14, 23, 0.95)
                `,borderColor:"color-mix(in srgb, #EF4444 40%, transparent)",boxShadow:`
                  0 25px 80px rgba(0, 0, 0, 0.6),
                  0 0 60px color-mix(in srgb, #EF4444 30%, transparent),
                  0 0 120px color-mix(in srgb, #F59E0B 20%, transparent),
                  inset 0 3px 0 rgba(255, 255, 255, 0.3),
                  inset 0 -3px 0 rgba(0, 0, 0, 0.2)
                `,backdropFilter:"blur(32px) saturate(180%)",WebkitBackdropFilter:"blur(32px) saturate(180%)",position:"relative",zIndex:1000001},children:[e.jsx("div",{className:"mb-4 md:mb-6",children:e.jsx("div",{className:"w-28 h-28 md:w-32 md:h-32 mx-auto rounded-full flex items-center justify-center breathing-icon",style:{background:`
                      radial-gradient(circle at 30% 30%, rgba(255,255,255,0.3) 0%, transparent 60%),
                      radial-gradient(circle at 70% 70%, color-mix(in srgb, #EF4444 25%, transparent) 0%, transparent 50%),
                      linear-gradient(135deg, color-mix(in srgb, #EF4444 50%, transparent), color-mix(in srgb, #F59E0B 40%, transparent))
                    `,border:"4px solid color-mix(in srgb, #EF4444 80%, transparent)",boxShadow:`
                      0 0 50px color-mix(in srgb, #EF4444 80%, transparent),
                      0 0 100px color-mix(in srgb, #EF4444 60%, transparent),
                      0 0 150px color-mix(in srgb, #F59E0B 50%, transparent),
                      inset 0 4px 0 rgba(255,255,255,0.6),
                      inset 0 -3px 0 rgba(0,0,0,0.3)
                    `,backdropFilter:"blur(24px) saturate(180%)",WebkitBackdropFilter:"blur(24px) saturate(180%)"},children:e.jsx(I,{Icon:v.AlertTriangle,size:window.innerWidth<768?64:72,style:{color:"#EF4444",filter:`
                        drop-shadow(0 0 16px color-mix(in srgb, #EF4444 100%, transparent))
                        drop-shadow(0 0 32px color-mix(in srgb, #EF4444 80%, transparent))
                        drop-shadow(0 0 48px color-mix(in srgb, #F59E0B 60%, transparent))
                      `},variant:"pure"})})}),e.jsxs("div",{className:"space-y-3 md:space-y-4 mb-6 md:mb-8",children:[e.jsx("h2",{id:"global-exit-modal-title",className:"text-xl md:text-3xl font-bold text-white leading-tight",children:t}),e.jsx("p",{className:"text-white/90 text-sm md:text-lg leading-relaxed max-w-sm mx-auto px-2",children:a}),e.jsxs("div",{className:"inline-flex items-center gap-2 md:gap-3 px-4 md:px-6 py-2 md:py-3 rounded-full",style:{background:"color-mix(in srgb, #F59E0B 20%, transparent)",border:"2px solid color-mix(in srgb, #F59E0B 40%, transparent)",backdropFilter:"blur(16px) saturate(140%)"},children:[e.jsx("div",{className:"w-2 h-2 md:w-3 md:h-3 rounded-full bg-orange-400 animate-pulse"}),e.jsxs("span",{className:"text-orange-300 text-sm md:text-base font-bold",children:[r," Actif"]})]}),i&&i.length>0&&e.jsxs("div",{className:"mt-4 p-4 rounded-xl",style:{background:"color-mix(in srgb, #3B82F6 15%, transparent)",border:"2px solid color-mix(in srgb, #3B82F6 30%, transparent)",backdropFilter:"blur(16px)"},children:[e.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[e.jsx(I,{Icon:v.AlertCircle,size:16,className:"text-blue-400 mt-0.5"}),e.jsx("h4",{className:"text-blue-300 font-semibold text-sm",children:"Champs non sauvegardés :"})]}),e.jsx("div",{className:"space-y-2 text-left",children:i.map((y,C)=>e.jsxs("div",{className:"text-blue-200 text-sm",children:[e.jsx("span",{className:"font-medium text-blue-300",children:y.section}),y.fields&&y.fields.length>0&&e.jsxs("span",{className:"text-blue-200/80",children:[" : ",y.fields.join(", ")]})]},C))})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-3 md:gap-4 justify-center",children:[d&&e.jsx("button",{onClick:b,disabled:u,className:"w-full md:w-auto px-6 md:px-8 py-3 md:py-4 text-base md:text-xl font-bold rounded-full relative overflow-hidden",style:{background:`linear-gradient(135deg,
                        color-mix(in srgb, #3B82F6 85%, transparent),
                        color-mix(in srgb, #60A5FA 70%, transparent)
                      )`,border:"3px solid color-mix(in srgb, #3B82F6 70%, transparent)",boxShadow:`
                        0 16px 50px color-mix(in srgb, #3B82F6 50%, transparent),
                        0 0 80px color-mix(in srgb, #3B82F6 40%, transparent),
                        inset 0 4px 0 rgba(255,255,255,0.5)
                      `,backdropFilter:"blur(24px) saturate(170%)",color:"#fff",transition:"all 0.2s ease",opacity:u?.6:1,cursor:u?"not-allowed":"pointer"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(I,{Icon:u?v.Loader2:v.Save,size:window.innerWidth<768?18:24,className:u?"text-white animate-spin":"text-white"}),e.jsx("span",{children:u?"Sauvegarde...":"Sauvegarder et Quitter"})]})}),e.jsx("button",{onClick:g,disabled:u,className:"w-full md:w-auto px-6 md:px-8 py-3 md:py-4 text-base md:text-xl font-bold rounded-full relative overflow-hidden",style:{background:`linear-gradient(135deg, 
                      color-mix(in srgb, #EF4444 85%, transparent), 
                      color-mix(in srgb, #F59E0B 70%, transparent)
                    )`,border:"3px solid color-mix(in srgb, #EF4444 70%, transparent)",boxShadow:`
                      0 16px 50px color-mix(in srgb, #EF4444 50%, transparent),
                      0 0 80px color-mix(in srgb, #EF4444 40%, transparent),
                      inset 0 4px 0 rgba(255,255,255,0.5)
                    `,backdropFilter:"blur(24px) saturate(170%)",color:"#fff",transition:"all 0.2s ease",opacity:u?.5:1,cursor:u?"not-allowed":"pointer"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(I,{Icon:v.LogOut,size:window.innerWidth<768?18:24,className:"text-white"}),e.jsx("span",{children:"Quitter"})]})}),e.jsx("button",{onClick:x,disabled:u,className:"w-full md:w-auto px-6 md:px-8 py-3 md:py-4 text-base md:text-xl font-bold rounded-full",style:{background:`linear-gradient(135deg, 
                      color-mix(in srgb, #22C55E 80%, transparent), 
                      color-mix(in srgb, #10B981 60%, transparent)
                    )`,border:"3px solid color-mix(in srgb, #22C55E 70%, transparent)",boxShadow:`
                      0 16px 50px color-mix(in srgb, #22C55E 50%, transparent),
                      0 0 80px color-mix(in srgb, #22C55E 40%, transparent),
                      inset 0 4px 0 rgba(255,255,255,0.5)
                    `,backdropFilter:"blur(24px) saturate(170%)",color:"#fff",opacity:u?.5:1,cursor:u?"not-allowed":"pointer"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(I,{Icon:v.ArrowLeft,size:window.innerWidth<768?18:24,className:"text-white"}),e.jsx("span",{children:"Continuer"})]})})]})]})})})}),document.body)},Ss=({content:s,title:t,examples:a=[],learnMoreUrl:r,placement:i="top",children:o,delay:l=300,maxWidth:c=320})=>{const[d,p]=E.useState(!1),[h,m]=E.useState({top:0,left:0}),u=E.useRef(null),f=E.useRef(null),g=E.useRef(),x=()=>{g.current=setTimeout(()=>{p(!0)},l)},b=()=>{g.current&&clearTimeout(g.current),p(!1)};E.useEffect(()=>{if(d&&u.current&&f.current){const C=u.current.getBoundingClientRect(),j=f.current.getBoundingClientRect();let S=0,N=0;switch(i){case"top":S=C.top-j.height-8,N=C.left+(C.width-j.width)/2;break;case"bottom":S=C.bottom+8,N=C.left+(C.width-j.width)/2;break;case"left":S=C.top+(C.height-j.height)/2,N=C.left-j.width-8;break;case"right":S=C.top+(C.height-j.height)/2,N=C.right+8;break}const T=8;S=Math.max(T,Math.min(S,window.innerHeight-j.height-T)),N=Math.max(T,Math.min(N,window.innerWidth-j.width-T)),m({top:S,left:N})}},[d,i]);const y=e.jsx(H,{children:d&&e.jsx(w.div,{ref:f,initial:{opacity:0,scale:.95,y:i==="top"?10:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:i==="top"?10:-10},transition:{duration:.2,ease:"easeOut"},style:{position:"fixed",top:h.top,left:h.left,zIndex:9999,maxWidth:c,pointerEvents:"none"},children:e.jsxs(q,{className:"p-4 shadow-2xl",style:{background:"rgba(20, 20, 30, 0.95)",borderColor:"rgba(255, 255, 255, 0.15)",backdropFilter:"blur(20px) saturate(180%)",boxShadow:`
                0 20px 60px rgba(0, 0, 0, 0.5),
                0 0 30px rgba(255, 255, 255, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.1)
              `},children:[t&&e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(I,{Icon:v.Info,size:16,className:"text-blue-400"}),e.jsx("h4",{className:"text-white font-semibold text-sm",children:t})]}),e.jsx("div",{className:"text-white/80 text-sm leading-relaxed mb-3",children:s}),a.length>0&&e.jsxs("div",{className:"mt-3 p-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx(I,{Icon:v.Lightbulb,size:14,className:"text-yellow-400"}),e.jsx("span",{className:"text-yellow-300 text-xs font-medium",children:"Exemples"})]}),e.jsx("ul",{className:"space-y-1",children:a.map((C,j)=>e.jsxs("li",{className:"text-white/70 text-xs flex items-start gap-2",children:[e.jsx("span",{className:"text-yellow-400 mt-0.5",children:"•"}),e.jsx("span",{children:C})]},j))})]}),r&&e.jsxs("a",{href:r,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1.5 mt-3 text-blue-400 hover:text-blue-300 text-xs font-medium transition-colors pointer-events-auto",children:[e.jsx("span",{children:"En savoir plus"}),e.jsx(I,{Icon:v.ExternalLink,size:12})]}),e.jsx("div",{className:"absolute w-3 h-3 bg-inherit border-inherit",style:{[i==="top"?"bottom":i==="bottom"?"top":i==="left"?"right":"left"]:-6,[i==="top"||i==="bottom"?"left":"top"]:"50%",transform:"translate(-50%, 0) rotate(45deg)",borderWidth:i==="top"?"0 1px 1px 0":i==="bottom"?"1px 0 0 1px":i==="left"?"1px 1px 0 0":"0 0 1px 1px"}})]})})});return e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:u,onMouseEnter:x,onMouseLeave:b,onFocus:x,onBlur:b,style:{display:"inline-block"},children:o}),typeof document<"u"&&fe.createPortal(y,document.body)]})},Le="twinforge-unified-notifications",Ns=3,Ts=30,me={"step1-welcome":{type:"contextual",message:"Salut ! Je suis là si tu as besoin 👋",mode:"general",priority:2,addToHistory:!1,autoHideDelay:3e3},"step2-adjust":{type:"step2-alert",message:"Ton coach t'attend pour ajuster ta séance !",mode:"training",priority:10,addToHistory:!1,autoHideDelay:5e3},"training-intro":{type:"contextual",message:"Prêt pour ta séance ? Clique pour commencer !",mode:"training",priority:3,addToHistory:!1,autoHideDelay:3e3},"nutrition-intro":{type:"contextual",message:"Un conseil nutrition ? Je suis disponible !",mode:"nutrition",priority:3,addToHistory:!1,autoHideDelay:3e3},"fasting-intro":{type:"contextual",message:"Ton coach jeûne est là pour t'accompagner !",mode:"fasting",priority:3,addToHistory:!1,autoHideDelay:3e3}},Be={appearance:2e3,step2Appearance:1e3};class As{constructor(){k(this,"persistence",{});k(this,"activeNotificationId",null);k(this,"scheduledTimeout",null);k(this,"hideTimeout",null);k(this,"notificationQueue",[]);this.loadPersistence()}loadPersistence(){try{const t=localStorage.getItem(Le);t&&(this.persistence=JSON.parse(t))}catch(t){n.warn("UNIFIED_NOTIFICATION","Failed to load persistence",{error:t}),this.persistence={}}}savePersistence(){try{localStorage.setItem(Le,JSON.stringify(this.persistence))}catch(t){n.warn("UNIFIED_NOTIFICATION","Failed to save persistence",{error:t})}}isInCooldown(t){const a=this.persistence[t];if(!a?.cooldownUntil)return!1;const r=new Date(a.cooldownUntil);return new Date<r}hasReachedMaxViews(t){return(this.persistence[t]?.viewCount||0)>=Ns}shouldShow(t){const{isOpen:a}=de.getState();return a?(n.debug("UNIFIED_NOTIFICATION","Chat is open, skipping notification",{notificationId:t}),!1):this.activeNotificationId===t?(n.debug("UNIFIED_NOTIFICATION","Notification already active",{notificationId:t}),!1):this.isInCooldown(t)?(n.debug("UNIFIED_NOTIFICATION","Notification in cooldown",{notificationId:t}),!1):this.hasReachedMaxViews(t)?(n.debug("UNIFIED_NOTIFICATION","Notification reached max views",{notificationId:t,viewCount:this.persistence[t]?.viewCount}),!1):!0}markAsViewed(t){const a=new Date,r=new Date(a.getTime()+Ts*60*1e3);this.persistence[t]?(this.persistence[t].viewCount+=1,this.persistence[t].lastSeenAt=a.toISOString(),this.persistence[t].cooldownUntil=r.toISOString()):this.persistence[t]={viewCount:1,firstSeenAt:a.toISOString(),lastSeenAt:a.toISOString(),cooldownUntil:r.toISOString()},this.savePersistence(),n.debug("UNIFIED_NOTIFICATION","Notification marked as viewed",{notificationId:t,viewCount:this.persistence[t].viewCount,cooldownUntil:r.toISOString()})}clearTimeouts(){this.scheduledTimeout&&(clearTimeout(this.scheduledTimeout),this.scheduledTimeout=null),this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null)}showNotification(t){const a=me[t];if(!a){n.error("UNIFIED_NOTIFICATION","Unknown notification ID",{notificationId:t});return}({...a});const{showNotification:r,addMessage:i}=de.getState();r({id:t,message:a.message,mode:a.mode,autoHideDelay:a.autoHideDelay}),this.activeNotificationId=t,a.addToHistory&&i({role:"coach",type:"text",content:a.message}),this.markAsViewed(t),n.info("UNIFIED_NOTIFICATION","Notification shown",{notificationId:t,type:a.type,priority:a.priority,addedToHistory:a.addToHistory}),a.autoHideDelay&&(this.hideTimeout=setTimeout(()=>{this.hideNotification(t)},a.autoHideDelay))}scheduleNotification(t,a=!1){if(!this.shouldShow(t))return;this.clearTimeouts();const r=me[t],i=a||r.type==="step2-alert"?Be.step2Appearance:Be.appearance;this.scheduledTimeout=setTimeout(()=>{this.showNotification(t)},i),n.debug("UNIFIED_NOTIFICATION","Notification scheduled",{notificationId:t,delayMs:i,immediate:a})}hideNotification(t){const{currentNotification:a,hideNotification:r}=de.getState();if(a){if(t&&a.id!==t){n.debug("UNIFIED_NOTIFICATION","Notification ID mismatch, skipping hide",{requested:t,current:a.id});return}r(),this.activeNotificationId=null,this.clearTimeouts(),n.debug("UNIFIED_NOTIFICATION","Notification hidden",{notificationId:a.id}),this.processQueue()}}processQueue(){if(this.notificationQueue.length===0||this.activeNotificationId!==null)return;const t=this.notificationQueue.shift();t&&this.scheduleNotification(t,!0)}queueNotification(t){this.shouldShow(t)&&(this.notificationQueue.includes(t)||(this.notificationQueue.push(t),this.notificationQueue.sort((a,r)=>{const i=me[a].priority;return me[r].priority-i}),n.debug("UNIFIED_NOTIFICATION","Notification queued",{notificationId:t,queueLength:this.notificationQueue.length})),this.activeNotificationId===null&&this.processQueue())}cancelScheduled(){this.clearTimeouts(),n.debug("UNIFIED_NOTIFICATION","Scheduled notification cancelled")}clearQueue(){this.notificationQueue=[],this.clearTimeouts(),n.debug("UNIFIED_NOTIFICATION","Notification queue cleared")}resetNotification(t){t?delete this.persistence[t]:this.persistence={},this.savePersistence(),n.info("UNIFIED_NOTIFICATION","Notification reset",{notificationId:t||"all"})}getNotificationState(t){return this.persistence[t]||null}cleanup(){this.clearTimeouts(),this.notificationQueue=[],this.activeNotificationId=null,n.debug("UNIFIED_NOTIFICATION","Service cleaned up")}}const se=new As,He=({buttonRef:s})=>{const{currentNotification:t,open:a,hideNotification:r}=de(),{click:i}=G(),o=E.useRef(null),l=()=>{i(),Q.press(),t&&se.hideNotification(t.id),a(t?.mode)};E.useEffect(()=>{if(!t?.isVisible)return;const m=u=>{const f=u.target,g=o.current?.contains(f),x=s?.current?.contains(f);!g&&!x&&t&&se.hideNotification(t.id)};return document.addEventListener("mousedown",m),document.addEventListener("touchstart",m),()=>{document.removeEventListener("mousedown",m),document.removeEventListener("touchstart",m)}},[t?.isVisible,r]);const[c,d]=E.useState(typeof window<"u"?window.innerWidth>=1025:!1);E.useEffect(()=>{const m=()=>{d(window.innerWidth>=1025)};return window.addEventListener("resize",m),()=>window.removeEventListener("resize",m)},[]);const[p,h]=E.useState({position:"fixed"});return E.useEffect(()=>{if(!c||!t?.isVisible)return;const m=()=>{if(s?.current&&o?.current){const u=s.current.getBoundingClientRect(),f=o.current.getBoundingClientRect(),g=320,x=8;u.width;const b=u.height,y=f.height||56,C=window.innerWidth-u.left+x,S=u.top+b/2-y/2;h({position:"fixed",right:`${C}px`,top:`${S}px`,transform:"none",width:`${g}px`,maxWidth:`${g}px`})}else h({position:"fixed",bottom:"24px",right:"92px",transform:"none",width:"320px",maxWidth:"320px"})};return setTimeout(m,0),window.addEventListener("resize",m),()=>window.removeEventListener("resize",m)},[c,t?.isVisible,s]),E.useEffect(()=>{c||h({position:"fixed"})},[c]),e.jsx(H,{children:t?.isVisible&&e.jsx(w.div,{ref:o,className:`chat-notification-bubble ${c?"chat-notification-bubble--desktop":"chat-notification-bubble--mobile"}`,style:p,initial:c?{x:-40,opacity:0,scale:.85}:{y:40,opacity:0,scale:.95},animate:c?{x:0,opacity:1,scale:1}:{y:0,opacity:1,scale:1},exit:c?{x:-40,opacity:0,scale:.85}:{y:40,opacity:0,scale:.95},transition:{type:"spring",stiffness:320,damping:28,mass:.8},onClick:l,role:"button",tabIndex:0,"aria-label":t.message,onKeyDown:m=>{(m.key==="Enter"||m.key===" ")&&(m.preventDefault(),l())},children:e.jsxs("div",{className:"chat-notification-bubble__message",children:[e.jsx("div",{className:"chat-notification-bubble__icon",children:e.jsx(I,{Icon:v.MessageSquare,size:c?16:18,style:{color:"#18E3FF",filter:"drop-shadow(0 0 8px rgba(24, 227, 255, 0.4))"}})}),e.jsx("span",{children:t.message})]})})})},ks=_.forwardRef(({className:s=""},t)=>{const a=pe(),{isPanelOpen:r,togglePanel:i,currentMode:o,modeConfigs:l,hasUnreadMessages:c,unreadCount:d,isInStep2:p,voiceState:h,isVoiceOnlyMode:m,exitVoiceOnlyMode:u}=z(),{click:f}=G(),{mode:g}=X(),[x,b]=E.useState(typeof window<"u"?window.innerWidth>=1025:!1),y=E.useRef(null),C=t||y,j=g==="high-performance",S=p||a.pathname.includes("/pipeline/step-2");E.useEffect(()=>{const A=()=>{b(window.innerWidth>=1025)};return window.addEventListener("resize",A),()=>window.removeEventListener("resize",A)},[]),E.useEffect(()=>{if(!r)return a.pathname.includes("/pipeline/step-2")?se.scheduleNotification("step2-adjust"):a.pathname.includes("/training")?se.scheduleNotification("training-intro"):a.pathname.includes("/meals")||a.pathname.includes("/fridge")?se.scheduleNotification("nutrition-intro"):a.pathname.includes("/fasting")?se.scheduleNotification("fasting-intro"):se.scheduleNotification("step1-welcome"),()=>{se.cancelScheduled()}},[a.pathname,r,o]);const T=l[o].color,R=h==="listening"||h==="speaking",$=()=>{f(),Q.press(),m?(n.info("FLOATING_CHAT_BUTTON","Exiting voice-only mode to view conversation"),u()):i()},P=e.jsxs(w.button,{ref:A=>{typeof t=="function"?t(A):t&&(t.current=A),y&&(y.current=A)},onClick:$,className:`floating-chat-button ${S?"floating-chat-button--step2":""} ${s}`,style:{position:"fixed",right:r&&!x?"-100px":x?"24px":"8px",bottom:x?"24px":"calc(var(--new-bottom-bar-height) + var(--new-bottom-bar-bottom-offset) + 8px)",zIndex:be.FLOATING_CHAT_BUTTON,borderRadius:"50%",overflow:"visible",display:"flex",alignItems:"center",justifyContent:"center",padding:"0",isolation:"isolate",width:x?"60px":"56px",height:x?"60px":"56px",background:j?R&&!r?"linear-gradient(135deg, rgba(239, 68, 68, 0.3), rgba(220, 38, 38, 0.4))":c?`linear-gradient(135deg, color-mix(in srgb, ${T} 15%, rgba(11, 14, 23, 0.95)), rgba(11, 14, 23, 0.95))`:"rgba(11, 14, 23, 0.95)":c?`
                  radial-gradient(circle at 30% 30%, color-mix(in srgb, ${T} 30%, transparent) 0%, transparent 50%),
                  radial-gradient(circle at 70% 70%, rgba(255,255,255,0.25) 0%, transparent 60%),
                  var(--liquid-pill-bg)
                `:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.20) 0%, transparent 50%),
                  var(--liquid-pill-bg)
                `,border:c?`1.5px solid color-mix(in srgb, ${T} 40%, transparent)`:"1.5px solid rgba(255,255,255,0.22)",backdropFilter:"blur(var(--liquid-pill-blur)) saturate(var(--liquid-pill-saturate))",WebkitBackdropFilter:"blur(var(--liquid-pill-blur)) saturate(var(--liquid-pill-saturate))",boxShadow:j?"0 2px 8px rgba(0, 0, 0, 0.3)":c?`
                  var(--liquid-pill-shadow),
                  0 0 40px color-mix(in srgb, ${T} 30%, transparent),
                  0 0 60px color-mix(in srgb, ${T} 15%, transparent)
                `:`
                  var(--liquid-pill-shadow),
                  0 0 32px color-mix(in srgb, ${T} 15%, transparent)
                `,cursor:"pointer",transition:"right 400ms cubic-bezier(0.25, 0.1, 0.25, 1), transform var(--liquid-transition-medium), background var(--liquid-transition-fast), box-shadow var(--liquid-transition-fast), border-color var(--liquid-transition-fast)",willChange:"right, transform, filter",transform:"translateZ(0)"},initial:!1,whileHover:{scale:1.08,boxShadow:`
          var(--liquid-pill-shadow),
          0 0 48px color-mix(in srgb, ${T} 25%, transparent),
          0 4px 20px rgba(0, 0, 0, 0.3)
        `,transition:{duration:.25,ease:[.16,1,.3,1]}},whileTap:{scale:.92,transition:{duration:.15}},"aria-label":r?"Fermer le chat":"Ouvrir le chat","aria-expanded":r,children:[!j&&e.jsx("div",{style:{position:"absolute",top:"2px",left:"2px",right:"50%",bottom:"50%",borderRadius:"inherit",background:"radial-gradient(circle at 20% 20%, rgba(255,255,255,0.4) 0%, transparent 60%)",opacity:.6,pointerEvents:"none"}}),e.jsx(w.div,{animate:{rotate:r?180:0},transition:{duration:.3},className:"button-icon",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(H,{mode:"wait",children:(R||m)&&!r?e.jsx(w.div,{initial:{scale:.8,opacity:0,rotate:-10},animate:{scale:1,opacity:1,rotate:0},exit:{scale:.8,opacity:0,rotate:10},transition:{duration:.2},children:e.jsx(I,{Icon:v.Radio,size:x?28:24,style:{color:"rgba(239, 68, 68, 0.95)",filter:"drop-shadow(0 0 16px rgba(239, 68, 68, 0.8))"}})},"voice-active-icon"):e.jsx(w.div,{initial:{scale:.8,opacity:0,rotate:-10},animate:{scale:1,opacity:1,rotate:0},exit:{scale:.8,opacity:0,rotate:10},transition:{duration:.2},children:e.jsx(I,{Icon:v.MessageSquare,size:x?28:24,style:{color:T,filter:S?"drop-shadow(0 0 16px rgba(59, 130, 246, 0.8))":`drop-shadow(0 0 14px color-mix(in srgb, ${T} 60%, transparent))`}})},"default-icon")})}),e.jsx(H,{children:!r&&c&&d>0&&!S&&e.jsx(w.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},className:"floating-chat-badge",style:{position:"absolute",top:"-4px",right:"-4px",minWidth:"20px",height:"20px",padding:"0 6px",borderRadius:"10px",background:`
                radial-gradient(circle at 30% 30%, ${T} 0%, color-mix(in srgb, ${T} 80%, #000) 100%)
              `,border:"2px solid rgba(11, 14, 23, 0.9)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"11px",fontWeight:"bold",color:"white",boxShadow:`
                0 0 16px color-mix(in srgb, ${T} 60%, transparent),
                0 2px 8px rgba(0, 0, 0, 0.4)
              `},children:d>9?"9+":d})}),e.jsx(H,{children:!r&&S&&e.jsx(w.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},className:"floating-chat-button--step2-notification",title:"Ton coach t'attend pour ajuster ta séance !",children:"!"})})]});return S&&!r?e.jsxs(e.Fragment,{children:[e.jsx(Ss,{content:"Ton coach t'attend pour ajuster ta séance ! Clique pour ouvrir le chat.",title:"Ajuste ton programme",placement:"left",delay:500,maxWidth:280,children:P}),e.jsx(He,{buttonRef:C})]}):e.jsxs(e.Fragment,{children:[P,e.jsx(He,{buttonRef:C})]})});ks.displayName="FloatingChatButton";class Rs{constructor(){k(this,"peerConnection",null);k(this,"isConnected",!1);k(this,"connectHandlers",new Set);k(this,"disconnectHandlers",new Set);k(this,"errorHandlers",new Set)}async createPeerConnection(){return n.info("REALTIME_CONNECTION","🔌 Creating RTCPeerConnection..."),this.peerConnection=new RTCPeerConnection,this.setupConnectionHandlers(),n.info("REALTIME_CONNECTION","✅ RTCPeerConnection created",{connectionState:this.peerConnection.connectionState,iceConnectionState:this.peerConnection.iceConnectionState}),this.peerConnection}async negotiateConnection(t){if(!this.peerConnection)throw new Error("Peer connection not initialized");n.info("REALTIME_CONNECTION","📝 Creating SDP offer...");const a=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(a),n.info("REALTIME_CONNECTION","✅ SDP offer created",{sdpType:a.type,sdpLength:a.sdp?.length||0});const i={type:"answer",sdp:await this.sendOfferToBackend(a,t)};await this.peerConnection.setRemoteDescription(i),n.info("REALTIME_CONNECTION","✅ SDP answer set as remote description"),await this.waitForConnection()}async sendOfferToBackend(t,a){const r="https://kwipydbtjagypocpvbwn.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3aXB5ZGJ0amFneXBvY3B2YnduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODg0MjIsImV4cCI6MjA3MDI2NDQyMn0.IS5IdKbmnGtgU_AaGYtUgX3ewaNpsiSAui5kbFV31_U",o=`${r}/functions/v1/voice-coach-realtime/session`;n.info("REALTIME_CONNECTION","🌐 Sending SDP offer to backend",{url:o});const l=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`,apikey:i},body:JSON.stringify({sdp:t.sdp,model:a.model,voice:a.voice,instructions:a.instructions})});if(!l.ok){const d=await l.text();throw n.error("REALTIME_CONNECTION","❌ Backend error",{status:l.status,error:d}),new Error(`Failed to create session: ${l.status} - ${d}`)}const c=await l.text();return n.info("REALTIME_CONNECTION","✅ Received SDP answer",{sdpAnswerLength:c.length}),c}async waitForConnection(){return new Promise((t,a)=>{const r=Date.now(),i=15e3,o=()=>{if(!this.peerConnection){a(new Error("Peer connection lost"));return}const l=this.peerConnection.connectionState,c=this.peerConnection.iceConnectionState;if(l==="connected"||c==="connected"||c==="completed"){n.info("REALTIME_CONNECTION","✅ Connection established",{duration:Date.now()-r}),this.isConnected=!0,this.notifyConnected(),t();return}if(l==="failed"||c==="failed"){n.error("REALTIME_CONNECTION","❌ Connection failed"),a(new Error("WebRTC connection failed"));return}if(Date.now()-r>i){n.error("REALTIME_CONNECTION","❌ Connection timeout"),a(new Error("Connection timeout"));return}setTimeout(o,100)};o()})}setupConnectionHandlers(){this.peerConnection&&(this.peerConnection.onconnectionstatechange=()=>{const t=this.peerConnection?.connectionState;n.info("REALTIME_CONNECTION",`Connection state: ${t}`),(t==="failed"||t==="closed"||t==="disconnected")&&(this.isConnected=!1,this.notifyDisconnected(),t==="failed"&&this.notifyError(new Error("WebRTC connection failed")))},this.peerConnection.oniceconnectionstatechange=()=>{const t=this.peerConnection?.iceConnectionState;n.info("REALTIME_CONNECTION",`ICE state: ${t}`)})}close(){this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null),this.isConnected=!1}onConnect(t){return this.connectHandlers.add(t),()=>this.connectHandlers.delete(t)}onDisconnect(t){return this.disconnectHandlers.add(t),()=>this.disconnectHandlers.delete(t)}onError(t){return this.errorHandlers.add(t),()=>this.errorHandlers.delete(t)}notifyConnected(){this.connectHandlers.forEach(t=>{try{t()}catch(a){n.error("REALTIME_CONNECTION","Error in connect handler",{error:a})}})}notifyDisconnected(){this.disconnectHandlers.forEach(t=>{try{t()}catch(a){n.error("REALTIME_CONNECTION","Error in disconnect handler",{error:a})}})}notifyError(t){this.errorHandlers.forEach(a=>{try{a(t)}catch(r){n.error("REALTIME_CONNECTION","Error in error handler",{handlerError:r})}})}get connection(){return this.peerConnection}get connected(){return this.isConnected}get connectionState(){return this.peerConnection?.connectionState||"none"}get iceConnectionState(){return this.peerConnection?.iceConnectionState||"none"}}class _s{constructor(){k(this,"dataChannel",null);k(this,"messageHandlers",new Set);k(this,"sessionConfigured",!1);k(this,"sessionConfiguredResolve",null)}createDataChannel(t){return n.info("REALTIME_DC","📡 Creating data channel..."),this.dataChannel=t.createDataChannel("oai-events"),this.setupHandlers(),this.dataChannel}async waitForReady(){return new Promise((t,a)=>{if(!this.dataChannel){a(new Error("Data channel not created"));return}if(this.dataChannel.readyState==="open"){n.info("REALTIME_DC","✅ Data channel already open"),t();return}const r=1e4,i=Date.now(),o=()=>{n.info("REALTIME_DC","✅ Data channel opened",{duration:Date.now()-i}),p(),t()},l=h=>{n.error("REALTIME_DC","❌ Data channel error",{error:h}),p(),a(new Error("Data channel error"))},c=()=>{n.error("REALTIME_DC","❌ Data channel closed prematurely"),p(),a(new Error("Data channel closed before opening"))},d=setTimeout(()=>{n.error("REALTIME_DC","❌ Data channel timeout"),p(),a(new Error("Data channel open timeout"))},r),p=()=>{clearTimeout(d),this.dataChannel&&(this.dataChannel.removeEventListener("open",o),this.dataChannel.removeEventListener("error",l),this.dataChannel.removeEventListener("close",c))};this.dataChannel.addEventListener("open",o),this.dataChannel.addEventListener("error",l),this.dataChannel.addEventListener("close",c)})}setupHandlers(){this.dataChannel&&(this.dataChannel.onopen=()=>{n.info("REALTIME_DC","✅ Data channel opened",{readyState:this.dataChannel?.readyState})},this.dataChannel.onclose=()=>{n.info("REALTIME_DC","🔌 Data channel closed")},this.dataChannel.onerror=t=>{n.error("REALTIME_DC","❌ Data channel error",{error:t})},this.dataChannel.onmessage=t=>{this.handleMessage(t.data)})}handleMessage(t){try{const a=JSON.parse(t);["session.updated","conversation.item.input_audio_transcription.delta","conversation.item.input_audio_transcription.completed","response.audio_transcript.delta","response.audio_transcript.done","response.done","error","input_audio_buffer.speech_started","input_audio_buffer.speech_stopped","conversation.item.created"].includes(a.type)&&n.info("REALTIME_DC",`📨 ${a.type}`,{hasContent:!!a.delta||!!a.transcript}),a.type==="session.updated"&&this.sessionConfiguredResolve&&(n.info("REALTIME_DC","✅ Session configuration confirmed"),this.sessionConfigured=!0,this.sessionConfiguredResolve(),this.sessionConfiguredResolve=null),this.messageHandlers.forEach(i=>{try{i(a)}catch(o){n.error("REALTIME_DC","Error in message handler",{error:o})}})}catch(a){n.error("REALTIME_DC","Error parsing message",{error:a,data:t})}}send(t){if(!this.dataChannel||this.dataChannel.readyState!=="open"){n.error("REALTIME_DC","❌ Cannot send: channel not open",{hasChannel:!!this.dataChannel,readyState:this.dataChannel?.readyState,messageType:t.type});return}try{const a=JSON.stringify(t);this.dataChannel.send(a),n.info("REALTIME_DC",`✅ Sent: ${t.type}`,{size:a.length})}catch(a){n.error("REALTIME_DC","❌ Error sending message",{error:a,messageType:t.type})}}async waitForSessionConfigured(){if(!this.sessionConfigured)return new Promise(t=>{this.sessionConfiguredResolve=t,setTimeout(()=>{!this.sessionConfigured&&this.sessionConfiguredResolve&&(n.warn("REALTIME_DC","⚠️ Session config timeout, continuing anyway"),this.sessionConfigured=!0,this.sessionConfiguredResolve=null,t())},3e3)})}close(){this.dataChannel&&(this.dataChannel.close(),this.dataChannel=null),this.sessionConfigured=!1,this.sessionConfiguredResolve=null}onMessage(t){return this.messageHandlers.add(t),()=>this.messageHandlers.delete(t)}get channel(){return this.dataChannel}get readyState(){return this.dataChannel?.readyState||"none"}get isSessionConfigured(){return this.sessionConfigured}}class Ms{constructor(){k(this,"audioElement",null);k(this,"localStream",null);k(this,"audioPlaybackStarted",!1);k(this,"audioAutoplayBlocked",!1);k(this,"audioInputActive",!1)}createAudioElement(){return this.audioElement=document.createElement("audio"),this.audioElement.autoplay=!0,this.audioElement.volume=1,this.audioElement.style.display="none",document.body.appendChild(this.audioElement),this.setupAudioEventHandlers(),n.info("REALTIME_AUDIO","🔊 Audio element created",{autoplay:this.audioElement.autoplay,volume:this.audioElement.volume}),this.audioElement}async getMicrophoneAccess(){n.info("REALTIME_AUDIO","🎤 Requesting microphone access...");try{return this.localStream=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:24e3,channelCount:1}}),n.info("REALTIME_AUDIO","✅ Microphone access granted",{trackCount:this.localStream.getTracks().length,tracks:this.localStream.getTracks().map(t=>({kind:t.kind,label:t.label,enabled:t.enabled}))}),this.localStream}catch(t){throw n.error("REALTIME_AUDIO","❌ Failed to get microphone access",{error:t}),new Error("Microphone access required for voice sessions")}}setupAudioEventHandlers(){this.audioElement&&(this.audioElement.onplay=()=>{n.info("REALTIME_AUDIO","▶️ Audio playback started",{volume:this.audioElement?.volume,muted:this.audioElement?.muted}),this.audioPlaybackStarted=!0,this.audioAutoplayBlocked=!1},this.audioElement.onplaying=()=>{n.info("REALTIME_AUDIO","🔊 Audio is playing",{currentTime:this.audioElement?.currentTime,volume:this.audioElement?.volume})},this.audioElement.onpause=()=>{n.warn("REALTIME_AUDIO","⏸️ Audio paused unexpectedly")},this.audioElement.onerror=()=>{n.error("REALTIME_AUDIO","❌ Audio playback error",{error:this.audioElement?.error?.message,code:this.audioElement?.error?.code})},this.audioElement.onloadeddata=()=>{n.info("REALTIME_AUDIO","📦 Audio data loaded")},this.audioElement.onvolumechange=()=>{n.debug("REALTIME_AUDIO","🔊 Volume changed",{volume:this.audioElement?.volume,muted:this.audioElement?.muted})})}async handleRemoteTrack(t){n.info("REALTIME_AUDIO","📥 Received remote audio track",{streamId:t.streams[0]?.id,trackKind:t.track.kind,trackEnabled:t.track.enabled}),this.audioElement&&t.streams[0]&&(this.audioElement.srcObject=t.streams[0],n.info("REALTIME_AUDIO","✅ Audio stream connected",{streamActive:t.streams[0].active,audioTracks:t.streams[0].getAudioTracks().length}),await this.ensureAudioPlayback())}async ensureAudioPlayback(){if(!(!this.audioElement||this.audioPlaybackStarted))try{n.info("REALTIME_AUDIO","🎵 Starting audio playback...");const t=this.audioElement.play();t!==void 0&&(await t,n.info("REALTIME_AUDIO","✅ Audio playback started automatically"),this.audioPlaybackStarted=!0,this.audioAutoplayBlocked=!1)}catch(t){t instanceof Error&&t.name==="NotAllowedError"?(n.warn("REALTIME_AUDIO","⚠️ Autoplay blocked",{solution:"User interaction required"}),this.audioAutoplayBlocked=!0,this.notifyAutoplayBlocked()):n.error("REALTIME_AUDIO","❌ Failed to start playback",{error:t})}}notifyAutoplayBlocked(){const t=new CustomEvent("voiceCoachAutoplayBlocked",{detail:{message:"Cliquez pour activer l'audio du coach",action:"enableAudioPlayback"}});window.dispatchEvent(t)}async enableAudioPlayback(){if(!this.audioElement)return n.error("REALTIME_AUDIO","❌ No audio element"),!1;if(this.audioPlaybackStarted)return n.info("REALTIME_AUDIO","✅ Already started"),!0;try{return n.info("REALTIME_AUDIO","👆 User interaction - enabling audio..."),await this.audioElement.play(),this.audioPlaybackStarted=!0,this.audioAutoplayBlocked=!1,n.info("REALTIME_AUDIO","✅ Audio enabled by user"),!0}catch(t){return n.error("REALTIME_AUDIO","❌ Failed to enable audio",{error:t}),!1}}verifyAudioInput(){if(!this.localStream){n.warn("REALTIME_AUDIO","⚠️ No local audio stream");return}const t=this.localStream.getAudioTracks();if(t.length===0){n.error("REALTIME_AUDIO","❌ No audio tracks");return}this.audioInputActive=!1,t.forEach((a,r)=>{n.info("REALTIME_AUDIO",`🎤 Audio track ${r}:`,{label:a.label,enabled:a.enabled,muted:a.muted,readyState:a.readyState}),a.readyState==="live"&&a.enabled&&(this.audioInputActive=!0)}),this.audioInputActive?n.info("REALTIME_AUDIO","✅ Audio input verification PASSED"):n.error("REALTIME_AUDIO","❌ Audio input verification FAILED")}getAudioDiagnostics(){return{hasAudioElement:!!this.audioElement,isPlaybackStarted:this.audioPlaybackStarted,isAutoplayBlocked:this.audioAutoplayBlocked,volume:this.audioElement?.volume??0,muted:this.audioElement?.muted??!1,readyState:this.audioElement?.readyState??0,networkState:this.audioElement?.networkState??0,paused:this.audioElement?.paused??!0,hasStream:!!this.audioElement?.srcObject,streamActive:this.audioElement?.srcObject?.active??!1,audioTracks:this.audioElement?.srcObject?.getAudioTracks().length??0}}logAudioDiagnostics(){const t=this.getAudioDiagnostics();n.info("REALTIME_AUDIO","🔍 AUDIO DIAGNOSTICS",t)}cleanup(){this.localStream&&(this.localStream.getTracks().forEach(t=>t.stop()),this.localStream=null),this.audioElement&&(this.audioElement.pause(),this.audioElement.srcObject=null,this.audioElement.parentNode&&this.audioElement.parentNode.removeChild(this.audioElement),this.audioElement=null),this.audioPlaybackStarted=!1,this.audioAutoplayBlocked=!1,this.audioInputActive=!1}get element(){return this.audioElement}get stream(){return this.localStream}get isInputActive(){return this.audioInputActive}get isPlaybackStarted(){return this.audioPlaybackStarted}get isAutoplayBlocked(){return this.audioAutoplayBlocked}}class Os{constructor(t){k(this,"dataChannelManager");k(this,"config",null);k(this,"lastSpeechDetectedAt",null);this.dataChannelManager=t}setConfig(t){this.config=t}async configureSession(t,a){if(this.dataChannelManager.isSessionConfigured){n.warn("REALTIME_SESSION","⚠️ Session already configured");return}n.info("REALTIME_SESSION","⚙️ Configuring session",{mode:a,promptLength:t.length}),this.dataChannelManager.send({type:"session.update",session:{instructions:t,modalities:["text","audio"],voice:this.config?.voice||"alloy",input_audio_format:"pcm16",output_audio_format:"pcm16",input_audio_transcription:{model:"whisper-1"},turn_detection:{type:"server_vad",threshold:.5,prefix_padding_ms:300,silence_duration_ms:700,create_response:!0},temperature:this.config?.temperature||.8,max_response_output_tokens:this.config?.maxTokens||4096}}),n.info("REALTIME_SESSION","✅ Session configuration sent"),await this.dataChannelManager.waitForSessionConfigured()}sendTextMessage(t){this.dataChannelManager.send({type:"conversation.item.create",item:{type:"message",role:"user",content:[{type:"input_text",text:t}]}}),this.dataChannelManager.send({type:"response.create"}),n.debug("REALTIME_SESSION","Text message sent",{text:t})}cancelResponse(){this.dataChannelManager.send({type:"response.cancel"}),n.debug("REALTIME_SESSION","Response cancelled")}handleMessage(t){t.type==="input_audio_buffer.speech_started"&&(this.lastSpeechDetectedAt=Date.now(),n.info("REALTIME_SESSION","🎤 Speech detected"))}get lastSpeechTime(){return this.lastSpeechDetectedAt}reset(){this.lastSpeechDetectedAt=null}}class Fs{constructor(t,a,r,i){k(this,"connectionManager");k(this,"dataChannelManager");k(this,"audioManager");k(this,"sessionManager");k(this,"healthCheckInterval",null);this.connectionManager=t,this.dataChannelManager=a,this.audioManager=r,this.sessionManager=i}startHealthCheck(){this.healthCheckInterval=window.setInterval(()=>{const t=this.getConnectionDiagnostics();n.debug("REALTIME_HEALTH","💓 Health check",{...t,timeSinceLastSpeech:this.sessionManager.lastSpeechTime?Date.now()-this.sessionManager.lastSpeechTime:null}),t.isConnected&&!t.audioInputActive&&n.warn("REALTIME_HEALTH","⚠️ Audio input not active despite connection"),t.isConnected&&t.dataChannelState!=="open"&&n.error("REALTIME_HEALTH","❌ Data channel not open")},3e4)}stopHealthCheck(){this.healthCheckInterval&&(clearInterval(this.healthCheckInterval),this.healthCheckInterval=null)}getConnectionDiagnostics(){return{isConnected:this.connectionManager.connected,sessionConfigured:this.dataChannelManager.isSessionConfigured,audioInputActive:this.audioManager.isInputActive,peerConnectionState:this.connectionManager.connectionState,iceConnectionState:this.connectionManager.iceConnectionState,dataChannelState:this.dataChannelManager.readyState,localStreamActive:this.audioManager.stream?.active||!1,audioTracksCount:this.audioManager.stream?.getAudioTracks().length||0}}logConnectionDiagnostics(){const t=this.getConnectionDiagnostics();n.info("REALTIME_DIAGNOSTICS","🔍 CONNECTION DIAGNOSTICS",t)}}class Ds{constructor(){k(this,"connectionManager");k(this,"dataChannelManager");k(this,"audioManager");k(this,"sessionManager");k(this,"diagnosticsManager");k(this,"config",null);this.connectionManager=new Rs,this.dataChannelManager=new _s,this.audioManager=new Ms,this.sessionManager=new Os(this.dataChannelManager),this.diagnosticsManager=new Fs(this.connectionManager,this.dataChannelManager,this.audioManager,this.sessionManager)}async connect(t){if(this.connectionManager.connected){n.info("REALTIME","✅ Already connected");return}this.config=t,this.sessionManager.setConfig(t);try{n.info("REALTIME","🚀 STARTING WEBRTC CONNECTION",{model:t.model,voice:t.voice,timestamp:new Date().toISOString()});const a="https://kwipydbtjagypocpvbwn.supabase.co",r="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3aXB5ZGJ0amFneXBvY3B2YnduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODg0MjIsImV4cCI6MjA3MDI2NDQyMn0.IS5IdKbmnGtgU_AaGYtUgX3ewaNpsiSAui5kbFV31_U";if(typeof RTCPeerConnection>"u")throw new Error("WebRTC API not available");const i=await this.connectionManager.createPeerConnection(),o=this.audioManager.createAudioElement(),l=await this.audioManager.getMicrophoneAccess();l.getTracks().forEach(d=>{i.addTrack(d,l),n.info("REALTIME","✅ Audio track added",{trackKind:d.kind,trackId:d.id})}),i.ontrack=async d=>{await this.audioManager.handleRemoteTrack(d)};const c=this.dataChannelManager.createDataChannel(i);this.dataChannelManager.onMessage(d=>{this.sessionManager.handleMessage(d)}),this.connectionManager.onConnect(()=>{n.info("REALTIME","✅ Connection established")}),this.connectionManager.onDisconnect(()=>{n.info("REALTIME","🔌 Disconnected")}),await this.connectionManager.negotiateConnection(t),await this.dataChannelManager.waitForReady(),n.info("REALTIME","✅✅✅ SUCCESSFULLY CONNECTED ✅✅✅"),this.audioManager.verifyAudioInput(),setTimeout(()=>{this.audioManager.verifyAudioInput()},1e3),this.diagnosticsManager.startHealthCheck()}catch(a){throw n.error("REALTIME","❌ CONNECTION FAILED",{error:a}),this.cleanup(),a}}async configureSession(t,a){await this.sessionManager.configureSession(t,a)}sendTextMessage(t){this.sessionManager.sendTextMessage(t)}cancelResponse(){this.sessionManager.cancelResponse()}sendAudio(t){n.debug("REALTIME","Audio handled automatically by WebRTC")}commitAudioBuffer(){n.debug("REALTIME","Audio buffer commit not needed with WebRTC")}async enableAudioPlayback(){return await this.audioManager.enableAudioPlayback()}disconnect(){n.info("REALTIME","Disconnecting..."),this.cleanup()}cleanup(){this.diagnosticsManager.stopHealthCheck(),this.dataChannelManager.close(),this.connectionManager.close(),this.audioManager.cleanup(),this.sessionManager.reset(),n.info("REALTIME","Cleanup complete")}getConnectionDiagnostics(){return this.diagnosticsManager.getConnectionDiagnostics()}getAudioDiagnostics(){return this.audioManager.getAudioDiagnostics()}logAudioDiagnostics(){this.audioManager.logAudioDiagnostics()}onMessage(t){return this.dataChannelManager.onMessage(t)}onError(t){return this.connectionManager.onError(t)}onConnect(t){return this.connectionManager.onConnect(t)}onDisconnect(t){return this.connectionManager.onDisconnect(t)}get connected(){return this.connectionManager.connected}get readyState(){switch(this.connectionManager.connectionState){case"new":case"connecting":return 0;case"connected":return 1;case"disconnected":case"failed":case"closed":return 3;default:return 3}}}const te=new Ds;class $s{constructor(){k(this,"isInitialized",!1);k(this,"currentCoachMessage","")}async initialize(){if(this.isInitialized){n.debug("VOICE_ORCHESTRATOR","Already initialized");return}try{n.info("VOICE_ORCHESTRATOR","Initializing voice coach orchestrator (WebRTC mode)"),n.debug("VOICE_ORCHESTRATOR","Checking Supabase configuration");const t="https://kwipydbtjagypocpvbwn.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3aXB5ZGJ0amFneXBvY3B2YnduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODg0MjIsImV4cCI6MjA3MDI2NDQyMn0.IS5IdKbmnGtgU_AaGYtUgX3ewaNpsiSAui5kbFV31_U";n.debug("VOICE_ORCHESTRATOR","Supabase configuration OK, setting up handlers"),n.debug("VOICE_ORCHESTRATOR","Setting up Realtime handlers"),this.setupRealtimeHandlers(),this.isInitialized=!0,n.info("VOICE_ORCHESTRATOR","Voice coach orchestrator initialized successfully (WebRTC mode)")}catch(t){throw n.error("VOICE_ORCHESTRATOR","Initialization failed",{error:t instanceof Error?t.message:String(t),stack:t instanceof Error?t.stack:void 0}),t}}async startVoiceSession(t){const a=z.getState();try{if(n.info("VOICE_ORCHESTRATOR","🚀 Starting voice session (WebRTC)",{mode:t}),a.voiceState==="listening"||a.voiceState==="speaking"){n.warn("VOICE_ORCHESTRATOR","Session already active");return}n.info("VOICE_ORCHESTRATOR","📡 Setting voice state to connecting"),a.setVoiceState("connecting"),n.info("VOICE_ORCHESTRATOR","🔬 Running pre-connection diagnostics");const{VoiceConnectionDiagnostics:r}=await Yi(async()=>{const{VoiceConnectionDiagnostics:g}=await import("./voiceConnectionDiagnostics-CGIO5UCm.js");return{VoiceConnectionDiagnostics:g}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])),l=(await new r().runAllTests()).filter(g=>!g.passed);if(l.length>0){n.error("VOICE_ORCHESTRATOR","❌ Diagnostics failed",{failedTests:l.map(x=>({test:x.test,message:x.message}))});const g=l.map(x=>`• ${x.test}: ${x.message}`).join(`
`);throw new Error(`Voice connection prerequisites failed:

${g}

Please check the console for detailed diagnostics.`)}n.info("VOICE_ORCHESTRATOR","✅ All diagnostics passed");const d=oe.getState().profile?.displayName||"champion",p=a.modeConfigs[t];if(!p)throw new Error(`Invalid mode: ${t}`);const h=`${p.systemPrompt}

IMPORTANT: L'utilisateur s'appelle ${d}. Adresse-toi à lui par son prénom pour créer une relation plus chaleureuse et personnelle.`;n.info("VOICE_ORCHESTRATOR","👤 Personalized system prompt",{firstName:d,mode:t}),n.info("VOICE_ORCHESTRATOR","🌐 Connecting to Realtime API via WebRTC"),await te.connect({model:"gpt-realtime-mini",voice:"alloy",temperature:.8,maxTokens:4096,instructions:h}),n.info("VOICE_ORCHESTRATOR","✅ Realtime API WebRTC connected successfully"),n.info("VOICE_ORCHESTRATOR","⚙️ Configuring session with VAD and transcription"),await te.configureSession(h,t),n.info("VOICE_ORCHESTRATOR","✅ Session configuration confirmed by server");const m=te.getConnectionDiagnostics();n.info("VOICE_ORCHESTRATOR","🔍 Connection diagnostics after configuration:",m),m.audioInputActive||n.warn("VOICE_ORCHESTRATOR","⚠️ Audio input may not be active - user speech detection might not work"),n.info("VOICE_ORCHESTRATOR","💬 Starting conversation in store"),a.startConversation(t),n.info("VOICE_ORCHESTRATOR","🎙️ Setting communication mode to voice (realtime)"),a.setCommunicationMode("voice"),a.setInputMode("realtime");const f={training:`Salut ${d}! Je suis ton coach sportif personnel. Prêt à donner le meilleur de toi-même aujourd'hui?`,nutrition:`Salut ${d}! Nous voilà prêts à optimiser notre alimentation. Qu'est-ce que nous allons travailler aujourd'hui?`,fasting:`Salut ${d}! Nous commençons une nouvelle session de jeûne ensemble. Comment nous sentons-nous?`,general:`Salut ${d}! Nous sommes TwinCoach, ton compagnon de progression. Qu'est-ce que nous allons accomplir aujourd'hui?`,"body-scan":`Salut ${d}! Regardons ensemble notre évolution corporelle. Prêt à découvrir nos progrès?`}[t]||`Bonjour ${d}! Nous sommes là pour t'accompagner. Que souhaitons-nous faire aujourd'hui?`;n.info("VOICE_ORCHESTRATOR","👋 Triggering personalized welcome message from coach",{firstName:d,mode:t}),te.sendTextMessage(f),n.info("VOICE_ORCHESTRATOR","👂 Setting voice state to listening"),a.setVoiceState("listening"),n.info("VOICE_ORCHESTRATOR","✅✅✅ Voice session started successfully - STATE = LISTENING ✅✅✅")}catch(r){n.error("VOICE_ORCHESTRATOR","Failed to start voice session",{error:r instanceof Error?r.message:String(r),stack:r instanceof Error?r.stack:void 0}),n.error("VOICE_ORCHESTRATOR","❌ CRITICAL: Voice session failed to start"),a.setVoiceState("error");let i="Failed to start voice session";throw r instanceof Error&&(r.message.includes("permission")?i="Microphone permission required":r.message.includes("connect")||r.message.includes("WebRTC")?i="Unable to connect to voice service":i=r.message),n.error("VOICE_ORCHESTRATOR","💥 Error message for user",{errorMessage:i}),a.setError(i),r}}async stopVoiceSession(){try{n.info("VOICE_ORCHESTRATOR","Stopping voice session"),te.disconnect();const t=z.getState();t.endConversation(),t.setVoiceState("idle"),n.info("VOICE_ORCHESTRATOR","Voice session stopped")}catch(t){n.error("VOICE_ORCHESTRATOR","Error stopping voice session",{error:t})}}setupRealtimeHandlers(){te.onMessage(t=>{this.handleRealtimeMessage(t)}),te.onError(t=>{n.error("VOICE_ORCHESTRATOR","❌ Realtime API error",{error:t.message,stack:t.stack});const a=z.getState();a.setVoiceState("error"),a.setError(t.message)}),te.onConnect(()=>{n.info("VOICE_ORCHESTRATOR","✅ Realtime API WebRTC connected successfully")}),te.onDisconnect(()=>{n.info("VOICE_ORCHESTRATOR","🔌 Realtime API disconnected")})}handleRealtimeMessage(t){const a=z.getState();switch(n.info("VOICE_ORCHESTRATOR",`📨 Received Realtime message: ${t.type}`,{type:t.type,hasContent:!!t.delta||!!t.transcript,hasDelta:!!t.delta,hasTranscript:!!t.transcript,hasAudio:!!t.audio,fullMessage:t}),t.type){case"input_audio_buffer.speech_started":n.info("VOICE_ORCHESTRATOR","🎤 User started speaking - VAD detected speech"),a.setVoiceState("processing"),a.setProcessing(!0);break;case"input_audio_buffer.speech_stopped":n.info("VOICE_ORCHESTRATOR","🔇 User stopped speaking - VAD detected silence");break;case"conversation.item.input_audio_transcription.delta":t.delta&&(n.info("VOICE_ORCHESTRATOR","📝 User transcription delta",{delta:t.delta}),a.setCurrentTranscription(a.currentTranscription+t.delta));break;case"conversation.item.input_audio_transcription.completed":t.transcript&&(n.info("VOICE_ORCHESTRATOR","✅ User transcription completed",{transcript:t.transcript}),a.setCurrentTranscription(t.transcript),a.addMessage({role:"user",content:t.transcript}),a.setCurrentTranscription(""));break;case"conversation.item.created":n.info("VOICE_ORCHESTRATOR","📋 Conversation item created",{itemId:t.item?.id,itemType:t.item?.type,itemRole:t.item?.role});break;case"response.audio.delta":a.voiceState!=="speaking"&&(n.info("VOICE_ORCHESTRATOR","🔊 Coach speaking via WebRTC, setting state to speaking"),a.setVoiceState("speaking"),a.setSpeaking(!0));break;case"response.audio_transcript.delta":if(t.delta){n.info("VOICE_ORCHESTRATOR","💬 Coach transcript delta",{delta:t.delta.substring(0,50)}),this.currentCoachMessage+=t.delta;const r=a.messages,i=r[r.length-1];if(i&&i.role==="coach"){n.debug("VOICE_ORCHESTRATOR","🔄 Updating existing coach message");const o=r.slice(0,-1);a.clearMessages(),o.forEach(l=>a.addMessage(l)),a.addMessage({role:"coach",content:this.currentCoachMessage})}else n.info("VOICE_ORCHESTRATOR","➕ Creating new coach message"),a.addMessage({role:"coach",content:this.currentCoachMessage})}break;case"response.audio_transcript.done":this.currentCoachMessage&&(n.info("VOICE_ORCHESTRATOR","✅ Coach transcript completed",{fullMessage:this.currentCoachMessage.substring(0,100)+"..."}),this.currentCoachMessage="");break;case"response.audio.done":n.info("VOICE_ORCHESTRATOR","✅ Audio response completed"),a.setSpeaking(!1);break;case"response.done":n.info("VOICE_ORCHESTRATOR","✅ Response done, setting state back to listening"),a.setVoiceState("listening"),a.setProcessing(!1),a.setSpeaking(!1);break;case"error":n.error("VOICE_ORCHESTRATOR","❌ Realtime API error from server",{errorMessage:t.error?.message,errorType:t.error?.type,fullMessage:t}),a.setVoiceState("error"),a.setError(t.error?.message||"Unknown error");break;case"session.updated":n.info("VOICE_ORCHESTRATOR","⚙️ Session configuration updated");break;case"response.created":n.info("VOICE_ORCHESTRATOR","🎯 Response creation started by server"),a.setVoiceState("processing"),a.setProcessing(!0);break;default:n.debug("VOICE_ORCHESTRATOR","❓ Unhandled message type",{type:t.type})}}cleanup(){this.currentCoachMessage="",this.isInitialized=!1}get initialized(){return this.isInitialized}}const he=new $s,Ee=({message:s,stepColor:t,showCTA:a=!1,ctaButtons:r=[],onCTAClick:i})=>{const{currentMode:o}=de(),l=o==="training",c=s.role==="coach";return s.role==="system"?e.jsx(w.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"flex justify-center my-4",children:e.jsxs("div",{className:"system-message px-4 py-2 rounded-full bg-white/5 border border-white/10 text-xs text-white/60 flex items-center gap-2",children:[e.jsx(I,{Icon:v.Info,size:12}),s.content]})}):e.jsx(w.div,{initial:{opacity:0,y:10,x:c?-10:10},animate:{opacity:1,y:0,x:0},transition:{duration:.3,ease:"easeOut"},className:`flex ${c?"justify-start":"justify-end"} mb-4`,children:e.jsxs("div",{className:`flex flex-col gap-2 ${c?"items-start":"items-end"} max-w-[85%]`,children:[e.jsxs("div",{className:`flex ${c?"flex-row":"flex-row-reverse"} items-end gap-2`,children:[c&&e.jsx("div",{className:"message-avatar w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                  radial-gradient(circle at 30% 30%, color-mix(in srgb, ${t} 40%, transparent) 0%, transparent 70%),
                  rgba(255, 255, 255, 0.1)
                `,border:`1.5px solid color-mix(in srgb, ${t} 50%, transparent)`,boxShadow:`0 0 12px color-mix(in srgb, ${t} 30%, transparent)`},children:e.jsx(I,{Icon:v.Zap,size:16,style:{color:t,filter:`drop-shadow(0 0 8px color-mix(in srgb, ${t} 60%, transparent))`}})}),e.jsxs("div",{className:`coach-message-bubble ${c?"coach-message-bubble--coach":"coach-message-bubble--user"} ${c?"px-4":"px-5"} py-3 rounded-2xl relative`,style:{background:c?`
                    radial-gradient(circle at 30% 30%, color-mix(in srgb, ${t} 15%, transparent) 0%, transparent 70%),
                    rgba(255, 255, 255, 0.08)
                  `:"rgba(255, 255, 255, 0.12)",border:c?`1px solid color-mix(in srgb, ${t} 25%, transparent)`:"1px solid rgba(255, 255, 255, 0.2)",boxShadow:c?`
                    0 2px 8px rgba(0, 0, 0, 0.2),
                    0 0 16px color-mix(in srgb, ${t} 15%, transparent),
                    inset 0 1px 0 rgba(255, 255, 255, 0.1)
                  `:`
                    0 2px 8px rgba(0, 0, 0, 0.2),
                    inset 0 1px 0 rgba(255, 255, 255, 0.15)
                  `,backdropFilter:"blur(12px) saturate(140%)",WebkitBackdropFilter:"blur(12px) saturate(140%)",borderRadius:c?"4px 16px 16px 16px":"16px 4px 16px 16px"},children:[e.jsx("p",{className:"message-content-text text-sm text-white leading-relaxed",style:{wordBreak:"normal",overflowWrap:"break-word",whiteSpace:"pre-wrap",hyphens:"none",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none"},children:s.content}),s.type==="audio"&&e.jsxs("div",{className:"audio-message-indicator flex items-center gap-2 mt-2 pt-2 border-t border-white/10",children:[e.jsx(I,{Icon:v.Volume2,size:12,style:{color:"rgba(255,255,255,0.6)"}}),e.jsx("span",{className:"text-xs text-white/60",children:"Message vocal"})]}),e.jsx("div",{className:`message-timestamp text-[10px] text-white/40 mt-1 ${c?"text-left":"text-right"}`,children:new Date(s.timestamp).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})})]})]}),c&&a&&l&&r.length>0&&e.jsx("div",{className:"flex flex-col gap-2 pl-10 self-stretch",children:r.map((p,h)=>{const m=p.icon?v[p.icon]:null,u=p.variant==="primary";return e.jsxs(w.button,{onClick:()=>i?.(p.id),className:"flex items-center justify-center gap-2 py-2.5 px-4 rounded-xl font-medium text-sm",initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:h*.1,type:"spring",stiffness:400,damping:17},whileHover:{scale:1.02,x:2},whileTap:{scale:.98},style:{background:u?`
                          radial-gradient(circle at 30% 30%, color-mix(in srgb, ${t} 25%, transparent) 0%, transparent 70%),
                          color-mix(in srgb, ${t} 18%, rgba(255, 255, 255, 0.08))
                        `:`
                          radial-gradient(circle at 50% 0%, rgba(255, 255, 255, 0.08) 0%, transparent 70%),
                          rgba(255, 255, 255, 0.05)
                        `,border:u?`1.5px solid color-mix(in srgb, ${t} 35%, transparent)`:"1px solid rgba(255, 255, 255, 0.12)",backdropFilter:"blur(10px)",boxShadow:u?`
                          0 2px 12px color-mix(in srgb, ${t} 20%, transparent),
                          inset 0 1px 0 rgba(255, 255, 255, 0.12)
                        `:"inset 0 1px 0 rgba(255, 255, 255, 0.08)",color:u?t:"rgba(255, 255, 255, 0.9)"},children:[m&&e.jsx(I,{Icon:m,size:14,style:{color:u?t:"rgba(255, 255, 255, 0.8)",filter:u?`drop-shadow(0 0 8px color-mix(in srgb, ${t} 50%, transparent))`:"none"}}),e.jsx("span",{children:p.label})]},p.id)})})]})})},Ps=({exercises:s,programType:t,introText:a,onExerciseClick:r,stepColor:i})=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-white/90 text-[15px] leading-relaxed",children:a||"Parfait ! Voici les exercices de ta séance. Lequel souhaites-tu ajuster ?"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.map((o,l)=>e.jsxs(w.button,{onClick:()=>r(o.id,o.name),className:"exercise-chip",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:l*.05},whileHover:{scale:1.02},whileTap:{scale:.98},style:{padding:"12px 20px",background:"rgba(255, 255, 255, 0.08)",border:"1.5px solid rgba(255, 255, 255, 0.15)",borderRadius:"16px",backdropFilter:"blur(12px)",color:"white",fontSize:"14px",fontWeight:"500",cursor:"pointer",transition:"all 0.2s ease"},children:[o.orderIndex,". ",o.name]},o.id))})]}),Ls=[{id:"increase-sets",label:"+1 Série",icon:"Plus",color:"#10B981",category:"volume",action:"increase",description:"Ajouter une série supplémentaire",shortMessage:"J'aimerais ajouter une série supplémentaire"},{id:"decrease-sets",label:"-1 Série",icon:"Minus",color:"#F59E0B",category:"volume",action:"decrease",description:"Retirer une série",shortMessage:"J'aimerais retirer une série"},{id:"increase-reps",label:"+2 Reps",icon:"TrendingUp",color:"#22C55E",category:"volume",action:"increase",description:"Augmenter le nombre de répétitions",shortMessage:"J'aimerais faire plus de répétitions"},{id:"decrease-reps",label:"-2 Reps",icon:"TrendingDown",color:"#EF4444",category:"volume",action:"decrease",description:"Diminuer le nombre de répétitions",shortMessage:"J'aimerais faire moins de répétitions"},{id:"increase-load",label:"Charge +",icon:"ChevronUp",color:"#8B5CF6",category:"intensity",action:"increase",description:"Augmenter la charge",shortMessage:"C'est trop léger, je peux mettre plus lourd"},{id:"decrease-load",label:"Charge -",icon:"ChevronDown",color:"#EC4899",category:"intensity",action:"decrease",description:"Diminuer la charge",shortMessage:"C'est trop lourd, je dois alléger"},{id:"adjust-tempo",label:"Tempo",icon:"Timer",color:"#06B6D4",category:"technique",action:"modify",description:"Modifier le tempo d'exécution",shortMessage:"Je veux ajuster le tempo de cet exercice"},{id:"adjust-rest",label:"Repos",icon:"Clock",color:"#3B82F6",category:"timing",action:"modify",description:"Modifier le temps de repos",shortMessage:"Je voudrais ajuster le temps de repos"},{id:"increase-rest",label:"Repos +30s",icon:"PlusCircle",color:"#14B8A6",category:"timing",action:"increase",description:"Augmenter le temps de repos de 30 secondes",shortMessage:"J'ai besoin de plus de repos entre les séries"},{id:"decrease-rest",label:"Repos -30s",icon:"MinusCircle",color:"#F97316",category:"timing",action:"decrease",description:"Diminuer le temps de repos de 30 secondes",shortMessage:"Je peux réduire le temps de repos"},{id:"easier-variant",label:"Variante Facile",icon:"ArrowDown",color:"#84CC16",category:"substitution",action:"substitute",description:"Proposer une variante plus facile",shortMessage:"Cet exercice est trop difficile, tu as une variante plus facile ?"},{id:"harder-variant",label:"Variante Difficile",icon:"ArrowUp",color:"#DC2626",category:"substitution",action:"substitute",description:"Proposer une variante plus difficile",shortMessage:"Cet exercice est trop facile, tu as une variante plus difficile ?"},{id:"change-equipment",label:"Changer Équipement",icon:"Settings",color:"#6366F1",category:"equipment",action:"substitute",description:"Utiliser un autre équipement",shortMessage:"Je n'ai pas cet équipement, on peut adapter ?"},{id:"bodyweight-variant",label:"Poids Corps",icon:"User",color:"#A855F7",category:"equipment",action:"substitute",description:"Version au poids du corps",shortMessage:"Je préférerais une version au poids du corps"},{id:"technique-help",label:"Aide Technique",icon:"HelpCircle",color:"#0EA5E9",category:"technique",action:"info",description:"Obtenir des conseils techniques",shortMessage:"Je voudrais des conseils sur la technique de cet exercice"},{id:"substitute-exercise",label:"Autre Exercice",icon:"RefreshCw",color:"#F59E0B",category:"substitution",action:"substitute",description:"Remplacer complètement l'exercice",shortMessage:"Je voudrais remplacer cet exercice par un autre"}],Bs=[{id:"volume",label:"Volume",icon:"BarChart3",color:"#10B981",description:"Séries et répétitions"},{id:"intensity",label:"Intensité",icon:"Zap",color:"#8B5CF6",description:"Charge et difficulté"},{id:"technique",label:"Technique",icon:"Target",color:"#06B6D4",description:"Exécution et tempo"},{id:"equipment",label:"Équipement",icon:"Wrench",color:"#6366F1",description:"Matériel utilisé"},{id:"substitution",label:"Substitution",icon:"Repeat",color:"#F59E0B",description:"Variantes et alternatives"},{id:"timing",label:"Timing",icon:"Clock",color:"#3B82F6",description:"Temps de repos"}],Hs=({exerciseName:s,onCategorySelect:t,stepColor:a})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-white/90 text-[15px] leading-relaxed",children:["Super ! Qu'est-ce que tu veux ajuster sur ",e.jsx("strong",{className:"text-white font-semibold",children:s})," ?"]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Bs.map((r,i)=>{const o=v[r.icon];return e.jsxs(w.button,{onClick:()=>t(r.id),className:"category-card",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:i*.06},whileHover:{scale:1.02,y:-2},whileTap:{scale:.98},style:{padding:"16px",background:`
                  radial-gradient(circle at 30% 30%, color-mix(in srgb, ${r.color} 12%, transparent) 0%, transparent 70%),
                  rgba(255, 255, 255, 0.06)
                `,border:`1.5px solid color-mix(in srgb, ${r.color} 30%, transparent)`,borderRadius:"16px",backdropFilter:"blur(12px)",boxShadow:`
                  0 2px 8px rgba(0, 0, 0, 0.15),
                  0 0 16px color-mix(in srgb, ${r.color} 10%, transparent)
                `,cursor:"pointer",position:"relative",overflow:"hidden"},children:[e.jsx("div",{className:"absolute inset-0 opacity-0 hover:opacity-100 transition-opacity",style:{background:`radial-gradient(circle at center, color-mix(in srgb, ${r.color} 20%, transparent) 0%, transparent 70%)`}}),e.jsxs("div",{className:"relative flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-xl flex-shrink-0",style:{background:`color-mix(in srgb, ${r.color} 20%, transparent)`,border:`1px solid color-mix(in srgb, ${r.color} 35%, transparent)`,boxShadow:`0 0 12px color-mix(in srgb, ${r.color} 15%, transparent)`},children:o&&e.jsx(I,{Icon:o,size:20,style:{color:r.color,filter:`drop-shadow(0 0 6px color-mix(in srgb, ${r.color} 40%, transparent))`}})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("div",{className:"font-semibold text-[14px] mb-1",style:{color:r.color,textShadow:`0 0 8px color-mix(in srgb, ${r.color} 25%, transparent)`},children:r.label}),e.jsx("div",{className:"text-white/60 text-[12px] leading-tight",children:r.description})]})]})]},r.id)})})]}),zs=({exerciseName:s,category:t,onOptionSelect:a,onBack:r,stepColor:i})=>{const o=Ls.filter(l=>l.category===t);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(w.button,{onClick:r,className:"back-button p-2 rounded-full",whileHover:{scale:1.1},whileTap:{scale:.9},style:{background:"rgba(255, 255, 255, 0.08)",border:"1px solid rgba(255, 255, 255, 0.15)",backdropFilter:"blur(12px)"},children:e.jsx(I,{Icon:v.ArrowLeft,size:16,style:{color:"rgba(255,255,255,0.8)"}})}),e.jsxs("p",{className:"text-white/90 text-[15px] leading-relaxed flex-1",children:["Comment veux-tu ajuster ",e.jsx("strong",{className:"text-white font-semibold",children:s})," ?"]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:o.map((l,c)=>{const d=v[l.icon];return e.jsxs(w.button,{onClick:()=>a(l.id),className:"option-card",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:c*.05},whileHover:{scale:1.02,y:-2},whileTap:{scale:.98},style:{padding:"14px",background:`
                  radial-gradient(circle at 30% 20%, color-mix(in srgb, ${l.color} 10%, transparent) 0%, transparent 70%),
                  rgba(255, 255, 255, 0.06)
                `,border:`1.5px solid color-mix(in srgb, ${l.color} 25%, transparent)`,borderRadius:"14px",backdropFilter:"blur(12px)",boxShadow:`
                  0 2px 8px rgba(0, 0, 0, 0.12),
                  0 0 12px color-mix(in srgb, ${l.color} 8%, transparent)
                `,cursor:"pointer",textAlign:"left"},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[d&&e.jsx("div",{className:"icon-container w-7 h-7 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                        radial-gradient(circle at 30% 30%, color-mix(in srgb, ${l.color} 25%, transparent) 0%, transparent 70%),
                        color-mix(in srgb, ${l.color} 15%, rgba(255, 255, 255, 0.08))
                      `,border:`1px solid color-mix(in srgb, ${l.color} 35%, transparent)`,boxShadow:`0 0 10px color-mix(in srgb, ${l.color} 20%, transparent)`},children:e.jsx(I,{Icon:d,size:14,style:{color:l.color,filter:`drop-shadow(0 0 6px color-mix(in srgb, ${l.color} 45%, transparent))`}})}),e.jsx("span",{className:"font-bold text-[13px]",style:{color:l.color,textShadow:`0 0 8px color-mix(in srgb, ${l.color} 25%, transparent)`},children:l.label})]}),e.jsx("p",{className:"text-[11px] text-white/70 leading-tight line-clamp-2 ml-9",children:l.description})]},l.id)})}),e.jsx("style",{children:`
        .line-clamp-2 {
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
      `})]})},Us=({exerciseName:s,adjustmentLabel:t,summary:a,onValidate:r,onModify:i,stepColor:o})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-white/90 text-[15px] leading-relaxed",children:["Voici ce que je vais appliquer à ",e.jsx("strong",{className:"text-white font-semibold",children:s})," :"]}),e.jsxs(w.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"preview-box",style:{padding:"18px",background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, ${o} 12%, transparent) 0%, transparent 70%),
            rgba(255, 255, 255, 0.08)
          `,border:`1.5px solid color-mix(in srgb, ${o} 30%, transparent)`,borderRadius:"16px",backdropFilter:"blur(14px)",boxShadow:`
            0 2px 12px rgba(0, 0, 0, 0.2),
            0 0 20px color-mix(in srgb, ${o} 12%, transparent),
            inset 0 1px 0 rgba(255, 255, 255, 0.12)
          `},children:[e.jsx("div",{className:"text-[13px] mb-2 uppercase tracking-wide font-bold",style:{color:o,textShadow:`0 0 8px color-mix(in srgb, ${o} 30%, transparent)`},children:t}),e.jsx("div",{className:"text-white text-[15px] font-medium leading-relaxed",children:a})]}),e.jsx("p",{className:"text-white/80 text-[14px]",children:"Est-ce que ça te convient ? 💪"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(w.button,{onClick:r,whileHover:{scale:1.02,y:-1},whileTap:{scale:.98},className:"flex-1 flex items-center justify-center gap-2",style:{padding:"14px 24px",background:`
              linear-gradient(135deg, #10B981 0%, #059669 100%)
            `,border:"1.5px solid rgba(255, 255, 255, 0.25)",borderRadius:"14px",color:"white",fontSize:"15px",fontWeight:"700",cursor:"pointer",boxShadow:`
              0 4px 12px rgba(16, 185, 129, 0.25),
              0 0 20px rgba(16, 185, 129, 0.15),
              inset 0 1px 0 rgba(255, 255, 255, 0.2)
            `},children:[e.jsx(I,{Icon:v.Check,size:18,style:{filter:"drop-shadow(0 0 6px rgba(255,255,255,0.4))"}}),"Valider"]}),e.jsxs(w.button,{onClick:i,whileHover:{scale:1.02,y:-1},whileTap:{scale:.98},className:"flex-1 flex items-center justify-center gap-2",style:{padding:"14px 24px",background:`
              radial-gradient(circle at 30% 30%, rgba(251, 146, 60, 0.15) 0%, transparent 70%),
              rgba(255, 255, 255, 0.08)
            `,border:"1.5px solid rgba(251, 146, 60, 0.3)",borderRadius:"14px",color:"#FB923C",fontSize:"15px",fontWeight:"700",cursor:"pointer",boxShadow:`
              0 2px 8px rgba(0, 0, 0, 0.15),
              0 0 16px rgba(251, 146, 60, 0.12)
            `,backdropFilter:"blur(12px)"},children:[e.jsx(I,{Icon:v.RefreshCw,size:18,style:{color:"#FB923C",filter:"drop-shadow(0 0 6px rgba(251, 146, 60, 0.4))"}}),"Modifier"]})]})]}),Ws=({exerciseName:s,newParameters:t,onViewExercise:a,onContinue:r,stepColor:i})=>{const o=()=>{const l=[];return t.sets&&l.push(`${t.sets} séries`),t.reps&&l.push(`${t.reps} reps`),t.load&&l.push(t.load),t.rest&&l.push(`${t.rest} repos`),t.tempo&&l.push(`tempo ${t.tempo}`),l.length>0?l.join(" • "):"Paramètres mis à jour"};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(w.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:200,damping:15},className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2.5 rounded-full flex-shrink-0",style:{background:`
              linear-gradient(135deg, #10B981 0%, #059669 100%)
            `,boxShadow:`
              0 4px 12px rgba(16, 185, 129, 0.3),
              0 0 20px rgba(16, 185, 129, 0.2),
              inset 0 1px 0 rgba(255, 255, 255, 0.25)
            `},children:e.jsx(I,{Icon:v.CheckCircle2,size:24,style:{color:"white",filter:"drop-shadow(0 0 8px rgba(255,255,255,0.5))"}})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-white font-bold text-[16px] mb-1",children:"Modification appliquée ! ✓"}),e.jsxs("div",{className:"text-white/70 text-[14px] leading-relaxed",children:[e.jsx("strong",{className:"text-white",children:s})," a été mis à jour"]})]})]}),e.jsxs(w.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"parameters-preview",style:{padding:"14px 16px",background:`
            radial-gradient(circle at 30% 20%, rgba(16, 185, 129, 0.12) 0%, transparent 70%),
            rgba(255, 255, 255, 0.06)
          `,border:"1.5px solid rgba(16, 185, 129, 0.25)",borderRadius:"12px",backdropFilter:"blur(12px)",boxShadow:`
            0 2px 8px rgba(0, 0, 0, 0.15),
            0 0 16px rgba(16, 185, 129, 0.1)
          `},children:[e.jsx("div",{className:"text-[12px] text-emerald-400 font-bold uppercase tracking-wide mb-1",children:"Nouveaux paramètres"}),e.jsx("div",{className:"text-white text-[13px] font-medium",children:o()})]}),e.jsx("p",{className:"text-white/80 text-[14px] leading-relaxed",children:"Regarde la carte mise à jour ou continue tes ajustements ! 💪"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(w.button,{onClick:a,whileHover:{scale:1.02,y:-1},whileTap:{scale:.98},className:"flex-1 flex items-center justify-center gap-2",style:{padding:"14px 20px",background:`
              radial-gradient(circle at 30% 30%, color-mix(in srgb, ${i} 18%, transparent) 0%, transparent 70%),
              rgba(255, 255, 255, 0.1)
            `,border:`1.5px solid color-mix(in srgb, ${i} 35%, transparent)`,borderRadius:"14px",fontSize:"15px",fontWeight:"700",cursor:"pointer",boxShadow:`
              0 2px 10px rgba(0, 0, 0, 0.15),
              0 0 18px color-mix(in srgb, ${i} 15%, transparent)
            `,backdropFilter:"blur(12px)"},children:[e.jsx(I,{Icon:v.Eye,size:18,style:{color:i,filter:`drop-shadow(0 0 6px color-mix(in srgb, ${i} 45%, transparent))`}}),e.jsx("span",{style:{color:i,textShadow:`0 0 8px color-mix(in srgb, ${i} 30%, transparent)`},children:"Voir l'exercice"})]}),e.jsxs(w.button,{onClick:r,whileHover:{scale:1.02,y:-1},whileTap:{scale:.98},className:"flex-1 flex items-center justify-center gap-2",style:{padding:"14px 20px",background:"rgba(255, 255, 255, 0.08)",border:"1.5px solid rgba(255, 255, 255, 0.18)",borderRadius:"14px",color:"white",fontSize:"15px",fontWeight:"700",cursor:"pointer",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.15)",backdropFilter:"blur(12px)"},children:[e.jsx(I,{Icon:v.ArrowRight,size:18,style:{filter:"drop-shadow(0 0 4px rgba(255,255,255,0.3))"}}),"Continuer"]})]})]})},Vs=({message:s,stepColor:t,onExerciseClick:a,onCategorySelect:r,onOptionSelect:i,onValidate:o,onModify:l,onViewExercise:c,onContinue:d,onBack:p})=>{switch(s.type){case"exercise-list-intro":if(s.metadata?.exerciseListData&&a){const{exercises:h,programType:m,introText:u}=s.metadata.exerciseListData;return e.jsx(Ps,{exercises:h,programType:m,introText:u,onExerciseClick:a,stepColor:t})}break;case"category-selection":if(s.metadata?.exerciseName&&r)return e.jsx(Hs,{exerciseName:s.metadata.exerciseName,onCategorySelect:r,stepColor:t});break;case"option-selection":if(s.metadata?.exerciseName&&s.metadata?.category&&i&&p)return e.jsx(zs,{exerciseName:s.metadata.exerciseName,category:s.metadata.category,onOptionSelect:i,onBack:p,stepColor:t});break;case"validation":if(s.metadata?.validationData&&o&&l){const{exerciseName:h,adjustmentLabel:m,summary:u}=s.metadata.validationData;return e.jsx(Us,{exerciseName:h,adjustmentLabel:m,summary:u,onValidate:o,onModify:l,stepColor:t})}break;case"update-complete":if(s.metadata?.updateCompleteData&&c&&d){const{exerciseName:h,newParameters:m}=s.metadata.updateCompleteData;return e.jsx(Ws,{exerciseName:h,newParameters:m,onViewExercise:c,onContinue:d,stepColor:t})}break;default:return e.jsx(Ee,{message:s,stepColor:t})}return e.jsx(Ee,{message:s,stepColor:t})},qs=({stepColor:s})=>e.jsx(w.div,{initial:{opacity:0,y:10,x:-10},animate:{opacity:1,y:0,x:0},exit:{opacity:0,y:-10},className:"flex justify-start mb-4",children:e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("div",{className:"message-avatar w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
              radial-gradient(circle at 30% 30%, color-mix(in srgb, ${s} 40%, transparent) 0%, transparent 70%),
              rgba(255, 255, 255, 0.1)
            `,border:`1.5px solid color-mix(in srgb, ${s} 50%, transparent)`,boxShadow:`0 0 12px color-mix(in srgb, ${s} 30%, transparent)`},children:e.jsx(I,{Icon:v.Zap,size:16,style:{color:s,filter:`drop-shadow(0 0 8px color-mix(in srgb, ${s} 60%, transparent))`}})}),e.jsx("div",{className:"typing-indicator px-5 py-3 rounded-2xl",style:{background:`
              radial-gradient(circle at 30% 30%, color-mix(in srgb, ${s} 15%, transparent) 0%, transparent 70%),
              rgba(255, 255, 255, 0.08)
            `,border:`1px solid color-mix(in srgb, ${s} 25%, transparent)`,boxShadow:`
              0 2px 8px rgba(0, 0, 0, 0.2),
              0 0 16px color-mix(in srgb, ${s} 15%, transparent),
              inset 0 1px 0 rgba(255, 255, 255, 0.1)
            `,backdropFilter:"blur(12px) saturate(140%)",WebkitBackdropFilter:"blur(12px) saturate(140%)",borderRadius:"4px 16px 16px 16px"},children:e.jsx("div",{className:"flex items-center gap-1.5",children:[0,1,2].map(t=>e.jsx("div",{className:"typing-dot",style:{background:`color-mix(in srgb, ${s} 60%, white)`}},t))})})]})}),Gs=({frequencies:s,color:t,isActive:a,height:r=80,barCount:i=32,className:o=""})=>{const l=E.useRef(null),c=E.useRef();return E.useEffect(()=>{const d=l.current;if(!d)return;const p=d.getContext("2d");if(!p)return;const h=window.devicePixelRatio||1,m=d.getBoundingClientRect();d.width=m.width*h,d.height=m.height*h,p.scale(h,h);const u=m.width/i,f=2,g=()=>{p.clearRect(0,0,m.width,m.height);for(let x=0;x<i;x++){const b=Math.floor(x/i*s.length),y=s[b]||0,C=Math.min(y/255,1),j=C*r*.8,S=x*u,N=r-j,T=p.createLinearGradient(S,N,S,r);T.addColorStop(0,t),T.addColorStop(1,`${t}40`),p.fillStyle=T,p.fillRect(S,N,u-f,j),a&&C>.1&&(p.shadowBlur=8,p.shadowColor=t,p.fillRect(S,N,u-f,j),p.shadowBlur=0)}c.current=requestAnimationFrame(g)};return g(),()=>{c.current&&cancelAnimationFrame(c.current)}},[s,t,a,r,i]),e.jsxs("div",{className:`audio-waveform-container ${o}`,style:{width:"100%",height:r},children:[e.jsx("canvas",{ref:l,style:{width:"100%",height:"100%",display:"block",transform:"translateZ(0)",willChange:"transform"}}),!a&&e.jsx(w.div,{className:"waveform-overlay",style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:e.jsx(w.div,{animate:{scale:[1,1.05,1],opacity:[.5,.8,.5]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},style:{fontSize:"0.75rem",color:"rgba(255, 255, 255, 0.5)",textAlign:"center"},children:"En attente..."})})]})},Js=s=>{const t=[];return(s.toLowerCase().includes("prêt")||s.toLowerCase().includes("commencer"))&&(t.push({label:"Oui, allons-y !",action:"confirm"}),t.push({label:"Pas encore",action:"wait"})),(s.toLowerCase().includes("ajuster")||s.toLowerCase().includes("modifier"))&&(t.push({label:"Modifier",action:"modify"}),t.push({label:"C'est bon",action:"keep"})),t},Xs=({stepColor:s,isTyping:t=!1,className:a="",messagesContainerRef:r,onScrollChange:i,onExerciseClick:o,onCategorySelect:l,onOptionSelect:c,onValidate:d,onModify:p,onViewExercise:h,onContinue:m,onBack:u,onSendMessage:f})=>{const g=E.useRef(null),x=E.useRef(null),b=r||x,y=z(A=>A.messages),C=z(A=>A.currentMode),j=z(A=>A.voiceState),S=z(A=>A.currentTranscription),N=z(A=>A.isSpeaking),T=z(A=>A.visualization),R=j==="listening"||j==="speaking"||j==="processing",$=(A=!0)=>{g.current?.scrollIntoView({behavior:A?"smooth":"auto",block:"end"})};E.useEffect(()=>{$(!0)},[y,t]);const P=()=>{if(!b.current)return;const{scrollTop:A,scrollHeight:M,clientHeight:K}=b.current,Z=!(M-A-K<100);i&&i(Z)};return e.jsxs("div",{ref:b,onScroll:P,className:`messages-container flex-1 overflow-y-auto px-2.5 pt-1.5 pb-0 ${a}`,style:{overscrollBehavior:"contain",minHeight:0},children:[e.jsx(H,{children:R&&e.jsxs(w.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},style:{position:"sticky",top:0,zIndex:10,marginBottom:"12px",padding:"12px 16px",borderRadius:"16px",background:`
                linear-gradient(180deg,
                  rgba(239, 68, 68, 0.25) 0%,
                  rgba(220, 38, 38, 0.15) 100%
                )
              `,backdropFilter:"blur(20px)",border:"1.5px solid rgba(239, 68, 68, 0.4)",boxShadow:"0 4px 24px rgba(239, 68, 68, 0.2), 0 0 32px rgba(239, 68, 68, 0.15)",display:"flex",flexDirection:"column",gap:"8px"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(w.div,{animate:{scale:N?[1,1.2,1]:1,opacity:N?[.6,1,.6]:1},transition:{duration:1.5,repeat:1/0},style:{width:"10px",height:"10px",borderRadius:"50%",background:N?"#10B981":"#EF4444",boxShadow:N?"0 0 12px rgba(16, 185, 129, 0.8)":"0 0 12px rgba(239, 68, 68, 0.8)"}}),e.jsxs("span",{style:{fontSize:"13px",fontWeight:600,color:"#FFF"},children:[j==="listening"&&"En écoute...",j==="speaking"&&"Coach parle...",j==="processing"&&"Traitement..."]})]})}),T.frequencies&&T.frequencies.length>0&&e.jsx(Gs,{frequencies:T.frequencies,color:N?"#10B981":"#EF4444",isActive:R,height:40}),S&&e.jsxs(w.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},style:{fontSize:"12px",color:"rgba(255, 255, 255, 0.8)",fontStyle:"italic",paddingTop:"8px",borderTop:"1px solid rgba(255, 255, 255, 0.1)"},children:["Vous: ",S,"..."]})]})}),y.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center h-full text-center py-4",children:e.jsxs(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"max-w-md",children:[e.jsx("div",{className:"w-16 h-16 rounded-full mx-auto mb-4 flex items-center justify-center",style:{background:`
                  radial-gradient(circle at 30% 30%, color-mix(in srgb, ${s} 35%, transparent) 0%, transparent 70%),
                  rgba(255, 255, 255, 0.1)
                `,border:`2px solid color-mix(in srgb, ${s} 40%, transparent)`,boxShadow:`0 0 24px color-mix(in srgb, ${s} 25%, transparent)`},children:e.jsx(w.div,{animate:{scale:[1,1.1,1],rotate:[0,5,-5,0]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:e.jsx("span",{className:"text-3xl",children:"💪"})})}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Ton Coach est Prêt !"}),e.jsx("p",{className:"text-sm text-white/60 leading-relaxed",children:"Utilise le chat ci-dessous pour échanger avec ton coach IA"})]})}):e.jsxs(e.Fragment,{children:[y.map(A=>{const M=A;if(["exercise-list-intro","category-selection","option-selection","validation","update-complete"].includes(M.type)&&C==="training")return e.jsx(Vs,{message:M,stepColor:s,onExerciseClick:o,onCategorySelect:l,onOptionSelect:c,onValidate:d,onModify:p,onViewExercise:h,onContinue:m,onBack:u},A.id);const D=A.role==="coach"&&C==="training"&&A.type==="text",F=D?Js(A.content):[],O=V=>{if(!f)return;const U={"reduce-intensity":"Je voudrais réduire la difficulté","increase-intensity":"J'aimerais augmenter l'intensité","adjust-sets":"Je veux ajuster le nombre de séries","adjust-reps":"Je veux modifier les répétitions","show-alternatives":"Montre-moi les alternatives","keep-exercise":"Je garde cet exercice","keep-as-is":"C'est parfait comme ça","yes-perfect":"Oui, c'est parfait !","need-changes":"J'aimerais faire quelques ajustements",understood:"Compris"}[V]||"OK";f(U)};return e.jsx(Ee,{message:A,stepColor:s,showCTA:D,ctaButtons:F,onCTAClick:O},A.id)}),t&&e.jsx(qs,{stepColor:s}),e.jsx("div",{ref:g})]}),e.jsx("style",{children:`
        .messages-container {
          scrollbar-width: thin;
          scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
        }

        .messages-container::-webkit-scrollbar {
          width: 6px;
        }

        .messages-container::-webkit-scrollbar-track {
          background: transparent;
        }

        .messages-container::-webkit-scrollbar-thumb {
          background: rgba(255, 255, 255, 0.2);
          border-radius: 3px;
        }

        .messages-container::-webkit-scrollbar-thumb:hover {
          background: rgba(255, 255, 255, 0.3);
        }
      `})]})};class Ks{constructor(){k(this,"mediaRecorder",null);k(this,"audioChunks",[]);k(this,"isRecording",!1);k(this,"stream",null)}async startRecording(){try{n.info("WHISPER_SERVICE","Starting audio recording"),this.stream=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:16e3,channelCount:1}}),n.info("WHISPER_SERVICE","Microphone access granted");const t=this.getSupportedMimeType();this.mediaRecorder=new MediaRecorder(this.stream,{mimeType:t,audioBitsPerSecond:128e3}),this.audioChunks=[],this.mediaRecorder.ondataavailable=a=>{a.data.size>0&&(this.audioChunks.push(a.data),n.debug("WHISPER_SERVICE",`Audio chunk captured: ${a.data.size} bytes`))},this.mediaRecorder.start(100),this.isRecording=!0,n.info("WHISPER_SERVICE","Recording started successfully",{mimeType:t,audioBitsPerSecond:128e3})}catch(t){throw n.error("WHISPER_SERVICE","Failed to start recording",{error:t}),new Error("Impossible d'accéder au microphone")}}async stopRecording(){return new Promise((t,a)=>{if(!this.mediaRecorder||!this.isRecording){a(new Error("Aucun enregistrement en cours"));return}n.info("WHISPER_SERVICE","Stopping recording"),this.mediaRecorder.onstop=()=>{const r=this.getSupportedMimeType(),i=new Blob(this.audioChunks,{type:r});n.info("WHISPER_SERVICE","Recording stopped",{size:i.size,type:i.type,chunks:this.audioChunks.length}),this.cleanup(),t(i)},this.mediaRecorder.onerror=r=>{n.error("WHISPER_SERVICE","MediaRecorder error",{event:r}),this.cleanup(),a(new Error("Erreur lors de l'enregistrement"))},this.mediaRecorder.stop(),this.isRecording=!1})}async transcribe(t){try{if(n.info("WHISPER_SERVICE","Starting transcription",{size:t.size,type:t.type}),t.size<1024)throw new Error("L'enregistrement est trop court");if(t.size>25*1024*1024)throw new Error("L'enregistrement est trop long");const a=new FormData;a.append("audio",t,"recording.webm");const r="https://kwipydbtjagypocpvbwn.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3aXB5ZGJ0amFneXBvY3B2YnduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODg0MjIsImV4cCI6MjA3MDI2NDQyMn0.IS5IdKbmnGtgU_AaGYtUgX3ewaNpsiSAui5kbFV31_U",o=await fetch(`${r}/functions/v1/audio-transcribe`,{method:"POST",headers:{Authorization:`Bearer ${i}`,apikey:i},body:a});if(!o.ok){const c=await o.json();throw n.error("WHISPER_SERVICE","Transcription failed",{status:o.status,error:c}),new Error(c.error||"Erreur lors de la transcription")}const l=await o.json();return n.info("WHISPER_SERVICE","Transcription successful",{textLength:l.text.length,language:l.language,duration:l.duration}),l}catch(a){throw n.error("WHISPER_SERVICE","Transcription error",{error:a}),a}}async recordAndTranscribe(){try{n.info("WHISPER_SERVICE","Starting record and transcribe flow"),await this.startRecording();const t=await this.stopRecording();return(await this.transcribe(t)).text}catch(t){throw n.error("WHISPER_SERVICE","Record and transcribe error",{error:t}),t}}cleanup(){this.stream&&(this.stream.getTracks().forEach(t=>t.stop()),this.stream=null),this.mediaRecorder=null,this.audioChunks=[],this.isRecording=!1,n.debug("WHISPER_SERVICE","Resources cleaned up")}getSupportedMimeType(){const t=["audio/webm;codecs=opus","audio/webm","audio/ogg;codecs=opus","audio/mp4","audio/mpeg"];for(const a of t)if(MediaRecorder.isTypeSupported(a))return a;return"audio/webm"}get recording(){return this.isRecording}cancelRecording(){this.mediaRecorder&&this.isRecording&&(n.info("WHISPER_SERVICE","Cancelling recording"),this.mediaRecorder.stop(),this.cleanup())}}const ve=new Ks,ze=({mode:s,message:t,onMessageChange:a,onSubmit:r,onKeyDown:i,placeholder:o,isFocused:l,onFocus:c,onBlur:d,textareaRef:p,disabled:h,isRecording:m,isTranscribing:u,onStopRecording:f,transcribedText:g,voiceState:x,onStopRealtime:b,stepColor:y})=>{if(s==="text")return e.jsx("div",{className:"flex-1 relative",children:e.jsx("textarea",{ref:p,value:t,onChange:C=>a(C.target.value),onKeyDown:i,onFocus:c,onBlur:d,placeholder:o,disabled:h,rows:1,className:"chat-textarea w-full resize-none bg-transparent border-none outline-none text-white placeholder-white/40 text-sm leading-relaxed py-1.5 px-1.5",style:{maxHeight:"90px",minHeight:"32px"}})});if(s==="voice-to-text")return e.jsxs(w.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.2},style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"16px",padding:"24px 16px",minHeight:"200px"},children:[e.jsxs(w.div,{animate:{scale:m?[1,1.02,1]:1},transition:{duration:1.2,repeat:m?1/0:0,ease:"easeInOut"},style:{position:"relative",width:"120px",height:"120px",borderRadius:"50%",background:m?"linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.4))":"rgba(11, 14, 23, 0.95)",border:m?`3px solid ${y}80`:"2px solid rgba(255, 255, 255, 0.2)",boxShadow:m?`0 0 40px ${y}40, 0 8px 24px rgba(0, 0, 0, 0.6)`:"0 4px 20px rgba(0, 0, 0, 0.3)",display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx(I,{Icon:u?v.Loader:v.Mic,size:48,style:{color:y,filter:`drop-shadow(0 0 12px ${y}80)`},className:u?"animate-spin":""}),m&&e.jsxs(e.Fragment,{children:[e.jsx(w.div,{style:{position:"absolute",inset:-8,borderRadius:"50%",border:`2px solid ${y}40`,pointerEvents:"none"},animate:{scale:[1,1.15,1],opacity:[.5,0,.5]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}}),e.jsx(w.div,{style:{position:"absolute",inset:-16,borderRadius:"50%",border:`2px solid ${y}30`,pointerEvents:"none"},animate:{scale:[1,1.2,1],opacity:[.3,0,.3]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut",delay:.25}})]})]}),e.jsxs("div",{style:{textAlign:"center",width:"100%",maxWidth:"300px"},children:[e.jsx("div",{style:{fontSize:"15px",fontWeight:600,color:u?"rgba(255, 255, 255, 0.7)":y},children:u?"Transcription...":"Enregistrement en cours"}),e.jsx("div",{style:{fontSize:"13px",color:"rgba(255, 255, 255, 0.5)",marginTop:"6px"},children:u?"Analyse de votre message":"Appuyez pour terminer"}),g&&!u&&e.jsxs(w.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},style:{marginTop:"16px",padding:"12px 16px",borderRadius:"12px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",backdropFilter:"blur(8px)",fontSize:"14px",color:"rgba(255, 255, 255, 0.9)",lineHeight:"1.5",textAlign:"left"},children:[e.jsx("div",{style:{fontSize:"11px",color:"rgba(255, 255, 255, 0.5)",marginBottom:"6px"},children:"Transcription:"}),g]})]}),m&&!u&&e.jsxs(w.button,{onClick:f,whileHover:{scale:1.05},whileTap:{scale:.95},style:{padding:"12px 24px",borderRadius:"20px",background:`linear-gradient(135deg, ${y}E6, ${y}CC)`,border:`2px solid ${y}`,boxShadow:`0 4px 16px ${y}30, 0 0 32px ${y}20`,display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[e.jsx(I,{Icon:v.Square,size:16,style:{color:"#fff"}}),e.jsx("span",{style:{fontSize:"14px",fontWeight:600,color:"#fff"},children:"Terminer"})]})]});if(s==="realtime"){const C=x==="connecting",j=x==="listening",S=x==="speaking",N=x==="processing",T=x==="error",R=j||S;return e.jsxs(w.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.2},style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"16px",padding:"24px 16px",minHeight:"200px"},children:[e.jsxs(w.div,{animate:{scale:S?[1,1.02,1]:1},transition:{duration:1.2,repeat:S?1/0:0,ease:"easeInOut"},style:{position:"relative",width:"120px",height:"120px",borderRadius:"50%",background:R?"linear-gradient(135deg, rgba(239, 68, 68, 0.3), rgba(220, 38, 38, 0.4))":"rgba(11, 14, 23, 0.95)",border:R?"3px solid rgba(239, 68, 68, 0.6)":"2px solid rgba(255, 255, 255, 0.2)",boxShadow:R?"0 0 40px rgba(239, 68, 68, 0.4), 0 8px 24px rgba(0, 0, 0, 0.6)":"0 4px 20px rgba(0, 0, 0, 0.3)",display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx(H,{mode:"wait",children:S?e.jsx(w.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(I,{Icon:v.Radio,size:48,style:{color:"rgba(239, 68, 68, 0.95)",filter:"drop-shadow(0 0 12px rgba(239, 68, 68, 0.8))"}})},"speaking"):j?e.jsx(w.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(I,{Icon:v.Mic,size:48,style:{color:"rgba(239, 68, 68, 0.95)",filter:"drop-shadow(0 0 12px rgba(239, 68, 68, 0.8))"}})},"listening"):e.jsx(w.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(I,{Icon:v.Loader,size:48,style:{color:"rgba(255, 255, 255, 0.5)"},className:C?"animate-spin":""})},"idle")}),j&&e.jsxs(e.Fragment,{children:[e.jsx(w.div,{style:{position:"absolute",inset:-8,borderRadius:"50%",border:"2px solid rgba(239, 68, 68, 0.4)",pointerEvents:"none"},animate:{scale:[1,1.15,1],opacity:[.5,0,.5]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}}),e.jsx(w.div,{style:{position:"absolute",inset:-16,borderRadius:"50%",border:"2px solid rgba(239, 68, 68, 0.3)",pointerEvents:"none"},animate:{scale:[1,1.2,1],opacity:[.3,0,.3]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut",delay:.25}})]})]}),e.jsx("div",{style:{textAlign:"center"},children:e.jsxs(H,{mode:"wait",children:[C&&e.jsx(w.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},style:{fontSize:"15px",fontWeight:600,color:"#fff"},children:"Connexion..."},"connecting"),j&&e.jsx(w.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},style:{fontSize:"15px",fontWeight:600,color:"#EF4444"},children:"Je t'écoute"},"listening"),S&&e.jsx(w.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},style:{fontSize:"15px",fontWeight:600,color:"#EF4444"},children:"Coach parle..."},"speaking"),N&&e.jsx(w.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},style:{fontSize:"15px",fontWeight:600,color:"rgba(255, 255, 255, 0.7)"},children:"Traitement..."},"processing"),T&&e.jsx(w.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},style:{fontSize:"15px",fontWeight:600,color:"#EF4444"},children:"Erreur"},"error")]})}),e.jsxs(w.button,{onClick:b,whileHover:{scale:1.05},whileTap:{scale:.95},style:{padding:"12px 24px",borderRadius:"20px",background:"linear-gradient(135deg, rgba(239, 68, 68, 0.9), rgba(220, 38, 38, 0.9))",border:"2px solid rgba(239, 68, 68, 0.6)",boxShadow:"0 4px 16px rgba(239, 68, 68, 0.3), 0 0 32px rgba(239, 68, 68, 0.2)",display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[e.jsx(I,{Icon:v.Square,size:16,style:{color:"#fff"}}),e.jsx("span",{style:{fontSize:"14px",fontWeight:600,color:"#fff"},children:"Terminer"})]})]})}return null},Ys=({onSendMessage:s,onStartVoiceRecording:t,onStopVoiceRecording:a,onStartRealtimeSession:r,onStopRealtimeSession:i,isRecording:o,isProcessing:l,isSpeaking:c,realtimeState:d,realtimeError:p,voiceEnabled:h,stepColor:m,placeholder:u="Parle à ton coach...",disabled:f=!1})=>{const[g,x]=E.useState(""),[b,y]=E.useState(!1),[C,j]=E.useState(!1),[S,N]=E.useState(void 0),[T,R]=E.useState(""),$=E.useRef(null),{click:P}=G(),A=z(L=>L.setInputMode),[M,K]=E.useState("text");E.useEffect(()=>{let L="text";o||C?L="voice-to-text":d!=="idle"&&d!=="error"&&(L="realtime"),K(L),A(L),n.debug("CHAT_INPUT_BAR","Input mode changed",{mode:L,isRecording:o,isTranscribing:C,realtimeState:d})},[o,C,d,A]),E.useEffect(()=>{$.current&&($.current.style.height="auto",$.current.style.height=`${Math.min($.current.scrollHeight,120)}px`)},[g]);const Y=()=>{g.trim()&&!f&&(s(g.trim()),x(""),P(),Q.tap(),$.current&&($.current.style.height="auto"))},Z=L=>{L.key==="Enter"&&!L.shiftKey&&(L.preventDefault(),Y())},D=async()=>{if(P(),Q.press(),o){n.info("CHAT_INPUT_BAR","Stopping voice recording and starting transcription"),a();try{N(void 0),R("");const L=await ve.stopRecording();n.info("CHAT_INPUT_BAR","Audio blob captured",{size:L.size}),j(!0);const U=await ve.transcribe(L);j(!1),n.info("CHAT_INPUT_BAR","Transcription completed",{textLength:U.text.length,text:U.text}),U.text.trim()?(R(U.text.trim()),setTimeout(()=>{s(U.text.trim()),R(""),Q.impact(),n.info("CHAT_INPUT_BAR","Returning to text mode after voice-to-text message sent")},500)):(N("Aucun texte détecté dans l'enregistrement"),n.info("CHAT_INPUT_BAR","Returning to text mode after transcription error"))}catch(L){j(!1);const U=L instanceof Error?L.message:"Erreur de transcription";N(U),n.error("CHAT_INPUT_BAR","Transcription error",{error:U}),n.info("CHAT_INPUT_BAR","Returning to text mode after transcription exception")}}else{n.info("CHAT_INPUT_BAR","Starting voice recording");try{N(void 0),R(""),await ve.startRecording(),t()}catch(L){const U=L instanceof Error?L.message:"Erreur microphone";N(U),n.error("CHAT_INPUT_BAR","Recording start error",{error:U})}}},F=async()=>{P(),Q.press(),d==="idle"||d==="error"?await r():i()},O=d!=="idle"&&d!=="error",V=O||o||C;return e.jsxs("div",{className:"chat-input-bar-container",style:{position:"relative",width:"100%",zIndex:1,pointerEvents:f?"none":"auto",opacity:f?.6:1,margin:"0",padding:"0"},children:[e.jsxs(H,{children:[p&&e.jsx(w.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},style:{padding:"8px 16px",marginBottom:"8px",borderRadius:"12px",background:"linear-gradient(180deg, rgba(220, 38, 38, 0.2) 0%, rgba(153, 27, 27, 0.15) 100%)",backdropFilter:"blur(16px)",border:"1px solid rgba(239, 68, 68, 0.4)",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"8px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(I,{Icon:v.AlertTriangle,size:14,style:{color:"#EF4444"}}),e.jsx("span",{style:{fontSize:"12px",color:"rgba(255, 255, 255, 0.9)"},children:p})]})}),S&&e.jsx(w.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},style:{padding:"8px 16px",marginBottom:"8px",borderRadius:"12px",background:"linear-gradient(180deg, rgba(220, 38, 38, 0.2) 0%, rgba(153, 27, 27, 0.15) 100%)",backdropFilter:"blur(16px)",border:"1px solid rgba(239, 68, 68, 0.4)",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"8px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(I,{Icon:v.AlertTriangle,size:14,style:{color:"#EF4444"}}),e.jsx("span",{style:{fontSize:"12px",color:"rgba(255, 255, 255, 0.9)"},children:S})]})})]}),e.jsx(H,{children:d==="connecting"&&e.jsxs(w.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},style:{padding:"6px 16px",marginBottom:"8px",borderRadius:"12px",background:"linear-gradient(180deg, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.1) 100%)",backdropFilter:"blur(16px)",border:"1px solid rgba(239, 68, 68, 0.4)",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[e.jsx(w.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},style:{width:"12px",height:"12px",border:"2px solid #EF4444",borderTopColor:"transparent",borderRadius:"50%"}}),e.jsx("span",{style:{fontSize:"12px",color:"rgba(255, 255, 255, 0.9)"},children:"Connexion au coach vocal..."})]})}),e.jsxs(H,{children:[l&&e.jsxs(w.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},style:{padding:"6px 16px",marginBottom:"8px",borderRadius:"12px",background:`
                linear-gradient(180deg,
                  rgba(11, 14, 23, 0.8) 0%,
                  rgba(11, 14, 23, 0.6) 100%
                )
              `,backdropFilter:"blur(16px)",border:`1px solid color-mix(in srgb, ${m} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[e.jsx(w.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},style:{width:"12px",height:"12px",border:`2px solid ${m}`,borderTopColor:"transparent",borderRadius:"50%"}}),e.jsx("span",{style:{fontSize:"12px",color:"rgba(255, 255, 255, 0.7)"},children:"Traitement en cours..."})]}),C&&e.jsxs(w.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},style:{padding:"6px 16px",marginBottom:"8px",borderRadius:"12px",background:`
                linear-gradient(180deg,
                  rgba(11, 14, 23, 0.8) 0%,
                  rgba(11, 14, 23, 0.6) 100%
                )
              `,backdropFilter:"blur(16px)",border:`1px solid color-mix(in srgb, ${m} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[e.jsx(w.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},style:{width:"12px",height:"12px",border:`2px solid ${m}`,borderTopColor:"transparent",borderRadius:"50%"}}),e.jsx("span",{style:{fontSize:"12px",color:"rgba(255, 255, 255, 0.7)"},children:"Transcription en cours..."})]})]}),e.jsx(H,{mode:"wait",children:V?e.jsx(w.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.3,ease:"easeOut"},className:"chat-input-bar",style:{background:`
                radial-gradient(ellipse at 50% 100%, color-mix(in srgb, ${m} 20%, transparent) 0%, transparent 60%),
                var(--liquid-reflections-multi),
                var(--liquid-highlight-ambient),
                var(--liquid-glass-bg-elevated)
              `,backdropFilter:"blur(var(--liquid-bottombar-blur)) saturate(var(--liquid-bottombar-saturate))",WebkitBackdropFilter:"blur(var(--liquid-bottombar-blur)) saturate(var(--liquid-bottombar-saturate))",border:`1.5px solid color-mix(in srgb, ${m} 40%, transparent)`,boxShadow:`
                0 4px 24px rgba(0, 0, 0, 0.25),
                0 0 32px color-mix(in srgb, ${m} 20%, transparent),
                inset 0 1px 0 rgba(255, 255, 255, 0.15)
              `,borderRadius:"18px",padding:"0",minHeight:"240px",transition:"all 0.3s cubic-bezier(0.25, 0.1, 0.25, 1)",overflow:"hidden"},children:e.jsx(ze,{mode:M,message:g,onMessageChange:x,onSubmit:Y,onKeyDown:Z,placeholder:u,isFocused:b,onFocus:()=>y(!0),onBlur:()=>y(!1),textareaRef:$,disabled:f,isRecording:o,isTranscribing:C,onStopRecording:D,transcribedText:T,voiceState:d,onStopRealtime:F,stepColor:m})},"voice-mode"):e.jsx(w.div,{initial:{opacity:.8,scale:.98},animate:{opacity:1,scale:1},exit:{opacity:.8,scale:.98},transition:{duration:.2,ease:"easeInOut"},className:`chat-input-bar ${b?"chat-input-bar--focused":""}`,style:{background:`
                radial-gradient(ellipse at 50% 100%, color-mix(in srgb, ${m} 12%, transparent) 0%, transparent 60%),
                var(--liquid-reflections-multi),
                var(--liquid-highlight-ambient),
                var(--liquid-glass-bg-base)
              `,backdropFilter:"blur(var(--liquid-bottombar-blur)) saturate(var(--liquid-bottombar-saturate))",WebkitBackdropFilter:"blur(var(--liquid-bottombar-blur)) saturate(var(--liquid-bottombar-saturate))",border:b?`1.5px solid color-mix(in srgb, ${m} 40%, transparent)`:"1.5px solid rgba(255, 255, 255, 0.15)",boxShadow:b?`
                    0 4px 24px rgba(0, 0, 0, 0.25),
                    0 0 32px color-mix(in srgb, ${m} 20%, transparent),
                    inset 0 1px 0 rgba(255, 255, 255, 0.15)
                  `:`
                    0 4px 20px rgba(0, 0, 0, 0.2),
                    0 0 24px rgba(255, 255, 255, 0.05),
                    inset 0 1px 0 rgba(255, 255, 255, 0.1)
                  `,borderRadius:"18px",padding:"6px 8px",minHeight:"auto",transition:"all 0.3s cubic-bezier(0.25, 0.1, 0.25, 1)",overflow:"hidden",willChange:"transform, opacity"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[h&&e.jsxs(w.button,{onClick:D,className:`chat-input-button flex-shrink-0 w-9 h-9 rounded-full flex items-center justify-center ${o?"chat-input-button--recording":""}`,style:{background:o?`
                      radial-gradient(circle at 30% 30%, rgba(239, 68, 68, 0.3) 0%, transparent 70%),
                      rgba(239, 68, 68, 0.15)
                    `:`
                      radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.18) 0%, transparent 50%),
                      var(--liquid-pill-bg)
                    `,border:o?"1.5px solid rgba(239, 68, 68, 0.5)":"1px solid rgba(255, 255, 255, 0.2)",boxShadow:o?"0 0 20px rgba(239, 68, 68, 0.3), 0 4px 12px rgba(0, 0, 0, 0.2)":"var(--liquid-pill-shadow)"},whileHover:{scale:1.05},whileTap:{scale:.95},disabled:f||l,children:[e.jsx(H,{mode:"wait",children:o?e.jsx(w.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},exit:{scale:0,rotate:180},children:e.jsx(I,{Icon:v.MicOff,size:18,style:{color:"#EF4444"}})},"recording"):e.jsx(w.div,{initial:{scale:0,rotate:180},animate:{scale:1,rotate:0},exit:{scale:0,rotate:-180},children:e.jsx(I,{Icon:v.Mic,size:18,style:{color:"rgba(255, 255, 255, 0.7)"}})},"idle")}),o&&e.jsxs(e.Fragment,{children:[e.jsx(w.div,{style:{position:"absolute",inset:-4,borderRadius:"50%",border:"2px solid rgba(239, 68, 68, 0.6)",pointerEvents:"none"},animate:{scale:[1,1.3,1],opacity:[.8,0,.8]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}}),e.jsx(w.div,{style:{position:"absolute",inset:-8,borderRadius:"50%",border:"2px solid rgba(239, 68, 68, 0.4)",pointerEvents:"none"},animate:{scale:[1,1.5,1],opacity:[.6,0,.6]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut",delay:.3}})]})]}),e.jsx(ze,{mode:"text",message:g,onMessageChange:x,onSubmit:Y,onKeyDown:Z,placeholder:u,isFocused:b,onFocus:()=>y(!0),onBlur:()=>y(!1),textareaRef:$,disabled:f,isRecording:!1,isTranscribing:!1,onStopRecording:()=>{},transcribedText:"",voiceState:"idle",onStopRealtime:()=>{},stepColor:m}),h&&!g.trim()?e.jsxs(w.button,{onClick:F,className:"chat-input-button flex-shrink-0 w-9 h-9 rounded-full flex items-center justify-center relative",style:{background:O?"linear-gradient(135deg, rgba(239, 68, 68, 1) 0%, rgba(220, 38, 38, 1) 100%)":`
                      radial-gradient(circle at 30% 30%, rgba(239, 68, 68, 0.3) 0%, transparent 70%),
                      linear-gradient(135deg, rgba(239, 68, 68, 0.7), rgba(220, 38, 38, 0.8))
                    `,border:O?"3px solid rgba(255, 255, 255, 0.3)":"2px solid rgba(239, 68, 68, 0.6)",boxShadow:O?`
                      0 0 40px rgba(239, 68, 68, 0.8),
                      0 8px 24px rgba(0, 0, 0, 0.6),
                      inset 0 2px 0 rgba(255, 255, 255, 0.4)
                    `:`
                      0 0 20px rgba(239, 68, 68, 0.4),
                      0 4px 12px rgba(0, 0, 0, 0.3),
                      inset 0 1px 0 rgba(255, 255, 255, 0.2)
                    `},whileHover:{scale:1.08,boxShadow:O?`
                      0 0 50px rgba(239, 68, 68, 0.9),
                      0 10px 28px rgba(0, 0, 0, 0.7),
                      inset 0 2px 0 rgba(255, 255, 255, 0.5)
                    `:`
                      0 0 35px rgba(239, 68, 68, 0.7),
                      0 8px 20px rgba(0, 0, 0, 0.5),
                      inset 0 1px 0 rgba(255, 255, 255, 0.4)
                    `},whileTap:{scale:.92},disabled:f,children:[e.jsx(H,{mode:"wait",children:O?e.jsx(w.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{duration:.15},children:e.jsx(I,{Icon:v.Square,size:18,style:{color:"rgba(255, 255, 255, 0.95)",filter:"drop-shadow(0 0 8px rgba(255, 255, 255, 0.6))",zIndex:2,position:"relative"}})},"stop-icon"):e.jsx(w.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{duration:.15},children:e.jsx(I,{Icon:v.Radio,size:18,style:{color:"rgba(255, 255, 255, 0.85)",filter:"drop-shadow(0 0 4px rgba(255, 255, 255, 0.4))",zIndex:2,position:"relative"}})},"radio-icon")}),O&&e.jsx(w.div,{style:{position:"absolute",inset:-2,borderRadius:"50%",background:"rgba(239, 68, 68, 0.3)",filter:"blur(8px)",zIndex:-1},animate:{scale:[1,1.2,1],opacity:[.5,.8,.5]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}}),d==="connecting"&&e.jsx(w.div,{style:{position:"absolute",inset:-3,borderRadius:"50%",border:"2px solid transparent",borderTopColor:"#EF4444",borderRightColor:"#EF4444",pointerEvents:"none"},animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"}})]}):e.jsx(w.button,{onClick:Y,disabled:!g.trim()||f||l,className:`chat-input-button flex-shrink-0 w-9 h-9 rounded-full flex items-center justify-center ${g.trim()&&!f?"chat-input-button--send-enabled":""}`,initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},style:{background:g.trim()?`
                      radial-gradient(circle at 30% 30%, color-mix(in srgb, ${m} 35%, transparent) 0%, transparent 70%),
                      linear-gradient(135deg, color-mix(in srgb, ${m} 30%, transparent), color-mix(in srgb, ${m} 18%, transparent))
                    `:"rgba(255, 255, 255, 0.05)",border:g.trim()?`1.5px solid color-mix(in srgb, ${m} 50%, transparent)`:"1px solid rgba(255, 255, 255, 0.1)",boxShadow:g.trim()?`0 0 16px color-mix(in srgb, ${m} 25%, transparent), 0 4px 12px rgba(0, 0, 0, 0.2)`:"none",cursor:g.trim()&&!f?"pointer":"not-allowed",opacity:g.trim()&&!f?1:.5},whileHover:g.trim()&&!f?{scale:1.05}:void 0,whileTap:g.trim()&&!f?{scale:.95}:void 0,children:e.jsx(I,{Icon:v.Send,size:18,style:{color:g.trim()?m:"rgba(255, 255, 255, 0.4)",filter:g.trim()?`drop-shadow(0 0 8px color-mix(in srgb, ${m} 40%, transparent))`:"none"}})})]})},"text-mode")})]})},Zs=({stepColor:s,onSendMessage:t,isTyping:a=!1,className:r="",messagesContainerRef:i,onScrollChange:o,onExerciseClick:l,onCategorySelect:c,onOptionSelect:d,onValidate:p,onModify:h,onViewExercise:m,onContinue:u,onBack:f})=>{const g=z(M=>M.isRecording),x=z(M=>M.isProcessing),b=z(M=>M.isSpeaking),y=z(M=>M.voiceState),C=z(M=>M.currentMode),j=z(M=>M.error),[S,N]=E.useState(void 0),T={enabled:!0},R=()=>{n.info("COACH_CHAT_INTERFACE","Voice-to-text recording started via ChatInputBar"),z.getState().setRecording(!0),n.debug("COACH_CHAT_INTERFACE","Store isRecording set to TRUE")},$=()=>{n.info("COACH_CHAT_INTERFACE","Voice-to-text recording stopped via ChatInputBar"),z.getState().setRecording(!1),n.debug("COACH_CHAT_INTERFACE","Store isRecording set to FALSE")},P=async()=>{try{n.info("COACH_CHAT_INTERFACE","Starting Realtime session"),N(void 0),he.initialized||(n.info("COACH_CHAT_INTERFACE","Initializing voice coach orchestrator"),await he.initialize());const M=C||"force";n.info("COACH_CHAT_INTERFACE",`Starting voice session with mode: ${M}`),await he.startVoiceSession(M),n.info("COACH_CHAT_INTERFACE","Realtime session started successfully")}catch(M){n.error("COACH_CHAT_INTERFACE","Failed to start Realtime session",{error:M});const K=M instanceof Error?M.message:"Failed to start voice session";N(K),j&&N(j)}},A=()=>{try{n.info("COACH_CHAT_INTERFACE","Stopping Realtime session"),N(void 0),he.stopVoiceSession(),n.info("COACH_CHAT_INTERFACE","Realtime session stopped"),z.getState().setInputMode("text"),n.info("COACH_CHAT_INTERFACE","Returned to text mode after stopping Realtime")}catch(M){n.error("COACH_CHAT_INTERFACE","Error stopping Realtime session",{error:M})}};return E.useEffect(()=>{y==="idle"&&N(void 0)},[y]),e.jsxs("div",{className:`coach-chat-interface flex flex-col ${r}`,style:{height:"100%",position:"relative",minHeight:0},children:[e.jsx(Xs,{stepColor:s,isTyping:a,messagesContainerRef:i,onScrollChange:o,onExerciseClick:l,onCategorySelect:c,onOptionSelect:d,onValidate:p,onModify:h,onViewExercise:m,onContinue:u,onBack:f,onSendMessage:t}),e.jsx("div",{className:"chat-input-footer flex-shrink-0",style:{borderTop:y!=="idle"||g?"none":"1px solid rgba(255, 255, 255, 0.08)",padding:y!=="idle"||g?"0":"8px 8px 0px 8px",transition:"all 0.3s ease"},children:e.jsx(Ys,{onSendMessage:t,onStartVoiceRecording:R,onStopVoiceRecording:$,onStartRealtimeSession:P,onStopRealtimeSession:A,isRecording:g,isProcessing:x,isSpeaking:b,realtimeState:y,realtimeError:S,voiceEnabled:T.enabled,stepColor:s})})]})};class Qs{constructor(){k(this,"baseUrl");const t="https://kwipydbtjagypocpvbwn.supabase.co";this.baseUrl=`${t}/functions/v1`}async sendMessage(t){const a=`chat-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;try{n.info("CHAT_AI_SERVICE","🚀 Starting sendMessage request",{requestId:a,mode:t.mode,messageCount:t.messages.length,hasContext:!!t.contextData,baseUrl:this.baseUrl});const{data:{session:r}}=await B.auth.getSession();if(!r)throw n.error("CHAT_AI_SERVICE","❌ User not authenticated",{requestId:a}),new Error("User not authenticated");n.info("CHAT_AI_SERVICE","✅ Session validated, making fetch request",{requestId:a,userId:r.user.id,url:`${this.baseUrl}/chat-ai`});const i=await fetch(`${this.baseUrl}/chat-ai`,{method:"POST",headers:{Authorization:`Bearer ${r.access_token}`,"Content-Type":"application/json",apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3aXB5ZGJ0amFneXBvY3B2YnduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODg0MjIsImV4cCI6MjA3MDI2NDQyMn0.IS5IdKbmnGtgU_AaGYtUgX3ewaNpsiSAui5kbFV31_U"},body:JSON.stringify(t)});if(n.info("CHAT_AI_SERVICE","📡 Fetch response received",{requestId:a,status:i.status,ok:i.ok,contentType:i.headers.get("Content-Type")}),!i.ok){const l=await i.text();n.error("CHAT_AI_SERVICE","❌ Response not OK",{requestId:a,status:i.status,errorText:l});let c;try{c=JSON.parse(l)}catch{c={error:l||"Unknown error"}}throw new Error(c.error||`API error: ${i.status}`)}const o=await i.json();return n.info("CHAT_AI_SERVICE","✅ Response parsed successfully",{requestId:a,mode:t.mode,tokensUsed:o.usage?.total_tokens,hasMessage:!!o.message,messageLength:o.message?.content?.length||0}),o}catch(r){throw n.error("CHAT_AI_SERVICE","❌ Fatal error in sendMessage",{requestId:a,error:r instanceof Error?r.message:String(r),stack:r instanceof Error?r.stack:void 0}),r}}async sendStreamMessage(t,a){const r=Date.now();let i=0,o="",l="unknown";try{n.info("CHAT_AI_SERVICE","Starting stream request",{mode:t.mode,messageCount:t.messages.length});const{data:{session:c}}=await B.auth.getSession();if(!c)throw n.error("CHAT_AI_SERVICE","User not authenticated for stream"),new Error("User not authenticated");const d=await fetch(`${this.baseUrl}/chat-ai`,{method:"POST",headers:{Authorization:`Bearer ${c.access_token}`,"Content-Type":"application/json",apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3aXB5ZGJ0amFneXBvY3B2YnduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODg0MjIsImV4cCI6MjA3MDI2NDQyMn0.IS5IdKbmnGtgU_AaGYtUgX3ewaNpsiSAui5kbFV31_U"},body:JSON.stringify({...t,stream:!0})});if(l=d.headers.get("X-Request-Id")||"unknown",n.info("CHAT_AI_SERVICE","Stream response received",{requestId:l,status:d.status,ok:d.ok,contentType:d.headers.get("Content-Type")}),!d.ok){const g=await d.text();throw n.error("CHAT_AI_SERVICE","Stream response not ok",{requestId:l,status:d.status,error:g}),new Error(`API error: ${d.status} - ${g}`)}const p=d.body?.getReader(),h=new TextDecoder;if(!p)throw n.error("CHAT_AI_SERVICE","No response body reader",{requestId:l}),new Error("Response body is not readable");n.info("CHAT_AI_SERVICE","Starting to read stream chunks",{requestId:l});let m="",u=0,f=0;for(;;){const{done:g,value:x}=await p.read();if(g){n.info("CHAT_AI_SERVICE","Stream reading completed",{requestId:l,chunkCount:i,totalLength:o.length,totalLinesProcessed:u,dataLinesProcessed:f,durationMs:Date.now()-r});break}m+=h.decode(x,{stream:!0});const b=m.split(`
`);m=b.pop()||"",u<10&&n.debug("CHAT_AI_SERVICE","Stream chunk received",{requestId:l,lineCount:b.length,bufferSize:m.length,firstLinePreview:b[0]?.substring(0,100)});for(const y of b)if(u++,!!y.trim()&&y.startsWith("data: ")){f++;const C=y.slice(6).trim();if(C==="[DONE]"){n.info("CHAT_AI_SERVICE","Stream [DONE] marker received",{requestId:l,totalChunks:i,totalLength:o.length});return}try{const j=JSON.parse(C);i<3&&n.debug("CHAT_AI_SERVICE","Parsed SSE data",{requestId:l,hasChoices:!!j.choices,choicesLength:j.choices?.length,hasDelta:!!j.choices?.[0]?.delta,deltaKeys:j.choices?.[0]?.delta?Object.keys(j.choices[0].delta):[],hasContent:!!j.choices?.[0]?.delta?.content});const S=j.choices?.[0]?.delta?.content;S?(i++,o+=S,n.info("CHAT_AI_SERVICE","🔥 CALLING onChunk with content",{requestId:l,chunkNumber:i,contentLength:S.length,contentPreview:S.substring(0,50)}),a(S),i<=3&&n.debug("CHAT_AI_SERVICE","Content chunk extracted",{requestId:l,chunkNumber:i,contentLength:S.length,contentPreview:S.substring(0,50)})):i<3&&n.warn("CHAT_AI_SERVICE","❌ NO CONTENT in chunk",{requestId:l,parsed:JSON.stringify(j).substring(0,200)})}catch(j){n.warn("CHAT_AI_SERVICE","Failed to parse SSE data",{requestId:l,dataLength:C.length,dataPreview:C.substring(0,200),error:j instanceof Error?j.message:String(j)})}}}i===0&&n.warn("CHAT_AI_SERVICE","No content chunks received in stream",{requestId:l,durationMs:Date.now()-r})}catch(c){throw n.error("CHAT_AI_SERVICE","Error in stream",{requestId:l,error:c instanceof Error?c.message:String(c),stack:c instanceof Error?c.stack:void 0,chunkCount:i,durationMs:Date.now()-r}),c}}convertMessagesToAPI(t){return t.map(a=>({role:a.role==="coach"?"assistant":a.role,content:a.content}))}}const Ue=new Qs;class en{async getModeId(t){try{const{data:a,error:r}=await B.from("chat_modes").select("id").eq("name",t).maybeSingle();return r?(n.error("CHAT_CONVERSATION_SERVICE","Error getting mode ID",{error:r}),null):a?.id||null}catch(a){return n.error("CHAT_CONVERSATION_SERVICE","Error in getModeId",{error:a}),null}}async getOrCreateConversation(t,a){try{const{data:{user:r}}=await B.auth.getUser();if(!r)throw new Error("User not authenticated");const i=await this.getModeId(t);if(!i)throw new Error(`Mode ${t} not found in database`);const{data:o,error:l}=await B.from("chat_conversations").select("id").eq("user_id",r.id).eq("mode_id",i).eq("is_active",!0).maybeSingle();if(l)throw n.error("CHAT_CONVERSATION_SERVICE","Error fetching conversation",{fetchError:l}),l;if(o)return n.debug("CHAT_CONVERSATION_SERVICE","Using existing conversation",{conversationId:o.id,mode:t}),o.id;const{data:c,error:d}=await B.from("chat_conversations").insert({user_id:r.id,mode_id:i,context_data:a||{},is_active:!0}).select("id").single();if(d)throw n.error("CHAT_CONVERSATION_SERVICE","Error creating conversation",{createError:d}),d;return n.info("CHAT_CONVERSATION_SERVICE","Created new conversation",{conversationId:c.id,mode:t}),c.id}catch(r){return n.error("CHAT_CONVERSATION_SERVICE","Error in getOrCreateConversation",{error:r}),null}}async saveMessage(t,a){try{const{data:r,error:i}=await B.from("chat_messages").insert({conversation_id:t,role:a.role,type:a.type,content:a.content,metadata:a.metadata||{},audio_url:a.audioUrl||null}).select("id").single();if(i)throw n.error("CHAT_CONVERSATION_SERVICE","Error saving message",{error:i}),i;return n.debug("CHAT_CONVERSATION_SERVICE","Message saved",{messageId:r.id,conversationId:t}),r.id}catch(r){return n.error("CHAT_CONVERSATION_SERVICE","Error in saveMessage",{error:r}),null}}async getConversationMessages(t){try{const{data:a,error:r}=await B.from("chat_messages").select("*").eq("conversation_id",t).order("created_at",{ascending:!0});if(r)throw n.error("CHAT_CONVERSATION_SERVICE","Error fetching messages",{error:r}),r;return(a||[]).map(i=>({id:i.id,role:i.role,type:i.type,content:i.content,timestamp:new Date(i.created_at),...i.metadata&&Object.keys(i.metadata).length>0?{metadata:i.metadata}:{},...i.audio_url?{audioUrl:i.audio_url}:{}}))}catch(a){return n.error("CHAT_CONVERSATION_SERVICE","Error in getConversationMessages",{error:a}),[]}}async endConversation(t){try{const{error:a}=await B.from("chat_conversations").update({is_active:!1,ended_at:new Date().toISOString()}).eq("id",t);return a?(n.error("CHAT_CONVERSATION_SERVICE","Error ending conversation",{error:a}),!1):(n.info("CHAT_CONVERSATION_SERVICE","Conversation ended",{conversationId:t}),!0)}catch(a){return n.error("CHAT_CONVERSATION_SERVICE","Error in endConversation",{error:a}),!1}}async getActiveConversationByMode(t){try{const{data:{user:a}}=await B.auth.getUser();if(!a)return null;const r=await this.getModeId(t);if(!r)return null;const{data:i,error:o}=await B.from("chat_conversations").select("id").eq("user_id",a.id).eq("mode_id",r).eq("is_active",!0).maybeSingle();return o?(n.error("CHAT_CONVERSATION_SERVICE","Error fetching active conversation",{error:o}),null):i?.id||null}catch(a){return n.error("CHAT_CONVERSATION_SERVICE","Error in getActiveConversationByMode",{error:a}),null}}}const le=new en,_n=({chatButtonRef:s})=>{const t=pe(),{isPanelOpen:a,closePanel:r,currentMode:i,modeConfigs:o,setMode:l,closeOnNavigation:c,addMessage:d,messages:p,isTyping:h,setTyping:m,conversationId:u,incrementUnread:f,voiceState:g,isVoiceOnlyMode:x}=z(),{navClose:b}=G(),y=E.useRef(t.pathname),[C,j]=E.useState(!1),S=E.useRef(null),{mode:N}=X(),T=o[i],R=T.color,$={width:420},P=E.useMemo(()=>N==="high-performance"?"none":"blur(4px)",[N]),A=E.useMemo(()=>N==="high-performance"?"none":N==="balanced"?"blur(8px)":"blur(16px)",[N]);xe(),E.useEffect(()=>xe.subscribe(F=>F.activeOverlayId,F=>{F!=="chatDrawer"&&F!=="none"&&a&&(n.debug("GLOBAL_CHAT_DRAWER","Another overlay opened - closing chat",{newOverlay:F,currentMode:i,timestamp:new Date().toISOString()}),r())}),[a,i,r]);const M=()=>{const D=p[p.length-1],F=D&&D.role==="coach";(h||F)&&(f(),n.debug("GLOBAL_CHAT_DRAWER","Closing chat with unread messages",{mode:i,isTyping:h,hasUnreadCoachMessage:F,timestamp:new Date().toISOString()})),r()};E.useEffect(()=>{y.current!==t.pathname&&(a&&c&&(n.debug("GLOBAL_CHAT_DRAWER","Closing chat on navigation",{from:y.current,to:t.pathname,timestamp:new Date().toISOString()}),b(),Q.tap(),M()),y.current=t.pathname)},[t.pathname,a,c,b]),E.useEffect(()=>{if(!a)return;let D=i;t.pathname.startsWith("/training")||t.pathname.includes("/pipeline")?D="training":t.pathname.startsWith("/meals")||t.pathname.startsWith("/fridge")?D="nutrition":t.pathname.startsWith("/fasting")?D="fasting":t.pathname.startsWith("/body-scan")||t.pathname.startsWith("/avatar")?D="body-scan":D="general",D!==i&&(n.debug("GLOBAL_CHAT_DRAWER","Auto-switching mode based on route",{route:t.pathname,from:i,to:D,timestamp:new Date().toISOString()}),l(D),d({role:"system",type:"system",content:`Passage en mode ${o[D].displayName}`}))},[t.pathname,a]),E.useEffect(()=>{if(!a)return;(async()=>{try{const F=await le.getActiveConversationByMode(i);if(F){const O=await le.getConversationMessages(F);O.length>0&&(z.setState({conversationId:F,messages:O}),n.debug("GLOBAL_CHAT_DRAWER","Loaded conversation history",{conversationId:F,messageCount:O.length,mode:i}))}}catch(F){n.error("GLOBAL_CHAT_DRAWER","Error loading conversation history",{error:F})}})()},[i,a]),E.useEffect(()=>{if(!a)return;const D=F=>{F.key==="Escape"&&(b(),Q.tap(),M())};return document.addEventListener("keydown",D),()=>document.removeEventListener("keydown",D)},[a,b,M]);const K=async D=>{const F={role:"user",type:"text",content:D};n.info("GLOBAL_CHAT_DRAWER","🚀 User sent message",{messageLength:D.length,currentMode:i,messageCount:p.length}),d(F),m(!0);try{n.info("GLOBAL_CHAT_DRAWER","📝 Getting conversation ID",{currentMode:i});const O=u||await le.getOrCreateConversation(i);if(!O)throw n.error("GLOBAL_CHAT_DRAWER","❌ Failed to get conversation ID"),new Error("Failed to get or create conversation");n.info("GLOBAL_CHAT_DRAWER","✅ Conversation ID obtained",{convId:O}),u||z.setState({conversationId:O}),await le.saveMessage(O,F),n.info("GLOBAL_CHAT_DRAWER","✅ User message saved to DB");let V=T.systemPrompt;const L=p.slice(-10),U=[{role:"system",content:V},...Ue.convertMessagesToAPI(L),{role:"user",content:D}];n.info("GLOBAL_CHAT_DRAWER","📤 Calling chatAIService.sendMessage",{apiMessageCount:U.length,mode:i});const re=await Ue.sendMessage({messages:U,mode:i});n.info("GLOBAL_CHAT_DRAWER","✅ Received response from AI",{hasContent:!!re.message?.content,contentLength:re.message?.content?.length||0});const ce={role:"coach",type:"text",content:re.message.content};d(ce),await le.saveMessage(O,ce),n.info("GLOBAL_CHAT_DRAWER","✅ Assistant message saved to DB")}catch(O){n.error("GLOBAL_CHAT_DRAWER","❌ Error in message flow",{error:O instanceof Error?O.message:String(O),stack:O instanceof Error?O.stack:void 0}),d({role:"system",type:"system",content:"Désolé, une erreur est survenue. Veuillez réessayer."})}finally{m(!1)}},Y=$.width,Z=(D=!0)=>{S.current&&S.current.scrollTo({top:S.current.scrollHeight,behavior:D?"smooth":"auto"})};return e.jsx(H,{children:a&&e.jsxs(e.Fragment,{children:[e.jsx(w.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},onClick:()=>{b(),Q.tap(),M()},className:"lg:hidden",style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.5)",backdropFilter:P,zIndex:9993}},"chat-overlay"),e.jsxs(w.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",stiffness:300,damping:30,mass:.8},className:"global-chat-drawer",style:{position:"fixed",top:"calc(64px + 12px)",right:"8px",bottom:"calc(var(--new-bottom-bar-height) + var(--new-bottom-bar-bottom-offset) + 12px)",width:`min(${Y}px, calc(100vw - 16px))`,zIndex:be.CHAT_DRAWER,borderRadius:"20px",background:N==="high-performance"?"rgba(11, 14, 23, 0.95)":`
                    var(--liquid-reflections-multi),
                    var(--liquid-highlight-ambient),
                    var(--liquid-glass-bg-elevated)
                  `,backdropFilter:N==="high-performance"?"none":"blur(var(--liquid-panel-blur)) saturate(var(--liquid-panel-saturate))",WebkitBackdropFilter:N==="high-performance"?"none":"blur(var(--liquid-panel-blur)) saturate(var(--liquid-panel-saturate))",boxShadow:"var(--liquid-panel-shadow)",display:"flex",flexDirection:"column",overflow:"hidden",isolation:"isolate",transform:"translateZ(0)",willChange:"transform, filter"},children:[N!=="high-performance"&&e.jsx("div",{style:{position:"absolute",inset:"-2px",borderRadius:"inherit",padding:"2px",background:"var(--liquid-border-gradient-tricolor)",WebkitMask:"linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)",WebkitMaskComposite:"xor",maskComposite:"exclude",pointerEvents:"none",opacity:1,zIndex:1,animation:"borderPulse 4s ease-in-out infinite"}}),N!=="high-performance"&&e.jsx("div",{style:{position:"absolute",inset:"-8px",borderRadius:"calc(20px + 4px)",background:`radial-gradient(
                    ellipse at 80% 50%,
                    color-mix(in srgb, ${R} 15%, transparent) 0%,
                    rgba(61, 19, 179, 0.1) 40%,
                    transparent 70%
                  )`,opacity:.8,zIndex:-1,pointerEvents:"none",animation:"glowPulse 3s ease-in-out infinite alternate"}}),e.jsxs("div",{className:"drawer-header",style:{padding:"16px 20px",borderBottom:`1px solid color-mix(in srgb, ${R} 20%, transparent)`,background:`
                  linear-gradient(180deg,
                    rgba(11, 14, 23, 0.6) 0%,
                    rgba(11, 14, 23, 0.3) 100%
                  )
                `,backdropFilter:A,display:"flex",alignItems:"center",justifyContent:"space-between",gap:"12px",flexShrink:0},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"mode-icon-container",style:{width:"40px",height:"40px",borderRadius:"50%",background:`
                      radial-gradient(circle at 30% 30%, color-mix(in srgb, ${R} 30%, transparent), transparent 70%),
                      rgba(255, 255, 255, 0.1)
                    `,border:`2px solid color-mix(in srgb, ${R} 40%, transparent)`,boxShadow:`0 0 20px color-mix(in srgb, ${R} 25%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(I,{Icon:v[T.icon]||v.MessageSquare,size:20,style:{color:R}})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-bold text-lg",children:T.displayName}),e.jsx("p",{className:"text-white/60 text-xs",children:i==="general"?"En ligne • Avec toi":"En ligne • Prêt à aider"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{children:C&&e.jsx(w.button,{className:"scroll-to-bottom",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},onClick:()=>Z(!0),style:{width:"36px",height:"36px",borderRadius:"50%",background:"rgba(255, 255, 255, 0.08)",border:"1px solid rgba(255, 255, 255, 0.15)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},whileHover:{scale:1.05,background:"rgba(255, 255, 255, 0.12)"},whileTap:{scale:.95},children:e.jsx(I,{Icon:v.ArrowDown,size:16,style:{color:R,filter:`drop-shadow(0 0 8px color-mix(in srgb, ${R} 40%, transparent))`}})})}),(g==="listening"||g==="speaking"||g==="connecting")&&e.jsx(w.button,{className:"minimize-button",onClick:()=>{n.info("GLOBAL_CHAT_DRAWER","Minimizing chat with active realtime session"),b(),Q.tap(),M()},style:{width:"36px",height:"36px",borderRadius:"50%",background:"rgba(239, 68, 68, 0.2)",border:"1px solid rgba(239, 68, 68, 0.4)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},whileHover:{scale:1.05,background:"rgba(239, 68, 68, 0.3)"},whileTap:{scale:.95},title:"Continuer en arrière-plan",children:e.jsx(I,{Icon:v.Minimize2,size:16,className:"text-red-400"})}),e.jsx(w.button,{className:"header-button",onClick:()=>{b(),Q.tap(),M()},style:{width:"36px",height:"36px",borderRadius:"50%",background:"rgba(255, 255, 255, 0.08)",border:"1px solid rgba(255, 255, 255, 0.15)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},whileHover:{scale:1.05,background:"rgba(255, 255, 255, 0.12)"},whileTap:{scale:.95},children:e.jsx(I,{Icon:v.X,size:18,className:"text-white/70"})})]})]}),e.jsx("div",{className:"chat-interface-wrapper",style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",position:"relative",minHeight:0},children:e.jsx(Zs,{stepColor:R,onSendMessage:K,isTyping:h,className:"flex-1",messagesContainerRef:S,onScrollChange:j})})]},"chat-drawer")]})})},Mn=()=>{const{isPerformanceMode:s,mode:t}=X(),a=E.useRef(!1);return E.useEffect(()=>{const r=document.body,i=document.documentElement;return r.classList.remove("performance-mode","mobile-performance-mode","mode-quality","mode-balanced","mode-high-performance"),i.classList.remove("performance-mode","mode-high-performance","mode-balanced","mode-quality"),s?(r.classList.add("performance-mode","mobile-performance-mode","mode-high-performance"),r.setAttribute("data-performance-mode","true"),i.classList.add("performance-mode","mode-high-performance")):(r.removeAttribute("data-performance-mode"),t==="quality"?(r.classList.add("mode-quality"),i.classList.add("mode-quality")):t==="balanced"&&(r.classList.add("mode-balanced"),i.classList.add("mode-balanced"))),()=>{r.classList.remove("performance-mode","mobile-performance-mode","mode-quality","mode-balanced","mode-high-performance"),r.removeAttribute("data-performance-mode"),i.classList.remove("performance-mode","mode-high-performance","mode-balanced","mode-quality")}},[s,t]),E.useEffect(()=>{const r=document.getElementById("cosmic-forge-particles-container");r&&(r.innerHTML=""),a.current=!1},[s,t]),s?e.jsx("div",{style:{position:"fixed",inset:0,background:"var(--forge-deep)",zIndex:-1},"aria-hidden":"true"}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"bg-twinforge-visionos","aria-hidden":"true"})})};class tn{detectDeviceSpecs(){const t=window.innerWidth,a=window.innerHeight,r=window.devicePixelRatio||1,i=t<768,o=t>=768&&t<1024,l=window.matchMedia("(hover: hover) and (pointer: fine)").matches,c=navigator.deviceMemory||this.estimateMemory(),d=navigator.hardwareConcurrency||4,p=navigator.connection;let h="medium";if(p){const g=p.effectiveType;g==="slow-2g"||g==="2g"?h="slow":g==="3g"?h="medium":(g==="4g"||g==="5g")&&(h="fast")}const m=this.detectGPUTier(),{estimatedYear:u,deviceModel:f}=this.detectDeviceModel();return{memoryGB:c,cores:d,isMobile:i,isTablet:o,supportsHover:l,screenWidth:t,screenHeight:a,devicePixelRatio:r,connectionSpeed:h,gpuTier:m,estimatedYear:u,deviceModel:f}}estimateMemory(){const t=navigator.userAgent.toLowerCase();return/mobile|android|iphone|ipad/i.test(t)?/iphone 1[5-9]|iphone 2\d/i.test(t)?8:/iphone 1[2-4]/i.test(t)?6:/iphone [8-9]|iphone 1[0-1]|iphone x/i.test(t)?3:/iphone [5-7]/i.test(t)?2:4:8}detectGPUTier(){try{const t=document.createElement("canvas"),a=t.getContext("webgl")||t.getContext("experimental-webgl");if(!a)return"unknown";const r=a.getExtension("WEBGL_debug_renderer_info");if(!r)return"medium";const i=a.getParameter(r.UNMASKED_RENDERER_WEBGL).toLowerCase();return/apple|nvidia|adreno [6-9]|mali-g[7-9]|immortalis/i.test(i)?"high":/adreno [4-5]|mali-g[5-6]|powervr/i.test(i)?"medium":/adreno [2-3]|mali-[4t]/i.test(i)?"low":"medium"}catch(t){return n.error("DEVICE_DETECTION","Failed to detect GPU",{error:t}),"unknown"}}detectDeviceModel(){const t=navigator.userAgent;let a=new Date().getFullYear(),r="Unknown Device";const i=t.match(/iPhone(\d+),(\d+)/);if(i){const c=parseInt(i[1]);r=`iPhone (Model ${c},${i[2]})`,c>=16?a=2024:c>=14?a=2022:c>=13?a=2021:c>=12?a=2020:c>=11?a=2018:c>=10?a=2017:a=2016}const o=t.match(/iPad(\d+),(\d+)/);if(o){const c=parseInt(o[1]);r=`iPad (Model ${c},${o[2]})`,c>=14?a=2023:c>=13?a=2021:c>=11?a=2020:a=2018}const l=t.match(/Android\s([\d.]+)/);if(l&&!i&&!o){const c=parseFloat(l[1]);r=`Android ${c}`,c>=14?a=2024:c>=13?a=2023:c>=12?a=2022:c>=11?a=2021:a=2020}return{estimatedYear:a,deviceModel:r}}calculatePerformanceScore(t){let a=0;a+=Math.min(t.memoryGB*10,30),a+=Math.min(t.cores*3,20),t.gpuTier==="high"?a+=20:t.gpuTier==="medium"?a+=12:t.gpuTier==="low"?a+=5:a+=8;const r=new Date().getFullYear()-t.estimatedYear;return r<=1?a+=15:r<=2?a+=12:r<=3?a+=8:r<=4&&(a+=4),t.isMobile?t.isTablet&&(a+=5):a+=10,t.connectionSpeed==="fast"?a+=5:t.connectionSpeed==="medium"&&(a+=3),Math.min(Math.max(a,0),100)}categorizeDevice(t,a){const r=new Date().getFullYear()-a.estimatedYear;return t>=80&&r<=2?"flagship":t>=60&&r<=3?"mid-range":t>=40||r<=5?"budget":"legacy"}recommendMode(t,a,r){const i=new Date().getFullYear()-a.estimatedYear;return a.isMobile&&i>=5||r==="legacy"||t<40||r==="budget"||t>=40&&t<60?"high-performance":r==="mid-range"||t>=60&&t<80||a.isMobile&&t>=70?"balanced":"quality"}generateReasons(t,a,r){const i=[],o=new Date().getFullYear()-a.estimatedYear;return t==="high-performance"?(o>=5&&i.push(`Votre appareil a ${o} ans - optimisation recommandée`),a.memoryGB<4&&i.push(`RAM limitée (${a.memoryGB}GB) - fluidité prioritaire`),a.cores<4&&i.push(`Processeur limité (${a.cores} cœurs) - performance maximale`),a.gpuTier==="low"&&i.push("GPU peu puissant - effets visuels désactivés"),a.isMobile&&i.push("Mobile détecté - optimisation batterie et fluidité")):t==="balanced"?(i.push("Configuration équilibrée détectée"),i.push("Bon compromis entre performance et design"),a.isMobile&&i.push("Optimisé pour mobile avec effets essentiels")):(i.push("Appareil performant détecté - expérience premium disponible"),i.push("Tous les effets visuels activés"),a.isMobile||i.push("Desktop - rendu haute qualité optimal")),i}shouldShowAlert(t,a,r){return t==="high-performance"&&(a==="legacy"||a==="budget")||r<50}analyzeDevice(){n.info("DEVICE_DETECTION","Starting device analysis");const t=this.detectDeviceSpecs(),a=this.calculatePerformanceScore(t),r=this.categorizeDevice(a,t),i=this.recommendMode(a,t,r),o=this.shouldShowAlert(i,r,a),l=this.generateReasons(i,t,a),c={recommendedMode:i,deviceCategory:r,deviceSpecs:t,performanceScore:a,shouldShowAlert:o,reasons:l};return n.info("DEVICE_DETECTION","Device analysis complete",{category:r,score:a,recommendedMode:i,shouldShowAlert:o}),c}getCategoryLabel(t){return{flagship:"Haut de gamme","mid-range":"Milieu de gamme",budget:"Entrée de gamme",legacy:"Ancien modèle"}[t]}getModeLabel(t){return{"high-performance":"Performance Maximale",balanced:"Équilibré",quality:"Qualité Premium"}[t]}}const Ie=new tn,On=({recommendation:s,onDismiss:t,onNavigateToSettings:a})=>{const[r,i]=E.useState(!0),o=ae(),{showToast:l}=Ye(),c=async()=>{i(!1),setTimeout(()=>{t()},300)},d=()=>{i(!1),setTimeout(()=>{o("/settings"),a()},300)},p=()=>{switch(s.recommendedMode){case"high-performance":return v.Zap;case"balanced":return v.Scale;case"quality":return v.Sparkles;default:return v.Settings}},h=()=>{switch(s.recommendedMode){case"high-performance":return"#10B981";case"balanced":return"#3B82F6";case"quality":return"#A855F7";default:return"#94A3B8"}},m=u=>u>=80?"#10B981":u>=60?"#3B82F6":u>=40?"#F59E0B":"#EF4444";return e.jsx(H,{children:r&&e.jsx(w.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",style:{backgroundColor:"rgba(0, 0, 0, 0.85)",backdropFilter:"blur(12px)"},children:e.jsx(w.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},transition:{type:"spring",damping:25,stiffness:300},className:"w-full max-w-2xl rounded-3xl overflow-hidden",style:{background:"linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(15, 23, 42, 0.95) 100%)",border:"1px solid rgba(148, 163, 184, 0.2)",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.5)"},children:e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(w.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring"},children:e.jsx(I,{Icon:p(),size:40,color:h(),variant:"pure"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-1",children:"Optimisation Détectée"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Configuration de performance recommandée"})]})]}),e.jsx("button",{onClick:c,className:"text-slate-400 hover:text-white transition-colors p-2","aria-label":"Fermer",children:e.jsx(I,{Icon:v.X,size:24,variant:"pure"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-6 rounded-2xl",style:{background:"linear-gradient(135deg, rgba(51, 65, 85, 0.6) 0%, rgba(30, 41, 59, 0.6) 100%)",border:"1px solid rgba(148, 163, 184, 0.15)"},children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsx(I,{Icon:v.Smartphone,size:24,color:"#60A5FA",variant:"pure"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Votre Appareil"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Modèle:"}),e.jsx("span",{className:"text-white ml-2",children:s.deviceSpecs.deviceModel})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Catégorie:"}),e.jsx("span",{className:"text-white ml-2",children:Ie.getCategoryLabel(s.deviceCategory)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"RAM:"}),e.jsxs("span",{className:"text-white ml-2",children:[s.deviceSpecs.memoryGB,"GB"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Processeur:"}),e.jsxs("span",{className:"text-white ml-2",children:[s.deviceSpecs.cores," cœurs"]})]})]})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-2",children:[e.jsx("span",{className:"text-slate-400",children:"Score de Performance"}),e.jsxs("span",{className:"font-semibold",style:{color:m(s.performanceScore)},children:[s.performanceScore,"/100"]})]}),e.jsx("div",{className:"h-2 rounded-full bg-slate-700 overflow-hidden",children:e.jsx(w.div,{initial:{width:0},animate:{width:`${s.performanceScore}%`},transition:{delay:.5,duration:1,ease:"easeOut"},className:"h-full rounded-full",style:{background:`linear-gradient(90deg, ${m(s.performanceScore)} 0%, ${m(s.performanceScore)}CC 100%)`}})})]})})]}),e.jsxs("div",{className:"p-6 rounded-2xl",style:{background:`linear-gradient(135deg, ${h()}20 0%, ${h()}10 100%)`,border:`1px solid ${h()}40`},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(I,{Icon:p(),size:28,color:h(),variant:"pure"}),e.jsx("div",{children:e.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Mode Recommandé: ",Ie.getModeLabel(s.recommendedMode)]})})]}),e.jsx("ul",{className:"space-y-2",children:s.reasons.map((u,f)=>e.jsxs(w.li,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.6+f*.1},className:"flex items-start gap-2 text-sm",children:[e.jsx(I,{Icon:v.CheckCircle,size:16,color:h(),variant:"pure",className:"mt-0.5"}),e.jsx("span",{className:"text-slate-300",children:u})]},f))})]}),e.jsx("div",{className:"p-5 rounded-2xl",style:{background:"rgba(59, 130, 246, 0.1)",border:"1px solid rgba(59, 130, 246, 0.3)"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(I,{Icon:v.Info,size:20,color:"#60A5FA",variant:"pure"}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm text-slate-300 leading-relaxed",children:"Nous avons conçu l'application avec soin pour offrir 3 niveaux de qualité visuelle. Vous pouvez choisir le mode qui vous convient et profiter d'une expérience fluide adaptée à votre appareil."})})]})})]}),e.jsxs("div",{className:"flex gap-3 mt-8",children:[e.jsx("button",{onClick:c,className:"flex-1 px-6 py-3 rounded-2xl font-medium transition-all",style:{background:"rgba(71, 85, 105, 0.5)",border:"1px solid rgba(148, 163, 184, 0.3)",color:"#CBD5E1"},children:"Plus tard"}),e.jsx("button",{onClick:d,className:"flex-1 px-6 py-3 rounded-2xl font-medium transition-all",style:{background:`linear-gradient(135deg, ${h()} 0%, ${h()}CC 100%)`,border:`1px solid ${h()}`,color:"white",boxShadow:`0 4px 12px ${h()}40`},children:"Choisir mon mode"})]})]})})})})};function Fn(){const[s,t]=E.useState(!1),[a,r]=E.useState(null),{profile:i}=oe();return E.useEffect(()=>{(async()=>{if(i?.id)try{const{data:c}=await B.from("user_preferences").select("performance_alert_shown").eq("user_id",i.id).maybeSingle();if(c?.performance_alert_shown){n.debug("PERFORMANCE_ALERT","Alert already shown to user");return}const d=Ie.analyzeDevice();d.shouldShowAlert&&(r(d),t(!0),await B.from("user_preferences").upsert({user_id:i.id,performance_alert_shown:!0,updated_at:new Date().toISOString()},{onConflict:"user_id"}),n.info("PERFORMANCE_ALERT","Showing performance recommendation alert",{recommendedMode:d.recommendedMode,score:d.performanceScore}))}catch(c){n.error("PERFORMANCE_ALERT","Failed to check alert status",{error:c})}})()},[i?.id]),{showAlert:s,recommendation:a,dismissAlert:()=>{t(!1),r(null)}}}function Dn({icon:s="Home",title:t,subtitle:a,actions:r,className:i="",circuit:o="home",iconColor:l}){const{isPerformanceMode:c}=X(),d=o==="track"?v.Target:v[s],p=l||ie[o];return e.jsxs("header",{className:`pt-6 md:pt-8 mb-4 md:mb-6 will-change-transform-important ${i}`,role:"banner","aria-labelledby":"page-title",children:[e.jsxs("div",{className:"flex flex-row items-center gap-6 mb-8",children:[c?e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"w-20 h-20 md:w-24 md:h-24 rounded-2xl flex items-center justify-center relative overflow-hidden",style:{background:`linear-gradient(145deg,
                  color-mix(in srgb, ${p} 25%, #1e293b),
                  color-mix(in srgb, ${p} 12%, #0f172a)
                )`,border:`2px solid color-mix(in srgb, ${p} 50%, transparent)`,boxShadow:`
                  0 8px 24px rgba(0, 0, 0, 0.4),
                  0 2px 8px color-mix(in srgb, ${p} 20%, transparent),
                  0 4px 16px color-mix(in srgb, ${p} 15%, transparent),
                  inset 0 2px 0 rgba(255, 255, 255, 0.15),
                  inset 0 -2px 0 rgba(0, 0, 0, 0.2)
                `},role:"img","aria-label":`Icône de la page ${t}`,children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-1",style:{background:`linear-gradient(90deg,
                    transparent,
                    color-mix(in srgb, ${p} 60%, transparent),
                    transparent
                  )`}}),e.jsx(I,{Icon:d,size:48,variant:"pure",className:"text-white relative z-10",style:{color:p,filter:`drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3)) drop-shadow(0 1px 3px color-mix(in srgb, ${p} 25%, transparent))`,opacity:1},"aria-hidden":"true"})]})}):e.jsx("div",{className:"breathing-icon flex-shrink-0",style:{"--animation-duration-slower":"5s"},children:e.jsx("div",{className:"w-20 h-20 md:w-24 md:h-24 rounded-2xl flex items-center justify-center relative overflow-hidden shadow-lg",style:{"--header-icon-radius":"24px",borderRadius:"var(--header-icon-radius)",WebkitMaskImage:"radial-gradient(white, black)",maskImage:"radial-gradient(white, black)",background:`
                  radial-gradient(circle at 30% 30%, color-mix(in srgb, ${p} 40%, transparent) 0%, transparent 60%),
                  radial-gradient(circle at 70% 70%, color-mix(in srgb, var(--brand-primary) 35%, transparent) 0%, transparent 50%),
                  radial-gradient(circle at 50% 50%, color-mix(in srgb, ${p} 25%, transparent) 0%, transparent 70%),
                  rgba(255, 255, 255, 0.15)
                `,border:`2px solid color-mix(in srgb, ${p} 60%, transparent)`,boxShadow:`
                  0 16px 64px color-mix(in srgb, ${p} 45%, transparent),
                  0 0 100px color-mix(in srgb, ${p} 35%, transparent),
                  0 0 160px color-mix(in srgb, var(--brand-primary) 25%, transparent),
                  inset 0 4px 0 rgba(255, 255, 255, 0.3),
                  inset 0 -3px 0 rgba(0, 0, 0, 0.15)
                `,backdropFilter:"blur(24px) saturate(200%)",WebkitBackdropFilter:"blur(24px) saturate(200%)",willChange:"transform, box-shadow",transform:"translateZ(0)"},role:"img","aria-label":`Icône de la page ${t}`,children:e.jsx(I,{Icon:d,size:48,variant:"pure",className:"text-white relative z-10",style:{color:p,filter:`drop-shadow(0 0 30px color-mix(in srgb, ${p} 90%, transparent)) drop-shadow(0 0 60px color-mix(in srgb, ${p} 60%, transparent))`,textShadow:`0 0 40px color-mix(in srgb, ${p} 80%, transparent), 0 0 80px color-mix(in srgb, var(--brand-primary) 40%, transparent)`},"aria-hidden":"true"})})}),e.jsxs("div",{className:"space-y-2 text-left flex-1 min-w-0",children:[e.jsx("h1",{id:"page-title",className:"text-2xl md:text-3xl lg:text-4xl font-bold text-white page-header-title",style:{color:"var(--text-primary)",fontWeight:700,letterSpacing:"-0.01em",textShadow:c?"0 2px 8px rgba(0, 0, 0, 0.6)":`0 0 40px color-mix(in srgb, ${p} 50%, transparent)`,lineHeight:"1.2"},children:t}),a&&e.jsx("p",{className:"text-gray-300 text-lg md:text-xl max-w-2xl leading-relaxed page-header-subtitle",style:{color:`color-mix(in srgb, #E5E7EB 90%, ${p} 10%)`,textShadow:c?"0 1px 4px rgba(0, 0, 0, 0.5)":"0 0 20px rgba(0, 0, 0, 0.5)",lineHeight:"1.4"},"aria-describedby":"page-title",children:a})]})]}),r&&e.jsx("div",{className:"mt-3 md:mt-4 flex justify-center",role:"group","aria-label":"Actions de la page",children:r})]})}const et=E.createContext(void 0),Ne=()=>{const s=E.useContext(et);if(!s)throw new Error("Tabs components must be used within a Tabs provider");return s},an={"profile:identity":"#60A5FA","profile:nutrition":"#10B981","profile:health":"#EF4444","profile:fasting":"#F59E0B","profile:preferences":"#18E3FF","profile:geo":"#EC4899","profile:avatar":"#A855F7",scanner:"#EC4899",inventaire:"#06B6D4",recipes:"#10B981",plan:"#8B5CF6",courses:"#F59E0B","meals:daily":"#10B981","meals:insights":"#F59E0B","meals:progression":"#06B6D4","meals:history":"#8B5CF6",journal:"#10B981",statistiques:"#06B6D4","fasting:daily":"#F59E0B","fasting:insights":"#10B981","fasting:progression":"#06B6D4","fasting:history":"#8B5CF6",timer:"#F59E0B",protocoles:"#06B6D4","activity:daily":"#3B82F6","activity:insights":"#F59E0B","activity:progression":"#10B981","activity:history":"#8B5CF6","activity:input":"#3B82F6","avatar:scanCta":"#8B5CF6","avatar:avatar":"#06B6D4","avatar:projection":"#10B981","avatar:insights":"#F59E0B","avatar:history":"#8B5CF6","avatar:face":"#EC4899","avatar:comparaison":"#A855F7","aujourd hui":"#18E3FF",conseils:"#10B981",progressionTraining:"#F59E0B",records:"#EF4444",historiqueTraining:"#8B5CF6",programmes:"#18E3FF",exercices:"#06B6D4",account:"#10B981",performance:"#F59E0B",preferences:"#8B5CF6",general:"#8B5CF6",notifications:"#EC4899",confidentialite:"#3B82F6",appareils:"#06B6D4",recentes:"#EC4899",parametres:"#8B5CF6","health:overview":"#EF4444","health:basic-info":"#EF4444","health:lifestyle":"#F59E0B","health:intimacy":"#EC4899","health:family-history":"#06B6D4","health:vital-signs":"#8B5CF6","health:geographic":"#3B82F6"};function We(s){return an[s]}const Te=({defaultValue:s,value:t,className:a="",children:r,onValueChange:i,forgeContext:o})=>{const l=pe(),c=ae(),d=_.useMemo(()=>{if(t!==void 0)return t;const h=l.hash.replace("#","");return(h?decodeURIComponent(h):"")||s},[t,l.hash,s]),p=_.useCallback(h=>{c({hash:h}),i?.(h)},[c,i]);return e.jsx(et.Provider,{value:{activeTab:d,setActiveTab:p,forgeContext:o},children:e.jsx("div",{className:`tabs w-full ${a}`,children:r})})},rn=({role:s="tablist","aria-label":t,className:a="",children:r})=>{const i=_.useRef(null),o=_.useRef(null),[l,c]=_.useState(!1),[d,p]=_.useState(0),{activeTab:h}=Ne(),[m,u]=_.useState([]);_.useEffect(()=>{const x=()=>{const y=i.current,C=o.current;if(!y||!C)return;const j=y.scrollWidth>y.clientWidth;c(j),C.classList.toggle("has-overflow",j);const S=Array.from(y.querySelectorAll(".tabs-trigger"));u(S)};x();const b=new ResizeObserver(x);return i.current&&b.observe(i.current),()=>b.disconnect()},[r]),_.useEffect(()=>{const x=m.findIndex(b=>b.getAttribute("aria-selected")==="true"||b.getAttribute("value")===h);x!==-1&&p(x)},[h,m]),_.useEffect(()=>{if(!i.current)return;const x=i.current.querySelector(`button[id="tab-${h}"]`);if(x){const b=i.current,y=x.getBoundingClientRect(),C=b.getBoundingClientRect(),j=y.left<C.left||y.right>C.right;(l||j)&&setTimeout(()=>{x.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})},100)}},[h,l]);const f=_.useMemo(()=>!l||m.length===0?[]:m.map((x,b)=>({id:b,active:b===d})),[l,m,d]),g=_.Children.map(r,x=>_.isValidElement(x)&&x.type===tt?_.cloneElement(x,{listRef:i,hasOverflow:l,...x.props}):x);return e.jsxs("div",{children:[e.jsx("div",{ref:o,className:`tabs-list-container ${a}`,style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, var(--brand-primary) 8%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, color-mix(in srgb, var(--color-plasma-cyan) 6%, transparent) 0%, transparent 50%),
            rgba(255, 255, 255, 0.05)
          `,border:"2px solid color-mix(in srgb, var(--color-plasma-cyan) 15%, transparent)",backdropFilter:"blur(16px) saturate(140%)",boxShadow:`
            0 8px 32px rgba(0, 0, 0, 0.25),
            0 0 20px color-mix(in srgb, var(--brand-primary) 10%, transparent),
            inset 0 1px 0 rgba(255, 255, 255, 0.15)
          `},children:e.jsx("div",{ref:i,role:s,"aria-label":t,className:"tabs-list",children:g})}),l&&f.length>0&&e.jsx("div",{className:"tabs-scroll-indicators",children:f.map(x=>e.jsx("div",{className:`tabs-scroll-dot ${x.active?"tabs-scroll-dot--active":""}`,title:`Onglet ${x.id+1}`},x.id))})]})},tt=({value:s,icon:t,children:a,listRef:r,hasOverflow:i})=>{const{activeTab:o,setActiveTab:l,forgeContext:c}=Ne(),d=o===s,p=t?v[t]:null,h=_.useRef(null),m=(g,x,b)=>{if(x){if(b){const y=`${b}:${g}`,C=We(y);if(C)return C}return We(g)}},u=()=>{l(s),i&&r?.current&&h.current&&h.current.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})},f=m(s,d,c);return e.jsxs("button",{ref:h,role:"tab","aria-selected":d,"aria-controls":`panel-${s}`,id:`tab-${s}`,className:`tabs-trigger ${d?"active":""}`,onClick:u,style:{"--button-color":f||"var(--color-plasma-cyan)"},children:[p&&e.jsx(p,{className:"tab-icon",color:f,style:f?{color:f}:void 0}),a]})},sn=({value:s,children:t,disableAnimation:a=!1})=>{const{activeTab:r}=Ne(),i=r===s,[o,l]=_.useState(i);return _.useEffect(()=>{i&&!o&&l(!0)},[i,o]),o?e.jsx("div",{role:"tabpanel",id:`panel-${s}`,"aria-labelledby":`tab-${s}`,className:"tabs-panel pt-6 md:pt-8",style:{display:i?"block":"none"},children:t}):null};Te.List=rn;Te.Trigger=tt;Te.Panel=sn;const $n=()=>{E.useEffect(()=>{const s=t=>{if(t.target&&t.target.getAttribute("role")==="tab"){const a=t.target.closest('[role="tablist"]');if(!a)return;const r=Array.from(a.querySelectorAll('[role="tab"]')),i=r.indexOf(t.target);let o=i;t.key==="ArrowRight"?o=(i+1)%r.length:t.key==="ArrowLeft"&&(o=(i-1+r.length)%r.length),o!==i&&(t.preventDefault(),r[o]?.click(),r[o]?.focus())}};return document.addEventListener("keydown",s),()=>document.removeEventListener("keydown",s)},[])};function Ae(s,t,a){const{hash:r,tab:i,smooth:o=!0,delay:l=100}=a||{};let c=t;const d=new URLSearchParams;i&&d.set("tab",i);const p=d.toString();p&&(c+=`?${p}`),r&&(c+=`#${r}`),s(c)}const at="twinforge:profile-nudge:dismissed",nn=24;function on(){try{const s=localStorage.getItem(at);if(!s)return!1;const{timestamp:t}=JSON.parse(s),a=new Date(t);return(new Date().getTime()-a.getTime())/(1e3*60*60)<nn}catch{return!1}}function cn(){try{localStorage.setItem(at,JSON.stringify({timestamp:new Date().toISOString(),completionPercentage:0}))}catch{}}const Pn=({completion:s,variant:t="card",className:a="",onDismiss:r,showDismiss:i=!0})=>{const o=ae(),{click:l,success:c}=G(),[d,p]=_.useState(!1);if(_.useEffect(()=>{p(on())},[]),!s||s.isSufficient||d)return null;const h=()=>{if(l(),s.nextAction){const g=s.nextAction.route,[x,b]=g.split("#"),[y,C]=x.split("?"),S=new URLSearchParams(C).get("tab");Ae(o,y,{tab:S||void 0,hash:b||void 0,smooth:!0,delay:200}),c()}},m=g=>{g?.stopPropagation(),l(),cn(),p(!0),r?.()},u=s.missingHighPriorityFields.length>0?"#EF4444":"#F59E0B",f=s.missingHighPriorityFields.length>0?"Critique":"Recommandé";return t==="banner"?e.jsx(w.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:`w-full ${a}`,children:e.jsx(q,{className:"p-4",style:{background:`
              radial-gradient(circle at 30% 20%, color-mix(in srgb, ${u} 12%, transparent) 0%, transparent 60%),
              var(--glass-opacity)
            `,borderColor:`color-mix(in srgb, ${u} 25%, transparent)`,boxShadow:`
              0 8px 32px rgba(0, 0, 0, 0.2),
              0 0 20px color-mix(in srgb, ${u} 15%, transparent),
              inset 0 1px 0 rgba(255, 255, 255, 0.15)
            `},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`color-mix(in srgb, ${u} 20%, transparent)`,border:`2px solid color-mix(in srgb, ${u} 40%, transparent)`},children:e.jsx(I,{Icon:v.User,size:18,style:{color:u}})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-semibold text-sm",children:s.suggestedMessage}),e.jsxs("p",{className:"text-white/70 text-xs",children:[s.completionPercentage,"% complété • ",f]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.nextAction&&e.jsx("button",{onClick:h,className:"btn-glass--primary px-4 py-2 text-sm",children:s.nextAction.label}),i&&e.jsx("button",{onClick:m,className:"p-2 rounded-full hover:bg-white/10 transition-colors",children:e.jsx(I,{Icon:v.X,size:14,className:"text-white/60"})})]})]})})}):t==="compact"?e.jsx(w.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:`inline-flex ${a}`,children:e.jsxs("button",{onClick:h,className:"flex items-center gap-2 px-3 py-2 rounded-full text-sm transition-all duration-200",style:{background:`color-mix(in srgb, ${u} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${u} 30%, transparent)`,color:u},children:[e.jsx(I,{Icon:v.AlertCircle,size:14}),e.jsxs("span",{className:"font-medium",children:["Profil ",s.completionPercentage,"%"]})]})}):e.jsx(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},className:a,children:e.jsx(q,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, ${u} 12%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, color-mix(in srgb, #06B6D4 8%, transparent) 0%, transparent 50%),
            var(--glass-opacity)
          `,borderColor:`color-mix(in srgb, ${u} 25%, transparent)`,boxShadow:`
            0 12px 40px rgba(0, 0, 0, 0.25),
            0 0 30px color-mix(in srgb, ${u} 15%, transparent),
            inset 0 2px 0 rgba(255, 255, 255, 0.15)
          `},children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, ${u} 35%, transparent), color-mix(in srgb, ${u} 25%, transparent))
              `,border:`2px solid color-mix(in srgb, ${u} 50%, transparent)`,boxShadow:`0 0 20px color-mix(in srgb, ${u} 30%, transparent)`},children:e.jsx(I,{Icon:v.User,size:20,style:{color:u}})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-white font-bold text-lg",children:"Optimisez vos Recettes"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{background:u}}),e.jsx("span",{className:"text-sm font-medium",style:{color:u},children:f})]})]}),e.jsx("p",{className:"text-white/80 text-sm mb-4 leading-relaxed",children:s.suggestedMessage}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-xs text-white/60 mb-2",children:[e.jsx("span",{children:"Profil complété"}),e.jsxs("span",{children:[s.completionPercentage,"%"]})]}),e.jsx("div",{className:"w-full bg-white/10 rounded-full h-2 overflow-hidden",children:e.jsx(w.div,{className:"h-2 rounded-full",style:{background:`linear-gradient(90deg, ${u}, color-mix(in srgb, ${u} 80%, white))`,width:`${s.completionPercentage}%`},initial:{width:0},animate:{width:`${s.completionPercentage}%`},transition:{duration:1,ease:"easeOut"}})})]}),s.missingHighPriorityFields.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"text-white/90 text-sm font-medium mb-2",children:"Champs essentiels manquants :"}),e.jsxs("div",{className:"space-y-1",children:[s.missingHighPriorityFields.slice(0,3).map((g,x)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-1 rounded-full bg-red-400"}),e.jsx("span",{className:"text-red-300 text-xs",children:g.label}),e.jsxs("span",{className:"text-white/50 text-xs",children:["• ",g.description]})]},g.key)),s.missingHighPriorityFields.length>3&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-1 rounded-full bg-red-400"}),e.jsxs("span",{className:"text-red-300 text-xs",children:["+",s.missingHighPriorityFields.length-3," autres champs"]})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[s.nextAction&&e.jsx("button",{onClick:h,className:"btn-glass--primary px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{Icon:v.ArrowRight,size:14}),e.jsx("span",{children:s.nextAction.label})]})}),i&&e.jsx("button",{onClick:m,className:"btn-glass--secondary-nav px-3 py-2",title:"Ignorer pour maintenant",children:e.jsx(I,{Icon:v.X,size:14})})]})]})]})})})},Ve={activity:[{key:"sex",label:"Genre"},{key:"height_cm",label:"Taille"},{key:"weight_kg",label:"Poids"}],meals:[{key:"sex",label:"Genre"},{key:"weight_kg",label:"Poids"},{key:"height_cm",label:"Taille"},{key:"objective",label:"Objectif"}],fasting:[{key:"weight_kg",label:"Poids"},{key:"objective",label:"Objectif"},{key:"activity_level",label:"Niveau d'activité"}],culinary:[{key:"weight_kg",label:"Poids"},{key:"objective",label:"Objectif"}],avatar:[{key:"sex",label:"Genre"},{key:"height_cm",label:"Taille"},{key:"weight_kg",label:"Poids"},{key:"birthdate",label:"Date de naissance"}]},ln={activity:{incomplete:"Profil incomplet pour le tracking d'activité",complete:"Profil optimisé pour le tracking d'activité"},meals:{incomplete:"Profil incomplet - Analyses nutritionnelles limitées",complete:"Profil complet pour l'analyse nutritionnelle"},fasting:{incomplete:"Profil incomplet pour le suivi du jeûne",complete:"Profil complet pour le jeûne intermittent"},culinary:{incomplete:"Profil incomplet pour les recommandations culinaires",complete:"Profil complet pour vos recommandations"},avatar:{incomplete:"Profil incomplet pour le scan corporel",complete:"Profil complet pour le scan 3D"}};function dn(s,t){if(!s){const l=Ve[t].map(c=>c.label);return{percentage:0,missingFields:["Profil non chargé"],missingCritical:l,isComplete:!1,canProvideAccurateAnalysis:!1}}const a=Ve[t],r=a.filter(l=>{const c=s[l.key];return c==null||c===""}).map(l=>l.label),i=a.filter(l=>{const c=s[l.key];return c!=null&&c!==""}),o=a.length>0?Math.round(i.length/a.length*100):100;return{percentage:o,missingFields:r,missingCritical:r,isComplete:o===100,canProvideAccurateAnalysis:r.length===0}}function pn(s,t){const a=ln[t];return s.isComplete||s.canProvideAccurateAnalysis?{title:a.complete,type:"success",actionText:"Voir le profil"}:s.missingCritical.length>0?{title:a.incomplete,type:"error",actionText:"Compléter"}:{title:a.incomplete,type:"warning",actionText:"Compléter"}}const Ln=({profile:s,forgeContext:t})=>{const{isPerformanceMode:a}=X(),r=a?"div":w.div,i=ae(),{click:o,success:l}=G(),c=_.useMemo(()=>{n.debug("PROFILE_COMPLETENESS_ALERT","Calculating profile completeness",{forgeContext:t,profileExists:!!s,profileId:s?.id,timestamp:new Date().toISOString()});const h=dn(s,t);return n.debug("PROFILE_COMPLETENESS_ALERT","Profile completeness calculated",{forgeContext:t,percentage:h.percentage,canProvideAccurateAnalysis:h.canProvideAccurateAnalysis,missingCriticalCount:h.missingCritical.length,missingCritical:h.missingCritical,timestamp:new Date().toISOString()}),h},[s,t,s?.sex,s?.height_cm,s?.weight_kg,s?.objective,s?.activity_level,s?.birthdate,s?._immutabilityMarker,s?.updated_at]),d=pn(c,t);if(c.canProvideAccurateAnalysis||c.percentage>=100)return null;const p={bg:"rgba(239, 68, 68, 0.08)",border:"rgba(239, 68, 68, 0.25)",text:"#EF4444",icon:"AlertCircle"};return e.jsx(r,{...!a&&{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5}},children:e.jsx(q,{className:"p-4",style:{background:a?`linear-gradient(145deg, ${p.bg}, transparent)`:`radial-gradient(circle at 30% 20%, ${p.bg} 0%, transparent 60%), var(--glass-opacity)`,borderColor:p.border,boxShadow:a?"0 4px 16px rgba(0, 0, 0, 0.5)":`0 0 20px ${p.text}15`},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`${p.text}20`,border:`1px solid ${p.text}40`},children:e.jsx(I,{Icon:v[p.icon],size:12,style:{color:p.text}})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white font-medium text-sm",children:d.title}),e.jsx("div",{className:"text-white/60 text-xs mt-1",children:c.missingCritical.length>0?`${c.missingCritical.length} champs critiques manquants`:`${c.percentage}% complété`})]})]}),e.jsx("button",{onClick:()=>{o(),Ae(i,"/profile",{tab:"identity",smooth:!0,delay:150}),l()},className:"btn-glass--secondary-nav px-3 py-1.5 text-xs",style:{background:"rgba(59, 130, 246, 0.15)",borderColor:"rgba(59, 130, 246, 0.3)",color:"#3B82F6"},children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(I,{Icon:v.User,size:12}),e.jsx("span",{children:d.actionText||"Compléter"})]})})]})})})},Bn=({completion:s,forgeName:t,forgeColor:a,className:r=""})=>{const i=ae(),{click:o}=G();if(!s||s.isSufficient)return null;const l=()=>{if(o(),s.nextAction){const p=s.nextAction.route,[h,m]=p.split("#"),[u,f]=h.split("?"),x=new URLSearchParams(f).get("tab");Ae(i,u,{tab:x||void 0,hash:m||void 0,smooth:!0,delay:200})}},c=s.missingHighPriorityFields.length>0?"#EF4444":"#F59E0B",d=s.missingHighPriorityFields.length>0?"Champs critiques manquants":"Optimisation recommandée";return e.jsx(q,{className:`p-6 ${r}`,style:{background:`
          radial-gradient(circle at 30% 20%, color-mix(in srgb, ${c} 10%, transparent) 0%, transparent 60%),
          radial-gradient(circle at 70% 80%, color-mix(in srgb, ${a} 8%, transparent) 0%, transparent 50%),
          var(--glass-opacity)
        `,borderColor:`color-mix(in srgb, ${c} 20%, transparent)`,boxShadow:`
          0 8px 32px rgba(0, 0, 0, 0.2),
          0 0 20px color-mix(in srgb, ${c} 12%, transparent),
          inset 0 1px 0 rgba(255, 255, 255, 0.1)
        `},children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
              radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15) 0%, transparent 60%),
              linear-gradient(135deg, color-mix(in srgb, ${c} 30%, transparent), color-mix(in srgb, ${c} 20%, transparent))
            `,border:`2px solid color-mix(in srgb, ${c} 40%, transparent)`,boxShadow:`0 0 20px color-mix(in srgb, ${c} 25%, transparent)`},children:e.jsx(I,{Icon:v.AlertCircle,size:20,style:{color:c}})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{background:c}}),e.jsx("span",{className:"text-sm font-semibold",style:{color:c},children:d})]}),e.jsxs("h4",{className:"text-white font-bold text-base mb-2",children:["Complétez votre profil pour ",t]}),e.jsx("p",{className:"text-white/70 text-sm mb-3 leading-relaxed",children:s.suggestedMessage}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-xs text-white/60 mb-1.5",children:[e.jsx("span",{children:"Profil complété"}),e.jsxs("span",{className:"font-semibold",children:[s.completionPercentage,"%"]})]}),e.jsx("div",{className:"w-full bg-white/10 rounded-full h-1.5 overflow-hidden",children:e.jsx("div",{className:"h-1.5 rounded-full transition-all duration-1000 ease-out",style:{background:`linear-gradient(90deg, ${c}, color-mix(in srgb, ${c} 80%, white))`,width:`${s.completionPercentage}%`}})})]}),s.missingHighPriorityFields.length>0&&e.jsx("div",{className:"mb-4 p-3 rounded-lg",style:{background:"rgba(239, 68, 68, 0.08)",border:"1px solid rgba(239, 68, 68, 0.15)"},children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(I,{Icon:v.AlertTriangle,size:14,className:"flex-shrink-0 mt-0.5",style:{color:"#EF4444"}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-red-300 text-xs font-medium mb-1",children:"Champs essentiels manquants :"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.missingHighPriorityFields.map(p=>e.jsx("span",{className:"inline-block px-2 py-0.5 rounded text-xs",style:{background:"rgba(239, 68, 68, 0.15)",color:"#FCA5A5"},children:p.label},p.key))})]})]})}),s.nextAction&&e.jsx("button",{onClick:l,className:"group relative overflow-hidden px-4 py-2.5 rounded-xl font-semibold text-sm transition-all duration-300 hover:scale-105",style:{background:`linear-gradient(135deg, color-mix(in srgb, ${c} 85%, transparent) 0%, color-mix(in srgb, ${c} 75%, transparent) 100%)`,border:`2px solid color-mix(in srgb, ${c} 60%, transparent)`,boxShadow:`
                  0 8px 24px color-mix(in srgb, ${c} 35%, transparent),
                  inset 0 1px 0 rgba(255, 255, 255, 0.2),
                  inset 0 -1px 0 rgba(0, 0, 0, 0.15)
                `,color:"#FFFFFF",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)"},children:e.jsxs("div",{className:"relative flex items-center justify-center gap-2",children:[e.jsx(I,{Icon:v.User,size:16,style:{color:"#FFFFFF",filter:"drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3))"}}),e.jsx("span",{children:s.nextAction.label}),e.jsx(I,{Icon:v.ArrowRight,size:14,style:{color:"#FFFFFF",filter:"drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3))"}})]})})]})]})})},Hn=({isOpen:s,onClose:t,onConfirm:a,title:r,message:i,confirmText:o="Confirmer",cancelText:l="Annuler",variant:c="danger"})=>{const d=()=>{a(),t()},h=(()=>{switch(c){case"danger":return{iconColor:"#EF4444",icon:v.AlertTriangle,borderColor:"rgba(239, 68, 68, 0.3)",bgGradient:"radial-gradient(circle at 30% 20%, rgba(239, 68, 68, 0.1) 0%, transparent 60%)"};case"warning":return{iconColor:"#F59E0B",icon:v.AlertCircle,borderColor:"rgba(245, 158, 11, 0.3)",bgGradient:"radial-gradient(circle at 30% 20%, rgba(245, 158, 11, 0.1) 0%, transparent 60%)"};case"info":return{iconColor:"#3B82F6",icon:v.Info,borderColor:"rgba(59, 130, 246, 0.3)",bgGradient:"radial-gradient(circle at 30% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 60%)"}}})(),m=e.jsx(H,{children:s&&e.jsxs(e.Fragment,{children:[e.jsx(w.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 backdrop-blur-sm z-[200000]",onClick:t,style:{position:"fixed",top:0,left:0,right:0,bottom:0}}),e.jsx(w.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{type:"spring",damping:25,stiffness:300},className:"fixed inset-0 z-[200001] flex items-center justify-center p-4 pointer-events-none",style:{position:"fixed",top:0,left:0,right:0,bottom:0},children:e.jsx(q,{className:"w-full max-w-md pointer-events-auto",style:{background:`${h.bgGradient}, var(--glass-opacity)`,borderColor:h.borderColor},children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center",style:{background:`radial-gradient(circle at 30% 30%, color-mix(in srgb, ${h.iconColor} 30%, transparent) 0%, transparent 60%), rgba(255, 255, 255, 0.1)`,border:`2px solid color-mix(in srgb, ${h.iconColor} 40%, transparent)`,boxShadow:`0 4px 16px color-mix(in srgb, ${h.iconColor} 20%, transparent)`},children:e.jsx(I,{Icon:h.icon,size:24,style:{color:h.iconColor,filter:`drop-shadow(0 0 8px color-mix(in srgb, ${h.iconColor} 60%, transparent))`}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-white font-semibold text-lg mb-2",children:r}),e.jsx("p",{className:"text-white/70 text-sm leading-relaxed",children:i})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:t,className:"flex-1 py-2.5 px-4 rounded-lg bg-white/10 hover:bg-white/20 text-white text-sm font-medium transition-all",children:l}),e.jsx("button",{onClick:d,className:"flex-1 py-2.5 px-4 rounded-lg text-white text-sm font-medium transition-all shadow-lg",style:{background:c==="danger"?"linear-gradient(135deg, #EF4444 0%, #DC2626 100%)":c==="warning"?"linear-gradient(135deg, #F59E0B 0%, #D97706 100%)":"linear-gradient(135deg, #3B82F6 0%, #2563EB 100%)",boxShadow:`0 4px 12px color-mix(in srgb, ${h.iconColor} 30%, transparent)`},children:o})]})]})})})]})});return typeof document<"u"?fe.createPortal(m,document.body):m},zn=({children:s,containerId:t="portal-root"})=>{const a=E.useRef(null);return E.useEffect(()=>{let r=document.getElementById(t);return r||(r=document.createElement("div"),r.id=t,document.body.appendChild(r)),a.current=r,()=>{a.current&&a.current.childNodes.length===0&&a.current.remove()}},[t]),a.current?fe.createPortal(s,a.current):null},Un=({benefits:s,themeColor:t,title:a="Pourquoi utiliser cette fonctionnalité ?",className:r=""})=>e.jsx(w.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.4},className:r,children:e.jsxs(q,{className:"p-4",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, ${t} 6%, transparent) 0%, transparent 60%),
            var(--glass-opacity-base)
          `,borderColor:`color-mix(in srgb, ${t} 20%, transparent)`,boxShadow:`
            var(--glass-shadow-sm),
            0 0 12px color-mix(in srgb, ${t} 8%, transparent)
          `},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center breathing-icon",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, ${t} 40%, transparent), color-mix(in srgb, ${t} 30%, transparent))
              `,border:`2px solid color-mix(in srgb, ${t} 60%, transparent)`,boxShadow:`
                0 0 20px color-mix(in srgb, ${t} 50%, transparent),
                inset 0 2px 0 rgba(255,255,255,0.3)
              `},children:e.jsx(I,{Icon:v.Info,size:14,style:{color:t},variant:"pure"})}),e.jsx("h4",{className:"text-white/90 font-medium text-sm",children:a})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:s.map((i,o)=>e.jsxs(w.div,{className:"benefit-card",style:{background:`color-mix(in srgb, ${i.color} 6%, transparent)`,border:`1px solid color-mix(in srgb, ${i.color} 15%, transparent)`,borderRadius:"12px",padding:"12px",backdropFilter:"blur(8px)",transition:"all 0.2s ease"},initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3,delay:.1+o*.1},whileHover:{y:-2,borderColor:`color-mix(in srgb, ${i.color} 30%, transparent)`,background:`color-mix(in srgb, ${i.color} 10%, transparent)`},children:[e.jsx("div",{className:"flex items-center justify-center mb-2",style:{width:"32px",height:"32px",borderRadius:"8px",background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, ${i.color} 25%, transparent), color-mix(in srgb, ${i.color} 15%, transparent))
                  `,border:`1px solid color-mix(in srgb, ${i.color} 30%, transparent)`,boxShadow:`0 0 12px color-mix(in srgb, ${i.color} 20%, transparent)`},children:e.jsx(I,{Icon:v[i.icon],size:16,style:{color:i.color},variant:"pure"})}),e.jsx("div",{className:"text-white font-semibold text-sm mb-1",children:i.title}),e.jsx("div",{className:"text-white/70 text-xs leading-relaxed",children:i.description})]},i.id))})]})}),Wn=["apple_health","google_fit","strava"],un={strava:{id:"strava",name:"Strava",description:"Course, vélo, natation et autres activités",icon:"Activity",color:"#FC4C02",authUrl:"https://www.strava.com/oauth/authorize",scopes:["read","activity:read_all","activity:read"],dataTypes:["workout","distance","heart_rate","calories","elevation","pace","cadence"],supportsWebhooks:!0,requiresApp:!1,platform:"all"},garmin:{id:"garmin",name:"Garmin Connect",description:"Montres Garmin et données fitness complètes",icon:"Watch",color:"#007CC3",authUrl:"https://connect.garmin.com/oauth/authorize",scopes:["activities","wellness","sleep"],dataTypes:["heart_rate","steps","calories","distance","sleep","workout","hrv","stress_level","body_battery","vo2max"],supportsWebhooks:!0,requiresApp:!1,platform:"all"},fitbit:{id:"fitbit",name:"Fitbit",description:"Trackers Fitbit et montres Versa/Sense",icon:"Activity",color:"#00B0B9",authUrl:"https://www.fitbit.com/oauth2/authorize",scopes:["activity","heartrate","sleep","weight","nutrition"],dataTypes:["heart_rate","resting_heart_rate","steps","calories","distance","sleep","weight","active_minutes","spo2"],supportsWebhooks:!0,requiresApp:!1,platform:"all"},apple_health:{id:"apple_health",name:"Apple Health",description:"Apple Watch et iPhone Health",icon:"Heart",color:"#FF3B30",authUrl:"",scopes:["health_read"],dataTypes:["heart_rate","steps","calories","distance","sleep","workout","weight","blood_pressure","spo2","hrv","vo2max"],supportsWebhooks:!1,requiresApp:!0,platform:"ios"},polar:{id:"polar",name:"Polar Flow",description:"Montres Polar et capteurs",icon:"Heart",color:"#E30613",authUrl:"https://flow.polar.com/oauth2/authorization",scopes:["accesslink.read_all"],dataTypes:["heart_rate","workout","calories","distance","sleep","hrv"],supportsWebhooks:!0,requiresApp:!1,platform:"all"},wahoo:{id:"wahoo",name:"Wahoo",description:"Capteurs Wahoo et compteurs vélo",icon:"Bike",color:"#2E3192",authUrl:"https://api.wahooligan.com/oauth/authorize",scopes:["workouts_read","power_read"],dataTypes:["workout","heart_rate","power","cadence","distance","calories"],supportsWebhooks:!1,requiresApp:!1,platform:"all"},whoop:{id:"whoop",name:"WHOOP",description:"Bracelet WHOOP et métriques de récupération",icon:"Activity",color:"#000000",authUrl:"https://api.prod.whoop.com/oauth/authorize",scopes:["read:recovery","read:workout","read:sleep"],dataTypes:["heart_rate","hrv","sleep","workout","stress_level","calories"],supportsWebhooks:!1,requiresApp:!1,platform:"all"},oura:{id:"oura",name:"Oura Ring",description:"Bague Oura et données de sommeil",icon:"Moon",color:"#5E17EB",authUrl:"https://cloud.ouraring.com/oauth/authorize",scopes:["daily","personal","session"],dataTypes:["heart_rate","hrv","sleep","temperature","steps","calories"],supportsWebhooks:!1,requiresApp:!1,platform:"all"},suunto:{id:"suunto",name:"Suunto",description:"Montres Suunto pour sports outdoor",icon:"Watch",color:"#FF3B3F",authUrl:"https://cloudapi.suunto.com/oauth/authorize",scopes:["workout"],dataTypes:["workout","heart_rate","distance","elevation","calories"],supportsWebhooks:!1,requiresApp:!1,platform:"all"},coros:{id:"coros",name:"COROS",description:"Montres COROS pour endurance",icon:"Watch",color:"#FF6B00",authUrl:"https://open.coros.com/oauth2/authorize",scopes:["workouts:read"],dataTypes:["workout","heart_rate","distance","elevation","pace","calories"],supportsWebhooks:!1,requiresApp:!1,platform:"all"},google_fit:{id:"google_fit",name:"Google Fit",description:"Google Fit et Android Health",icon:"Activity",color:"#4285F4",authUrl:"https://accounts.google.com/o/oauth2/v2/auth",scopes:["https://www.googleapis.com/auth/fitness.activity.read","https://www.googleapis.com/auth/fitness.heart_rate.read"],dataTypes:["heart_rate","steps","calories","distance","workout","weight"],supportsWebhooks:!1,requiresApp:!0,platform:"android"}},Vn=({variant:s="compact",showSyncButton:t=!1,className:a=""})=>{const{user:r}=oe(),{devices:i,loading:o,syncing:l,syncDevice:c,refreshDevices:d}=es(r?.id||null),[p,h]=E.useState(null),[m,u]=E.useState("idle");E.useEffect(()=>{r?.id&&d()},[r?.id]),E.useEffect(()=>{if(!r?.id||i.length===0)return;const b=setInterval(()=>{d()},6e4);return()=>clearInterval(b)},[r?.id,i.length]);const f=async b=>{try{u("syncing"),n.info("[WEARABLE_STATUS] Manual sync initiated",{deviceId:b}),await c(b),u("success"),n.info("[WEARABLE_STATUS] Manual sync completed",{deviceId:b}),setTimeout(()=>{u("idle")},3e3)}catch(y){u("error"),n.error("[WEARABLE_STATUS] Manual sync failed",{deviceId:b,error:y instanceof Error?y.message:"Unknown error"}),setTimeout(()=>{u("idle")},3e3)}};if(o)return e.jsxs("div",{className:`wearable-status-loading ${a}`,children:[e.jsx(I,{Icon:v.Loader2,size:20,className:"animate-spin",color:"#60A5FA"}),e.jsx("span",{children:"Vérification des appareils..."})]});if(i.length===0)return e.jsxs("div",{className:`wearable-status-empty ${a}`,children:[e.jsx("div",{className:"wearable-status-icon",children:e.jsx(I,{Icon:v.Watch,size:24,color:"#64748B"})}),e.jsxs("div",{className:"wearable-status-text",children:[e.jsx("h4",{children:"Aucun appareil connecté"}),e.jsx("p",{children:"Connectez votre montre pour synchroniser vos données"})]})]});const g=i.filter(b=>b.status==="connected"),x=g.length>0;return s==="compact"?e.jsxs("div",{className:`wearable-status-compact ${a}`,children:[e.jsxs("div",{className:"wearable-status-indicator",children:[e.jsx("div",{className:`status-dot ${x?"connected":"disconnected"}`,title:x?"Connecté":"Déconnecté"}),e.jsx("span",{className:"status-label",children:x?`${g.length} appareil${g.length>1?"s":""} connecté${g.length>1?"s":""}`:"Appareils déconnectés"})]}),x&&g[0].lastSyncAt&&e.jsxs("span",{className:"last-sync-time",children:["Dernière synchro:"," ",new Date(g[0].lastSyncAt).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})]})]}):e.jsxs("div",{className:`wearable-status-detailed ${a}`,children:[e.jsxs("div",{className:"wearable-status-header",children:[e.jsxs("div",{className:"status-title",children:[e.jsx(I,{Icon:v.Watch,size:24,color:x?"#10B981":"#64748B"}),e.jsx("h3",{children:"Appareils Connectés"})]}),t&&x&&e.jsxs(w.button,{onClick:()=>f(g[0].id),disabled:l||m==="syncing",className:"sync-all-button",whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(I,{Icon:v.RefreshCw,size:18,className:l||m==="syncing"?"animate-spin":""}),e.jsx("span",{children:"Synchroniser"})]})]}),e.jsxs(H,{children:[m==="success"&&e.jsxs(w.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"sync-status-message success",children:[e.jsx(I,{Icon:v.CheckCircle,size:18,color:"#10B981"}),e.jsx("span",{children:"Synchronisation réussie"})]}),m==="error"&&e.jsxs(w.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"sync-status-message error",children:[e.jsx(I,{Icon:v.AlertCircle,size:18,color:"#EF4444"}),e.jsx("span",{children:"Échec de la synchronisation"})]})]}),e.jsx("div",{className:"devices-list",children:i.map(b=>{const y=un[b.provider],C=p===b.id,j=b.status==="connected";return e.jsxs(w.div,{className:`device-item ${j?"connected":"disconnected"}`,initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[e.jsxs("div",{className:"device-main",children:[e.jsx("div",{className:"device-icon-wrapper",style:{background:`${y.color}20`},children:e.jsx(I,{Icon:v[y.icon],size:24,color:y.color})}),e.jsxs("div",{className:"device-info",children:[e.jsx("div",{className:"device-name",children:b.displayName||y.name}),e.jsxs("div",{className:"device-meta",children:[e.jsxs("span",{className:`device-status-badge ${b.status}`,children:[b.status==="connected"&&"Connecté",b.status==="syncing"&&"Synchronisation...",b.status==="error"&&"Erreur",b.status==="disconnected"&&"Déconnecté"]}),b.lastSyncAt&&e.jsx("span",{className:"device-last-sync",children:new Date(b.lastSyncAt).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})})]})]}),e.jsx("button",{onClick:()=>h(C?null:b.id),className:"expand-button","aria-label":C?"Réduire":"Développer",children:e.jsx(I,{Icon:C?v.ChevronUp:v.ChevronDown,size:20})})]}),e.jsx(H,{children:C&&e.jsxs(w.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"device-details",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Connecté depuis"}),e.jsx("span",{className:"detail-value",children:new Date(b.connectedAt).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"})})]}),b.lastError&&e.jsxs("div",{className:"detail-item error",children:[e.jsx("span",{className:"detail-label",children:"Dernière erreur"}),e.jsx("span",{className:"detail-value",children:b.lastError})]}),e.jsx("div",{className:"detail-actions",children:j&&e.jsxs("button",{onClick:()=>f(b.id),disabled:l,className:"detail-action-button primary",children:[e.jsx(I,{Icon:v.RefreshCw,size:16,className:l?"animate-spin":""}),e.jsx("span",{children:"Synchroniser"})]})})]})})]},b.id)})})]})},qn=({mode:s,isSelected:t,isRecommended:a,onClick:r,disabled:i=!1})=>{const l=(()=>{switch(s){case"high-performance":return{title:"Performance Maximale",subtitle:"Fluidité 60fps garantie",icon:v.Zap,color:"#10B981",gradient:"linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(16, 185, 129, 0.05) 100%)",features:[{label:"Animations désactivées",enabled:!1},{label:"Effets de verre remplacés",enabled:!1},{label:"Transitions simplifiées",enabled:!1},{label:"Particules désactivées",enabled:!1},{label:"Performance optimale",enabled:!0},{label:"Batterie économisée",enabled:!0},{label:"Fluidité maximale",enabled:!0},{label:"Zéro flickering",enabled:!0}],benefits:["60fps constant","Batterie optimisée","iPhone 8+ compatible"]};case"balanced":return{title:"Équilibré",subtitle:"Compromis idéal",icon:v.Scale,color:"#3B82F6",gradient:"linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(59, 130, 246, 0.05) 100%)",features:[{label:"Animations désactivées",enabled:!1},{label:"Effets de verre légers",enabled:!0},{label:"Transitions simplifiées",enabled:!0},{label:"Particules désactivées",enabled:!1},{label:"Fond statique",enabled:!0},{label:"Design sobre bleu",enabled:!0},{label:"Bonne performance",enabled:!0},{label:"Batterie économisée",enabled:!0}],benefits:["Design + Performance","Bon compromis","iPhone 11+ recommandé"]};case"quality":return{title:"Qualité Premium",subtitle:"Expérience complète",icon:v.Sparkles,color:"#A855F7",gradient:"linear-gradient(135deg, rgba(168, 85, 247, 0.2) 0%, rgba(168, 85, 247, 0.05) 100%)",features:[{label:"Toutes les animations",enabled:!0},{label:"Effets de verre complets",enabled:!0},{label:"Transitions élaborées",enabled:!0},{label:"Particules et lumière",enabled:!0},{label:"Design immersif",enabled:!0},{label:"Expérience premium",enabled:!0},{label:"Tous les effets visuels",enabled:!0},{label:"Rendu haute qualité",enabled:!0}],benefits:["Design complet","Tous les effets","iPhone 13+ / Desktop"]}}})();return e.jsxs(w.button,{onClick:r,disabled:i,whileHover:i?{}:{scale:1.02},whileTap:i?{}:{scale:.98},className:"w-full text-left relative overflow-hidden rounded-2xl transition-all",style:{background:t?`linear-gradient(135deg, ${l.color}30 0%, ${l.color}15 100%)`:l.gradient,border:t?`2px solid ${l.color}`:"1px solid rgba(148, 163, 184, 0.2)",boxShadow:t?`0 8px 24px ${l.color}40, 0 0 0 1px ${l.color}20`:"0 2px 8px rgba(0, 0, 0, 0.1)",opacity:i?.6:1,cursor:i?"not-allowed":"pointer"},children:[e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{Icon:l.icon,size:32,color:l.color,variant:"pure"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:l.title}),e.jsx("p",{className:"text-sm text-slate-400",children:l.subtitle})]})]}),t&&e.jsx(w.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:500,damping:30},children:e.jsx(I,{Icon:v.CheckCircle,size:24,color:l.color,variant:"pure"})})]}),a&&e.jsxs(w.div,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full mb-4",style:{background:`${l.color}30`,border:`1px solid ${l.color}60`},children:[e.jsx(I,{Icon:v.Star,size:14,color:l.color,variant:"pure"}),e.jsx("span",{className:"text-xs font-semibold",style:{color:l.color},children:"Recommandé pour votre appareil"})]}),e.jsx("div",{className:"space-y-2 mb-4",children:l.features.map((c,d)=>e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx(I,{Icon:c.enabled?v.Check:v.X,size:16,color:c.enabled?l.color:"#64748B",variant:"pure",className:"mt-0.5"}),e.jsx("span",{className:c.enabled?"text-slate-300":"text-slate-500",style:{textDecoration:c.enabled?"none":"line-through"},children:c.label})]},d))}),e.jsx("div",{className:"pt-4 border-t border-slate-700/50",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:l.benefits.map((c,d)=>e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-medium",style:{background:"rgba(51, 65, 85, 0.6)",color:"#CBD5E1",border:"1px solid rgba(148, 163, 184, 0.2)"},children:c},d))})})]}),t&&s!=="high-performance"&&e.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{background:`radial-gradient(circle at 50% 0%, ${l.color}15, transparent 70%)`,zIndex:0}})]})},Gn=({label:s,description:t,enabled:a,onChange:r,disabled:i=!1,loading:o=!1})=>{const l=()=>{!i&&!o&&r(!a)};return e.jsxs("div",{className:`settings-toggle-container ${i?"disabled":""} ${o?"loading":""}`,children:[e.jsxs("div",{className:"settings-toggle-labels",children:[e.jsx("label",{className:"settings-toggle-label",children:s}),t&&e.jsx("p",{className:"settings-toggle-description",children:t})]}),e.jsx("button",{type:"button",role:"switch","aria-checked":a,"aria-label":s,onClick:l,disabled:i||o,className:`settings-toggle-switch ${a?"enabled":"disabled"}`,children:e.jsx(J,{className:"settings-toggle-thumb",animate:{x:a?20:0},transition:{type:"spring",stiffness:700,damping:35}})})]})},mn={info:qe,warning:Ce,error:Ge,success:Je},Jn=({type:s="info",title:t,message:a,actions:r,className:i=""})=>{const o=mn[s];return e.jsxs("div",{className:`settings-info-card settings-info-card-${s} ${i}`,children:[e.jsx("div",{className:"settings-info-card-icon",children:e.jsx(o,{size:20})}),e.jsxs("div",{className:"settings-info-card-content",children:[t&&e.jsx("h4",{className:"settings-info-card-title",children:t}),e.jsx("div",{className:"settings-info-card-message",children:a}),r&&e.jsx("div",{className:"settings-info-card-actions",children:r})]})]})},Xn=({children:s,onClick:t,variant:a="primary",disabled:r=!1,loading:i=!1,icon:o,fullWidth:l=!1,type:c="button",className:d=""})=>{const p=r||i;return e.jsxs("button",{type:c,onClick:t,disabled:p,className:`
        settings-button
        settings-button-${a}
        ${l?"settings-button-full-width":""}
        ${p?"settings-button-disabled":""}
        ${i?"settings-button-loading":""}
        ${d}
      `,children:[i&&e.jsx(we,{className:"settings-button-loader",size:18}),!i&&o&&e.jsx("span",{className:"settings-button-icon",children:o}),e.jsx("span",{className:"settings-button-label",children:s})]})},W=({width:s="100%",height:t="20px",borderRadius:a="8px",className:r="",style:i={},shimmer:o=!0,pulse:l=!1})=>{const{isPerformanceMode:c}=X(),d={width:s,height:t,borderRadius:a,position:"relative",overflow:"hidden",...i};if(c){const m=["skeleton-performance-base",o&&"skeleton-shimmer-performance",l&&"skeleton-pulse-performance",r].filter(Boolean).join(" ");return e.jsx("div",{className:m,style:{...d,background:"rgba(255, 255, 255, 0.06)"}})}const p=o?{animate:{backgroundPosition:["0% 0%","100% 0%","0% 0%"]},transition:{duration:2,repeat:1/0,ease:"linear"},style:{...d,background:"linear-gradient(90deg, rgba(255, 255, 255, 0.06), rgba(255, 255, 255, 0.12), rgba(255, 255, 255, 0.06))",backgroundSize:"200% 100%"}}:{},h=l?{animate:{opacity:[.6,1,.6]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}}:{};return e.jsx(J,{className:r,style:o||l?void 0:{...d,background:"rgba(255, 255, 255, 0.08)"},...o?p:{},...l?h:{}})},Kn=({className:s=""})=>{const{isPerformanceMode:t}=X();return e.jsxs("div",{className:`space-y-8 w-full ${s}`,children:[e.jsxs(q,{className:"p-6",children:[e.jsx("div",{className:"flex items-center mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{width:"40px",height:"40px",borderRadius:"50%",shimmer:!0}),e.jsx(W,{width:"150px",height:"24px",shimmer:!0})]})}),e.jsxs("div",{className:"relative h-[400px] sm:h-[500px] lg:h-[600px] rounded-xl overflow-hidden",style:{background:t?"rgba(139, 92, 246, 0.06)":"linear-gradient(135deg, rgba(139, 92, 246, 0.08), rgba(59, 130, 246, 0.04))",border:"1px solid rgba(139, 92, 246, 0.2)"},children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t?e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-32 h-32 rounded-full border-4",style:{borderColor:"rgba(139, 92, 246, 0.3)"}}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-24 h-24 rounded-full",style:{background:"rgba(139, 92, 246, 0.2)"}})}),e.jsx("div",{className:"absolute -bottom-12 left-1/2 transform -translate-x-1/2 whitespace-nowrap",children:e.jsx("span",{className:"text-white/70 text-sm font-medium",children:"Chargement de votre avatar..."})})]}):e.jsxs(J,{className:"relative",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.6},children:[e.jsx(J,{className:"w-32 h-32 rounded-full border-4",style:{borderColor:"rgba(139, 92, 246, 0.3)"},animate:{scale:[1,1.2,1],opacity:[.3,.6,.3]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}}),e.jsx(J,{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(J,{className:"w-24 h-24 rounded-full",style:{background:"radial-gradient(circle, rgba(139, 92, 246, 0.4), rgba(139, 92, 246, 0.1))",boxShadow:"0 0 40px rgba(139, 92, 246, 0.3)"},animate:{scale:[1,1.1,1]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}})}),e.jsx(J,{className:"absolute -bottom-12 left-1/2 transform -translate-x-1/2 whitespace-nowrap",animate:{opacity:[.5,1,.5]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:e.jsx("span",{className:"text-white/70 text-sm font-medium",children:"Chargement de votre avatar..."})})]})}),!t&&e.jsx(J,{className:"absolute top-4 right-4 w-20 h-20 rounded-full",style:{background:"radial-gradient(circle, rgba(139, 92, 246, 0.2), transparent)"},animate:{opacity:[.3,.6,.3],scale:[.8,1,.8]},transition:{duration:3,repeat:1/0,ease:"easeInOut",delay:.5}})]})]}),e.jsxs(q,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{width:"40px",height:"40px",borderRadius:"50%",shimmer:!0}),e.jsx(W,{width:"180px",height:"20px",shimmer:!0})]}),e.jsx(W,{width:"100px",height:"24px",borderRadius:"12px",shimmer:!0})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[...Array(4)].map((a,r)=>e.jsxs(J,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.4,delay:.1+r*.1},className:"p-4 rounded-xl",style:{background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(W,{width:"32px",height:"32px",borderRadius:"8px",shimmer:!0}),e.jsx(W,{width:"80px",height:"12px",shimmer:!0})]}),e.jsx(W,{width:"60px",height:"24px",shimmer:!0,className:"mb-1"}),e.jsx(W,{width:"50px",height:"14px",shimmer:!0})]},r))})]}),e.jsxs(q,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{width:"40px",height:"40px",borderRadius:"50%",shimmer:!0}),e.jsx(W,{width:"200px",height:"20px",shimmer:!0})]}),e.jsx(W,{width:"120px",height:"24px",borderRadius:"12px",shimmer:!0})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[...Array(4)].map((a,r)=>e.jsxs(J,{initial:{opacity:0,y:15},animate:{opacity:1,y:0},transition:{duration:.4,delay:.1+r*.1},className:"p-4 rounded-xl text-center",style:{background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:[e.jsx("div",{className:"flex justify-center mb-3",children:e.jsx(W,{width:"48px",height:"48px",borderRadius:"50%",shimmer:!0})}),e.jsx(W,{width:"80%",height:"16px",shimmer:!0,className:"mx-auto mb-2"}),e.jsx(W,{width:"60%",height:"14px",shimmer:!0,className:"mx-auto"})]},r))}),e.jsxs(J,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.6},className:"p-4 rounded-xl",style:{background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:[e.jsx(W,{width:"100%",height:"14px",shimmer:!0,className:"mb-2"}),e.jsx(W,{width:"90%",height:"14px",shimmer:!0,className:"mb-2"}),e.jsx(W,{width:"80%",height:"14px",shimmer:!0})]})]}),e.jsx("div",{className:"mt-8 text-center",children:e.jsx(W,{width:"250px",height:"56px",borderRadius:"28px",shimmer:!0,className:"mx-auto"})})]})},Yn=({modules:s,progress:t,themeColor:a,reduceMotion:r=!1,className:i=""})=>e.jsx("div",{className:`grid grid-cols-1 md:grid-cols-3 gap-6 ${i}`,children:s.map((o,l)=>{const c=t>=o.activeThreshold;return e.jsxs(w.div,{className:"p-6 rounded-xl relative overflow-hidden",style:{background:`
                radial-gradient(circle at 30% 20%, color-mix(in srgb, ${o.color} ${c?"15":"8"}%, transparent) 0%, transparent 60%),
                rgba(255,255,255,${c?"0.08":"0.04"})
              `,border:`2px solid color-mix(in srgb, ${o.color} ${c?"40":"20"}%, transparent)`,backdropFilter:"blur(12px) saturate(140%)",WebkitBackdropFilter:"blur(12px) saturate(140%)",boxShadow:c?`0 0 20px color-mix(in srgb, ${o.color} 30%, transparent)`:`0 0 8px color-mix(in srgb, ${o.color} 15%, transparent)`,transition:"all 0.6s ease"},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:l*.2},children:[c&&!r&&e.jsx("div",{className:"absolute top-2 right-2 w-3 h-3 rounded-full",style:{background:o.color,boxShadow:`0 0 12px color-mix(in srgb, ${o.color} 80%, transparent)`,animation:"energyPulse 1.5s ease-in-out infinite"}}),e.jsx("div",{className:"flex items-center justify-center gap-3 mb-3",children:e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${c&&!r?"breathing-icon":""}`,style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, ${o.color} 40%, transparent), color-mix(in srgb, ${o.color} 30%, transparent))
                  `,border:`2px solid color-mix(in srgb, ${o.color} 60%, transparent)`,boxShadow:`
                    0 0 20px color-mix(in srgb, ${o.color} 50%, transparent),
                    inset 0 2px 0 rgba(255,255,255,0.3)
                  `},children:e.jsx(I,{Icon:v[o.icon],size:20,style:{color:o.color},variant:"pure"})})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-base font-bold mb-1",style:{color:o.color},children:o.label}),e.jsx("div",{className:"text-xs text-white/60",children:o.sublabel})]}),c&&!r&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 rounded-b-xl overflow-hidden",style:{background:`linear-gradient(90deg,
                    transparent 0%,
                    ${o.color} 50%,
                    transparent 100%
                  )`,animation:"energyFlow 2s ease-in-out infinite"}})]},o.label)})});export{Jn as A,An as B,Hn as C,wn as D,Xn as E,ks as F,q as G,Gn as H,v as I,ge as J,Ze as K,Nn as L,js as M,J as N,Kn as O,Bn as P,In as Q,Yn as R,I as S,Tn as T,En as U,Sn as W,Ln as a,Pn as b,ue as c,Cs as d,is as e,jn as f,kn as g,Rn as h,_n as i,Mn as j,Cn as k,Fn as l,On as m,ws as n,Dn as o,$n as p,Te as q,ns as r,zn as s,Un as t,Ye as u,Vn as v,un as w,Wn as x,Ie as y,qn as z};
