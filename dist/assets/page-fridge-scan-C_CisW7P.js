const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/page-fridge-C1QVLxk9.js","assets/vendor-ZbFMzY-i.js","assets/utils-CUtLAp28.js","assets/supabase-8_3juhcZ.js","assets/stores-ZZM8MTtI.js","assets/ui-components-OHztaiDj.js","assets/motion-HGAT--uT.js","assets/ui-components-DyoLTZgZ.css","assets/date-utils-BlBdbPk_.js"])))=>i.map(i=>d[i]);
import{b as ge,r as j,d as ue,u as ne,e as xe,R as J,j as e}from"./vendor-ZbFMzY-i.js";import{a as re,c as he,F as se,b as me,d as be}from"./stores-ZZM8MTtI.js";import{s as C,l as i,_ as ye,u as Q,a as G}from"./page-fridge-C1QVLxk9.js";import{u as V,G as P,S as v,I as f,b as fe}from"./ui-components-OHztaiDj.js";import{m as I,A as ie}from"./motion-HGAT--uT.js";import{p as ve}from"./utils-CUtLAp28.js";function lt(){const{session:r}=re(),t=r?.user?.id,{data:a,isLoading:s,error:o}=ge({queryKey:["connected-wearables",t],queryFn:async()=>{if(!t)return{hasConnectedWearable:!1,connectedDevicesCount:0};try{const{data:n,error:l}=await C.from("connected_devices").select("id, status, provider").eq("user_id",t).eq("status","connected");if(l)throw i.error("USE_HAS_CONNECTED_WEARABLE","Failed to fetch connected devices",{error:l.message,userId:t,timestamp:new Date().toISOString()}),l;const m=n?.length||0,d=m>0;return i.info("USE_HAS_CONNECTED_WEARABLE","Connected devices checked",{hasConnectedWearable:d,connectedDevicesCount:m,userId:t,timestamp:new Date().toISOString()}),{hasConnectedWearable:d,connectedDevicesCount:m}}catch(n){throw i.error("USE_HAS_CONNECTED_WEARABLE","Error checking connected devices",{error:n instanceof Error?n.message:"Unknown error",userId:t,timestamp:new Date().toISOString()}),n}},enabled:!!t,staleTime:2*60*1e3,refetchOnWindowFocus:!0,retry:2});return{hasConnectedWearable:a?.hasConnectedWearable||!1,connectedDevicesCount:a?.connectedDevicesCount||0,loading:s,error:o}}class we{async getConnectedDevices(t){const{data:a,error:s}=await C.from("connected_devices").select("*").eq("user_id",t).order("connected_at",{ascending:!1});if(s)throw i.error("WEARABLE","Failed to fetch connected devices",{error:s}),s;return a.map(this.mapDevice)}async getDevice(t){const{data:a,error:s}=await C.from("connected_devices").select("*").eq("id",t).single();return s?(i.error("WEARABLE","Failed to fetch device",{error:s,deviceId:t}),null):this.mapDevice(a)}async disconnectDevice(t){const{error:a}=await C.from("connected_devices").update({status:"disconnected"}).eq("id",t);if(a)throw i.error("WEARABLE","Failed to disconnect device",{error:a,deviceId:t}),a;i.info("WEARABLE","Device disconnected successfully",{deviceId:t})}async deleteDevice(t){const{error:a}=await C.from("connected_devices").delete().eq("id",t);if(a)throw i.error("WEARABLE","Failed to delete device",{error:a,deviceId:t}),a;i.info("WEARABLE","Device deleted successfully",{deviceId:t})}async getSyncHistory(t,a=20){const{data:s,error:o}=await C.from("device_sync_history").select("*").eq("device_id",t).order("started_at",{ascending:!1}).limit(a);if(o)throw i.error("WEARABLE","Failed to fetch sync history",{error:o,deviceId:t}),o;return s.map(this.mapSyncHistory)}async triggerSync(t,a){const s=Date.now();i.info("WEARABLE_SYNC","Starting sync request",{deviceId:t,dataTypes:a,timestamp:new Date().toISOString()});const{data:o}=await C.auth.getSession();if(!o.session)throw i.error("WEARABLE_SYNC","Sync failed: Not authenticated",{deviceId:t}),new Error("Not authenticated");i.debug("WEARABLE_SYNC","Session verified",{deviceId:t,userId:o.session.user.id});try{const n=await fetch("https://kwipydbtjagypocpvbwn.supabase.co/functions/v1/wearable-sync",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o.session.access_token}`},body:JSON.stringify({deviceId:t,dataTypes:a})}),l=Date.now()-s;if(!n.ok){const d=await n.text();let x;try{x=JSON.parse(d)}catch{x={error:d}}throw i.error("WEARABLE_SYNC","Sync failed with HTTP error",{deviceId:t,status:n.status,statusText:n.statusText,error:x,duration:l}),new Error(x.error||"Sync failed")}const m=await n.json();i.info("WEARABLE_SYNC","Sync completed successfully",{deviceId:t,dataTypes:a,duration:l,result:m,timestamp:new Date().toISOString()})}catch(n){const l=Date.now()-s;throw i.error("WEARABLE_SYNC","Sync request failed",{deviceId:t,dataTypes:a,duration:l,error:n instanceof Error?n.message:"Unknown error",errorStack:n instanceof Error?n.stack:void 0}),n}}async getHealthData(t,a,s,o){let n=C.from("wearable_health_data").select("*").eq("user_id",t).eq("data_type",a).order("timestamp",{ascending:!1});s&&(n=n.gte("timestamp",s.toISOString())),o&&(n=n.lte("timestamp",o.toISOString()));const{data:l,error:m}=await n.limit(1e3);if(m)throw i.error("WEARABLE","Failed to fetch health data",{error:m,dataType:a}),m;return l.map(this.mapHealthData)}async getSyncPreferences(t){const{data:a,error:s}=await C.from("sync_preferences").select("*").eq("device_id",t).single();return s?(i.error("WEARABLE","Failed to fetch sync preferences",{error:s,deviceId:t}),null):this.mapSyncPreferences(a)}async updateSyncPreferences(t,a){const{error:s}=await C.from("sync_preferences").update({auto_sync_enabled:a.autoSyncEnabled,sync_frequency_minutes:a.syncFrequencyMinutes,data_types_enabled:a.dataTypesEnabled,sync_only_wifi:a.syncOnlyWifi,notify_on_sync:a.notifyOnSync,notify_on_error:a.notifyOnError,backfill_days:a.backfillDays}).eq("device_id",t);if(s)throw i.error("WEARABLE","Failed to update sync preferences",{error:s,deviceId:t}),s;i.info("WEARABLE","Sync preferences updated",{deviceId:t})}async getLatestWorkouts(t,a=10){const{data:s,error:o}=await C.from("wearable_health_data").select("*").eq("user_id",t).eq("data_type","workout").order("timestamp",{ascending:!1}).limit(a);return o?(i.error("WEARABLE","Failed to fetch workouts",{error:o}),[]):s.map(n=>this.normalizeWorkout(n)).filter(n=>n!==null)}async getAggregatedData(t,a,s,o){const n=await this.getHealthData(t,a,s,o),l=new Map;for(const m of n){const d=new Date(m.timestamp).toISOString().split("T")[0],x=m.valueNumeric||0;l.has(d)||l.set(d,[]),l.get(d).push(x)}return Array.from(l.entries()).map(([m,d])=>({date:m,value:d.reduce((x,u)=>x+u,0)/d.length})).sort((m,d)=>m.date.localeCompare(d.date))}mapDevice(t){return{id:t.id,userId:t.user_id,provider:t.provider,providerUserId:t.provider_user_id,displayName:t.display_name,deviceType:t.device_type,status:t.status,scopes:t.scopes||[],lastSyncAt:t.last_sync_at,lastError:t.last_error,errorCount:t.error_count||0,metadata:t.metadata||{},connectedAt:t.connected_at,createdAt:t.created_at,updatedAt:t.updated_at}}mapSyncHistory(t){return{id:t.id,deviceId:t.device_id,userId:t.user_id,syncType:t.sync_type,status:t.status,dataTypesSynced:t.data_types_synced||[],recordsFetched:t.records_fetched||0,recordsStored:t.records_stored||0,durationMs:t.duration_ms,errorMessage:t.error_message,errorCode:t.error_code,startedAt:t.started_at,completedAt:t.completed_at,createdAt:t.created_at}}mapHealthData(t){return{id:t.id,userId:t.user_id,deviceId:t.device_id,dataType:t.data_type,timestamp:t.timestamp,valueNumeric:t.value_numeric,valueText:t.value_text,valueJson:t.value_json,unit:t.unit,qualityScore:t.quality_score,sourceWorkoutId:t.source_workout_id,rawData:t.raw_data,syncedAt:t.synced_at,createdAt:t.created_at}}mapSyncPreferences(t){return{id:t.id,userId:t.user_id,deviceId:t.device_id,autoSyncEnabled:t.auto_sync_enabled,syncFrequencyMinutes:t.sync_frequency_minutes,dataTypesEnabled:t.data_types_enabled||[],syncOnlyWifi:t.sync_only_wifi,notifyOnSync:t.notify_on_sync,notifyOnError:t.notify_on_error,backfillDays:t.backfill_days,createdAt:t.created_at,updatedAt:t.updated_at}}normalizeWorkout(t){if(!t.valueJson)return null;const a=t.valueJson;return{id:t.id,userId:t.userId,deviceId:t.deviceId,provider:"unknown",startTime:t.timestamp,endTime:a.endTime||t.timestamp,durationSeconds:a.durationSeconds||0,activityType:a.activityType||"unknown",distanceMeters:a.distanceMeters,caloriesBurned:a.caloriesBurned,avgHeartRate:a.avgHeartRate,maxHeartRate:a.maxHeartRate,elevationGainMeters:a.elevationGainMeters,avgPace:a.avgPace,avgCadence:a.avgCadence,avgPower:a.avgPower,zones:a.zones,rawData:t.rawData||{}}}}const H=new we;function ct(r){const[t,a]=j.useState([]),[s,o]=j.useState(!0),[n,l]=j.useState(!1),[m,d]=j.useState(null),x=j.useCallback(async()=>{if(!r){a([]),o(!1);return}try{o(!0),d(null);const b=await H.getConnectedDevices(r);a(b),i.info("WEARABLE_HOOK","Devices refreshed",{count:b.length})}catch(b){const c=b instanceof Error?b:new Error("Failed to fetch devices");d(c),i.error("WEARABLE_HOOK","Failed to refresh devices",{error:b})}finally{o(!1)}},[r]),u=j.useCallback(async(b,c)=>{try{l(!0),d(null),i.info("WEARABLE_HOOK","Starting sync",{deviceId:b,dataTypes:c}),await H.triggerSync(b,c),await x(),i.info("WEARABLE_HOOK","Sync completed successfully",{deviceId:b})}catch(S){const z=S instanceof Error?S:new Error("Sync failed");throw d(z),i.error("WEARABLE_HOOK","Sync failed",{error:S,deviceId:b}),z}finally{l(!1)}},[x]),p=j.useCallback(async b=>{try{d(null),i.info("WEARABLE_HOOK","Disconnecting device",{deviceId:b}),await H.disconnectDevice(b),await x(),i.info("WEARABLE_HOOK","Device disconnected",{deviceId:b})}catch(c){const S=c instanceof Error?c:new Error("Failed to disconnect device");throw d(S),i.error("WEARABLE_HOOK","Failed to disconnect device",{error:c,deviceId:b}),S}},[x]),g=j.useCallback(async b=>{try{d(null),i.info("WEARABLE_HOOK","Deleting device",{deviceId:b}),await H.deleteDevice(b),await x(),i.info("WEARABLE_HOOK","Device deleted",{deviceId:b})}catch(c){const S=c instanceof Error?c:new Error("Failed to delete device");throw d(S),i.error("WEARABLE_HOOK","Failed to delete device",{error:c,deviceId:b}),S}},[x]),h=j.useCallback(async b=>{try{return i.info("WEARABLE_HOOK","Fetching sync history",{deviceId:b}),await H.getSyncHistory(b)}catch(c){throw i.error("WEARABLE_HOOK","Failed to fetch sync history",{error:c,deviceId:b}),c}},[]),D=j.useCallback(async b=>{try{return i.info("WEARABLE_HOOK","Fetching sync preferences",{deviceId:b}),await H.getSyncPreferences(b)}catch(c){throw i.error("WEARABLE_HOOK","Failed to fetch sync preferences",{error:c,deviceId:b}),c}},[]),_=j.useCallback(async(b,c)=>{try{i.info("WEARABLE_HOOK","Updating sync preferences",{deviceId:b,prefs:c}),await H.updateSyncPreferences(b,c),await x()}catch(S){throw i.error("WEARABLE_HOOK","Failed to update sync preferences",{error:S,deviceId:b}),S}},[x]);return j.useEffect(()=>{x()},[x]),{devices:t,loading:s,syncing:n,error:m,refreshDevices:x,syncDevice:u,disconnectDevice:p,deleteDevice:g,getSyncHistory:h,getSyncPreferences:D,updateSyncPreferences:_}}const dt={async estimate(r){i.info("Calling scan-estimate edge function",{clientScanId:r.clientScanId,resolvedGender:r.resolvedGender,userId:r.user_id,photosCount:r.photos?.length||0,userMetrics:{height_cm:r.user_declared_height_cm,weight_kg:r.user_declared_weight_kg,gender:r.user_declared_gender,resolvedGender:r.resolvedGender},timestamp:new Date().toISOString()});const{data:t,error:a}=await C.functions.invoke("scan-estimate",{body:r});if(i.info("Scan-estimate response received",{clientScanId:r.clientScanId,hasResponse:!!t,hasError:!!a,responseKeys:t?Object.keys(t):[],errorMessage:a?.message,timestamp:new Date().toISOString()}),a)throw i.error("Scan-estimate failed",{clientScanId:r.clientScanId,error:a.message||a,timestamp:new Date().toISOString()}),new Error(`Scan estimate failed: ${a.message}`);return i.info("Scan-estimate completed successfully",{clientScanId:r.clientScanId,hasExtractedData:!!t?.extracted_data,confidence:t?.extracted_data?.processing_confidence,hasSkinTone:!!t?.extracted_data?.skin_tone,measurementsKeys:t.extracted_data?.raw_measurements?Object.keys(t.extracted_data.raw_measurements):[]}),t},async semantic(r){i.info("Calling scan-semantic edge function",{clientScanId:r.clientScanId,resolvedGender:r.resolvedGender,userId:r.user_id,photosCount:r.photos?.length||0,hasExtractedData:!!r.extracted_data,userGender:r.user_declared_gender,timestamp:new Date().toISOString()});const{data:t,error:a}=await C.functions.invoke("scan-semantic",{body:r});if(i.info("Scan-semantic response received",{clientScanId:r.clientScanId,hasResponse:!!t,hasError:!!a,responseKeys:t?Object.keys(t):[],errorMessage:a?.message,timestamp:new Date().toISOString()}),a)throw i.error("Scan-semantic failed",{clientScanId:r.clientScanId,error:a.message||a,timestamp:new Date().toISOString()}),new Error(`Scan semantic failed: ${a.message}`);return i.info("Scan-semantic completed successfully",{clientScanId:r.clientScanId,hasSemanticProfile:!!t?.semantic_profile,semanticConfidence:t?.semantic_confidence,adjustmentsMade:t?.adjustments_made?.length||0,timestamp:new Date().toISOString()}),t},async match(r){i.info("Calling scan-match edge function",{clientScanId:r.clientScanId,resolvedGender:r.resolvedGender,userId:r.user_id,hasExtractedData:!!r.extracted_data,hasSemanticProfile:!!r.semantic_profile,matchingConfig:r.matching_config,timestamp:new Date().toISOString()});const{data:t,error:a}=await C.functions.invoke("scan-match",{body:r});if(i.info("Scan-match response received",{gender:r.resolvedGender,clientScanId:r.clientScanId,hasResponse:!!t,hasError:!!a,responseKeys:t?Object.keys(t):[],errorMessage:a?.message,auditData:t?{selectedArchetypesCount:t.selected_archetypes?.length||0,strategyUsed:t.strategy_used,semanticCoherenceScore:t.semantic_coherence_score,filteringStats:t.debug_phase_a?.filtering_stats,mappingMetadata:t.mapping_metadata,degradedMode:t.mapping_metadata?.fallback_used||!1,bmiFilteringAnalysis:{userBMI:r.extracted_data?.estimated_bmi,bmiRelaxationApplied:t.debug_phase_a?.filtering_stats?.bmiRelaxationApplied,totalArchetypesEvaluated:t.debug_phase_a?.filtering_stats?.totalArchetypes,afterBMIFilter:t.debug_phase_a?.filtering_stats?.afterBMIFilter,rejectedByBMI:t.debug_phase_a?.filtering_stats?t.debug_phase_a.filtering_stats.totalArchetypes-t.debug_phase_a.filtering_stats.afterBMIFilter:"unknown"}}:null,timestamp:new Date().toISOString()}),t?.mapping_metadata?.fallback_used&&i.warn("Scan-match AUDIT: DEGRADED MODE detected",{clientScanId:r.clientScanId,mapping_source:t.mapping_metadata.mapping_source,fallback_reason:t.mapping_metadata.fallback_reason,impact:"using_hardcoded_mapping_data",recommendation:"check_database_connectivity",philosophy:"degraded_mode_telemetry"}),a)throw i.error("Scan-match AUDIT: Function failed",{clientScanId:r.clientScanId,userBMI:r.extracted_data?.estimated_bmi,semanticProfile:r.semantic_profile?{obesity:r.semantic_profile.obesity,muscularity:r.semantic_profile.muscularity,morphotype:r.semantic_profile.morphotype}:null,error:a.message||a,errorType:typeof a,possibleCauses:["BMI filtering too restrictive","Semantic classification mismatch","Database connectivity issue","Archetype coverage insufficient"],timestamp:new Date().toISOString()}),new Error(`Scan match failed: ${a.message}`);return i.info("Scan-match AUDIT: Completed successfully",{clientScanId:r.clientScanId,userBMI:r.extracted_data?.estimated_bmi,selectedArchetypesCount:t?.selected_archetypes?.length||0,strategyUsed:t?.strategy_used,semanticCoherenceScore:t?.semantic_coherence_score,filteringStats:t?.debug_phase_a?.filtering_stats,mappingSource:t?.mapping_metadata?.mapping_source||"unknown",degradedMode:t?.mapping_metadata?.fallback_used||!1,bmiFilteringSuccess:{bmiRelaxationApplied:t?.debug_phase_a?.filtering_stats?.bmiRelaxationApplied,finalArchetypesFound:t?.selected_archetypes?.length||0,primaryArchetype:t?.selected_archetypes?.[0]?{id:t.selected_archetypes[0].id,bmiRange:t.selected_archetypes[0].bmi_range,obesity:t.selected_archetypes[0].obesity}:null},timestamp:new Date().toISOString()}),t},async refine(r){const t={};for(const[o,n]of Object.entries(r.blend_limb_masses))typeof n=="number"&&Number.isFinite(n)&&(t[o]=n);i.info("Filtering blend_limb_masses for Edge Function",{scanId:r.scan_id,originalKeys:Object.keys(r.blend_limb_masses),filteredKeys:Object.keys(t),removedKeys:Object.keys(r.blend_limb_masses).filter(o=>!(o in t)),hasUserMeasurements:!!r.user_measurements,philosophy:"ai_refinement_data_filtering",timestamp:new Date().toISOString()});const{data:a,error:s}=await C.functions.invoke("scan-refine-morphs",{body:{...r,blend_limb_masses:t,k5_envelope:r.k5_envelope,vision_classification:r.vision_classification,user_measurements:r.user_measurements}});if(i.info("Scan-refine-morphs response received",{scanId:r.scan_id,hasResponse:!!a,hasError:!!s,responseKeys:a?Object.keys(a):[],errorMessage:s?.message,aiRefine:a?.ai_refine,finalShapeParamsCount:a?.final_shape_params?Object.keys(a.final_shape_params).length:0,finalLimbMassesCount:a?.final_limb_masses?Object.keys(a.final_limb_masses).length:0,envelopeViolationsCount:a?.envelope_violations?.length||0,dbViolationsCount:a?.db_violations?.length||0,missingKeysAddedCount:a?.missing_keys_added?.length||0,extraKeysRemovedCount:a?.extra_keys_removed?.length||0,philosophy:"phase_b_ai_refinement_response",timestamp:new Date().toISOString()}),s)throw i.error("Scan-refine-morphs failed",{scanId:r.scan_id,error:s.message||s,philosophy:"phase_b_ai_refinement_failed",timestamp:new Date().toISOString()}),new Error(`AI morphological refinement failed: ${s.message}`);return i.info("Scan-refine-morphs completed successfully",{scanId:r.scan_id,aiRefine:a.ai_refine,finalShapeParamsCount:Object.keys(a.final_shape_params||{}).length,finalLimbMassesCount:Object.keys(a.final_limb_masses||{}).length,clampedKeysCount:a.clamped_keys?.length||0,envelopeViolationsCount:a.envelope_violations?.length||0,dbViolationsCount:a.db_violations?.length||0,outOfRangeCount:a.out_of_range_count||0,missingKeysAddedCount:a.missing_keys_added?.length||0,extraKeysRemovedCount:a.extra_keys_removed?.length||0,activeKeysCount:a.active_keys_count||0,aiConfidence:a.ai_confidence,mappingVersion:a.mapping_version,philosophy:"phase_b_ai_refinement_success",timestamp:new Date().toISOString()}),a},async commit(r){let s=null;i.info("Calling scan-commit edge function",{clientScanId:r.clientScanId,resolvedGender:r.resolvedGender,userId:r.user_id,hasEstimateResult:!!r.estimate_result,hasMatchResult:!!r.match_result,hasSemanticResult:!!r.semantic_result,hasAIRefinement:!!r.ai_refinement_result,hasFinalShapeParams:!!r.final_shape_params,finalShapeParamsCount:r.final_shape_params?Object.keys(r.final_shape_params).length:0,hasFinalLimbMasses:!!r.final_limb_masses,finalLimbMassesCount:r.final_limb_masses?Object.keys(r.final_limb_masses).length:0,hasSkinTone:!!r.skin_tone,maxRetries:3,philosophy:"scan_commit_with_retry_v2"});for(let o=1;o<=3;o++)try{o>1&&(i.info(`Scan-commit retry attempt ${o}/3`,{clientScanId:r.clientScanId,previousError:s?.message||"Unknown error",delayMs:2e3,philosophy:"retry_attempt"}),await new Promise(l=>setTimeout(l,2e3)));const n=await C.functions.invoke("scan-commit",{body:r});if(i.info("Scan-commit response received",{clientScanId:r.clientScanId,attempt:o,hasResponse:!!n,responseKeys:n?Object.keys(n):[],hasData:!!n?.data,hasError:!!n?.error,timestamp:new Date().toISOString()}),!n)throw new Error("No response received from scan-commit function");if(n.error){const l=n.error?.message||n.error||"Unknown commit error";throw i.error("Scan-commit returned error",{clientScanId:r.clientScanId,attempt:o,error:n.error,errorMessage:l,timestamp:new Date().toISOString()}),new Error(`Scan commit failed: ${l}`)}return n.data?(i.info("Scan-commit completed successfully",{clientScanId:r.clientScanId,attempt:o,serverScanId:n.data.scan_id,commitSuccess:!!n.data.success,processingComplete:!!n.data.processing_complete,philosophy:"commit_success"}),n.data):(i.warn("Scan-commit returned no data",{clientScanId:r.clientScanId,attempt:o,response:n}),{success:!0,message:"Commit completed without data"})}catch(n){if(s=n,i.error(`Scan-commit attempt ${o}/3 failed`,{clientScanId:r.clientScanId,attempt:o,error:n instanceof Error?n.message:"Unknown error",willRetry:o<3,philosophy:"commit_attempt_failed"}),o===3)throw i.error("Scan-commit all retry attempts exhausted",{clientScanId:r.clientScanId,totalAttempts:3,finalError:s instanceof Error?s.message:"Unknown error",philosophy:"commit_retry_exhausted"}),s}throw s||new Error("Scan commit failed after all retries")},async getLatest(r){const{data:t,error:a}=await C.functions.invoke("scan-latest",{method:"GET",query:{user_id:r}});if(a)throw new Error(`Get latest scan failed: ${a.message}`);return t},async getHistory(r,t=1e3){const{data:a,error:s}=await C.from("body_scans").select("*").eq("user_id",r).order("created_at",{ascending:!1}).limit(t);if(s)throw new Error(`Get scan history failed: ${s.message}`);return a},async getById(r){const{data:t,error:a}=await C.from("body_scans").select("*").eq("id",r).single();if(a)throw new Error(`Get scan by ID failed: ${a.message}`);return t},async getLatestWithMorphData(r){i.info("BODY_SCAN_REPO","Fetching latest body scan with morph data",{userId:r,philosophy:"get_latest_with_morph_data"});const{data:t,error:a}=await C.from("body_scans").select("*").eq("user_id",r).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(a)throw i.error("BODY_SCAN_REPO","Error fetching latest scan with morph data",{userId:r,error:a.message,philosophy:"get_latest_with_morph_data_error"}),new Error(`Get latest scan with morph data failed: ${a.message}`);return t?(i.info("BODY_SCAN_REPO","Latest body scan with morph data retrieved",{userId:r,scanId:t.id,hasMorphValues:!!t.morph_values,morphValuesCount:t.morph_values?Object.keys(t.morph_values).length:0,hasLimbMasses:!!t.limb_masses,limbMassesCount:t.limb_masses?Object.keys(t.limb_masses).length:0,hasWeight:!!t.weight,hasSkinTone:!!t.skin_tone,timestamp:t.timestamp,philosophy:"get_latest_with_morph_data_success"}),t):(i.info("BODY_SCAN_REPO","No body scan found",{userId:r,philosophy:"no_scan_found"}),null)}},_e=[{id:"setup",title:"Configuration Temporelle",subtitle:"Paramétrez votre protocole de jeûne",icon:"Settings",color:"#F59E0B"},{id:"active",title:"Session Active",subtitle:"Votre jeûne est en cours",icon:"Timer",color:"#EF4444"},{id:"completion",title:"Forge Accomplie",subtitle:"Session terminée avec succès",icon:"Check",color:"#22C55E"}],Se="twinforge:fasting:pipeline",X=ue()(ve((r,t)=>({currentStep:"setup",isActive:!1,session:null,steps:_e,lastTick:Date.now(),startFasting:(a,s)=>{const n=re.getState().session;if(!n?.user?.id){console.error("User not authenticated for fasting session");return}const l=new Date,m={userId:n.user.id,startTime:l,targetHours:a,protocol:s,status:"active"};r({currentStep:"active",isActive:!0,session:m}),i.info("FASTING_PIPELINE","Fasting session started",{userId:n.user.id,targetHours:a,protocol:s,startTime:l.toISOString(),timestamp:new Date().toISOString()})},stopFasting:()=>{const a=t();if(!a.session)return;const s=new Date,o=new Date(a.session.startTime).getTime(),n=Math.floor((s.getTime()-o)/1e3),l=n/3600,m={...a.session,endTime:s,actualDurationHours:l,status:"completed"};r({currentStep:"completion",isActive:!0,session:m}),i.info("FASTING_PIPELINE","Fasting session completed",{userId:a.session.userId,sessionId:a.session.id,actualDurationMinutes:(n/60).toFixed(1),actualDurationHours:l.toFixed(3),targetHours:a.session.targetHours,timestamp:new Date().toISOString()})},cancelFasting:()=>{const a=t();i.info("FASTING_PIPELINE","Fasting session cancelled",{userId:a.session?.userId,sessionDuration:a.getElapsedMinutes(),timestamp:new Date().toISOString()}),r({currentStep:"setup",isActive:!1,session:null})},saveFastingSession:async()=>{const a=t();if(a.session)try{i.info("FASTING_PIPELINE","Saving fasting session to database",{userId:a.session.userId,sessionId:a.session.id,actualDurationHours:a.session.actualDurationHours,targetHours:a.session.targetHours,timestamp:new Date().toISOString()});const{supabase:s}=await ye(async()=>{const{supabase:m}=await import("./page-fridge-C1QVLxk9.js").then(d=>d.q);return{supabase:m}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),o={user_id:a.session.userId,start_time:new Date(a.session.startTime).toISOString(),end_time:a.session.endTime?new Date(a.session.endTime).toISOString():null,target_hours:a.session.targetHours,actual_duration_hours:a.session.actualDurationHours||null,protocol_id:a.session.protocol||null,status:a.session.status,notes:a.session.notes||null},{data:n,error:l}=await s.from("fasting_sessions").insert([o]).select().single();if(l)throw new Error(`Database insertion failed: ${l.message}`);i.info("FASTING_PIPELINE","Session successfully saved to database",{userId:a.session.userId,sessionId:n?.id,actualDurationHours:a.session.actualDurationHours,timestamp:new Date().toISOString()}),r({currentStep:"setup",isActive:!1,session:null}),i.info("FASTING_PIPELINE","Session saved and pipeline reset",{userId:a.session.userId,timestamp:new Date().toISOString()})}catch(s){throw i.error("FASTING_PIPELINE","Failed to save fasting session",{error:s instanceof Error?s.message:"Unknown error",userId:a.session?.userId,timestamp:new Date().toISOString()}),s}},tick:()=>{r({lastTick:Date.now()})}}),{name:Se,partialize:r=>({currentStep:r.currentStep,isActive:r.isActive,session:r.session,lastTick:r.lastTick}),merge:(r,t)=>({...t,...r,steps:t.steps,lastTick:Date.now(),session:r.session?{...r.session,startTime:r.session.startTime?(()=>{const a=new Date(r.session.startTime);return isNaN(a.getTime())?new Date:a})():r.session.startTime,endTime:r.session.endTime?(()=>{const a=new Date(r.session.endTime);return isNaN(a.getTime())?void 0:a})():r.session.endTime}:null})})),mt=()=>X(r=>{if(!r.isActive||!r.session?.startTime)return 0;const t=Date.now(),a=new Date(r.session.startTime).getTime();return Math.floor((t-a)/1e3)}),pt=()=>X(r=>{if(!r.session?.targetHours||!r.isActive||!r.session?.startTime)return 0;const t=Date.now(),a=new Date(r.session.startTime).getTime(),s=Math.floor((t-a)/1e3),o=r.session.targetHours*60*60;return Math.min(100,s/o*100)}),gt=()=>{const r=X(a=>a.isActive),t=X(a=>a.tick);J.useEffect(()=>{if(!r)return;t();const a=setInterval(()=>{t()},1e3);return()=>{clearInterval(a)}},[r,t])};function ut(){const r=ne(),t=xe(),{session:a}=re(),{success:s,error:o}=Q(),{showToast:n}=V(),l=X();return{...l,actions:{startFasting:(p,g)=>{if(!a?.user?.id){o(),n({type:"error",title:"Erreur d'authentification",message:"Vous devez être connecté pour démarrer un jeûne",duration:4e3});return}l.startFasting(p,g),s(),n({type:"success",title:"Forge du Temps Activée",message:`Session de jeûne ${p}h démarrée`,duration:4e3})},stopFasting:()=>{const p=l,g=p.session?Math.floor((Date.now()-new Date(p.session.startTime).getTime())/1e3):0;l.stopFasting(),s(),n({type:"success",title:"Session Terminée",message:`Jeûne de ${Math.floor(g/60)} minutes complété`,duration:4e3})},cancelFasting:()=>{l.cancelFasting();const p=l,g=p.session?Math.floor((Date.now()-new Date(p.session.startTime).getTime())/6e4):0;i.info("FASTING_PIPELINE","Fasting session cancelled",{userId:p.session?.userId,sessionDuration:g,timestamp:new Date().toISOString()}),r("/fasting")},saveFastingSession:async()=>{try{await l.saveFastingSession(),t.invalidateQueries({queryKey:["fasting"]}),s(),n({type:"success",title:"Session Sauvegardée",message:"Votre session de jeûne a été enregistrée",duration:3e3}),r("/fasting#daily")}catch{o(),n({type:"error",title:"Erreur de Sauvegarde",message:"Impossible de sauvegarder votre session",duration:4e3})}}}}}function xt(){const{showToast:r}=V();j.useEffect(()=>{t()},[]);const t=async()=>{try{const{data:{user:a}}=await C.auth.getUser();if(!a)return;const s=`welcome_tokens_toast_shown_${a.id}`;if(localStorage.getItem(s))return;const{data:n}=await C.from("token_transactions").select("token_amount, created_at").eq("user_id",a.id).eq("transaction_type","bonus").or("metadata->>reason.eq.welcome_bonus,metadata->>reason.eq.backfill_welcome_bonus").order("created_at",{ascending:!1}).limit(1);if(n&&n.length>0){const l=n[0],m=new Date(l.created_at);(new Date().getTime()-m.getTime())/(1e3*60)<10&&setTimeout(()=>{r({type:"success",title:"Bienvenue sur TwinForgeFit!",message:`Vous avez reçu ${l.token_amount.toLocaleString("fr-FR")} tokens pour commencer votre aventure.`,duration:6e3}),localStorage.setItem(s,"true"),i.info("WELCOME_TOKENS_TOAST","Welcome tokens toast shown",{userId:a.id,tokenAmount:l.token_amount})},2e3)}}catch(a){i.error("WELCOME_TOKENS_TOAST","Error checking for welcome tokens toast",{error:a instanceof Error?a.message:"Unknown error"})}}}const ht=({isActive:r,currentStep:t,currentSessionId:a,simulatedOverallProgress:s,loadingState:o,capturedPhotos:n,startScan:l,resumePipeline:m})=>{j.useEffect(()=>{i.debug("FRIDGE_SCAN_PAGE","Component mounted, checking store state after hydration",{isActive:r,currentStep:t,currentSessionId:a,simulatedOverallProgress:s,loadingState:o,capturedPhotosCount:n.length,timestamp:new Date().toISOString()}),i.info("FRIDGE_SCAN_PAGE","Component mounted, checking pipeline state",{isActive:r,currentStep:t,loadingState:o,capturedPhotosCount:n.length,currentSessionId:a,timestamp:new Date().toISOString()}),!r&&!a?(i.info("FRIDGE_SCAN_PAGE","Pipeline not active, starting new scan",{currentStep:t,loadingState:o,currentSessionId:a,timestamp:new Date().toISOString()}),l()):!r&&a?(i.info("FRIDGE_SCAN_PAGE","Resuming persisted session",{currentSessionId:a,currentStep:t,timestamp:new Date().toISOString()}),m()):i.info("FRIDGE_SCAN_PAGE","Pipeline already active, maintaining current state",{currentStep:t,loadingState:o,isActive:r,currentSessionId:a,capturedPhotosCount:n.length,timestamp:new Date().toISOString()})},[]),j.useEffect(()=>{i.debug("FRIDGE_SCAN_PAGE","Captured photos count changed",{capturedPhotosCount:n.length,currentStep:t,isActive:r,currentSessionId:a,timestamp:new Date().toISOString()})},[n.length]),j.useEffect(()=>()=>{i.info("FRIDGE_SCAN_PAGE","Component unmounting, cleaning up pipeline",{currentStep:t,isActive:r,timestamp:new Date().toISOString()})},[]),j.useEffect(()=>{const x=setTimeout(()=>{window.scrollTo({top:0,behavior:"smooth"});const u=document.getElementById("main-content");u&&u.scrollTo({top:0,behavior:"smooth"})},150);return i.debug("FRIDGE_SCAN_PAGE","Auto-scroll triggered on step change",{currentStep:t,timestamp:new Date().toISOString()}),()=>clearTimeout(x)},[t]),j.useEffect(()=>{if(n.length>0){const x=setTimeout(()=>{const u=document.getElementById("analyze-cta");u?(u.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),i.debug("FRIDGE_SCAN_PAGE","Auto-scroll to AnalyzeCTA successful",{capturedPhotosCount:n.length,ctaElementFound:!0,timestamp:new Date().toISOString()})):(i.debug("FRIDGE_SCAN_PAGE","AnalyzeCTA not found, retrying...",{capturedPhotosCount:n.length,timestamp:new Date().toISOString()}),setTimeout(()=>{const p=document.getElementById("analyze-cta");p&&p.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},200))},500);return i.debug("FRIDGE_SCAN_PAGE","Scheduling auto-scroll to AnalyzeCTA",{capturedPhotosCount:n.length,timestamp:new Date().toISOString()}),()=>clearTimeout(x)}},[n.length])},bt=({currentStep:r,loadingState:t,isActive:a,currentSessionId:s,capturedPhotos:o,rawDetectedItems:n,suggestedComplementaryItems:l,goToStep:m,setLoadingState:d,startProgressSimulation:x,processVisionResults:u,setSuggestedComplementaryItems:p,addCapturedPhotos:g,updateInventory:h,removeCapturedPhoto:D,resetPipeline:_})=>{const b=ne(),{profile:c,session:S}=re(),{success:z,error:Z,click:q}=Q(),{showToast:N}=V(),{showModal:L}=he(),ee=()=>{i.info("FRIDGE_SCAN_PAGE","User requested manual exit from pipeline",{currentStep:r,loadingState:t,isActive:a,sessionId:s,timestamp:new Date().toISOString()}),L({title:"Quitter l'Atelier de Recettes",message:"Votre session de scan et de génération de recettes est en cours. Quitter maintenant entraînera une perte de progression et pourrait générer des coûts IA inutiles.",processName:"Scanner de Frigo",onConfirm:()=>{i.info("FRIDGE_SCAN_PAGE","User confirmed manual exit, resetting pipeline",{currentStep:r,loadingState:t,sessionId:s,timestamp:new Date().toISOString()}),_(),b("/fridge"),N({type:"info",title:"Atelier Réinitialisé",message:"Votre session a été annulée et l'atelier a été réinitialisé",duration:3e3})},onCancel:()=>{i.info("FRIDGE_SCAN_PAGE","User cancelled manual exit, continuing pipeline",{currentStep:r,loadingState:t,timestamp:new Date().toISOString()})}})},U=async k=>{try{i.info("FRIDGE_SCAN_PAGE","Photos uploaded, starting analysis",{photosCount:k.length,sessionId:s,timestamp:new Date().toISOString()}),m("analyze"),d("analyzing");const O=se.find(y=>y.id==="analyze"),B=se.find(y=>y.id==="validation");x([{message:"Initialisation de l'analyse IA...",duration:2e3,icon:"Zap"},{message:"Traitement des images avec GPT-4o...",duration:8e3,icon:"Eye"},{message:"Détection des ingrédients...",duration:4e3,icon:"Search"},{message:"Normalisation de l'inventaire...",duration:3e3,icon:"CheckCircle"}],O?.startProgress||33,B?.startProgress||66),i.info("FRIDGE_SCAN_PAGE","Starting vision analysis with OpenAI",{photosCount:k.length,sessionId:s,aiModel:"gpt-4o",timestamp:new Date().toISOString()});const R=await fetch("https://kwipydbtjagypocpvbwn.supabase.co/functions/v1/fridge-scan-vision",{method:"POST",headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3aXB5ZGJ0amFneXBvY3B2YnduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODg0MjIsImV4cCI6MjA3MDI2NDQyMn0.IS5IdKbmnGtgU_AaGYtUgX3ewaNpsiSAui5kbFV31_U","Content-Type":"application/json"},body:JSON.stringify({image_base64:k,user_id:S?.user?.id})});if(!R.ok)throw new Error(`Vision analysis failed: ${R.status} ${R.statusText}`);const T=await R.json();i.info("FRIDGE_SCAN_PAGE","Vision data received from Edge Function",{sessionId:s,hasDetectedItems:!!T.detected_items,detectedItemsCount:T.detected_items?.length||0,allDetectedItems:T.detected_items?.map(y=>({label:y.label,confidence:y.confidence,category:y.category,quantity:y.estimated_quantity,freshness:y.freshness_score})),detectionQuality:(T.detected_items?.length||0)>=15?"EXCELLENT":(T.detected_items?.length||0)>=10?"GOOD":(T.detected_items?.length||0)>=6?"ACCEPTABLE":"POOR",visionDataKeys:Object.keys(T),processingTimeMs:T.processing_time_ms,costUsd:T.cost_usd,cacheHit:T.cache_hit,timestamp:new Date().toISOString()}),i.info("FRIDGE_SCAN_PAGE","Vision analysis completed",{sessionId:s,itemsDetected:T.detected_items?.length||0,processingTimeMs:T.processing_time_ms,costUsd:T.cost_usd,imagesProcessed:T.images_processed,cacheHit:T.cache_hit,aiModel:"gpt-4o",timestamp:new Date().toISOString()}),i.info("FRIDGE_SCAN_PAGE","Starting inventory processing",{rawItemsCount:T.detected_items?.length||0,sessionId:s,timestamp:new Date().toISOString()});const M=await fetch("https://kwipydbtjagypocpvbwn.supabase.co/functions/v1/inventory-processor",{method:"POST",headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3aXB5ZGJ0amFneXBvY3B2YnduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODg0MjIsImV4cCI6MjA3MDI2NDQyMn0.IS5IdKbmnGtgU_AaGYtUgX3ewaNpsiSAui5kbFV31_U","Content-Type":"application/json"},body:JSON.stringify({raw_detected_items:T.detected_items||[],user_id:S?.user?.id})});if(!M.ok){const y=await M.text();throw i.error("FRIDGE_SCAN_PAGE","Inventory processor response error",{status:M.status,statusText:M.statusText,errorBody:y,sessionId:s,timestamp:new Date().toISOString()}),new Error(`Inventory processing failed: ${M.status} ${M.statusText}`)}const F=await M.json();i.info("FRIDGE_SCAN_PAGE","Processor data received from Edge Function",{sessionId:s,hasInventoryNormalized:!!F.inventory_normalized,inventoryNormalizedCount:F.inventory_normalized?.length||0,allNormalizedInventory:F.inventory_normalized?.map(y=>({name:y.name,category:y.category,quantity:y.quantity,freshness:y.freshness})),quantityAdjustmentCheck:F.inventory_normalized?.some(y=>y.quantity?.includes("pour")||y.quantity?.includes("personnes"))?"DETECTED_HOUSEHOLD_ADJUSTMENT":"RAW_QUANTITIES_PRESERVED",processorDataKeys:Object.keys(F),processingTimeMs:F.processing_time_ms,cacheHit:F.cache_hit,timestamp:new Date().toISOString()}),i.info("FRIDGE_SCAN_PAGE","Inventory processing completed",{sessionId:s,itemsProcessed:F.items_processed,itemsNormalized:F.inventory_normalized?.length||0,processingTimeMs:F.processing_time_ms,cacheHit:F.cache_hit,timestamp:new Date().toISOString()});let Y=[];const te=10,$=F.inventory_normalized?.length||0;if($<te){i.info("FRIDGE_SCAN_PAGE","Inventory insufficient, calling complementer",{sessionId:s,normalizedItemsCount:$,threshold:te,timestamp:new Date().toISOString()});try{const y=await fetch("https://kwipydbtjagypocpvbwn.supabase.co/functions/v1/inventory-complementer",{method:"POST",headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3aXB5ZGJ0amFneXBvY3B2YnduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODg0MjIsImV4cCI6MjA3MDI2NDQyMn0.IS5IdKbmnGtgU_AaGYtUgX3ewaNpsiSAui5kbFV31_U","Content-Type":"application/json"},body:JSON.stringify({user_id:S?.user?.id,current_inventory:F.inventory_normalized||[],user_profile:c})});if(!y.ok)throw new Error(`Complementer failed: ${y.status} ${y.statusText}`);const K=await y.json();i.info("FRIDGE_SCAN_PAGE","Complementer suggestions received",{sessionId:s,suggestionsCount:K.suggested_items?.length||0,processingTimeMs:K.processing_time_ms,timestamp:new Date().toISOString()}),Y=(K.suggested_items||[]).map((W,tt)=>({id:crypto.randomUUID(),userId:S?.user?.id||"",sessionId:s||"",name:W.label,category:W.category,quantity:W.quantity,confidence:W.confidence||.85,freshnessScore:W.freshness||90,isUserEdited:!1,isSuggested:!0,suggestionReason:W.reason||"Recommandé par notre IA nutritionniste",suggestionPriority:W.priority||"medium",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()})),p(Y)}catch(y){i.error("FRIDGE_SCAN_PAGE","Complementer call failed",{error:y instanceof Error?y.message:"Unknown error",sessionId:s,timestamp:new Date().toISOString()}),N({type:"warning",title:"Suggestions indisponibles",message:"Impossible de suggérer des aliments complémentaires, mais vous pouvez continuer.",duration:4e3})}}i.debug("FRIDGE_SCAN_PAGE","Converting normalized inventory to FridgeItem format",{sessionId:s,normalizedItemsCount:F.inventory_normalized?.length||0,timestamp:new Date().toISOString()});const ae=(F.inventory_normalized||[]).map((y,K)=>({id:`item-${K}`,userId:S?.user?.id||"",sessionId:s||"",name:y.name,category:y.category,quantity:y.quantity,confidence:.9,freshnessScore:y.freshness==="Excellent"?90:y.freshness==="Bon"?75:y.freshness==="Moyen"?50:30,expiryDate:y.estimated_expiry_days?new Date(Date.now()+y.estimated_expiry_days*24*60*60*1e3).toISOString().split("T")[0]:void 0,isUserEdited:!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}));i.info("FRIDGE_SCAN_PAGE","FridgeItems created successfully",{sessionId:s,fridgeItemsCount:ae.length,fridgeItemsPreview:ae.slice(0,3).map(y=>({id:y.id,name:y.name,category:y.category,quantity:y.quantity,freshnessScore:y.freshnessScore})),timestamp:new Date().toISOString()}),u(ae,Y),d("idle")}catch(O){i.error("FRIDGE_SCAN_PAGE","Photo analysis failed",{error:O instanceof Error?O.message:"Unknown error",photosCount:k.length,sessionId:s,loadingState:t,currentStep:r,timestamp:new Date().toISOString(),stack:O instanceof Error?O.stack:void 0}),Z(),N({type:"error",title:"Erreur d'analyse",message:O instanceof Error&&O.message.includes("unsupported image")?"Format d'image non supporté. Utilisez PNG, JPEG, GIF ou WebP.":"Impossible d'analyser les photos. Veuillez réessayer.",duration:5e3}),d("idle"),m("photo")}};return{handleManualExit:ee,handlePhotosUploaded:U,handleInventoryUpdate:k=>{i.debug("FRIDGE_SCAN_PAGE","Inventory updated by user",{inventoryCount:k.length,sessionId:s,timestamp:new Date().toISOString()}),h(k)},handleFileSelect:async k=>{if(!k||k.length===0)return;const O=["image/png","image/jpeg","image/jpg","image/gif","image/webp"],B=Array.from(k).filter(R=>O.includes(R.type.toLowerCase())?R.size>10*1024*1024?(N({type:"error",title:"Fichier trop volumineux",message:`${R.name} dépasse la limite de 10MB`,duration:3e3}),!1):!0:(N({type:"error",title:"Format non supporté",message:`${R.name} doit être au format PNG, JPEG, GIF ou WebP`,duration:4e3}),!1));if(B.length!==0)try{const T=B.slice(0,6).map(F=>new Promise((Y,te)=>{const $=new FileReader;$.onload=()=>Y($.result),$.onerror=te,$.readAsDataURL(F)})),M=await Promise.all(T);i.info("FRIDGE_SCAN_PAGE","Photos captured for analysis",{photosCount:M.length,maxSupported:6,timestamp:new Date().toISOString()}),g(M),z(),N({type:"success",title:"Photos capturées !",message:`${M.length} photo${M.length>1?"s":""} prête${M.length>1?"s":""} pour l'analyse`,duration:3e3})}catch{N({type:"error",title:"Erreur de traitement",message:"Impossible de traiter les photos sélectionnées",duration:4e3})}},removePhoto:k=>{D(k)},handleAnalyzePhotos:()=>{o.length!==0&&(q(),i.info("FRIDGE_SCAN_PAGE","User clicked analyze photos button",{capturedPhotosCount:o.length,sessionId:s,timestamp:new Date().toISOString()}),U(o))}}},je="_wrap_2h7el_11",Ie="_card_2h7el_18",Ee="_grid_2h7el_32",Ne="_icon_2h7el_42",Ce="_iconHalo_2h7el_66",ke="_iconGlyph_2h7el_77",Ae="_center_2h7el_83",De="_title_2h7el_91",Te="_subtitle_2h7el_102",Fe="_rail_2h7el_112",Oe="_seg_2h7el_120",Me="_segPink_2h7el_128",Pe="_segPinkLight_2h7el_132",Re="_isCurrent_2h7el_136",Ge="_isComplete_2h7el_140",ze="_fill_2h7el_144",Be="_fillPink_2h7el_152",Le="_fillPinkLight_2h7el_158",$e="_step_2h7el_165",We="_percent_2h7el_174",A={wrap:je,card:Ie,grid:Ee,icon:Ne,iconHalo:Ce,iconGlyph:ke,center:Ae,title:De,subtitle:Te,rail:Fe,seg:Oe,segPink:Me,segPinkLight:Pe,isCurrent:Re,isComplete:Ge,fill:ze,fillPink:Be,fillPinkLight:Le,step:$e,percent:We},He={photo:"Camera",analysis:"Scan",complement:"Lightbulb",validation:"Check"},yt=({currentStep:r,overallProgress:t,stepProgress:a,loadingMessage:s})=>{const o=Number.isFinite(t)?Math.min(100,Math.max(0,t)):0,n=se.slice(0,4).map(p=>({id:p.id,title:p.title})),l=100/n.length,m=Math.max(0,n.findIndex(p=>p.id===r.id)),d=m*l,x=Math.max(0,Math.min(1,(o-d)/l)),u=He[r.id]||"Refrigerator";return e.jsxs("div",{className:`${A.wrap}`,children:[e.jsx(P,{className:A.card,children:e.jsxs("div",{className:A.grid,"data-fridge-forge":!0,children:[e.jsxs("div",{className:A.icon,children:[e.jsx("div",{className:A.iconHalo}),e.jsx(v,{Icon:f[u],size:26,className:A.iconGlyph})]}),e.jsxs("div",{className:A.center,children:[e.jsx("h2",{className:A.title,children:r.title||"Forge Culinaire"}),r.subtitle&&e.jsx("p",{className:A.subtitle,children:r.subtitle}),e.jsx("div",{className:A.rail,role:"progressbar","aria-valuenow":Math.round(o),"aria-valuemin":0,"aria-valuemax":100,children:n.map((p,g)=>{const h=g<m,D=g===m,_=h?"100%":D?`${x*100}%`:"0%",b=g%2===0?A.segPink:A.segPinkLight,c=g%2===0?A.fillPink:A.fillPinkLight;return e.jsx("div",{className:`${A.seg} ${b} ${h?A.isComplete:""} ${D?A.isCurrent:""}`,children:(h||D)&&e.jsx(I.span,{className:`${A.fill} ${c}`,initial:{width:0},animate:{width:_},transition:{duration:.45,ease:"easeOut"}})},p.id)})}),e.jsxs("div",{className:A.step,children:["Atelier ",m+1," sur ",n.length]})]}),e.jsxs("div",{className:A.percent,"aria-hidden":"true",children:[Math.round(o),"%"]})]})}),s&&e.jsx("div",{className:"mt-3 text-sm text-gray-300 animate-pulse text-center",children:s})]})},ft=({isActive:r,currentStep:t,onManualExit:a})=>!r||t==="photo"||t==="validation"?null:e.jsx("div",{className:"flex justify-center pt-6",children:e.jsx("button",{onClick:a,className:"fridge-btn-danger px-6 py-3",title:"Quitter l'atelier de recettes",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{Icon:f.X,size:16,color:"rgba(239, 68, 68, 1)",variant:"pure"}),e.jsx("span",{children:"Quitter l'Atelier de Recettes"})]})})}),ce=({onCameraCapture:r,onFileUpload:t,fileInputRef:a})=>{const{isPerformanceMode:s}=G(),o=s?"div":I.div,n=s?"button":I.button;return e.jsxs(P,{className:"fridge-glass-scan p-8 text-center",children:[e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"relative flex justify-center",children:e.jsxs(o,{className:`fridge-icon-scan ${s?"":"fridge-ai-focus"}`,style:{width:"128px",height:"128px"},...!s&&{animate:{scale:[1,1.05,1]},transition:{duration:3,repeat:1/0,ease:"easeInOut"}},children:[e.jsx(v,{Icon:f.Camera,size:56,color:"rgba(255, 255, 255, 0.95)",variant:"pure"}),!s&&[0,.6,1.2].map((l,m)=>e.jsx(I.div,{className:"absolute inset-0 rounded-full border-2 pointer-events-none",style:{borderColor:m===0?"color-mix(in srgb, var(--fridge-scan-primary) 65%, transparent)":m===1?"color-mix(in srgb, var(--fridge-scan-secondary) 55%, transparent)":"color-mix(in srgb, var(--fridge-scan-accent) 45%, transparent)"},animate:{scale:[1,1.8,1.8],opacity:[.8,0,0]},transition:{duration:2.5,repeat:1/0,delay:l,ease:"easeOut"}},m))]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-white",style:{textShadow:"0 0 25px color-mix(in srgb, var(--fridge-scan-primary) 70%, transparent)"},children:"Scanner votre Frigo"}),e.jsx("p",{className:"text-white/85 text-lg max-w-md mx-auto leading-relaxed",children:"Prenez 1 à 6 photos de votre frigo, garde-manger, ou armoire pour que la Forge Spatiale analyse vos ingrédients disponibles."})]}),e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs(n,{onClick:r,className:"fridge-btn-scan-primary relative overflow-hidden px-10 py-5 text-xl font-bold rounded-2xl",style:{minWidth:"260px"},...!s&&{whileHover:{scale:1.05,y:-4},whileTap:{scale:.98}},children:[!s&&e.jsx(I.div,{className:"absolute inset-0 rounded-2xl pointer-events-none",style:{background:`linear-gradient(90deg,
                    transparent 0%,
                    rgba(255,255,255,0.45) 50%,
                    transparent 100%
                  )`},animate:{x:["-200%","200%"]},transition:{duration:2.5,repeat:1/0,ease:"easeInOut"}}),e.jsxs("div",{className:"flex items-center gap-3 relative z-10",children:[e.jsx(v,{Icon:f.Camera,size:28,color:"white",variant:"pure"}),e.jsx("span",{children:"Prendre une Photo"})]})]}),e.jsxs("button",{onClick:t,className:"text-pink-300 hover:text-pink-100 text-base font-medium transition-all duration-300 flex items-center gap-2 group",children:[e.jsx(v,{Icon:f.Image,size:18,className:"group-hover:scale-110 transition-transform"}),e.jsx("span",{className:"underline decoration-pink-400/40 hover:decoration-pink-300/60",children:"ou choisir depuis la galerie"})]})]}),e.jsx("div",{className:"flex justify-center pt-2",children:e.jsxs("div",{className:"inline-flex items-center gap-2 px-5 py-2.5 rounded-full",style:{background:"color-mix(in srgb, var(--fridge-scan-primary) 18%, transparent)",border:"2px solid color-mix(in srgb, var(--fridge-scan-primary) 35%, transparent)",backdropFilter:"blur(18px) saturate(150%)"},children:[e.jsx(o,{className:"w-2.5 h-2.5 rounded-full",style:{background:"var(--fridge-scan-primary)"},...!s&&{animate:{opacity:[1,.4,1],scale:[1,1.2,1]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}}}),e.jsx("span",{className:"text-pink-200 text-sm font-semibold",children:"Forge Spatiale Prête"})]})})]}),e.jsx("input",{ref:a,type:"file",accept:"image/png,image/jpeg,image/jpg,image/gif,image/webp",multiple:!0,className:"hidden"})]})},Ve=({capturedPhotos:r,onRemovePhoto:t})=>{const{isPerformanceMode:a}=G(),s=a?"div":I.div;return a||I.button,r.length===0?null:e.jsxs(P,{className:"fridge-glass-scan-subtle p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx(s,{className:`fridge-icon-inventory ${a?"":"fridge-ai-focus"}`,style:{width:"56px",height:"56px"},children:e.jsx(v,{Icon:f.Image,size:24,color:"rgba(255, 255, 255, 0.95)",variant:"pure"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-white font-bold text-xl mb-1",style:{textShadow:"0 2px 8px rgba(0,0,0,0.3)"},children:"Photos Capturées"}),e.jsxs("p",{className:"text-pink-200/80 text-sm",children:[r.length," / 6 photo",r.length>1?"s":""]})]}),e.jsxs("div",{className:"px-4 py-2 rounded-xl text-center",style:{background:"color-mix(in srgb, var(--fridge-scan-primary) 20%, transparent)",border:"2px solid color-mix(in srgb, var(--fridge-scan-primary) 40%, transparent)",backdropFilter:"blur(12px)"},children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:r.length}),e.jsxs("div",{className:"text-xs text-pink-200/70 font-medium",children:["photo",r.length>1?"s":""]})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4",children:a?r.map((o,n)=>e.jsx("div",{className:"group relative",children:e.jsxs("div",{className:"relative aspect-square rounded-2xl overflow-hidden",style:{background:"rgba(255, 255, 255, 0.05)",border:"2px solid color-mix(in srgb, var(--fridge-scan-primary) 25%, transparent)",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.2)",transition:"all 0.3s ease"},onMouseEnter:l=>{window.matchMedia("(hover: hover)").matches&&(l.currentTarget.style.transform="translateY(-4px) scale(1.02)",l.currentTarget.style.boxShadow=`
                      0 8px 24px rgba(0, 0, 0, 0.3),
                      0 0 24px color-mix(in srgb, var(--fridge-scan-primary) 35%, transparent)
                    `,l.currentTarget.style.borderColor="color-mix(in srgb, var(--fridge-scan-primary) 45%, transparent)")},onMouseLeave:l=>{window.matchMedia("(hover: hover)").matches&&(l.currentTarget.style.transform="translateY(0) scale(1)",l.currentTarget.style.boxShadow="0 4px 16px rgba(0, 0, 0, 0.2)",l.currentTarget.style.borderColor="color-mix(in srgb, var(--fridge-scan-primary) 25%, transparent)")},children:[e.jsx("img",{src:o,alt:`Photo du frigo ${n+1}`,loading:"lazy",className:"w-full h-full object-cover"}),e.jsx("button",{onClick:()=>t(n),className:"absolute top-2 right-2 w-9 h-9 rounded-full flex items-center justify-center z-10",style:{background:"radial-gradient(circle at center, rgba(239, 68, 68, 0.95) 0%, rgba(239, 68, 68, 0.85) 100%)",border:"2.5px solid rgba(255, 255, 255, 0.9)",boxShadow:"0 0 20px rgba(239, 68, 68, 0.7), 0 4px 12px rgba(0, 0, 0, 0.3)",backdropFilter:"blur(8px)",cursor:"pointer"},"aria-label":"Supprimer la photo",children:e.jsx(v,{Icon:f.X,size:16,color:"white",variant:"pure"})}),e.jsx("div",{className:"absolute bottom-2 left-2 px-3 py-1.5 rounded-full",style:{background:"rgba(0, 0, 0, 0.85)",border:"1.5px solid rgba(255, 255, 255, 0.35)",backdropFilter:"blur(12px)",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)"},children:e.jsxs("span",{className:"text-white text-xs font-semibold",children:["Photo ",n+1]})})]})},`${o}-${n}`)):e.jsx(ie,{children:r.map((o,n)=>e.jsx(I.div,{initial:{opacity:0,scale:.85,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.85,y:-20},transition:{duration:.45,delay:n*.08,ease:[.4,0,.2,1]},className:"group relative",children:e.jsxs("div",{className:"relative aspect-square rounded-2xl overflow-hidden",style:{background:"rgba(255, 255, 255, 0.05)",border:"2px solid color-mix(in srgb, var(--fridge-scan-primary) 25%, transparent)",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.2)",transition:"all 0.3s ease"},onMouseEnter:l=>{window.matchMedia("(hover: hover)").matches&&(l.currentTarget.style.transform="translateY(-4px) scale(1.02)",l.currentTarget.style.boxShadow=`
                        0 8px 24px rgba(0, 0, 0, 0.3),
                        0 0 24px color-mix(in srgb, var(--fridge-scan-primary) 35%, transparent)
                      `,l.currentTarget.style.borderColor="color-mix(in srgb, var(--fridge-scan-primary) 45%, transparent)")},onMouseLeave:l=>{window.matchMedia("(hover: hover)").matches&&(l.currentTarget.style.transform="translateY(0) scale(1)",l.currentTarget.style.boxShadow="0 4px 16px rgba(0, 0, 0, 0.2)",l.currentTarget.style.borderColor="color-mix(in srgb, var(--fridge-scan-primary) 25%, transparent)")},children:[e.jsx("img",{src:o,alt:`Photo du frigo ${n+1}`,loading:"lazy",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none",style:{background:"linear-gradient(180deg, transparent 0%, rgba(236, 72, 153, 0.15) 100%)"}}),e.jsx(I.button,{onClick:()=>t(n),className:"absolute top-2 right-2 w-9 h-9 rounded-full flex items-center justify-center z-10",style:{background:"radial-gradient(circle at center, rgba(239, 68, 68, 0.95) 0%, rgba(239, 68, 68, 0.85) 100%)",border:"2.5px solid rgba(255, 255, 255, 0.9)",boxShadow:"0 0 20px rgba(239, 68, 68, 0.7), 0 4px 12px rgba(0, 0, 0, 0.3)",backdropFilter:"blur(8px)",cursor:"pointer"},whileHover:{scale:1.15,boxShadow:"0 0 30px rgba(239, 68, 68, 0.9), 0 6px 16px rgba(0, 0, 0, 0.4)"},whileTap:{scale:.95},"aria-label":"Supprimer la photo",children:e.jsx(v,{Icon:f.X,size:16,color:"white",variant:"pure"})}),e.jsx("div",{className:"absolute bottom-2 left-2 px-3 py-1.5 rounded-full",style:{background:"rgba(0, 0, 0, 0.85)",border:"1.5px solid rgba(255, 255, 255, 0.35)",backdropFilter:"blur(12px)",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)"},children:e.jsxs("span",{className:"text-white text-xs font-semibold",children:["Photo ",n+1]})})]})},`${o}-${n}`))})}),r.length<6&&e.jsx(s,{...!a&&{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:r.length*.08+.3}},className:"mt-6 p-4 rounded-xl",style:{background:"color-mix(in srgb, var(--fridge-scan-primary) 15%, transparent)",border:"2px solid color-mix(in srgb, var(--fridge-scan-primary) 30%, transparent)",backdropFilter:"blur(16px)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",style:{background:"color-mix(in srgb, var(--fridge-scan-primary) 25%, transparent)",border:"1.5px solid color-mix(in srgb, var(--fridge-scan-primary) 45%, transparent)"},children:e.jsx(v,{Icon:f.Info,size:16,style:{color:"var(--fridge-scan-primary)"},variant:"pure"})}),e.jsxs("span",{className:"text-pink-100 text-sm font-medium",children:["Vous pouvez ajouter encore ",6-r.length," photo",6-r.length>1?"s":""," supplémentaire",6-r.length>1?"s":""]})]})})]})},Ue=({capturedPhotosCount:r,onAnalyzePhotos:t})=>{const{isPerformanceMode:a}=G();return r===0?null:e.jsx(P,{id:"analyze-cta",className:"fridge-glass-scan p-8 text-center",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"relative flex justify-center",children:e.jsx("div",{className:`fridge-icon-scan ${a?"":"fridge-ai-focus"}`,style:{width:"96px",height:"96px"},children:e.jsx(v,{Icon:f.Zap,size:40,color:"rgba(255, 255, 255, 0.9)",variant:"pure"})})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-2xl font-bold text-white",style:{textShadow:"0 0 20px color-mix(in srgb, var(--fridge-scan-primary) 60%, transparent)"},children:"Prêt pour l'Analyse"}),e.jsxs("p",{className:"text-white/90 text-lg",children:[r," photo",r>1?"s":""," prête",r>1?"s":""," à être analysée",r>1?"s":""," par la Forge Spatiale"]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:t,disabled:r===0,className:"fridge-btn-scan-primary relative overflow-hidden px-10 py-4 text-xl font-bold rounded-full",children:[!a&&e.jsx("div",{className:"absolute inset-0 rounded-full pointer-events-none fridge-spatial-shimmer",style:{background:`linear-gradient(90deg,
                    transparent 0%,
                    rgba(255,255,255,0.4) 50%,
                    transparent 100%
                  )`}}),e.jsxs("div",{className:"flex items-center gap-3 relative z-10",children:[e.jsx(v,{Icon:f.Zap,size:24,color:"white",variant:"pure"}),e.jsx("span",{children:"Analyser mes Photos"})]})]})}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full",style:{background:"color-mix(in srgb, var(--fridge-scan-primary) 15%, transparent)",border:"2px solid color-mix(in srgb, var(--fridge-scan-primary) 30%, transparent)",backdropFilter:"blur(16px) saturate(140%)"},children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${a?"animate-pulse":""}`,style:{background:"var(--fridge-scan-primary)"}}),e.jsx("span",{className:"text-pink-300 text-sm font-bold",children:"Forge Spatiale Prête"})]})})]})})},Ye=()=>{const{isPerformanceMode:r}=G(),t=r?"div":I.div,a=[{icon:"ChefHat",title:"Recettes Personnalisées",description:"Générez des recettes adaptées à vos ingrédients disponibles",color:"var(--color-fridge-primary)"},{icon:"TrendingDown",title:"Réduction du Gaspillage",description:"Utilisez vos aliments avant leur péremption",color:"var(--color-nutrition-primary)"},{icon:"DollarSign",title:"Économies Intelligentes",description:"Optimisez vos courses et votre budget alimentaire",color:"var(--color-fasting-primary)"},{icon:"Calendar",title:"Planification Facile",description:"Créez des plans de repas hebdomadaires automatiquement",color:"var(--color-training-primary)"},{icon:"ShoppingCart",title:"Listes de Courses",description:"Générez des listes précises basées sur vos besoins",color:"var(--color-ember-copper)"},{icon:"Heart",title:"Santé & Nutrition",description:"Suivez votre équilibre nutritionnel et vos objectifs",color:"var(--color-health-primary)"}];return e.jsx(t,{...!r&&{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.6,ease:"easeOut"}},children:e.jsxs(P,{className:"p-6",style:r?{background:"linear-gradient(145deg, color-mix(in srgb, var(--brand-primary) 15%, #1e293b), color-mix(in srgb, var(--brand-primary) 8%, #0f172a))",borderColor:"color-mix(in srgb, var(--brand-primary) 30%, transparent)",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.4)"}:{background:`
            radial-gradient(circle at 20% 30%, color-mix(in srgb, var(--brand-primary) 10%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 80% 70%, color-mix(in srgb, var(--color-plasma-cyan) 8%, transparent) 0%, transparent 50%),
            var(--glass-opacity)
          `,borderColor:"color-mix(in srgb, var(--brand-primary) 25%, transparent)",boxShadow:`
            0 8px 32px color-mix(in srgb, var(--brand-primary) 12%, transparent),
            0 0 0 1px color-mix(in srgb, var(--brand-primary) 20%, transparent),
            inset 0 1px 0 color-mix(in srgb, white 10%, transparent)
          `,backdropFilter:"blur(20px) saturate(180%)"},children:[e.jsx(t,{className:"flex justify-center mb-6",...!r&&{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.2,duration:.6}},children:e.jsx("div",{className:"w-20 h-20 rounded-full flex items-center justify-center",style:r?{background:"linear-gradient(135deg, color-mix(in srgb, var(--brand-primary) 30%, #1e293b), color-mix(in srgb, var(--brand-primary) 15%, #0f172a))",border:"3px solid color-mix(in srgb, var(--brand-primary) 40%, transparent)",boxShadow:"0 2px 12px rgba(0, 0, 0, 0.4)"}:{background:`
                radial-gradient(circle, color-mix(in srgb, var(--brand-primary) 25%, transparent) 0%,
                color-mix(in srgb, var(--color-plasma-cyan) 10%, transparent) 70%)
              `,border:"3px solid color-mix(in srgb, var(--brand-primary) 35%, transparent)",boxShadow:`
                0 0 30px color-mix(in srgb, var(--brand-primary) 30%, transparent),
                inset 0 2px 0 color-mix(in srgb, white 20%, transparent)
              `},children:e.jsx(v,{Icon:f.Lightbulb,size:48,style:{color:"var(--brand-primary)",filter:"drop-shadow(0 0 12px color-mix(in srgb, var(--brand-primary) 50%, transparent))"}})})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(t,{className:"text-xl font-bold mb-3 text-white",...!r&&{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{delay:.3,duration:.5}},children:"Pourquoi Scanner Mon Frigo ?"}),e.jsx(t,{className:"text-sm text-white/70 max-w-md mx-auto",...!r&&{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{delay:.4,duration:.5}},children:"Transformez votre inventaire en opportunités culinaires et économies intelligentes"})]}),e.jsx(t,{className:"grid grid-cols-1 md:grid-cols-2 gap-4",...!r&&{initial:"hidden",animate:"visible",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1,delayChildren:.5}}}},children:a.map((s,o)=>e.jsxs(t,{className:"flex items-start gap-4 p-4 rounded-lg",style:{background:"color-mix(in srgb, var(--glass-opacity) 60%, transparent)",border:"1px solid color-mix(in srgb, white 12%, transparent)"},...!r&&{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},transition:{duration:.5}},children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:r?{background:`linear-gradient(135deg, color-mix(in srgb, ${s.color} 25%, #1e293b), color-mix(in srgb, ${s.color} 12%, #0f172a))`,border:`2px solid color-mix(in srgb, ${s.color} 30%, transparent)`,boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)"}:{background:`
                    radial-gradient(circle, color-mix(in srgb, ${s.color} 20%, transparent) 0%,
                    color-mix(in srgb, ${s.color} 5%, transparent) 70%)
                  `,border:`2px solid color-mix(in srgb, ${s.color} 25%, transparent)`,boxShadow:`0 0 16px color-mix(in srgb, ${s.color} 20%, transparent)`},children:e.jsx(v,{Icon:f[s.icon],size:20,style:{color:s.color,filter:`drop-shadow(0 0 6px color-mix(in srgb, ${s.color} 35%, transparent))`}})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-semibold text-sm mb-1 text-white",children:s.title}),e.jsx("p",{className:"text-xs text-white/75 leading-relaxed",children:s.description})]})]},o))}),e.jsx(t,{className:"mt-6 pt-6 border-t border-white/10",...!r&&{initial:{opacity:0},animate:{opacity:1},transition:{delay:1,duration:.5}},children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-white mb-1",children:"30%"}),e.jsx("div",{className:"text-xs text-white/60",children:"Économies moyennes"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-white mb-1",children:"50%"}),e.jsx("div",{className:"text-xs text-white/60",children:"Réduction gaspillage"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-white mb-1",children:"2h"}),e.jsx("div",{className:"text-xs text-white/60",children:"Temps gagné/semaine"})]})]})})]})})};function Ke(r=768){const[t,a]=J.useState(!1);return J.useEffect(()=>{if(typeof window>"u")return;const s=window.matchMedia(`(max-width: ${r}px)`),o=n=>a(("matches"in n,n.matches));return o(s),"addEventListener"in s?s.addEventListener("change",o):s.addListener(o),()=>{"removeEventListener"in s?s.removeEventListener("change",o):s.removeListener(o)}},[r]),t}const Je=({simulatedLoadingStep:r,simulatedScanProgress:t,loadingMessage:a})=>{const s=Ke(),{isPerformanceMode:o}=G(),n=o?"div":I.div,l=[{message:"Téléchargement des photos...",duration:3e3,icon:"Upload"},{message:"Analyse des ingrédients par la Forge...",duration:12e3,icon:"Zap"},{message:"Détection des aliments...",duration:8e3,icon:"Search"},{message:"Évaluation de la fraîcheur...",duration:6e3,icon:"Heart"},{message:"Normalisation des données...",duration:4e3,icon:"Settings"},{message:"Préparation de l'inventaire...",duration:3e3,icon:"Check"}];return e.jsx(n,{...!o&&{initial:{opacity:0,y:30,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{duration:.8,ease:[.25,.1,.25,1]}},children:e.jsxs(P,{className:"p-8 text-center relative overflow-hidden",style:o?{background:"linear-gradient(145deg, color-mix(in srgb, var(--color-fridge-primary) 20%, #1e293b), color-mix(in srgb, var(--color-fridge-primary) 10%, #0f172a))",borderColor:"color-mix(in srgb, var(--color-fridge-primary) 40%, transparent)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)",minHeight:"400px"}:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, var(--color-fridge-primary) 18%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, color-mix(in srgb, var(--color-plasma-cyan) 15%, transparent) 0%, transparent 50%),
            radial-gradient(circle at 50% 50%, color-mix(in srgb, var(--brand-primary) 12%, transparent) 0%, transparent 70%),
            var(--glass-opacity)
          `,borderColor:"color-mix(in srgb, var(--color-fridge-primary) 35%, transparent)",boxShadow:`
            0 25px 80px rgba(0, 0, 0, 0.4),
            0 0 60px color-mix(in srgb, var(--color-fridge-primary) 30%, transparent),
            0 0 120px color-mix(in srgb, var(--color-plasma-cyan) 20%, transparent),
            inset 0 3px 0 rgba(255, 255, 255, 0.25),
            inset 0 -2px 0 rgba(0, 0, 0, 0.15)
          `,backdropFilter:"blur(32px) saturate(180%)",WebkitBackdropFilter:"blur(32px) saturate(180%)",minHeight:"400px"},children:[e.jsx("div",{className:"absolute inset-0 pointer-events-none opacity-20 fridge-grid-pulse",style:{background:`
              linear-gradient(90deg, transparent 0%, color-mix(in srgb, var(--color-plasma-cyan) 30%, transparent) 1px, transparent 2px),
              linear-gradient(0deg, transparent 0%, color-mix(in srgb, var(--color-plasma-cyan) 30%, transparent) 1px, transparent 2px)
            `,backgroundSize:"40px 40px"}}),!o&&e.jsx(I.div,{className:"absolute top-0 left-0 w-1 h-full pointer-events-none fridge-scan-analysis-line",style:{background:`linear-gradient(180deg,
                transparent 0%,
                color-mix(in srgb, var(--color-plasma-cyan) 80%, transparent) 30%,
                color-mix(in srgb, var(--color-plasma-cyan) 100%, transparent) 50%,
                color-mix(in srgb, var(--color-plasma-cyan) 80%, transparent) 70%,
                transparent 100%
              )`,boxShadow:"0 0 20px color-mix(in srgb, var(--color-plasma-cyan) 80%, transparent)"}}),!o&&[...Array(8)].map((m,d)=>e.jsx(I.div,{className:"absolute w-2 h-2 rounded-full pointer-events-none fridge-data-particle",style:{background:d%2===0?"var(--color-fridge-primary)":"var(--color-plasma-cyan)",boxShadow:`0 0 12px ${d%2===0?"var(--color-fridge-primary)":"var(--color-plasma-cyan)"}`,left:`${15+d*12}%`,top:`${20+d%3*25}%`}},d)),e.jsxs("div",{className:"relative z-10 space-y-8",children:[e.jsx("div",{className:"relative",children:e.jsxs(n,{className:"w-32 h-32 mx-auto rounded-full flex items-center justify-center relative fridge-ai-focus",style:o?{background:"linear-gradient(135deg, color-mix(in srgb, var(--color-fridge-primary) 45%, #1e293b), color-mix(in srgb, var(--color-plasma-cyan) 30%, #0f172a))",border:"4px solid color-mix(in srgb, var(--color-fridge-primary) 80%, transparent)",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.4)"}:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.3) 0%, transparent 60%),
                  radial-gradient(circle at 70% 70%, color-mix(in srgb, var(--color-fridge-primary) 25%, transparent) 0%, transparent 50%),
                  linear-gradient(135deg, color-mix(in srgb, var(--color-fridge-primary) 50%, transparent), color-mix(in srgb, var(--color-plasma-cyan) 40%, transparent))
                `,border:"4px solid color-mix(in srgb, var(--color-fridge-primary) 80%, transparent)",backdropFilter:"blur(24px) saturate(180%)",WebkitBackdropFilter:"blur(24px) saturate(180%)"},children:[e.jsx(n,{...!o&&{animate:{rotate:[0,360],scale:[1,1.1,1]},transition:{duration:s?6:3,repeat:1/0,ease:"linear"}},children:e.jsx(v,{Icon:f[l[r]?.icon]||f.Camera,size:56,style:{color:"var(--color-fridge-primary)",filter:`
                      drop-shadow(0 0 20px color-mix(in srgb, var(--color-fridge-primary) 90%, transparent))
                      drop-shadow(0 0 40px color-mix(in srgb, var(--color-fridge-primary) 70%, transparent))
                      drop-shadow(0 0 60px color-mix(in srgb, var(--color-plasma-cyan) 50%, transparent))
                    `},variant:"pure"})}),!o&&e.jsxs(e.Fragment,{children:[e.jsx(I.div,{className:"absolute inset-0 rounded-full border-2",style:{borderColor:"color-mix(in srgb, var(--color-fridge-primary) 60%, transparent)"},animate:{scale:[1,1.4,1],opacity:[.8,0,.8]},transition:{duration:2,repeat:1/0,ease:"easeOut"}}),e.jsx(I.div,{className:"absolute inset-0 rounded-full border-2",style:{borderColor:"color-mix(in srgb, var(--color-plasma-cyan) 50%, transparent)"},animate:{scale:[1,1.6,1],opacity:[.6,0,.6]},transition:{duration:2.5,repeat:1/0,ease:"easeOut",delay:.5}}),e.jsx(I.div,{className:"absolute inset-0 rounded-full border-2",style:{borderColor:"color-mix(in srgb, var(--brand-primary) 40%, transparent)"},animate:{scale:[1,1.8,1],opacity:[.4,0,.4]},transition:{duration:3,repeat:1/0,ease:"easeOut",delay:1}})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-3xl font-bold text-white",style:{textShadow:"0 0 20px color-mix(in srgb, var(--color-fridge-primary) 60%, transparent)"},children:"Forge Spatiale Active"}),e.jsx("p",{className:"text-white/90 text-xl",children:l[r]?.message||a}),e.jsxs("div",{className:"max-w-md mx-auto space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm text-white/70",children:[e.jsx("span",{children:"Progression de l'analyse"}),e.jsxs("span",{children:[Math.round(t),"%"]})]}),e.jsx("div",{className:"w-full bg-white/10 rounded-full h-3 overflow-hidden",children:e.jsx(I.div,{className:"h-3 rounded-full relative overflow-hidden",style:{background:`linear-gradient(90deg, 
                      var(--color-fridge-primary), 
                      var(--color-plasma-cyan), 
                      var(--brand-primary)
                    )`,boxShadow:`
                      0 0 16px color-mix(in srgb, var(--color-fridge-primary) 70%, transparent),
                      inset 0 1px 0 rgba(255,255,255,0.4)
                    `,width:`${t}%`},initial:{width:0},animate:{width:`${t}%`},transition:{duration:.3,ease:"easeOut"},children:!o&&e.jsx("div",{className:"absolute inset-0 rounded-full fridge-spatial-shimmer",style:{background:`linear-gradient(90deg,
                          transparent 0%,
                          rgba(255,255,255,0.6) 50%,
                          transparent 100%
                        )`}})})})]})]}),e.jsxs("div",{className:"space-y-3 max-w-lg mx-auto",children:[e.jsxs("h4",{className:"text-white/80 font-semibold text-lg mb-4 flex items-center gap-2",children:[e.jsx(v,{Icon:f.Zap,size:16,style:{color:"var(--color-plasma-cyan)"}}),"Processus d'Analyse de la Forge"]}),e.jsx("div",{className:"space-y-2",children:l.map((m,d)=>{const x=d===r,u=d<r;return e.jsxs(n,{className:"flex items-center gap-3 p-3 rounded-xl transition-all duration-300",style:{background:x?"color-mix(in srgb, var(--color-fridge-primary) 15%, transparent)":u?"color-mix(in srgb, var(--color-plasma-cyan) 10%, transparent)":"rgba(255, 255, 255, 0.05)",border:x?"2px solid color-mix(in srgb, var(--color-fridge-primary) 40%, transparent)":u?"1px solid color-mix(in srgb, var(--color-plasma-cyan) 30%, transparent)":"1px solid rgba(255, 255, 255, 0.1)",boxShadow:x?"0 0 20px color-mix(in srgb, var(--color-fridge-primary) 30%, transparent)":"none"},...!o&&{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.4,delay:d*.1}},children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",style:{background:x?"color-mix(in srgb, var(--color-fridge-primary) 25%, transparent)":u?"color-mix(in srgb, var(--color-plasma-cyan) 20%, transparent)":"rgba(255, 255, 255, 0.1)",border:x?"2px solid color-mix(in srgb, var(--color-fridge-primary) 50%, transparent)":u?"1px solid color-mix(in srgb, var(--color-plasma-cyan) 40%, transparent)":"1px solid rgba(255, 255, 255, 0.2)"},children:u?e.jsx(v,{Icon:f.Check,size:14,style:{color:"var(--color-plasma-cyan)"}}):x?o?e.jsx("div",{className:"w-3 h-3 rounded-full",style:{background:"var(--color-fridge-primary)"}}):e.jsx(I.div,{className:"w-3 h-3 rounded-full",style:{background:"var(--color-fridge-primary)"},animate:{scale:[1,1.3,1],opacity:[.8,1,.8]},transition:{duration:1,repeat:1/0}}):e.jsx("span",{className:"text-xs font-bold text-white/60",children:d+1})}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("span",{className:`text-sm font-medium ${x?"text-white":u?"text-white/90":"text-white/60"}`,children:m.message})}),e.jsx(v,{Icon:f[m.icon],size:16,style:{color:x?"var(--color-fridge-primary)":u?"var(--color-plasma-cyan)":"rgba(255, 255, 255, 0.4)"}})]},d)})})]}),e.jsxs(n,{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full",style:o?{background:"color-mix(in srgb, var(--color-plasma-cyan) 15%, #1e293b)",border:"1px solid color-mix(in srgb, var(--color-plasma-cyan) 30%, transparent)"}:{background:"color-mix(in srgb, var(--color-plasma-cyan) 10%, transparent)",border:"1px solid color-mix(in srgb, var(--color-plasma-cyan) 25%, transparent)",backdropFilter:"blur(12px) saturate(140%)"},...!o&&{animate:{scale:[1,1.02,1],opacity:[.8,1,.8]},transition:{duration:2,repeat:1/0}},children:[e.jsx(n,{className:"w-2 h-2 rounded-full",style:{background:"var(--color-plasma-cyan)"},...!o&&{animate:{scale:[1,1.2,1],opacity:[.6,1,.6]},transition:{duration:1,repeat:1/0}}}),e.jsx("span",{className:"text-cyan-300 text-sm font-medium",children:"Analyse de la Forge en cours... (~15-45 secondes)"})]})]})]})})},Xe=()=>{const{isPerformanceMode:r}=G(),t=r?"div":I.div;return e.jsx(t,{...!r&&{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.4}},children:e.jsx(P,{className:"fridge-info-panel p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"fridge-icon-info w-8 h-8 flex-shrink-0 mt-1",children:e.jsx(v,{Icon:f.Info,size:12,color:"var(--fridge-inventory-primary)",variant:"pure"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-cyan-300 font-semibold mb-2",children:"Que fait la Forge Spatiale ?"}),e.jsxs("div",{className:"space-y-2 text-sm text-cyan-200",children:[e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Vision de la Forge :"})," Détection précise des aliments et ingrédients"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Analyse Nutritionnelle :"})," Évaluation de la fraîcheur et des quantités"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Cartographie de la Forge :"})," Catégorisation et normalisation des données"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Préparation Recettes :"})," Optimisation pour la génération de recettes"]})]})]})]})})})},pe=({suggestedItems:r,onAddSelectedItems:t,onSelectionChange:a})=>{const[s,o]=j.useState(new Set),{isPerformanceMode:n}=G(),l=g=>{const h=new Set(s);h.has(g)?h.delete(g):h.add(g),o(h),a&&a(h.size>0)},m=()=>{const g=new Set(r.map((h,D)=>D));o(g),a&&a(g.size>0)},d=()=>{o(new Set),a&&a(!1)},x=()=>{const g=r.filter((h,D)=>s.has(D)).map(h=>({id:h.id,userId:h.userId,sessionId:h.sessionId,name:h.name,category:h.category,quantity:h.quantity,confidence:h.confidence,freshnessScore:h.freshnessScore,expiryDate:h.expiryDate,isUserEdited:!1,createdAt:h.createdAt,updatedAt:h.updatedAt}));t(g),o(new Set),a&&a(!1)},u=g=>{switch(g??"medium"){case"high":return"text-red-600 bg-red-50";case"medium":return"text-orange-600 bg-orange-50";case"low":return"text-green-600 bg-green-50";default:return"text-gray-600 bg-gray-50"}},p=g=>{switch(g??"medium"){case"high":return"Priorité haute";case"medium":return"Priorité moyenne";case"low":return"Priorité basse";default:return"Priorité inconnue"}};return r.length===0?null:e.jsxs("div",{className:"glass-card p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-500/20 to-blue-600/20 flex items-center justify-center",children:e.jsx(v,{Icon:f.Lightbulb,size:16,className:"text-blue-400",glowColor:"rgba(59, 130, 246, 0.6)"})}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Aliments complémentaires suggérés"})]}),e.jsx("p",{className:"text-sm text-white/70 mb-2",children:"Notre IA nutritionniste recommande ces aliments pour compléter votre inventaire"}),e.jsxs("p",{className:"text-sm text-white/60 mb-4",children:[s.size," / ",r.length," sélectionnés"]}),e.jsx("div",{className:"rounded-xl bg-black/20 p-3 mb-4 max-h-64 overflow-y-auto",style:{boxShadow:"inset 0 2px 8px rgba(0, 0, 0, 0.3), 0 1px 3px rgba(255, 255, 255, 0.1)"},children:e.jsx("div",{className:"space-y-2",children:r.map((g,h)=>e.jsxs(P,{className:`no-scale-hover flex items-center gap-3 p-2 ${n?"":"transition-all"} cursor-pointer ${s.has(h)?"ring-2 ring-blue-400/50 bg-blue-50/5":""}`,onClick:()=>l(h),children:[e.jsx("input",{type:"checkbox",checked:s.has(h),onChange:()=>l(h),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h4",{className:"text-xs font-medium text-white truncate",children:g.name}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full flex-shrink-0 ml-2 ${u(g.suggestionPriority)}`,children:p(g.suggestionPriority)})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-xxs text-white/70 mb-1",children:[e.jsx("span",{className:"bg-white/10 px-2 py-1 rounded",children:g.category}),e.jsx("span",{children:g.quantity})]}),e.jsx("p",{className:"text-xxs text-white/60 leading-relaxed line-clamp-1",children:g.suggestionReason})]})]},g.id))})}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4",children:[e.jsx("button",{onClick:m,className:`px-3 py-2 text-sm text-white/70 hover:text-white ${n?"":"transition-colors"} bg-white/10 rounded-lg`,children:"Tout sélectionner"}),e.jsx("button",{onClick:d,className:`px-3 py-2 text-sm text-white/70 hover:text-white ${n?"":"transition-colors"} bg-white/10 rounded-lg`,children:"Tout désélectionner"})]}),s.size>0&&e.jsx("div",{className:"w-full",children:e.jsxs("button",{onClick:x,className:"w-full btn-glass--primary px-4 py-3 text-sm font-medium",children:["Ajouter ",s.size," aliment",s.size>1?"s":""]})})]})},Qe=({userEditedInventory:r,suggestedComplementaryItems:t,addSelectedComplementaryItems:a,onContinueToValidation:s,onBackToPhoto:o})=>{const{click:n,success:l}=Q(),{showToast:m}=V(),{isPerformanceMode:d}=G(),[x,u]=j.useState(!1),p=d?"div":I.div,g=_=>{i.info("COMPLEMENT_STAGE","Adding selected complementary items",{selectedItemsCount:_.length,selectedItems:_.map(b=>({id:b.id,name:b.name,category:b.category,quantity:b.quantity})),timestamp:new Date().toISOString()}),a(_),l(),u(!1),m({type:"success",title:"Ingrédients ajoutés !",message:`${_.length} ingrédient${_.length>1?"s":""} ajouté${_.length>1?"s":""} à votre inventaire`,duration:3e3}),setTimeout(()=>{s()},1e3)},h=()=>{n(),i.info("COMPLEMENT_STAGE","User chose to continue to validation",{currentInventoryCount:r.length,suggestedItemsCount:t.length,hasUnaddedSelections:x,timestamp:new Date().toISOString()}),s()},D=()=>{n(),i.info("COMPLEMENT_STAGE","User chose to go back to photo capture",{timestamp:new Date().toISOString()}),o()};return e.jsx("div",{className:"glass-card p-6 space-y-6",style:{background:`
             radial-gradient(circle at 30% 20%, color-mix(in srgb, #EC4899 18%, transparent) 0%, transparent 60%),
             radial-gradient(circle at 70% 80%, color-mix(in srgb, #18E3FF 15%, transparent) 0%, transparent 50%),
             linear-gradient(145deg, rgba(255,255,255,0.12), rgba(255,255,255,0.08)),
             rgba(11, 14, 23, 0.85)
           `,borderColor:"color-mix(in srgb, #EC4899 35%, transparent)",boxShadow:`
             0 16px 48px rgba(0, 0, 0, 0.3),
             0 0 36px color-mix(in srgb, #EC4899 25%, transparent),
             inset 0 2px 0 rgba(255, 255, 255, 0.18)
           `,backdropFilter:"blur(28px) saturate(160%)",WebkitBackdropFilter:"blur(28px) saturate(160%)"},children:e.jsxs(p,{...!d&&{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.4,ease:[.4,0,.2,1]}},className:"space-y-6",children:[e.jsx(p,{...!d&&{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.4,delay:.1}},className:"glass-card p-5",style:{background:`
              radial-gradient(circle at 30% 20%, color-mix(in srgb, #A78BFA 18%, transparent) 0%, transparent 60%),
              radial-gradient(circle at 70% 80%, color-mix(in srgb, #8B5CF6 15%, transparent) 0%, transparent 50%),
              rgba(255, 255, 255, 0.06)
            `,borderColor:"color-mix(in srgb, #8B5CF6 35%, transparent)",boxShadow:`
              0 8px 24px rgba(0, 0, 0, 0.2),
              0 0 24px color-mix(in srgb, #8B5CF6 20%, transparent),
              inset 0 1px 0 rgba(255, 255, 255, 0.15)
            `,backdropFilter:"blur(20px) saturate(150%)"},children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(p,{className:"flex-shrink-0",...!d&&{animate:{scale:[1,1.05,1],boxShadow:["0 0 20px rgba(147, 51, 234, 0.3)","0 0 28px rgba(147, 51, 234, 0.5)","0 0 20px rgba(147, 51, 234, 0.3)"]},transition:{duration:2.5,repeat:1/0,ease:"easeInOut"}},children:e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:{background:"linear-gradient(135deg, rgba(147, 51, 234, 0.25) 0%, rgba(168, 85, 247, 0.35) 100%)",border:"2px solid rgba(147, 51, 234, 0.5)",boxShadow:"0 0 24px rgba(147, 51, 234, 0.4), inset 0 2px 0 rgba(255, 255, 255, 0.2)",backdropFilter:"blur(12px)"},children:e.jsx(v,{Icon:f.AlertCircle,size:22,className:"text-purple-300"})})}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:"Inventaire Insuffisant Détecté"}),e.jsxs("p",{className:"text-sm text-gray-200 leading-relaxed",children:["Votre frigo contient seulement ",e.jsxs("span",{className:"font-bold text-purple-300",children:[r.length," ingrédient",r.length>1?"s":""]}),"."]}),e.jsx("p",{className:"text-sm text-gray-300 leading-relaxed",children:"Pour optimiser vos possibilités culinaires, nous vous suggérons d'ajouter quelques ingrédients complémentaires."})]})]})}),t.length>0&&e.jsx(pe,{suggestedItems:t,onAddSelectedItems:g,onSelectionChange:u}),e.jsxs(p,{...!d&&{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.4,delay:.3}},className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("button",{onClick:h,className:"flex-1 px-7 py-4 rounded-2xl font-semibold text-base transition-all duration-300 group",style:{background:`
                linear-gradient(135deg,
                  color-mix(in srgb, #EC4899 75%, transparent),
                  color-mix(in srgb, #F472B6 60%, transparent)
                )
              `,border:"2px solid color-mix(in srgb, #EC4899 60%, transparent)",boxShadow:`
                0 8px 24px color-mix(in srgb, #EC4899 40%, transparent),
                0 0 32px color-mix(in srgb, #EC4899 25%, transparent),
                inset 0 2px 0 rgba(255, 255, 255, 0.4)
              `,color:"white"},onMouseEnter:_=>{window.matchMedia("(hover: hover)").matches&&(_.currentTarget.style.transform="translateY(-2px) scale(1.02)",_.currentTarget.style.boxShadow=`
                  0 12px 32px color-mix(in srgb, #EC4899 55%, transparent),
                  0 0 40px color-mix(in srgb, #EC4899 35%, transparent),
                  inset 0 2px 0 rgba(255, 255, 255, 0.5)
                `)},onMouseLeave:_=>{window.matchMedia("(hover: hover)").matches&&(_.currentTarget.style.transform="translateY(0) scale(1)",_.currentTarget.style.boxShadow=`
                  0 8px 24px color-mix(in srgb, #EC4899 40%, transparent),
                  0 0 32px color-mix(in srgb, #EC4899 25%, transparent),
                  inset 0 2px 0 rgba(255, 255, 255, 0.4)
                `)},children:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(v,{Icon:f.ArrowRight,size:22}),e.jsx("span",{children:"Continuer la Validation"})]})}),e.jsx("button",{onClick:D,className:"flex-1 px-7 py-4 rounded-2xl font-semibold text-base transition-all duration-300",style:{background:"rgba(255, 255, 255, 0.08)",border:"2px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.2)",backdropFilter:"blur(16px)",color:"white"},onMouseEnter:_=>{window.matchMedia("(hover: hover)").matches&&(_.currentTarget.style.transform="translateY(-2px)",_.currentTarget.style.background="rgba(255, 255, 255, 0.12)",_.currentTarget.style.borderColor="rgba(255, 255, 255, 0.3)")},onMouseLeave:_=>{window.matchMedia("(hover: hover)").matches&&(_.currentTarget.style.transform="translateY(0)",_.currentTarget.style.background="rgba(255, 255, 255, 0.08)",_.currentTarget.style.borderColor="rgba(255, 255, 255, 0.2)")},children:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(v,{Icon:f.Camera,size:22}),e.jsx("span",{children:"Reprendre des Photos"})]})})]}),x&&e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-sm text-orange-300 bg-orange-500/10 border border-orange-500/20 rounded-lg px-4 py-2",children:'💡 Vous avez sélectionné des aliments mais ne les avez pas encore ajoutés. Cliquez sur "Ajouter X aliments" ou continuez sans les ajouter.'})}),e.jsx(p,{...!d&&{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.4,delay:.4}},className:"glass-card p-5",style:{background:`
              radial-gradient(circle at 30% 20%, color-mix(in srgb, #18E3FF 18%, transparent) 0%, transparent 60%),
              radial-gradient(circle at 70% 80%, color-mix(in srgb, #06B6D4 15%, transparent) 0%, transparent 50%),
              rgba(255, 255, 255, 0.06)
            `,borderColor:"color-mix(in srgb, #18E3FF 35%, transparent)",boxShadow:`
              0 8px 24px rgba(0, 0, 0, 0.2),
              0 0 24px color-mix(in srgb, #18E3FF 20%, transparent),
              inset 0 1px 0 rgba(255, 255, 255, 0.15)
            `,backdropFilter:"blur(20px) saturate(150%)"},children:e.jsxs("div",{className:"grid grid-cols-2 gap-6 text-center",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{className:"text-4xl font-bold",style:{color:"#A78BFA",textShadow:"0 0 16px rgba(167, 139, 250, 0.5)"},...!d&&{animate:{scale:[1,1.05,1]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}},children:r.length}),e.jsx("div",{className:"text-sm font-medium text-gray-300",children:"Ingrédients détectés"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{className:"text-4xl font-bold",style:{color:"#18E3FF",textShadow:"0 0 16px rgba(24, 227, 255, 0.5)"},...!d&&{animate:{scale:[1,1.05,1]},transition:{duration:2,repeat:1/0,ease:"easeInOut",delay:.5}},children:t.length}),e.jsx("div",{className:"text-sm font-medium text-gray-300",children:"Suggestions disponibles"})]})]})})]})})},Ze=({inventoryCount:r,searchFilter:t,setSearchFilter:a,onAddCustomItem:s})=>e.jsxs(P,{className:"p-6",style:{background:`
        radial-gradient(circle at 30% 20%, color-mix(in srgb, var(--color-plasma-cyan) 12%, transparent) 0%, transparent 60%),
        var(--glass-opacity)
      `,borderColor:"color-mix(in srgb, var(--color-plasma-cyan) 25%, transparent)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, var(--color-plasma-cyan) 35%, transparent), color-mix(in srgb, var(--color-fridge-primary) 25%, transparent))
              `,border:"2px solid color-mix(in srgb, var(--color-plasma-cyan) 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, var(--color-plasma-cyan) 30%, transparent)"},children:e.jsx(v,{Icon:f.Edit,size:20,style:{color:"var(--color-plasma-cyan)"}})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Vérifier l'Inventaire"}),e.jsxs("p",{className:"text-white/80 text-sm",children:[r," ingrédient",r>1?"s":""," détecté",r>1?"s":""]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:s,className:"btn-glass px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{Icon:f.Plus,size:14}),e.jsx("span",{children:"Ajouter"})]})})})]}),e.jsx("div",{className:"relative mb-4",children:e.jsx("input",{type:"text",placeholder:"Rechercher un ingrédient...",value:t,onChange:o=>a(o.target.value),className:"glass-input w-full"})})]}),de=({item:r,index:t,isEditing:a,onEdit:s,onRemove:o,onStartEdit:n,onStopEdit:l})=>{const{isPerformanceMode:m}=G(),d=m?"div":I.div,x=m?"button":I.button,p=(g=>({Légumes:"#22C55E",Fruits:"#F59E0B",Viandes:"#EF4444",Poissons:"#06B6D4","Produits laitiers":"#8B5CF6",Céréales:"#D97706",Épices:"#EC4899",Autre:"#6B7280"})[g]||"#6B7280")(r.category);return e.jsx(d,{...!m&&{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.95},transition:{duration:.35,delay:t*.04,ease:[.4,0,.2,1]}},className:"group",children:e.jsx(P,{className:"p-4",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, ${p} 8%, transparent) 0%, transparent 60%),
            rgba(255, 255, 255, 0.06)
          `,borderColor:`color-mix(in srgb, ${p} 25%, transparent)`,boxShadow:`
            0 4px 16px rgba(0, 0, 0, 0.2),
            0 0 16px color-mix(in srgb, ${p} 15%, transparent),
            inset 0 1px 0 rgba(255, 255, 255, 0.12)
          `,backdropFilter:"blur(20px) saturate(150%)",WebkitBackdropFilter:"blur(20px) saturate(150%)",transition:m?"none":"all 0.3s ease"},onMouseEnter:g=>{!m&&window.matchMedia("(hover: hover)").matches&&(g.currentTarget.style.transform="translateY(-3px) scale(1.01)",g.currentTarget.style.boxShadow=`
              0 8px 24px rgba(0, 0, 0, 0.3),
              0 0 24px color-mix(in srgb, ${p} 25%, transparent),
              inset 0 1px 0 rgba(255, 255, 255, 0.18)
            `,g.currentTarget.style.borderColor=`color-mix(in srgb, ${p} 40%, transparent)`)},onMouseLeave:g=>{!m&&window.matchMedia("(hover: hover)").matches&&(g.currentTarget.style.transform="translateY(0) scale(1)",g.currentTarget.style.boxShadow=`
              0 4px 16px rgba(0, 0, 0, 0.2),
              0 0 16px color-mix(in srgb, ${p} 15%, transparent),
              inset 0 1px 0 rgba(255, 255, 255, 0.12)
            `,g.currentTarget.style.borderColor=`color-mix(in srgb, ${p} 25%, transparent)`)},children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(d,{className:"flex-shrink-0",...!m&&{whileHover:{scale:1.1,rotate:5},transition:{type:"spring",stiffness:400,damping:17}},children:e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.15) 0%, transparent 60%),
                  linear-gradient(135deg, color-mix(in srgb, ${p} 30%, transparent), color-mix(in srgb, ${p} 20%, transparent))
                `,border:`2px solid color-mix(in srgb, ${p} 50%, transparent)`,boxShadow:`
                  0 0 20px color-mix(in srgb, ${p} 30%, transparent),
                  inset 0 1px 0 rgba(255, 255, 255, 0.2)
                `},children:e.jsx(v,{Icon:f.Utensils,size:22,style:{color:p,filter:`drop-shadow(0 0 8px ${p})`}})})}),e.jsx("div",{className:"flex-1 min-w-0",children:a?e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"text",value:r.name,onChange:g=>s(r.id,"name",g.target.value),className:"w-full bg-white/10 border-2 border-white/20 rounded-xl px-4 py-2.5 text-white text-base font-medium outline-none focus:border-pink-400/50 focus:bg-white/15 transition-all",placeholder:"Nom de l'ingrédient",autoFocus:!0,style:{backdropFilter:"blur(12px)"}}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("input",{type:"text",value:r.quantity,onChange:g=>s(r.id,"quantity",g.target.value),className:"w-full bg-white/10 border-2 border-white/20 rounded-xl px-4 py-2.5 text-white text-sm font-medium outline-none focus:border-pink-400/50 focus:bg-white/15 transition-all",placeholder:"Quantité",style:{backdropFilter:"blur(12px)"}}),e.jsxs("select",{value:r.category,onChange:g=>s(r.id,"category",g.target.value),className:"w-full bg-white/10 border-2 border-white/20 rounded-xl px-4 py-2.5 text-white text-sm font-medium outline-none focus:border-pink-400/50 focus:bg-white/15 transition-all",style:{backdropFilter:"blur(12px)"},children:[e.jsx("option",{value:"Légumes",children:"Légumes"}),e.jsx("option",{value:"Fruits",children:"Fruits"}),e.jsx("option",{value:"Viandes",children:"Viandes"}),e.jsx("option",{value:"Poissons",children:"Poissons"}),e.jsx("option",{value:"Produits laitiers",children:"Produits laitiers"}),e.jsx("option",{value:"Céréales",children:"Céréales"}),e.jsx("option",{value:"Épices",children:"Épices"}),e.jsx("option",{value:"Autre",children:"Autre"})]})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-white font-bold text-lg truncate",style:{textShadow:"0 2px 8px rgba(0,0,0,0.3)"},children:r.name}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("span",{className:"text-white/80 text-sm font-medium",children:r.quantity}),e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-semibold",style:{background:`color-mix(in srgb, ${p} 18%, transparent)`,color:p,border:`1.5px solid color-mix(in srgb, ${p} 35%, transparent)`,boxShadow:`0 0 12px color-mix(in srgb, ${p} 20%, transparent)`},children:r.category}),r.confidence<.7&&e.jsxs("span",{className:"flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-orange-500/15 border border-orange-400/30 text-orange-300 text-xs font-medium",children:[e.jsx(v,{Icon:f.AlertTriangle,size:12}),"Incertain"]})]})]})}),e.jsx("div",{className:"flex items-center gap-2 ml-2",children:a?e.jsx(x,{onClick:l,className:"w-10 h-10 rounded-xl flex items-center justify-center",style:{background:"linear-gradient(135deg, rgba(34, 197, 94, 0.25), rgba(34, 197, 94, 0.15))",border:"2px solid rgba(34, 197, 94, 0.4)",boxShadow:"0 0 16px rgba(34, 197, 94, 0.3)",backdropFilter:"blur(12px)"},...!m&&{whileHover:{scale:1.1},whileTap:{scale:.95}},"aria-label":"Valider",children:e.jsx(v,{Icon:f.Check,size:18,className:"text-green-400"})}):e.jsxs(e.Fragment,{children:[e.jsx(x,{onClick:()=>n(r.id),className:"w-10 h-10 rounded-xl flex items-center justify-center",style:{background:"rgba(255, 255, 255, 0.08)",border:"2px solid rgba(255, 255, 255, 0.18)",backdropFilter:"blur(12px)"},...!m&&{whileHover:{scale:1.08,backgroundColor:"rgba(255, 255, 255, 0.12)",borderColor:"rgba(255, 255, 255, 0.3)"},whileTap:{scale:.95}},"aria-label":"Modifier",children:e.jsx(v,{Icon:f.Edit,size:16,className:"text-white/90"})}),e.jsx(x,{onClick:()=>o(r.id),className:"w-10 h-10 rounded-xl flex items-center justify-center",style:{background:"rgba(239, 68, 68, 0.15)",border:"2px solid rgba(239, 68, 68, 0.3)",backdropFilter:"blur(12px)"},...!m&&{whileHover:{scale:1.08,backgroundColor:"rgba(239, 68, 68, 0.25)",borderColor:"rgba(239, 68, 68, 0.5)",boxShadow:"0 0 16px rgba(239, 68, 68, 0.4)"},whileTap:{scale:.95}},"aria-label":"Supprimer",children:e.jsx(v,{Icon:f.Trash2,size:16,className:"text-red-400"})})]})})]})})})},qe=({userEditedInventory:r,onBack:t,handleManualExit:a,onValidateInventory:s})=>{const{click:o}=Q(),{showToast:n}=V(),l=ne(),{currentSessionId:m}=me(),{selectInventory:d,loadAvailableInventories:x}=be(),{isPerformanceMode:u}=G(),[p,g]=j.useState(!1),h=u?"div":I.div,D=()=>{s(),g(!0)},_=async()=>{try{i.info("REVIEW_EDIT_ACTIONS","Starting meal plan generation",{inventoryCount:r.length,timestamp:new Date().toISOString()}),m&&d(m),l("/fridge#plan")}catch(c){i.error("REVIEW_EDIT_ACTIONS","Meal plan generation failed",{error:c instanceof Error?c.message:"Unknown error",inventoryCount:r.length,timestamp:new Date().toISOString()}),n({type:"error",title:"Erreur de Navigation",message:"Impossible d'accéder à l'onglet plan. Veuillez réessayer.",duration:4e3})}},b=async()=>{try{i.info("REVIEW_EDIT_ACTIONS","Starting recipe generation",{inventoryCount:r.length,timestamp:new Date().toISOString()}),m&&d(m),l("/fridge#recipes")}catch(c){i.error("REVIEW_EDIT_ACTIONS","Recipe generation failed",{error:c instanceof Error?c.message:"Unknown error",inventoryCount:r.length,timestamp:new Date().toISOString()}),n({type:"error",title:"Erreur de Navigation",message:"Impossible d'accéder à l'onglet recettes. Veuillez réessayer.",duration:4e3})}};return e.jsx(ie,{mode:"wait",children:p?e.jsx(h,{...!u&&{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.95},transition:{duration:.5,ease:[.4,0,.2,1]}},children:e.jsx(P,{className:"p-8 text-center w-full",style:{background:`
                radial-gradient(circle at 30% 20%, color-mix(in srgb, #EC4899 20%, transparent) 0%, transparent 60%),
                radial-gradient(circle at 70% 80%, color-mix(in srgb, #8B5CF6 18%, transparent) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, color-mix(in srgb, #F472B6 15%, transparent) 0%, transparent 70%),
                linear-gradient(145deg, rgba(255,255,255,0.15), rgba(255,255,255,0.10)),
                rgba(11, 14, 23, 0.85)
              `,borderColor:"color-mix(in srgb, #EC4899 45%, transparent)",boxShadow:`
                0 20px 60px rgba(0, 0, 0, 0.35),
                0 0 40px color-mix(in srgb, #EC4899 30%, transparent),
                0 0 80px color-mix(in srgb, #8B5CF6 25%, transparent),
                inset 0 2px 0 rgba(255, 255, 255, 0.2)
              `,backdropFilter:"blur(32px) saturate(170%)",WebkitBackdropFilter:"blur(32px) saturate(170%)"},children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(h,{...!u&&{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:200,damping:15}},children:e.jsx(h,{className:"w-20 h-20 mx-auto rounded-full flex items-center justify-center relative",style:{background:`
                      radial-gradient(circle at 30% 30%, rgba(255,255,255,0.35) 0%, transparent 60%),
                      radial-gradient(circle at 70% 70%, color-mix(in srgb, #8B5CF6 30%, transparent) 0%, transparent 50%),
                      linear-gradient(135deg, color-mix(in srgb, #EC4899 55%, transparent), color-mix(in srgb, #8B5CF6 45%, transparent))
                    `,border:"3px solid color-mix(in srgb, #EC4899 70%, transparent)",boxShadow:`
                      0 0 40px color-mix(in srgb, #EC4899 60%, transparent),
                      0 0 80px color-mix(in srgb, #8B5CF6 40%, transparent),
                      inset 0 3px 0 rgba(255,255,255,0.5)
                    `},...!u&&{animate:{scale:[1,1.05,1],boxShadow:["0 0 40px rgba(236, 72, 153, 0.6), 0 0 80px rgba(139, 92, 246, 0.4)","0 0 50px rgba(236, 72, 153, 0.75), 0 0 100px rgba(139, 92, 246, 0.55)","0 0 40px rgba(236, 72, 153, 0.6), 0 0 80px rgba(139, 92, 246, 0.4)"]},transition:{duration:2.5,repeat:1/0,ease:"easeInOut"}},children:e.jsx(v,{Icon:f.Sparkles,size:36,color:"rgba(255, 255, 255, 0.95)",variant:"pure"})})}),e.jsxs(h,{...!u&&{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2}},children:[e.jsx("h4",{className:"text-2xl font-bold text-white mb-3",style:{textShadow:"0 0 20px color-mix(in srgb, #EC4899 50%, transparent)"},children:"Générer vos Recettes"}),e.jsx("p",{className:"text-white/85 text-base leading-relaxed max-w-lg mx-auto",children:"Inventaire validé avec succès ! Choisissez votre prochaine étape pour exploiter vos ingrédients."})]}),e.jsxs(h,{...!u&&{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3}},className:"flex flex-col sm:flex-row gap-4 justify-center max-w-2xl mx-auto",children:[e.jsx("button",{onClick:()=>{o(),_()},className:"relative overflow-hidden px-8 py-4 text-base font-bold rounded-2xl transition-all duration-300 group flex-1",style:{background:`
                      linear-gradient(135deg,
                        color-mix(in srgb, #EC4899 85%, transparent),
                        color-mix(in srgb, #F472B6 70%, transparent)
                      )
                    `,border:"2.5px solid color-mix(in srgb, #EC4899 70%, transparent)",boxShadow:`
                      0 12px 40px color-mix(in srgb, #EC4899 50%, transparent),
                      0 0 60px color-mix(in srgb, #EC4899 35%, transparent),
                      inset 0 3px 0 rgba(255,255,255,0.5)
                    `,color:"white"},onMouseEnter:c=>{window.matchMedia("(hover: hover)").matches&&(c.currentTarget.style.transform="translateY(-3px) scale(1.02)",c.currentTarget.style.boxShadow=`
                        0 16px 50px color-mix(in srgb, #EC4899 65%, transparent),
                        0 0 80px color-mix(in srgb, #EC4899 50%, transparent),
                        inset 0 3px 0 rgba(255,255,255,0.6)
                      `)},onMouseLeave:c=>{window.matchMedia("(hover: hover)").matches&&(c.currentTarget.style.transform="translateY(0) scale(1)",c.currentTarget.style.boxShadow=`
                        0 12px 40px color-mix(in srgb, #EC4899 50%, transparent),
                        0 0 60px color-mix(in srgb, #EC4899 35%, transparent),
                        inset 0 3px 0 rgba(255,255,255,0.5)
                      `)},children:e.jsxs("div",{className:"flex items-center justify-center gap-2.5 relative z-10",children:[e.jsx(v,{Icon:f.Calendar,size:20,color:"white",variant:"pure"}),e.jsx("span",{children:"Plan Repas"})]})}),e.jsx("button",{onClick:()=>{o(),b()},className:"relative overflow-hidden px-8 py-4 text-base font-bold rounded-2xl transition-all duration-300 group flex-1",style:{background:`
                      linear-gradient(135deg,
                        color-mix(in srgb, #8B5CF6 85%, transparent),
                        color-mix(in srgb, #A78BFA 70%, transparent)
                      )
                    `,border:"2.5px solid color-mix(in srgb, #8B5CF6 70%, transparent)",boxShadow:`
                      0 12px 40px color-mix(in srgb, #8B5CF6 50%, transparent),
                      0 0 60px color-mix(in srgb, #8B5CF6 35%, transparent),
                      inset 0 3px 0 rgba(255,255,255,0.5)
                    `,color:"white"},onMouseEnter:c=>{window.matchMedia("(hover: hover)").matches&&(c.currentTarget.style.transform="translateY(-3px) scale(1.02)",c.currentTarget.style.boxShadow=`
                        0 16px 50px color-mix(in srgb, #8B5CF6 65%, transparent),
                        0 0 80px color-mix(in srgb, #8B5CF6 50%, transparent),
                        inset 0 3px 0 rgba(255,255,255,0.6)
                      `)},onMouseLeave:c=>{window.matchMedia("(hover: hover)").matches&&(c.currentTarget.style.transform="translateY(0) scale(1)",c.currentTarget.style.boxShadow=`
                        0 12px 40px color-mix(in srgb, #8B5CF6 50%, transparent),
                        0 0 60px color-mix(in srgb, #8B5CF6 35%, transparent),
                        inset 0 3px 0 rgba(255,255,255,0.5)
                      `)},children:e.jsxs("div",{className:"flex items-center justify-center gap-2.5 relative z-10",children:[e.jsx(v,{Icon:f.Sparkles,size:20,color:"white",variant:"pure"}),e.jsx("span",{children:"Recettes"})]})}),e.jsx("button",{onClick:()=>{o(),l("/")},className:"px-8 py-4 rounded-2xl font-semibold text-base transition-all duration-300",style:{background:"rgba(255, 255, 255, 0.08)",border:"2px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.2)",backdropFilter:"blur(16px)",color:"white"},onMouseEnter:c=>{window.matchMedia("(hover: hover)").matches&&(c.currentTarget.style.transform="translateY(-2px)",c.currentTarget.style.background="rgba(255, 255, 255, 0.12)",c.currentTarget.style.borderColor="rgba(255, 255, 255, 0.3)")},onMouseLeave:c=>{window.matchMedia("(hover: hover)").matches&&(c.currentTarget.style.transform="translateY(0)",c.currentTarget.style.background="rgba(255, 255, 255, 0.08)",c.currentTarget.style.borderColor="rgba(255, 255, 255, 0.2)")},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(v,{Icon:f.Home,size:18}),e.jsx("span",{children:"Tableau de bord"})]})})]})]})})},"validated-state"):e.jsxs(h,{...!u&&{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.4,ease:[.4,0,.2,1]}},className:"space-y-4",children:[e.jsx(P,{className:"p-8 text-center w-full",style:{background:`
                radial-gradient(circle at 30% 20%, color-mix(in srgb, #EC4899 18%, transparent) 0%, transparent 60%),
                radial-gradient(circle at 70% 80%, color-mix(in srgb, #F472B6 15%, transparent) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, color-mix(in srgb, #DB2777 12%, transparent) 0%, transparent 70%),
                linear-gradient(145deg, rgba(255,255,255,0.15), rgba(255,255,255,0.10)),
                rgba(11, 14, 23, 0.85)
              `,borderColor:"color-mix(in srgb, #EC4899 40%, transparent)",boxShadow:`
                0 16px 48px rgba(0, 0, 0, 0.3),
                0 0 36px color-mix(in srgb, #EC4899 25%, transparent),
                inset 0 2px 0 rgba(255, 255, 255, 0.18)
              `,backdropFilter:"blur(28px) saturate(160%)",WebkitBackdropFilter:"blur(28px) saturate(160%)"},children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(h,{className:"relative inline-block",...!u&&{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5,delay:.1}},children:e.jsxs(h,{className:"w-20 h-20 mx-auto rounded-full flex items-center justify-center relative",style:{background:`
                      radial-gradient(circle at 30% 30%, rgba(255,255,255,0.35) 0%, transparent 60%),
                      radial-gradient(circle at 70% 70%, color-mix(in srgb, #EC4899 30%, transparent) 0%, transparent 50%),
                      linear-gradient(135deg, color-mix(in srgb, #EC4899 55%, transparent), color-mix(in srgb, #F472B6 45%, transparent))
                    `,border:"3px solid color-mix(in srgb, #EC4899 70%, transparent)",boxShadow:`
                      0 0 40px color-mix(in srgb, #EC4899 60%, transparent),
                      inset 0 3px 0 rgba(255,255,255,0.5)
                    `},...!u&&{animate:{scale:[1,1.05,1],boxShadow:["0 0 40px rgba(236, 72, 153, 0.6)","0 0 50px rgba(236, 72, 153, 0.75)","0 0 40px rgba(236, 72, 153, 0.6)"]},transition:{duration:2.5,repeat:1/0,ease:"easeInOut"}},children:[e.jsx(v,{Icon:f.Check,size:36,color:"rgba(255, 255, 255, 0.95)",variant:"pure"}),!u&&e.jsx(I.div,{className:"absolute inset-0 rounded-full border-2",style:{borderColor:"color-mix(in srgb, #EC4899 65%, transparent)"},animate:{scale:[1,1.5,1.5],opacity:[.8,0,0]},transition:{duration:2,repeat:1/0,ease:"easeOut"}})]})}),e.jsxs(h,{...!u&&{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.4,delay:.2}},children:[e.jsx("h4",{className:"text-2xl font-bold text-white mb-3",style:{textShadow:"0 0 20px color-mix(in srgb, #EC4899 50%, transparent)"},children:"Valider votre inventaire"}),e.jsxs("p",{className:"text-white/85 text-base leading-relaxed max-w-lg mx-auto",children:[e.jsxs("span",{className:"font-bold text-pink-300",children:[r.length," ingrédient",r.length>1?"s":""]})," prêt",r.length>1?"s":""," à être validé",r.length>1?"s":"",". Confirmez pour continuer vers la génération."]})]}),e.jsx(h,{...!u&&{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.4,delay:.3}},children:e.jsxs("button",{onClick:()=>{o(),D()},disabled:r.length===0,className:"relative overflow-hidden px-10 py-4 text-lg font-bold rounded-2xl transition-all duration-300 group",style:{background:`
                      linear-gradient(135deg,
                        color-mix(in srgb, #EC4899 90%, transparent),
                        color-mix(in srgb, #F472B6 75%, transparent),
                        color-mix(in srgb, #DB2777 65%, transparent)
                      )
                    `,border:"3px solid color-mix(in srgb, #EC4899 75%, transparent)",boxShadow:`
                      0 18px 60px color-mix(in srgb, #EC4899 60%, transparent),
                      0 0 100px color-mix(in srgb, #EC4899 50%, transparent),
                      inset 0 5px 0 rgba(255,255,255,0.6)
                    `,color:"white"},onMouseEnter:c=>{!u&&window.matchMedia("(hover: hover)").matches&&(c.currentTarget.style.transform="translateY(-3px) scale(1.03)",c.currentTarget.style.boxShadow=`
                        0 24px 80px color-mix(in srgb, #EC4899 75%, transparent),
                        0 0 130px color-mix(in srgb, #EC4899 65%, transparent),
                        inset 0 5px 0 rgba(255,255,255,0.7)
                      `)},onMouseLeave:c=>{!u&&window.matchMedia("(hover: hover)").matches&&(c.currentTarget.style.transform="translateY(0) scale(1)",c.currentTarget.style.boxShadow=`
                        0 18px 60px color-mix(in srgb, #EC4899 60%, transparent),
                        0 0 100px color-mix(in srgb, #EC4899 50%, transparent),
                        inset 0 5px 0 rgba(255,255,255,0.6)
                      `)},children:[!u&&e.jsx(I.div,{className:"absolute inset-0 rounded-2xl pointer-events-none",style:{background:"linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.45) 50%, transparent 100%)"},animate:{x:["-200%","200%"]},transition:{duration:2.5,repeat:1/0,ease:"easeInOut"}}),e.jsxs("div",{className:"flex items-center gap-3 relative z-10",children:[e.jsx(v,{Icon:f.Check,size:22,color:"white",variant:"pure"}),e.jsx("span",{children:"Valider l'inventaire"})]})]})}),e.jsxs(h,{...!u&&{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4}},className:"inline-flex items-center gap-2 px-5 py-2.5 rounded-full",style:{background:"color-mix(in srgb, #EC4899 18%, transparent)",border:"2px solid color-mix(in srgb, #EC4899 35%, transparent)",backdropFilter:"blur(18px) saturate(150%)"},children:[e.jsx(v,{Icon:f.Package,size:16,className:"text-pink-300"}),e.jsxs("span",{className:"text-pink-200 text-sm font-semibold",children:[r.length," ingrédient",r.length>1?"s":""," en attente"]})]})]})}),e.jsxs(h,{...!u&&{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.35}},className:"flex flex-col sm:flex-row gap-4 justify-between",children:[e.jsx("button",{onClick:t,className:"px-7 py-4 rounded-2xl font-semibold text-base transition-all duration-300 flex-1",style:{background:"rgba(255, 255, 255, 0.08)",border:"2px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.2)",backdropFilter:"blur(16px)",color:"white"},onMouseEnter:c=>{window.matchMedia("(hover: hover)").matches&&(c.currentTarget.style.transform="translateY(-2px)",c.currentTarget.style.background="rgba(255, 255, 255, 0.12)",c.currentTarget.style.borderColor="rgba(255, 255, 255, 0.3)")},onMouseLeave:c=>{window.matchMedia("(hover: hover)").matches&&(c.currentTarget.style.transform="translateY(0)",c.currentTarget.style.background="rgba(255, 255, 255, 0.08)",c.currentTarget.style.borderColor="rgba(255, 255, 255, 0.2)")},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(v,{Icon:f.ArrowLeft,size:18}),e.jsx("span",{children:"Retour"})]})}),e.jsx("button",{onClick:()=>{o(),a()},className:"px-7 py-4 rounded-2xl font-semibold text-base transition-all duration-300 flex-1",style:{background:"rgba(255, 255, 255, 0.08)",border:"2px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.2)",backdropFilter:"blur(16px)",color:"white"},onMouseEnter:c=>{window.matchMedia("(hover: hover)").matches&&(c.currentTarget.style.transform="translateY(-2px)",c.currentTarget.style.background="rgba(255, 255, 255, 0.12)",c.currentTarget.style.borderColor="rgba(255, 255, 255, 0.3)")},onMouseLeave:c=>{window.matchMedia("(hover: hover)").matches&&(c.currentTarget.style.transform="translateY(0)",c.currentTarget.style.background="rgba(255, 255, 255, 0.08)",c.currentTarget.style.borderColor="rgba(255, 255, 255, 0.2)")},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(v,{Icon:f.X,size:18}),e.jsx("span",{children:"Quitter l'Atelier"})]})})]})]},"validation-state")})},et=({rawDetectedItems:r,userEditedInventory:t,suggestedComplementaryItems:a,addSelectedComplementaryItems:s,onInventoryUpdate:o,onContinue:n,onBack:l,isLoading:m,handleManualExit:d})=>{const[x,u]=j.useState(null),[p,g]=j.useState(""),[h,D]=j.useState(!1),[_,b]=j.useState(!1),{click:c}=Q(),{showToast:S}=V(),{saveRecipeSession:z}=me(),{isPerformanceMode:Z}=G(),q=async()=>{try{b(!0),i.info("REVIEW_EDIT_STAGE","Starting inventory validation",{inventoryCount:N.length,timestamp:new Date().toISOString()}),await z(),D(!0),S({type:"success",title:"Inventaire Validé",message:"Votre inventaire a été sauvegardé avec succès",duration:3e3}),i.info("REVIEW_EDIT_STAGE","Inventory validated successfully",{inventoryCount:N.length,timestamp:new Date().toISOString()})}catch(w){i.error("REVIEW_EDIT_STAGE","Failed to validate inventory",{error:w instanceof Error?w.message:"Unknown error",inventoryCount:N.length,timestamp:new Date().toISOString()}),S({type:"error",title:"Erreur de Validation",message:"Impossible de valider l'inventaire. Veuillez réessayer.",duration:4e3})}finally{b(!1)}},N=Array.isArray(t)?t:[];j.useEffect(()=>{if(N.length===0&&r.length>0){i.info("REVIEW_EDIT_STAGE","Initializing inventory from detected items",{rawItemsCount:r.length,timestamp:new Date().toISOString()});const w=r.map((E,k)=>({id:`item-${k}`,userId:"",sessionId:"",name:E.label||E.name||"Ingrédient inconnu",category:E.category||"Autre",quantity:E.estimatedQuantity||E.quantity||"1",confidence:E.confidence||.8,freshnessScore:E.freshnessScore||85,expiryDate:E.expiryDate,photoUrl:E.photoUrl,isUserEdited:!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}));o(w),i.debug("REVIEW_EDIT_STAGE","Initial inventory created",{inventoryCount:w.length,categories:[...new Set(w.map(E=>E.category))],timestamp:new Date().toISOString()})}},[r,N.length,o]);const L=N.filter(w=>w.name.toLowerCase().includes(p.toLowerCase())||w.category.toLowerCase().includes(p.toLowerCase())),ee=(w,E,k)=>{i.debug("REVIEW_EDIT_STAGE","Item edited by user",{itemId:w,field:E,newValue:k,timestamp:new Date().toISOString()});const O=N.map(B=>B.id===w?{...B,[E]:k,isUserEdited:!0,updatedAt:new Date().toISOString()}:B);o(O)},U=w=>{const E=N.find(O=>O.id===w);i.info("REVIEW_EDIT_STAGE","Item removed by user",{itemId:w,itemName:E?.name,itemCategory:E?.category,timestamp:new Date().toISOString()});const k=N.filter(O=>O.id!==w);o(k),S({type:"success",title:"Ingrédient supprimé",message:"L'ingrédient a été retiré de votre inventaire",duration:2e3})},oe=()=>{i.info("REVIEW_EDIT_STAGE","Custom item added by user",{currentInventoryCount:N.length,timestamp:new Date().toISOString()});const w={id:`custom-${Date.now()}`,userId:"",sessionId:"",name:"Nouvel ingrédient",category:"Autre",quantity:"1",confidence:1,freshnessScore:90,isUserEdited:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};o([...N,w]),u(w.id),S({type:"success",title:"Ingrédient ajouté",message:"Nouvel ingrédient ajouté à votre inventaire",duration:2e3})},le=w=>{i.info("REVIEW_EDIT_STAGE","Adding selected complementary items",{itemsCount:w.length,itemNames:w.map(E=>E.name),timestamp:new Date().toISOString()}),s(w),S({type:"success",title:"Ingrédients ajoutés",message:`${w.length} ingrédient${w.length>1?"s":""} ajouté${w.length>1?"s":""} à votre inventaire`,duration:3e3})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ze,{inventoryCount:L.length,searchFilter:p,setSearchFilter:g,onAddCustomItem:oe}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Z?L.map((w,E)=>e.jsx(de,{item:w,index:E,isEditing:x===w.id,onEdit:ee,onRemove:U,onStartEdit:u,onStopEdit:()=>u(null)},w.id)):e.jsx(ie,{children:L.map((w,E)=>e.jsx(de,{item:w,index:E,isEditing:x===w.id,onEdit:ee,onRemove:U,onStartEdit:u,onStopEdit:()=>u(null)},w.id))})}),a&&a.length>0&&e.jsxs("details",{className:"glass-card",children:[e.jsxs("summary",{className:"cursor-pointer p-4 flex items-center gap-3 hover:bg-white/5 transition-colors",children:[e.jsx(v,{Icon:f.ChevronDown,size:16,className:"text-blue-400 transition-transform"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{Icon:f.Lightbulb,size:16,className:"text-blue-400"}),e.jsx("span",{className:"text-white font-medium",children:"Suggestions complémentaires (cliquez pour voir)"})]}),e.jsxs("span",{className:"text-sm text-white/70 ml-auto",children:[a.length," suggestion",a.length>1?"s":""]})]}),e.jsx("div",{className:"p-4 pt-0",children:e.jsx(pe,{suggestedItems:a,onAddSelectedItems:le})})]}),e.jsx(qe,{userEditedInventory:N,onBack:l,handleManualExit:d,onValidateInventory:q})]})},vt=({currentStep:r,capturedPhotos:t,simulatedLoadingStep:a,simulatedScanProgress:s,loadingMessage:o,userEditedInventory:n,suggestedComplementaryItems:l,rawDetectedItems:m,profileCompletion:d,nudgeDismissed:x,onCameraCapture:u,onFileUpload:p,onRemovePhoto:g,onAnalyzePhotos:h,onInventoryUpdate:D,onContinueToValidation:_,onBackToPhoto:b,onBack:c,onNudgeDismiss:S,addSelectedComplementaryItems:z,goToStep:Z,previousStep:q,handleManualExit:N})=>{const L=()=>{switch(r){case"photo":return e.jsxs("div",{className:"space-y-6",children:[e.jsx(ce,{onCameraCapture:u,onFileUpload:p,fileInputRef:J.createRef()}),t.length>0&&e.jsx(Ve,{capturedPhotos:t,onRemovePhoto:g}),t.length>0&&e.jsx(Ue,{capturedPhotosCount:t.length,onAnalyzePhotos:h}),d&&!d.isSufficient&&!x&&e.jsx(fe,{completion:d,variant:"card",onDismiss:S,showDismiss:!0}),e.jsx(Ye,{})]});case"analyze":return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Je,{simulatedLoadingStep:a,simulatedScanProgress:s,loadingMessage:o}),e.jsx(Xe,{})]});case"complement":return e.jsx(Qe,{userEditedInventory:n,suggestedComplementaryItems:l,addSelectedComplementaryItems:z,onContinueToValidation:_,onBackToPhoto:b});case"validation":return e.jsx(et,{rawDetectedItems:m,userEditedInventory:n,suggestedComplementaryItems:l,addSelectedComplementaryItems:z,onInventoryUpdate:D,onContinue:()=>{},onBack:c,isLoading:!1,handleManualExit:N});case"recipes":return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-4",children:"Génération des recettes en cours..."}),e.jsx("p",{className:"text-gray-600",children:"Cette fonctionnalité sera bientôt disponible."})]})});default:return e.jsx("div",{className:"space-y-6",children:e.jsx(ce,{onCameraCapture:u,onFileUpload:p,fileInputRef:J.createRef()})})}};return e.jsx("div",{className:"fridge-scan-stage-container",children:L()})};export{yt as F,ct as a,xt as b,X as c,gt as d,mt as e,pt as f,dt as g,ut as h,ht as i,bt as j,ft as k,vt as l,lt as u,H as w};
