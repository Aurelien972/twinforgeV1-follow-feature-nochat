import{r as n,j as e,b7 as k,b2 as N,b$ as $,c0 as M,cg as u,b1 as B,bH as _}from"./vendor-ZbFMzY-i.js";import{G as o}from"./ui-components-OHztaiDj.js";import{s as v,l as r}from"./page-fridge-C1QVLxk9.js";import"./utils-CUtLAp28.js";import"./supabase-8_3juhcZ.js";import"./motion-HGAT--uT.js";import"./stores-ZZM8MTtI.js";import"./page-fridge-scan-C_CisW7P.js";import"./date-utils-BlBdbPk_.js";function X(){const[A,D]=n.useState([]),[p,T]=n.useState({totalEntries:0,totalSize:0,aiCacheEntries:0,aiCacheSize:0}),[g,E]=n.useState(null),[y,t]=n.useState(""),[b,V]=n.useState([]),[x,d]=n.useState(!1),m=()=>{const s=[];let a=0,c=0,l=0;for(let i=0;i<localStorage.length;i++){const h=localStorage.key(i);if(h)try{const j=localStorage.getItem(h);if(!j)continue;const w=new Blob([j]).size;a+=w;const S=JSON.parse(j);h.includes("ai-cache")&&(c++,l+=w),s.push({key:h,value:S,size:w,timestamp:S?.timestamp||S?.createdAt||"N/A"})}catch{}}s.sort((i,h)=>i.key.localeCompare(h.key)),D(s),T({totalEntries:s.length,totalSize:a,aiCacheEntries:c,aiCacheSize:l}),r.info("DEV_CACHE_PAGE","Cache data loaded",{totalEntries:s.length,aiCacheEntries:c})};n.useEffect(()=>{m(),f()},[]);const f=async()=>{d(!0);try{const{data:s,error:a}=await v.from("training_ai_cache").select("*").order("created_at",{ascending:!1});a?(r.error("DEV_CACHE_PAGE","Failed to load Supabase cache",{error:a.message}),t("❌ Erreur lors du chargement du cache Supabase"),setTimeout(()=>t(""),3e3)):(V(s||[]),r.info("DEV_CACHE_PAGE","Supabase cache loaded",{count:s?.length||0}))}catch(s){r.error("DEV_CACHE_PAGE","Exception loading Supabase cache",{error:s})}finally{d(!1)}},G=async()=>{if(confirm("Êtes-vous sûr de vouloir vider TOUT le cache Supabase (training_ai_cache) ?")){d(!0);try{const{data:{user:s}}=await v.auth.getUser();if(!s){t("❌ Utilisateur non connecté"),setTimeout(()=>t(""),3e3);return}const{error:a}=await v.from("training_ai_cache").delete().eq("user_id",s.id);a?(r.error("DEV_CACHE_PAGE","Failed to clear Supabase cache",{error:a.message}),t("❌ Erreur lors de la suppression du cache")):(await f(),t("✅ Cache Supabase vidé avec succès"),r.info("DEV_CACHE_PAGE","Supabase cache cleared")),setTimeout(()=>t(""),3e3)}catch(s){r.error("DEV_CACHE_PAGE","Exception clearing Supabase cache",{error:s}),t("❌ Erreur lors de la suppression du cache"),setTimeout(()=>t(""),3e3)}finally{d(!1)}}},P=async s=>{if(confirm(`Supprimer l'entrée "${s}" du cache Supabase ?`)){d(!0);try{const{error:a}=await v.from("training_ai_cache").delete().eq("cache_key",s);a?(r.error("DEV_CACHE_PAGE","Failed to delete cache entry",{error:a.message,cacheKey:s}),t("❌ Erreur lors de la suppression")):(await f(),t(`✅ Entrée "${s}" supprimée`),r.info("DEV_CACHE_PAGE","Cache entry deleted",{cacheKey:s})),setTimeout(()=>t(""),3e3)}catch(a){r.error("DEV_CACHE_PAGE","Exception deleting cache entry",{error:a,cacheKey:s}),t("❌ Erreur lors de la suppression"),setTimeout(()=>t(""),3e3)}finally{d(!1)}}},H=()=>{confirm("Êtes-vous sûr de vouloir vider TOUT le cache localStorage ?")&&(localStorage.clear(),m(),t("✅ Tout le cache a été vidé"),setTimeout(()=>t(""),3e3),r.info("DEV_CACHE_PAGE","All cache cleared"))},z=()=>{if(!confirm("Êtes-vous sûr de vouloir vider uniquement le cache AI ?"))return;const s=[];for(let a=0;a<localStorage.length;a++){const c=localStorage.key(a);c?.includes("ai-cache")&&s.push(c)}s.forEach(a=>localStorage.removeItem(a)),m(),t(`✅ ${s.length} entrées AI supprimées`),setTimeout(()=>t(""),3e3),r.info("DEV_CACHE_PAGE","AI cache cleared",{count:s.length})},I=s=>{confirm(`Supprimer l'entrée "${s}" ?`)&&(localStorage.removeItem(s),m(),E(null),t(`✅ Entrée "${s}" supprimée`),setTimeout(()=>t(""),3e3),r.info("DEV_CACHE_PAGE","Cache entry removed",{key:s}))},C=s=>{if(s===0)return"0 B";const a=1024,c=["B","KB","MB"],l=Math.floor(Math.log(s)/Math.log(a));return`${Math.round(s/Math.pow(a,l)*100)/100} ${c[l]}`};return e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Cache Manager"}),e.jsx("p",{className:"text-neutral-400",children:"Gestion du localStorage en développement"})]}),e.jsxs("button",{onClick:m,className:"px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-white font-medium transition-colors flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4"}),"Rafraîchir"]})]}),y&&e.jsx("div",{className:"px-4 py-3 rounded-lg bg-green-500/10 border border-green-500/20 text-green-400",children:y}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(o,{variant:"premium",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-lg bg-blue-500/10",children:e.jsx(N,{className:"w-6 h-6 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-neutral-400",children:"Total Entries"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:p.totalEntries})]})]})}),e.jsx(o,{variant:"premium",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-lg bg-purple-500/10",children:e.jsx(N,{className:"w-6 h-6 text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-neutral-400",children:"Total Size"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:C(p.totalSize)})]})]})}),e.jsx(o,{variant:"premium",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-lg bg-orange-500/10",children:e.jsx($,{className:"w-6 h-6 text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-neutral-400",children:"AI Cache"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:p.aiCacheEntries})]})]})}),e.jsx(o,{variant:"premium",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-lg bg-green-500/10",children:e.jsx(M,{className:"w-6 h-6 text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-neutral-400",children:"AI Size"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:C(p.aiCacheSize)})]})]})})]}),e.jsxs(o,{variant:"premium",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-3",children:"Actions - LocalStorage"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:z,className:"px-4 py-2 rounded-lg bg-red-500/20 hover:bg-red-500/30 text-red-400 font-medium transition-colors flex items-center gap-2 border border-red-500/30",children:[e.jsx(u,{className:"w-4 h-4"}),"Vider Cache AI"]}),e.jsxs("button",{onClick:H,className:"px-4 py-2 rounded-lg bg-red-500/20 hover:bg-red-500/30 text-red-400 font-medium transition-colors flex items-center gap-2 border border-red-500/30",children:[e.jsx(u,{className:"w-4 h-4"}),"Vider Tout le Cache"]})]})]}),e.jsxs(o,{variant:"premium",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{className:"w-6 h-6 text-blue-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:"Cache Supabase (training_ai_cache)"}),e.jsxs("p",{className:"text-sm text-neutral-400",children:[b.length," entrées"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:f,disabled:x,className:"px-3 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-white font-medium transition-colors flex items-center gap-2 disabled:opacity-50",children:[e.jsx(k,{className:`w-4 h-4 ${x?"animate-spin":""}`}),"Rafraîchir"]}),e.jsxs("button",{onClick:G,disabled:x||b.length===0,className:"px-3 py-2 rounded-lg bg-red-500/20 hover:bg-red-500/30 text-red-400 font-medium transition-colors flex items-center gap-2 border border-red-500/30 disabled:opacity-50",children:[e.jsx(u,{className:"w-4 h-4"}),"Vider Cache Supabase"]})]})]}),e.jsx("div",{className:"space-y-2 max-h-[600px] overflow-y-auto",children:x?e.jsx("p",{className:"text-neutral-400 text-center py-8",children:"Chargement..."}):b.length===0?e.jsx("p",{className:"text-neutral-400 text-center py-8",children:"Aucune entrée dans le cache Supabase"}):b.map(s=>{const a=new Date(s.expires_at)<new Date,c=s.cached_data?.exercises&&Array.isArray(s.cached_data.exercises),l=c&&s.cached_data.exercises.length>0;return e.jsxs("div",{className:`p-4 rounded-lg transition-colors cursor-pointer border ${a?"bg-red-500/10 border-red-500/30":l?"bg-white/5 border-white/10 hover:bg-white/10":"bg-orange-500/10 border-orange-500/30"}`,onClick:()=>E(g===s.cache_key?null:s.cache_key),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"text-white font-medium truncate",children:s.cache_key}),a&&e.jsx("span",{className:"px-2 py-0.5 rounded text-xs bg-red-500/20 text-red-400 border border-red-500/30",children:"Expiré"}),!l&&!a&&e.jsx("span",{className:"px-2 py-0.5 rounded text-xs bg-orange-500/20 text-orange-400 border border-orange-500/30",children:"⚠️ Invalide"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-neutral-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(N,{className:"w-3 h-3"}),"Type: ",s.cache_type||"N/A"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(_,{className:"w-3 h-3"}),"Créé: ",new Date(s.created_at).toLocaleString()]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(_,{className:"w-3 h-3"}),"Expire: ",new Date(s.expires_at).toLocaleString()]}),c&&e.jsxs("span",{className:"text-green-400",children:["✓ ",s.cached_data.exercises.length," exercices"]})]})]}),e.jsx("button",{onClick:i=>{i.stopPropagation(),P(s.cache_key)},disabled:x,className:"px-3 py-2 rounded-lg bg-red-500/20 hover:bg-red-500/30 text-red-400 transition-colors border border-red-500/30 disabled:opacity-50",children:e.jsx(u,{className:"w-4 h-4"})})]}),g===s.cache_key&&e.jsx("div",{className:"mt-4 p-3 rounded bg-black/30 border border-white/5",children:e.jsx("pre",{className:"text-xs text-neutral-300 overflow-x-auto max-h-96",children:JSON.stringify(s.cached_data,null,2)})})]},s.cache_key)})})]}),e.jsxs(o,{variant:"premium",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Entrées du Cache"}),e.jsx("div",{className:"space-y-2 max-h-[600px] overflow-y-auto",children:A.length===0?e.jsx("p",{className:"text-neutral-400 text-center py-8",children:"Aucune entrée dans le cache"}):A.map(s=>e.jsxs("div",{className:"p-4 rounded-lg bg-white/5 hover:bg-white/10 transition-colors cursor-pointer border border-white/10",onClick:()=>E(g===s.key?null:s.key),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white font-medium truncate",children:s.key}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-xs text-neutral-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(N,{className:"w-3 h-3"}),C(s.size)]}),s.timestamp!=="N/A"&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(_,{className:"w-3 h-3"}),new Date(s.timestamp).toLocaleString()]})]})]}),e.jsx("button",{onClick:a=>{a.stopPropagation(),I(s.key)},className:"px-3 py-2 rounded-lg bg-red-500/20 hover:bg-red-500/30 text-red-400 transition-colors border border-red-500/30",children:e.jsx(u,{className:"w-4 h-4"})})]}),g===s.key&&e.jsx("div",{className:"mt-4 p-3 rounded bg-black/30 border border-white/5",children:e.jsx("pre",{className:"text-xs text-neutral-300 overflow-x-auto",children:JSON.stringify(s.value,null,2)})})]},s.key))})]})]})}export{X as default};
