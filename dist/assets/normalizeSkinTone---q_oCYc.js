import{l as g}from"./page-fridge-C1QVLxk9.js";import"./vendor-ZbFMzY-i.js";import"./utils-CUtLAp28.js";import"./supabase-8_3juhcZ.js";import"./stores-ZZM8MTtI.js";import"./ui-components-OHztaiDj.js";import"./motion-HGAT--uT.js";import"./page-fridge-scan-C_CisW7P.js";import"./date-utils-BlBdbPk_.js";function N(e){return e&&e.schema==="v2"&&e.space==="sRGB"&&e.format==="rgb255"&&typeof e.rgb?.r=="number"&&typeof e.rgb?.g=="number"&&typeof e.rgb?.b=="number"}const k={schema:"v2",space:"sRGB",format:"rgb255",rgb:{r:153,g:108,b:78},hex:"#996C4E",srgb_f32:{r:.6,g:.424,b:.306},linear_f32:{r:.318,g:.154,b:.079},source:"default_fallback",confidence:.5},m=e=>Math.max(0,Math.min(255,e|0));function f(e){const n=Math.max(0,Math.min(1,e));return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function T(e,n,a){const r=Math.max(0,Math.min(255,Math.round(e))),u=Math.max(0,Math.min(255,Math.round(n))),l=Math.max(0,Math.min(255,Math.round(a)));return"#"+[r,u,l].map(i=>{const o=i.toString(16);return o.length===1?"0"+o:o}).join("")}function v(e,n,a,r,u,l){const i={r:m(e),g:m(n),b:m(a)},o={r:i.r/255,g:i.g/255,b:i.b/255},c={r:f(o.r),g:f(o.g),b:f(o.b)},d=T(i.r,i.g,i.b);(!Number.isFinite(c.r)||!Number.isFinite(c.g)||!Number.isFinite(c.b))&&(g.warn("SKIN_TONE_CONVERSION","Invalid linear conversion, using fallback",{srgb_f32:o,linear_f32:c,originalRGB:{r:e,g:n,b:a}}),c.r=Math.pow(o.r,2.2),c.g=Math.pow(o.g,2.2),c.b=Math.pow(o.b,2.2));const b={schema:"v2",space:"sRGB",format:"rgb255",rgb:i,hex:d,srgb_f32:o,linear_f32:c,source:r,confidence:u,pixelCount:l};return g.info("SKIN_TONE_V2_CREATED","Skin tone created",{rgb:`rgb(${i.r}, ${i.g}, ${i.b})`,hex:d,source:r,confidence:u}),b}const h=e=>{const n=typeof e=="string"?parseFloat(e):e;return Number.isFinite(n)?n:null};function O(e){const n=h(e?.r??e?.avgR),a=h(e?.g??e?.avgG),r=h(e?.b??e?.avgB);return n===null||a===null||r===null?null:{r:m(n),g:m(a),b:m(r)}}function B(e){if(!e)return g.debug("SKIN_TONE_RESOLUTION_V2","No payload provided, using default",{philosophy:"v2_strict_prioritization"}),{tone:k,source:"default"};g.debug("SKIN_TONE_RESOLUTION_V2","Starting V2 strict prioritization",{payloadKeys:e?Object.keys(e):[],philosophy:"v2_strict_prioritization_audit"});const n=[e?.skin_tone,e?.avatar?.skin_tone,e?.estimate?.skin_tone,e?.savedAvatarPayload?.skin_tone,e?.preferences?.skin_tone].filter(Boolean);for(const t of n)if(N(t))return g.info("SKIN_TONE_RESOLUTION_V2","Found valid V2 skin tone (strict priority)",{skinToneRGB:`rgb(${t.rgb.r}, ${t.rgb.g}, ${t.rgb.b})`,skinToneHex:t.hex,source:t.source||"v2_direct",confidence:t.confidence||"unknown",schema:t.schema,philosophy:"v2_strict_priority_success"}),{tone:t,source:"v2-direct"};g.debug("SKIN_TONE_RESOLUTION_V2","No V2 format found, checking legacy sources",{v2CandidatesChecked:n.length,philosophy:"v2_not_found_fallback_to_legacy"});const a=[e?.skinTone,e?.avatar?.skinTone,e?.preferences?.skinTone,e?.estimate?.photos_metadata?.[0]?.captureReport?.skin_tone,e?.estimate?.photos_metadata?.[1]?.captureReport?.skin_tone,e?.estimate?.photos_metadata?.[0]?.report?.skin_tone,e?.estimate?.photos_metadata?.[1]?.report?.skin_tone,e?.estimate?.extracted_data?.skin_tone,e?.commit?.data?.skin_tone,e?.match?.skin_tone,e?.semantic?.skin_tone].filter(Boolean),r=a.map(O).filter(Boolean);if(!r.length)return g.debug("SKIN_TONE_RESOLUTION_V2","No valid legacy skin tones found, using default",{legacyCandidatesChecked:a.length,philosophy:"no_legacy_skin_tone_available"}),{tone:k,source:"default"};const u=r.map(t=>t.r).sort((t,_)=>t-_),l=r.map(t=>t.g).sort((t,_)=>t-_),i=r.map(t=>t.b).sort((t,_)=>t-_),o=t=>t[t.length-1>>1],c=o(u),d=o(l),b=o(i),p=r.reduce((t,_)=>t+(_.pixelCount||0),0),s=v(c,d,b,"legacy_unified_median",Math.min(.95,.5+r.length*.1),p>0?p:void 0);return g.info("SKIN_TONE_RESOLUTION_V2","Legacy skin tone converted to V2",{skinToneRGB:`rgb(${s.rgb.r}, ${s.rgb.g}, ${s.rgb.b})`,skinToneHex:s.hex,source:s.source,confidence:s.confidence?.toFixed(3),candidatesUsed:r.length,srgbFloat:`rgb(${s.srgb_f32.r.toFixed(4)}, ${s.srgb_f32.g.toFixed(4)}, ${s.srgb_f32.b.toFixed(4)})`,linearFloat:`rgb(${s.linear_f32.r.toFixed(4)}, ${s.linear_f32.g.toFixed(4)}, ${s.linear_f32.b.toFixed(4)})`,philosophy:"legacy_to_v2_conversion_success"}),{tone:s,source:"legacy-converted"}}export{v as createCompleteSkinTone,N as isSkinToneV2,B as resolveSkinTone};
