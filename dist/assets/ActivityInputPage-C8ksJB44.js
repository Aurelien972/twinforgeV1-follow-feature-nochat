import{u as G,R as $,j as e,r as b,e as ae}from"./vendor-ZbFMzY-i.js";import{u as Y,l as h,s as te}from"./page-fridge-C1QVLxk9.js";import{u as X,S as c,I as o,G as B,t as ie}from"./ui-components-OHztaiDj.js";import{a as K}from"./stores-ZZM8MTtI.js";import{a as ne,u as le}from"./page-fridge-scan-C_CisW7P.js";import{u as U,C as H,b as R,e as oe,h as ce,v as de,i as se}from"./ActivityUtils-DMO4ntjB.js";import{m as z,A as ee}from"./motion-HGAT--uT.js";import"./utils-CUtLAp28.js";import"./supabase-8_3juhcZ.js";import"./date-utils-BlBdbPk_.js";const Q=[{id:"capture",title:"Capture de Mouvement",subtitle:"Enregistrez votre session √©nerg√©tique",icon:"Activity",color:"#3B82F6"},{id:"analysis",title:"Analyse de Forge",subtitle:"Traitement de votre empreinte √©nerg√©tique",icon:"Zap",color:"#06B6D4"},{id:"review",title:"Revue √ânerg√©tique",subtitle:"Validation et ajustement de vos donn√©es",icon:"Target",color:"#1D4ED8"},{id:"insights_generation",title:"G√©n√©ration d'Insights",subtitle:"Analyse avanc√©e de vos patterns d'activit√©",icon:"Lightbulb",color:"#8B5CF6"}];function ue(){const s=G(),{success:r,error:i}=Y(),{showToast:t}=X(),[a,n]=$.useState({currentStep:"capture",overallProgress:0,message:"Pr√™t √† forger votre √©nergie",subMessage:"Commencez par enregistrer votre session d'activit√©",isActive:!1,steps:Q}),l=$.useCallback((m="capture")=>{h.info("ACTIVITY_PIPELINE","Starting activity pipeline",{initialStep:m,timestamp:new Date().toISOString()});const C={capture:{message:"Forge √ânerg√©tique Activ√©e",subMessage:"D√©crivez votre session d'activit√© physique"},analysis:{message:"Analyse de Forge",subMessage:"Traitement de votre empreinte √©nerg√©tique"},review:{message:"Revue √ânerg√©tique",subMessage:"Validation et ajustement de vos donn√©es"},insights_generation:{message:"G√©n√©ration d'Insights √ânerg√©tiques",subMessage:"Analyse avanc√©e de vos patterns d'activit√©"}}[m];n(A=>({...A,isActive:!0,currentStep:m,overallProgress:0,message:C.message,subMessage:C.subMessage}))},[]),y=$.useCallback((m,N,C,A)=>{n(v=>({...v,currentStep:m,overallProgress:N,message:C,subMessage:A||""}))},[]),p=$.useCallback(m=>{n(N=>({...N,audioData:m}))},[]),S=$.useCallback(m=>{n(N=>({...N,transcriptionResult:m}))},[]),g=$.useCallback(m=>{n(N=>({...N,analysisResult:m}))},[]),f=$.useCallback(()=>{h.info("ACTIVITY_PIPELINE","Pipeline completed successfully",{activitiesCount:a.analysisResult?.activities?.length||0,totalCalories:a.analysisResult?.totalCalories||0,timestamp:new Date().toISOString()}),n(m=>({...m,isActive:!1,currentStep:"capture",overallProgress:0,message:"Pr√™t √† forger votre √©nergie",subMessage:"Commencez par enregistrer votre session d'activit√©",audioData:void 0,transcriptionResult:void 0,analysisResult:void 0})),r(),t({type:"success",title:"Forge √ânerg√©tique Compl√©t√©e",message:"Vos activit√©s ont √©t√© enregistr√©es avec succ√®s",duration:4e3}),setTimeout(()=>{s("/activity#daily")},1e3)},[a.analysisResult,r,t,s]),j=$.useCallback(()=>{h.info("ACTIVITY_PIPELINE","Pipeline cancelled by user",{currentStep:a.currentStep,progress:a.overallProgress,timestamp:new Date().toISOString()}),n(m=>({...m,isActive:!1,currentStep:"capture",overallProgress:0,message:"Pr√™t √† forger votre √©nergie",subMessage:"Commencez par enregistrer votre session d'activit√©",audioData:void 0,transcriptionResult:void 0,analysisResult:void 0})),s("/activity")},[a.currentStep,a.overallProgress,s]),_=$.useCallback((m,N)=>{h.error("ACTIVITY_PIPELINE","Pipeline error occurred",{error:m,step:N,timestamp:new Date().toISOString()}),i(),t({type:"error",title:"Erreur de la Forge",message:m,duration:5e3});const C=Q.findIndex(v=>v.id===N),A=C>0?Q[C-1].id:"capture";n(v=>({...v,currentStep:A,overallProgress:Math.max(0,v.overallProgress-33),message:"Erreur de Forge - R√©essayez",subMessage:"Une erreur est survenue, veuillez r√©essayer"}))},[i,t]);return{state:a,actions:{startPipeline:l,setStep:y,setAudioData:p,setTranscriptionResult:S,setAnalysisResult:g,completePipeline:f,cancelPipeline:j,handleError:_}}}const me=({hasConnectedWearable:s,connectedDevicesCount:r,selectedInputMode:i,onModeChange:t,loading:a=!1})=>{const n=G(),{click:l}=Y(),y=()=>{l(),s?t("wearable"):n("/settings?tab=appareils")},p=i==="wearable";return a?e.jsx("div",{className:"capture-mode-button-3d opacity-50",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"capture-mode-icon-3d capture-mode-icon-3d-success",children:e.jsx(c,{Icon:o.Loader2,size:32,className:"text-white/60 animate-spin",variant:"pure"})}),e.jsx("h4",{className:"text-white font-bold text-lg",children:"Chargement..."})]}),e.jsx("p",{className:"text-white/70 text-sm text-left",children:"V√©rification de vos appareils"})]})}):s?e.jsx("button",{onClick:y,className:`capture-mode-button-3d ${p?"capture-mode-button-3d-active capture-mode-button-3d-active-success":""}`,children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"capture-mode-icon-3d capture-mode-icon-3d-success relative",children:[e.jsx(c,{Icon:o.Watch,size:32,style:{color:p?"#22C55E":"rgba(255, 255, 255, 0.6)"},variant:"pure"}),e.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 rounded-full bg-green-400 border-2 border-white/20",style:{boxShadow:"0 0 12px rgba(34, 197, 94, 0.6)"}})]}),e.jsx("h4",{className:"text-white font-bold text-lg",children:"Montre Connect√©e"})]}),e.jsxs("p",{className:"text-white/70 text-sm text-left",children:[r," appareil",r>1?"s":""," connect√©",r>1?"s":""]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-left",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400 animate-pulse"}),e.jsx("span",{className:"text-green-300",children:"Synchronisation active"})]})]})}):e.jsx("button",{onClick:y,className:`capture-mode-button-3d ${p?"capture-mode-button-3d-active capture-mode-button-3d-active-info":""}`,children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"capture-mode-icon-3d capture-mode-icon-3d-info",children:e.jsx(c,{Icon:o.Watch,size:32,style:{color:p?"#0EA5E9":"rgba(255, 255, 255, 0.6)"},variant:"pure"})}),e.jsx("h4",{className:"text-white font-bold text-lg",children:"Montre Connect√©e"}),e.jsx("div",{className:"flex-1"}),e.jsx(c,{Icon:o.ChevronRight,size:24,className:"text-white/40"})]}),e.jsx("p",{className:"text-white/70 text-sm text-left",children:"Connectez votre montre pour un tracking automatique"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-left",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-sky-400"}),e.jsx("span",{className:"text-sky-300",children:"Tracking automatique et pr√©cis"})]})]})})},xe=({selectedInputMode:s,onInputModeChange:r,hasConnectedWearable:i,connectedDevicesCount:t,loading:a=!1})=>{const{click:n}=Y(),l=p=>{n(),r(p),setTimeout(()=>{const S=document.querySelector(".capture-input-interface");S&&S.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100)},y=()=>s==="wearable"?"Vos activit√©s sont automatiquement synchronis√©es depuis votre montre connect√©e":s==="audio"?"Votre enregistrement sera analys√© par notre Forge IA pour extraire automatiquement les activit√©s, dur√©es et calories br√ªl√©es":s==="text"?"Votre description sera analys√©e par notre Forge IA pour extraire automatiquement les activit√©s, dur√©es et calories br√ªl√©es":"Choisissez votre m√©thode pr√©f√©r√©e pour enregistrer vos activit√©s";return e.jsx(e.Fragment,{children:e.jsxs(B,{className:"p-6 capture-stage-card",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"capture-mode-selector",children:[e.jsx(me,{hasConnectedWearable:i,connectedDevicesCount:t,selectedInputMode:s,onModeChange:l,loading:a}),e.jsx("button",{onClick:()=>l("audio"),className:`capture-mode-button-3d ${s==="audio"?"capture-mode-button-3d-active":""}`,children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"capture-mode-icon-3d capture-mode-icon-3d-primary",children:e.jsx(c,{Icon:o.Mic,size:32,style:{color:s==="audio"?"#3B82F6":"rgba(255, 255, 255, 0.6)"},variant:"pure"})}),e.jsx("h4",{className:"text-white font-bold text-lg",children:"Enregistrement Vocal"})]}),e.jsx("p",{className:"text-white/70 text-sm text-left",children:"D√©crivez votre activit√© √† voix haute"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-left",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400"}),e.jsx("span",{className:"text-green-300",children:"Rapide et naturel"})]})]})}),e.jsx("button",{onClick:()=>l("text"),className:`capture-mode-button-3d ${s==="text"?"capture-mode-button-3d-active capture-mode-button-3d-active-accent":""}`,children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"capture-mode-icon-3d capture-mode-icon-3d-accent",children:e.jsx(c,{Icon:o.FileText,size:32,style:{color:s==="text"?"#8B5CF6":"rgba(255, 255, 255, 0.6)"},variant:"pure"})}),e.jsx("h4",{className:"text-white font-bold text-lg",children:"Saisie Manuelle"})]}),e.jsx("p",{className:"text-white/70 text-sm text-left",children:"√âcrivez votre description d'activit√©"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-left",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-400"}),e.jsx("span",{className:"text-purple-300",children:"Pr√©cis et d√©taill√©"})]})]})})]}),!a&&!i&&e.jsx("div",{className:"mt-3 px-3 py-2 rounded-xl text-xs font-medium text-center",style:{background:"color-mix(in srgb, #64748B 10%, transparent)",border:"1px solid color-mix(in srgb, #64748B 20%, transparent)",color:"#94A3B8"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(c,{Icon:o.WifiOff,size:12,style:{color:"#94A3B8"}}),e.jsx("span",{children:"Aucun objet connect√©"})]})})]}),e.jsx("div",{className:"p-4 rounded-xl",style:{background:"color-mix(in srgb, var(--color-plasma-cyan) 8%, transparent)",border:"1px solid color-mix(in srgb, var(--color-plasma-cyan) 20%, transparent)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{background:"color-mix(in srgb, var(--color-plasma-cyan) 15%, transparent)",border:"1px solid color-mix(in srgb, var(--color-plasma-cyan) 25%, transparent)"},children:e.jsx(c,{Icon:o.Zap,size:16,style:{color:"var(--color-plasma-cyan)"}})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h5",{className:"text-cyan-300 font-semibold text-sm",children:"Forge IA Intelligente"}),e.jsx("p",{className:"text-cyan-200 text-xs",children:y()})]})]})})]})})},pe=({isRecording:s,recordingDuration:r,audioBlob:i,onStartRecording:t,onStopRecording:a,onProcessAudio:n,isProcessing:l})=>{const{click:y}=Y(),p=U(),S=b.useRef(null);b.useEffect(()=>{if(S.current){const j=`activity-perf-${p.mode}`;return S.current.classList.add(j),()=>{S.current?.classList.remove(j)}}},[p.mode]);const g=j=>{const _=Math.floor(j/60),m=j%60;return`${_}:${m.toString().padStart(2,"0")}`},f=()=>{y(),s?a():i||t()};return e.jsx("div",{ref:S,children:e.jsx(B,{className:"capture-audio-container capture-stage-card capture-input-interface",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"relative flex items-center justify-center",children:[e.jsx("button",{className:`capture-audio-visualizer-3d ${s?"capture-audio-visualizer-recording-3d":"capture-audio-visualizer-idle-3d"}`,onClick:f,"aria-label":s?"Arr√™ter l'enregistrement":"D√©marrer l'enregistrement",children:e.jsx("div",{className:"capture-audio-icon-wrapper",children:e.jsx(c,{Icon:s?o.Square:o.Mic,size:56,style:{color:s?"#EF4444":"#3B82F6"},variant:"pure"})})}),s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"capture-audio-ring-1"}),e.jsx("div",{className:"capture-audio-ring-2"}),e.jsx("div",{className:"capture-audio-ring-3"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-3xl font-bold text-white",children:s?"Enregistrement en cours...":"Parlez dans le Micro"}),e.jsx("p",{className:"text-white/80 text-lg leading-relaxed max-w-md mx-auto",children:s?"D√©crivez votre session d'activit√© physique en cours...":"Cliquez sur le microphone pour commencer √† d√©crire votre activit√©"})]}),s&&e.jsx(H,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:p.transitionDuration},className:"text-center",fallback:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"capture-audio-status",children:[e.jsx("div",{className:"capture-audio-status-indicator"}),e.jsx("span",{className:"capture-audio-timer",children:g(r)})]})}),children:e.jsxs("div",{className:"capture-audio-status",children:[e.jsx("div",{className:"capture-audio-status-indicator"}),e.jsx("span",{className:"capture-audio-timer",children:g(r)})]})}),e.jsxs("div",{className:"flex justify-center gap-4",children:[s&&e.jsx("button",{onClick:a,className:"capture-action-button-3d capture-action-button-3d-danger",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(c,{Icon:o.Square,size:24,className:"text-white"}),e.jsx("span",{children:"Terminer l'Enregistrement"})]})}),i&&!s&&!l&&e.jsx("button",{onClick:n,className:"capture-action-button-3d capture-action-button-3d-success",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(c,{Icon:o.Zap,size:24,className:"text-white"}),e.jsx("span",{children:"Processer ma Forge"})]})})]}),!s&&!i&&e.jsxs("div",{className:"mt-4 p-4 rounded-xl",style:{background:"color-mix(in srgb, #3B82F6 8%, transparent)",border:"1px solid color-mix(in srgb, #3B82F6 20%, transparent)"},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{background:"color-mix(in srgb, #3B82F6 15%, transparent)",border:"1px solid color-mix(in srgb, #3B82F6 25%, transparent)"},children:e.jsx(c,{Icon:o.Mic,size:16,style:{color:"#3B82F6"}})}),e.jsx("h4",{className:"text-blue-300 font-semibold text-sm",children:"Cliquez sur le microphone pour commencer"})]}),e.jsxs("div",{className:"text-blue-200 text-sm space-y-1 text-left",children:[e.jsx("p",{children:"‚Ä¢ Cliquez une fois pour d√©marrer l'enregistrement"}),e.jsx("p",{children:"‚Ä¢ Parlez clairement en d√©crivant vos activit√©s"}),e.jsx("p",{children:"‚Ä¢ Cliquez √† nouveau pour arr√™ter l'enregistrement"}),e.jsx("p",{children:"‚Ä¢ Puis traitez votre enregistrement avec le bouton vert"})]})]})]})})})},ge=({textInput:s,onTextInputChange:r,onProcessText:i,isProcessing:t})=>{const{showToast:a}=X(),n=()=>{if(!s.trim()){a({type:"error",title:"Texte requis",message:"Veuillez d√©crire votre activit√© avant de continuer",duration:3e3});return}if(s.trim().length<10){a({type:"warning",title:"Description trop courte",message:"Ajoutez plus de d√©tails sur votre activit√© pour une analyse pr√©cise",duration:3e3});return}i(s.trim())};return e.jsx(B,{className:"capture-text-container capture-stage-card capture-input-interface",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("div",{className:"capture-text-icon-3d",children:e.jsx("div",{className:"capture-text-icon-inner",children:e.jsx(c,{Icon:o.FileText,size:40,style:{color:"#8B5CF6"},variant:"pure"})})})}),e.jsx("h2",{className:"text-3xl font-bold text-white",children:"Saisie Manuelle"}),e.jsx("p",{className:"text-white/80 text-lg leading-relaxed max-w-md mx-auto",children:"D√©crivez votre session d'activit√© physique en d√©tail"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{htmlFor:"activity-description",className:"block text-white/90 text-sm font-medium text-left",children:"Description de votre activit√©"}),e.jsx("textarea",{id:"activity-description",value:s,onChange:l=>r(l.target.value),className:"capture-text-input",placeholder:"Ex: J'ai fait 30 minutes de course √† pied ce matin √† intensit√© mod√©r√©e, puis 10 minutes d'√©tirements pour r√©cup√©rer..."}),e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsx("span",{className:"text-white/60 text-left",children:s.length<10?"Ajoutez plus de d√©tails pour une analyse pr√©cise":"Description compl√®te"}),e.jsxs("span",{className:`font-medium ${s.length<10?"text-orange-400":s.length<50?"text-yellow-400":"text-green-400"}`,children:[s.length," caract√®res"]})]})]}),s.trim()&&!t&&e.jsx(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex justify-center",children:e.jsx("button",{onClick:n,className:"capture-action-button-3d capture-action-button-3d-primary",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(c,{Icon:o.Zap,size:24,className:"text-white"}),e.jsx("span",{children:"Processer ma Forge"})]})})}),e.jsxs("div",{className:"capture-text-hint",children:[e.jsxs("h4",{className:"text-purple-300 font-semibold mb-2 flex items-center gap-2",children:[e.jsx(c,{Icon:o.Info,size:16,style:{color:"#8B5CF6"}}),"Conseils pour une Description Optimale"]}),e.jsxs("div",{className:"text-purple-200 text-sm space-y-1 text-left",children:[e.jsx("p",{children:"‚Ä¢ D√©crivez clairement chaque activit√© et sa dur√©e"}),e.jsx("p",{children:"‚Ä¢ Pr√©cisez l'intensit√© (facile, mod√©r√©, intense, tr√®s intense)"}),e.jsx("p",{children:"‚Ä¢ Ajoutez des d√©tails sur le contexte (matin, soir, etc.)"}),e.jsx("p",{children:'‚Ä¢ Exemple : "Course 45min intense + √©tirements 10min"'})]})]})]})})},he=({connectedDevicesCount:s})=>{const r=G(),{click:i}=Y(),{session:t}=K(),{devices:a,loading:n,syncing:l,syncDevice:y}=ne(t?.user?.id||null),p=()=>{i(),r("/settings")},S=async()=>{if(i(),a.length>0)try{await y(a[0].id)}catch(g){console.error("Sync failed:",g)}};return e.jsx(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.4,ease:[.4,0,.2,1]},className:"space-y-4 capture-input-interface",children:e.jsx(B,{className:"p-6",children:e.jsxs("div",{className:"text-center space-y-6",children:[e.jsxs("div",{className:"relative inline-block",children:[e.jsxs("div",{className:"w-24 h-24 mx-auto rounded-full flex items-center justify-center relative",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(34, 197, 94, 0.25) 0%, transparent 60%),
                  linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(34, 197, 94, 0.05))
                `,border:"2px solid rgba(34, 197, 94, 0.3)",boxShadow:"0 0 40px rgba(34, 197, 94, 0.2)"},children:[e.jsx(c,{Icon:o.Watch,size:48,style:{color:"#22C55E"}}),e.jsx("div",{className:"absolute -top-1 -right-1 w-6 h-6 rounded-full bg-green-400 border-2 border-white/20 flex items-center justify-center",style:{boxShadow:"0 0 16px rgba(34, 197, 94, 0.6)"},children:e.jsx("span",{className:"text-white text-xs font-bold",children:s})})]}),[...Array(3)].map((g,f)=>{const j=f*120-90,_=50,m=Math.cos(j*Math.PI/180)*_,N=Math.sin(j*Math.PI/180)*_;return e.jsx(z.div,{className:"absolute w-2 h-2 rounded-full bg-green-400",style:{left:"50%",top:"50%",marginLeft:"-4px",marginTop:"-4px",boxShadow:"0 0 12px rgba(34, 197, 94, 0.8)"},animate:{x:[0,m,0],y:[0,N,0],opacity:[.8,0,.8]},transition:{duration:2,repeat:1/0,delay:f*.66,ease:"easeInOut"}},f)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:"Synchronisation Active"}),e.jsx("p",{className:"text-white/70 text-base",children:"Vos activit√©s sont automatiquement track√©es par votre montre connect√©e"})]}),!n&&a.length>0&&e.jsx("div",{className:"space-y-3",children:a.slice(0,3).map(g=>e.jsx("div",{className:"p-4 rounded-xl text-left",style:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center",style:{background:"linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(34, 197, 94, 0.1))",border:"1px solid rgba(34, 197, 94, 0.3)"},children:e.jsx(c,{Icon:o.Watch,size:20,style:{color:"#22C55E"}})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-white font-semibold text-sm",children:g.displayName||g.provider.toUpperCase()}),e.jsx("p",{className:"text-white/50 text-xs",children:g.lastSyncAt?`Derni√®re synchro: ${new Date(g.lastSyncAt).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})}`:"Pas encore synchronis√©"})]}),e.jsxs("div",{className:"px-2 py-1 rounded-full text-xs",style:{background:"rgba(34, 197, 94, 0.15)",border:"1px solid rgba(34, 197, 94, 0.3)",color:"#22C55E"},children:[g.status==="connected"&&"Connect√©",g.status==="syncing"&&"Synchro...",g.status==="error"&&"Erreur"]})]})},g.id))}),e.jsx("div",{className:"p-4 rounded-xl",style:{background:"color-mix(in srgb, var(--color-plasma-cyan) 8%, transparent)",border:"1px solid color-mix(in srgb, var(--color-plasma-cyan) 20%, transparent)"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",style:{background:"color-mix(in srgb, var(--color-plasma-cyan) 15%, transparent)",border:"1px solid color-mix(in srgb, var(--color-plasma-cyan) 25%, transparent)"},children:e.jsx(c,{Icon:o.Info,size:16,style:{color:"var(--color-plasma-cyan)"}})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h5",{className:"text-cyan-300 font-semibold text-sm mb-1",children:"Tracking Automatique"}),e.jsx("p",{className:"text-cyan-200/80 text-xs leading-relaxed",children:"Vos activit√©s sont automatiquement enregistr√©es. Pas besoin de saisie manuelle ! Les donn√©es sont synchronis√©es en temps r√©el depuis votre montre."})]})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:S,disabled:l||n,className:"flex-1 px-6 py-3 rounded-xl font-semibold text-white transition-all duration-300",style:{background:l?"rgba(255, 255, 255, 0.1)":"linear-gradient(135deg, rgba(34, 197, 94, 0.3), rgba(34, 197, 94, 0.2))",border:"1px solid rgba(34, 197, 94, 0.4)",boxShadow:l?"none":"0 4px 16px rgba(34, 197, 94, 0.2)"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(c,{Icon:o.RefreshCw,size:20,className:l?"animate-spin":""}),e.jsx("span",{children:l?"Synchronisation...":"Synchroniser maintenant"})]})}),e.jsx("button",{onClick:p,className:"px-6 py-3 rounded-xl font-semibold text-white transition-all duration-300",style:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.15)"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(c,{Icon:o.Settings,size:20}),e.jsx("span",{children:"G√©rer"})]})})]})]})})},"wearable-interface")},be=({isRecording:s,recordingDuration:r,audioBlob:i,onStartRecording:t,onStopRecording:a,onProcessAudio:n,onProcessText:l,isProcessing:y,selectedInputMode:p,onInputModeChange:S})=>{const[g,f]=b.useState(""),{hasConnectedWearable:j,connectedDevicesCount:_,loading:m}=le();b.useEffect(()=>{!m&&j&&p===null&&S("wearable")},[j,m,p,S]);const N=v=>{f(v)},C=v=>{l(v)},A=[{id:"wearable",icon:"Watch",color:"#22C55E",title:"Objet Connect√©",description:"Synchronisation automatique recommand√©e"},{id:"daily",icon:"Calendar",color:"#3B82F6",title:"Saisie Quotidienne",description:"Recommand√© si pas d'objet connect√©"},{id:"insights",icon:"Zap",color:"#8B5CF6",title:"Insights IA",description:"Analyse et recommandations personnalis√©es"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(xe,{selectedInputMode:p,onInputModeChange:S,hasConnectedWearable:j,connectedDevicesCount:_,loading:m}),e.jsxs(ee,{mode:"wait",children:[p==="wearable"&&e.jsx(he,{connectedDevicesCount:_},"wearable-interface"),p==="audio"&&e.jsx(pe,{isRecording:s,recordingDuration:r,audioBlob:i,onStartRecording:t,onStopRecording:a,onProcessAudio:n,isProcessing:y},"audio-interface"),p==="text"&&e.jsx(ge,{textInput:g,onTextInputChange:N,onProcessText:C,isProcessing:y},"text-interface")]}),e.jsx(ie,{benefits:A,themeColor:"#3B82F6",title:"Pourquoi tracker mes activit√©s ?"})]})},ye=({progress:s})=>{const r=U(),i=b.useRef(null);b.useEffect(()=>{if(i.current){const a=`activity-perf-${r.mode}`;return i.current.classList.add(a),()=>{i.current?.classList.remove(a)}}},[r.mode]);const t={primary:"#3B82F6",secondary:"#06B6D4"};return e.jsxs("div",{className:"analysis-icon-container",ref:i,children:[e.jsx("div",{className:`analysis-icon-ring ${r.enablePulseEffects?"analysis-icon-pulse":""}`}),e.jsx("div",{className:"analysis-icon-inner",children:e.jsx(c,{Icon:o.Zap,size:48,style:{color:t.primary,filter:r.enableGlows?`
              drop-shadow(0 0 12px color-mix(in srgb, ${t.primary} 90%, transparent))
              drop-shadow(0 0 24px color-mix(in srgb, ${t.primary} 70%, transparent))
              drop-shadow(0 0 36px color-mix(in srgb, ${t.secondary} 50%, transparent))
            `:"none"},variant:"pure"})})]})},ve=({progress:s})=>{const r=U(),i=b.useRef(null);b.useEffect(()=>{if(i.current){const a=`activity-perf-${r.mode}`;return i.current.classList.add(a),()=>{i.current?.classList.remove(a)}}},[r.mode]);const t=Math.min(100,Math.max(0,s));return e.jsxs("div",{className:"analysis-progress-container",ref:i,children:[e.jsx("div",{className:"analysis-progress-bar",children:e.jsx(H,{className:"analysis-progress-fill",style:{width:`${t}%`},initial:{width:0},animate:{width:`${t}%`},transition:{duration:r.transitionDuration*1.5,ease:"easeOut"},fallback:e.jsx("div",{className:"analysis-progress-fill",style:{width:`${t}%`,transition:`width ${r.transitionDuration*1.5}s ease-out`},children:r.enableShimmers&&e.jsx("div",{className:"analysis-progress-shimmer"})}),children:r.enableShimmers&&e.jsx("div",{className:"analysis-progress-shimmer"})})}),e.jsxs("span",{className:"analysis-progress-percentage",children:[Math.round(t),"%"]})]})},fe=({progress:s})=>{const r=U(),i=b.useRef(null);b.useEffect(()=>{if(i.current){const a=`activity-perf-${r.mode}`;return i.current.classList.add(a),()=>{i.current?.classList.remove(a)}}},[r.mode]);const t=[{icon:"Volume2",label:"D√©codage √ânerg√©tique",sublabel:"Extraction des donn√©es vocales",color:"#3B82F6",active:s>=10},{icon:"Target",label:"Analyse de Mouvement",sublabel:"Identification des activit√©s",color:"#06B6D4",active:s>=40},{icon:"Zap",label:"Calcul √ânerg√©tique",sublabel:"Optimisation des m√©triques",color:"#10B981",active:s>=70}];return e.jsx("div",{className:"analysis-modules-container",ref:i,children:t.map((a,n)=>{const l=`analysis-module ${a.active?"analysis-module-active":""}`;return e.jsxs(H,{className:l,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:r.transitionDuration,delay:n*r.staggerDelay},fallback:e.jsxs("div",{className:l,children:[e.jsx("div",{className:"analysis-module-icon",children:e.jsx(c,{Icon:o[a.icon],size:20,style:{color:a.color},variant:"pure"})}),e.jsx("div",{className:"analysis-module-title",children:a.label}),e.jsx("div",{className:"analysis-module-status",children:a.sublabel})]}),children:[e.jsx("div",{className:"analysis-module-icon",children:e.jsx(c,{Icon:o[a.icon],size:20,style:{color:a.color},variant:"pure"})}),e.jsx("div",{className:"analysis-module-title",children:a.label}),e.jsx("div",{className:"analysis-module-status",children:a.sublabel})]},a.label)})})},je=()=>{const s=U(),r=b.useRef(null);return b.useEffect(()=>{if(r.current){const i=`activity-perf-${s.mode}`;return r.current.classList.add(i),()=>{r.current?.classList.remove(i)}}},[s.mode]),s.enableComplexEffects?e.jsx("div",{className:"analysis-effects-container",ref:r,children:s.enableParticles&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"analysis-particle",style:{left:"10%",top:"20%"}}),e.jsx("div",{className:"analysis-particle",style:{left:"30%",top:"60%"}}),e.jsx("div",{className:"analysis-particle",style:{left:"50%",top:"30%"}}),e.jsx("div",{className:"analysis-particle",style:{left:"70%",top:"70%"}}),e.jsx("div",{className:"analysis-particle",style:{left:"85%",top:"40%"}}),e.jsx("div",{className:"analysis-particle",style:{left:"20%",top:"80%"}})]})}):null},Ne=({isProcessing:s,progress:r,currentMessage:i,subMessage:t})=>{const a=U(),n=b.useRef(null);return b.useEffect(()=>{if(n.current){const l=`activity-perf-${a.mode}`;return n.current.classList.add(l),()=>{n.current?.classList.remove(l)}}},[a.mode]),e.jsx("div",{className:"space-y-6 relative overflow-hidden analysis-stage-container",ref:n,children:e.jsxs(B,{className:"p-8 text-center relative overflow-hidden analysis-stage-card",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, #3B82F6 8%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, color-mix(in srgb, #06B6D4 6%, transparent) 0%, transparent 50%),
            linear-gradient(145deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06)),
            var(--glass-opacity)
          `,borderColor:"color-mix(in srgb, #3B82F6 25%, transparent)",boxShadow:`
            0 20px 60px rgba(0, 0, 0, 0.35),
            0 0 25px color-mix(in srgb, #3B82F6 12%, transparent),
            inset 0 1px 0 rgba(255, 255, 255, 0.20)
          `,backdropFilter:"blur(24px) saturate(150%)",WebkitBackdropFilter:"blur(24px) saturate(150%)"},children:[e.jsx(je,{}),e.jsxs("div",{className:"space-y-6 relative z-10",children:[e.jsx(ye,{progress:r}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-3xl font-bold text-white mb-2",children:i||"Analyse de Forge en Cours"}),e.jsx("p",{className:"text-white/80 text-lg leading-relaxed max-w-lg mx-auto",children:t||"Votre empreinte √©nerg√©tique est en cours de traitement par la Forge Spatiale"}),e.jsx(ve,{progress:r})]}),e.jsx(fe,{progress:r})]})]})})},Ie=()=>e.jsxs(B,{className:"p-6",style:{background:`
          radial-gradient(circle at 30% 20%, color-mix(in srgb, #06B6D4 8%, transparent) 0%, transparent 60%),
          var(--glass-opacity)
        `,borderColor:"color-mix(in srgb, #06B6D4 20%, transparent)",backdropFilter:"blur(16px) saturate(140%)"},children:[e.jsxs("h4",{className:"text-cyan-300 font-semibold mb-3 flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{background:"color-mix(in srgb, #06B6D4 15%, transparent)",border:"1px solid color-mix(in srgb, #06B6D4 25%, transparent)"},children:e.jsx(c,{Icon:o.Info,size:14,style:{color:"#06B6D4"}})}),"Processus de la Forge Spatiale"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-400 mt-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-blue-300 font-medium",children:"D√©codage √ânerg√©tique"}),e.jsx("div",{className:"text-blue-200 text-xs",children:"Transformation de votre voix en donn√©es structur√©es"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-cyan-400 mt-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-cyan-300 font-medium",children:"Analyse de Mouvement"}),e.jsx("div",{className:"text-cyan-200 text-xs",children:"Identification pr√©cise de vos activit√©s physiques"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-400 mt-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-green-300 font-medium",children:"Calcul √ânerg√©tique"}),e.jsx("div",{className:"text-green-200 text-xs",children:"Estimation des calories et m√©triques de performance"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-purple-400 mt-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-purple-300 font-medium",children:"Optimisation Forge"}),e.jsx("div",{className:"text-purple-200 text-xs",children:"Personnalisation selon votre profil √©nerg√©tique"})]})]})]})]})]}),we=({progress:s,currentMessage:r,subMessage:i})=>{const t={primary:"#3B82F6"},a=()=>s<20?"Initialisation de la Forge √ânerg√©tique...":s<40?"D√©codage de votre empreinte √©nerg√©tique...":s<60?"Analyse des patterns de mouvement...":s<80?"Calcul des m√©triques √©nerg√©tiques...":"Finalisation de l'analyse de Forge...",n=Math.min(100,Math.max(0,s));return e.jsx("div",{className:"mt-8 p-6 rounded-xl",style:{background:`
        radial-gradient(circle at center, color-mix(in srgb, ${t.primary} 8%, transparent) 0%, transparent 70%),
        rgba(255,255,255,0.04)
      `,border:`1px solid color-mix(in srgb, ${t.primary} 20%, transparent)`,backdropFilter:"blur(8px) saturate(120%)"},children:e.jsxs("div",{className:"text-center",children:[e.jsxs("h4",{className:"text-white font-semibold mb-3 flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center",style:{background:`color-mix(in srgb, ${t.primary} 20%, transparent)`,border:`1px solid color-mix(in srgb, ${t.primary} 30%, transparent)`},children:e.jsx(c,{Icon:o.Zap,size:12,style:{color:t.primary}})}),"Forge √ânerg√©tique Active"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-white mb-1",children:a().includes("Initialisation")?"üîÑ":a().includes("D√©codage")?"üé§":a().includes("Analyse")?"‚ö°":a().includes("Calcul")?"üî•":"‚ú®"}),e.jsx("div",{className:"text-xs text-white/60",children:"Phase Active"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-bold",style:{color:t.primary},children:[Math.round(n),"%"]}),e.jsx("div",{className:"text-xs text-white/60",children:"Progression"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-white mb-1",children:s<50?"‚è≥":s<80?"‚ö°":"üéØ"}),e.jsx("div",{className:"text-xs text-white/60",children:"Statut"})]})]})]})})},Ce=({isProcessing:s,progress:r,currentMessage:i,subMessage:t})=>e.jsxs("div",{className:"space-y-6 relative overflow-hidden",children:[e.jsx(Ne,{isProcessing:s,progress:r,currentMessage:i,subMessage:t}),e.jsx(we,{progress:r,currentMessage:i,subMessage:t}),e.jsx(Ie,{}),e.jsx("style",{children:`
        @keyframes energyScanVertical {
          0%, 100% { transform: translateY(-100%); opacity: 0; }
          10%, 90% { opacity: 0.6; }
          50% { transform: translateY(0); opacity: 1; }
        }

        @keyframes energyParticleFloat {
          0%, 100% { transform: translateY(0) scale(1); opacity: 0.6; }
          25% { transform: translateY(-8px) scale(1.2); opacity: 1; }
          50% { transform: translateY(-4px) scale(0.9); opacity: 0.8; }
          75% { transform: translateY(-12px) scale(1.1); opacity: 1; }
        }

        @keyframes energyGridPulse {
          0%, 100% { opacity: 0.2; }
          50% { opacity: 0.4; }
        }

        @keyframes energyPulse {
          0%, 100% { opacity: 1; transform: scale(1); }
          50% { opacity: 0.7; transform: scale(1.2); }
        }

        @keyframes energyShimmer {
          0% { transform: translateX(-100%); }
          100% { transform: translateX(200%); }
        }

        @keyframes energyFlow {
          0% { transform: translateX(-100%); opacity: 0; }
          50% { opacity: 1; }
          100% { transform: translateX(100%); opacity: 0; }
        }
      `})]}),Se=({activities:s,totalCalories:r,totalDuration:i})=>e.jsxs(B,{className:"p-8 text-center",style:{background:`
          radial-gradient(circle at 30% 20%, color-mix(in srgb, var(--color-ember-copper) 15%, transparent) 0%, transparent 60%),
          radial-gradient(circle at 70% 80%, color-mix(in srgb, #F59E0B 12%, transparent) 0%, transparent 50%),
          var(--glass-opacity)
        `,borderColor:"color-mix(in srgb, var(--color-ember-copper) 30%, transparent)",boxShadow:`
          0 12px 40px rgba(0, 0, 0, 0.25),
          0 0 30px color-mix(in srgb, var(--color-ember-copper) 20%, transparent),
          0 0 60px color-mix(in srgb, #F59E0B 15%, transparent),
          inset 0 2px 0 rgba(255, 255, 255, 0.15)
        `},children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"w-24 h-24 mx-auto mb-6 rounded-full flex items-center justify-center breathing-icon",style:{background:`
              radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
              radial-gradient(circle at 70% 70%, color-mix(in srgb, var(--color-ember-copper) 20%, transparent) 0%, transparent 50%),
              linear-gradient(135deg, color-mix(in srgb, var(--color-ember-copper) 45%, transparent), color-mix(in srgb, #F59E0B 35%, transparent))
            `,border:"3px solid color-mix(in srgb, var(--color-ember-copper) 70%, transparent)",boxShadow:`
              0 0 40px color-mix(in srgb, var(--color-ember-copper) 70%, transparent),
              0 0 80px color-mix(in srgb, var(--color-ember-copper) 50%, transparent),
              0 0 120px color-mix(in srgb, #F59E0B 40%, transparent),
              inset 0 4px 0 rgba(255,255,255,0.5),
              inset 0 -2px 0 rgba(0,0,0,0.2)
            `,backdropFilter:"blur(20px) saturate(170%)",WebkitBackdropFilter:"blur(20px) saturate(170%)"},children:e.jsx(c,{Icon:o.Fire,size:48,style:{color:"var(--color-ember-copper)",filter:`
                drop-shadow(0 0 12px color-mix(in srgb, var(--color-ember-copper) 90%, transparent))
                drop-shadow(0 0 24px color-mix(in srgb, var(--color-ember-copper) 70%, transparent))
                drop-shadow(0 0 36px color-mix(in srgb, #F59E0B 50%, transparent))
              `},variant:"pure"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-baseline justify-center gap-2",children:[e.jsx("span",{className:"text-6xl md:text-7xl font-black leading-none",style:{color:"var(--color-ember-copper)",textShadow:`
                  0 0 20px color-mix(in srgb, var(--color-ember-copper) 60%, transparent),
                  0 0 40px color-mix(in srgb, var(--color-ember-copper) 40%, transparent),
                  0 0 60px color-mix(in srgb, #F59E0B 30%, transparent)
                `,letterSpacing:"-0.02em"},children:r}),e.jsx("span",{className:"text-2xl font-bold mb-2",style:{color:"color-mix(in srgb, var(--color-ember-copper) 80%, white)",textShadow:"0 0 12px color-mix(in srgb, var(--color-ember-copper) 40%, transparent)"},children:"kcal"})]}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"√ânergie Forg√©e"}),e.jsx("p",{className:"text-white/80 text-lg",children:"Votre session √©nerg√©tique a √©t√© analys√©e avec succ√®s"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6 max-w-md mx-auto",children:[e.jsxs("div",{className:"text-center p-6 rounded-xl",style:{background:"color-mix(in srgb, #22C55E 10%, transparent)",border:"1px solid color-mix(in srgb, #22C55E 20%, transparent)",backdropFilter:"blur(12px) saturate(130%)"},children:[e.jsx("div",{className:"text-3xl font-bold text-green-400 mb-2",children:s.length}),e.jsx("div",{className:"text-green-300 text-sm font-medium",children:"Activit√©s"}),e.jsx("div",{className:"text-white/60 text-xs mt-1",children:"Forg√©es"})]}),e.jsxs("div",{className:"text-center p-6 rounded-xl",style:{background:"color-mix(in srgb, #3B82F6 10%, transparent)",border:"1px solid color-mix(in srgb, #3B82F6 20%, transparent)",backdropFilter:"blur(12px) saturate(130%)"},children:[e.jsx("div",{className:"text-3xl font-bold text-blue-400 mb-2",children:i}),e.jsx("div",{className:"text-blue-300 text-sm font-medium",children:"Minutes"}),e.jsx("div",{className:"text-white/60 text-xs mt-1",children:"Actives"})]})]})]}),_e=({activities:s,updateActivity:r,removeActivity:i})=>e.jsx("div",{className:"space-y-4",children:s.map((t,a)=>e.jsx(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:a*.1},children:e.jsxs(B,{className:"p-6",style:{background:`
                radial-gradient(circle at 30% 20%, color-mix(in srgb, ${R(t.intensity)} 8%, transparent) 0%, transparent 60%),
                var(--glass-opacity)
              `,borderColor:`color-mix(in srgb, ${R(t.intensity)} 20%, transparent)`},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:{background:`
                      radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15) 0%, transparent 60%),
                      linear-gradient(135deg, color-mix(in srgb, ${R(t.intensity)} 30%, transparent), color-mix(in srgb, ${R(t.intensity)} 20%, transparent))
                    `,border:`2px solid color-mix(in srgb, ${R(t.intensity)} 40%, transparent)`,boxShadow:`0 0 20px color-mix(in srgb, ${R(t.intensity)} 30%, transparent)`},children:e.jsx(c,{Icon:o[oe(t.type)],size:20,style:{color:R(t.intensity)}})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-white font-bold text-lg",children:t.type}),e.jsxs("p",{className:"text-white/60 text-sm",children:["Intensit√© ",ce(t.intensity)]})]})]}),e.jsx("button",{onClick:()=>i(a),className:"p-2 rounded-full transition-all duration-200",style:{background:"rgba(239, 68, 68, 0.15)",border:"1px solid rgba(239, 68, 68, 0.3)"},title:"Supprimer cette activit√©",children:e.jsx(c,{Icon:o.Trash2,size:16,className:"text-red-400"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white/80 text-sm font-medium",children:"Dur√©e (minutes)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>r(a,{duration_min:Math.max(5,t.duration_min-5)}),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:e.jsx(c,{Icon:o.Minus,size:14,className:"text-white"})}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("div",{className:"text-white font-bold text-lg",children:t.duration_min}),e.jsx("div",{className:"text-white/60 text-xs",children:"min"})]}),e.jsx("button",{onClick:()=>r(a,{duration_min:Math.min(300,t.duration_min+5)}),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:e.jsx(c,{Icon:o.Plus,size:14,className:"text-white"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white/80 text-sm font-medium",children:"Intensit√©"}),e.jsxs("select",{value:t.intensity,onChange:n=>r(a,{intensity:n.target.value}),className:"glass-input w-full",children:[e.jsx("option",{value:"low",children:"Faible"}),e.jsx("option",{value:"medium",children:"Mod√©r√©e"}),e.jsx("option",{value:"high",children:"Intense"}),e.jsx("option",{value:"very_high",children:"Tr√®s Intense"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white/80 text-sm font-medium",children:"Calories"}),e.jsxs("div",{className:"text-center",children:[e.jsx(z.div,{initial:{scale:1.2,opacity:.8},animate:{scale:1,opacity:1},transition:{duration:.3,ease:"easeOut"},className:"text-2xl font-bold text-white",children:t.calories_est},t.calories_est),e.jsx("div",{className:"text-white/60 text-xs",children:"kcal br√ªl√©es"})]})]})]}),t.notes&&e.jsx("div",{className:"mt-4 p-3 rounded-xl",style:{background:`color-mix(in srgb, ${R(t.intensity)} 6%, transparent)`,border:`1px solid color-mix(in srgb, ${R(t.intensity)} 15%, transparent)`},children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(c,{Icon:o.FileText,size:14,style:{color:R(t.intensity)},className:"mt-0.5"}),e.jsx("p",{className:"text-white/80 text-sm",children:t.notes})]})})]})},a))}),Te=({showAddForm:s,setShowAddForm:r,newActivity:i,setNewActivity:t,addNewActivity:a,profile:n})=>e.jsx(ee,{children:s?e.jsx(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:e.jsxs(B,{className:"p-6",style:{background:`
                radial-gradient(circle at 30% 20%, color-mix(in srgb, #8B5CF6 8%, transparent) 0%, transparent 60%),
                var(--glass-opacity)
              `,borderColor:"color-mix(in srgb, #8B5CF6 25%, transparent)"},children:[e.jsxs("h4",{className:"text-white font-bold text-lg mb-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, #8B5CF6 30%, transparent), color-mix(in srgb, #8B5CF6 20%, transparent))
                  `,border:"2px solid color-mix(in srgb, #8B5CF6 40%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #8B5CF6 30%, transparent)"},children:e.jsx(c,{Icon:o.Plus,size:16,style:{color:"#8B5CF6"}})}),"Nouveau Mouvement"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Type d'activit√©"}),e.jsx("input",{type:"text",value:i.type||"",onChange:l=>t(y=>({...y,type:l.target.value})),className:"glass-input w-full",placeholder:"Ex: Course √† pied, Musculation..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Dur√©e (minutes)"}),e.jsx("input",{type:"number",value:i.duration_min||30,onChange:l=>t(y=>({...y,duration_min:parseInt(l.target.value)||30})),className:"glass-input w-full",min:"5",max:"300"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Intensit√©"}),e.jsxs("select",{value:i.intensity||"medium",onChange:l=>t(y=>({...y,intensity:l.target.value})),className:"glass-input w-full",children:[e.jsx("option",{value:"low",children:"Faible"}),e.jsx("option",{value:"medium",children:"Mod√©r√©e"}),e.jsx("option",{value:"high",children:"Intense"}),e.jsx("option",{value:"very_high",children:"Tr√®s Intense"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Notes (optionnel)"}),e.jsx("input",{type:"text",value:i.notes||"",onChange:l=>t(y=>({...y,notes:l.target.value})),className:"glass-input w-full",placeholder:"D√©tails suppl√©mentaires..."})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:a,className:"flex-1 add-form-submit-button-3d",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(c,{Icon:o.Check,size:16,className:"text-white"}),e.jsx("span",{children:"Ajouter"})]})}),e.jsx("button",{onClick:()=>{r(!1),t({type:"",duration_min:30,intensity:"medium",calories_est:0})},className:"add-form-cancel-button-3d",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{Icon:o.X,size:16}),e.jsx("span",{children:"Annuler"})]})})]})]})}):e.jsx(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:e.jsx("button",{onClick:()=>r(!0),className:"add-activity-cta-3d",children:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("div",{className:"add-activity-icon-3d",children:e.jsx(c,{Icon:o.Plus,size:20,style:{color:"#8B5CF6"}})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-semibold text-lg",children:"Ajouter un Mouvement"}),e.jsx("div",{className:"text-white/60 text-sm",children:"Enrichissez votre forge √©nerg√©tique"})]})]})})})}),ke=({forgeInsights:s})=>!s||s.length===0?null:e.jsxs(B,{className:"p-6",style:{background:`
          radial-gradient(circle at 30% 20%, color-mix(in srgb, #F59E0B 8%, transparent) 0%, transparent 60%),
          var(--glass-opacity)
        `,borderColor:"color-mix(in srgb, #F59E0B 20%, transparent)"},children:[e.jsxs("h4",{className:"text-white font-bold text-lg mb-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
              radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15) 0%, transparent 60%),
              linear-gradient(135deg, color-mix(in srgb, #F59E0B 30%, transparent), color-mix(in srgb, #F59E0B 20%, transparent))
            `,border:"2px solid color-mix(in srgb, #F59E0B 40%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #F59E0B 30%, transparent)"},children:e.jsx(c,{Icon:o.Lightbulb,size:16,style:{color:"#F59E0B"}})}),"Insights de la Forge"]}),e.jsx("div",{className:"space-y-3",children:s.map((r,i)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-xl",style:{background:"color-mix(in srgb, #F59E0B 6%, transparent)",border:"1px solid color-mix(in srgb, #F59E0B 15%, transparent)"},children:[e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center mt-0.5",style:{background:"color-mix(in srgb, #F59E0B 15%, transparent)",border:"1px solid color-mix(in srgb, #F59E0B 25%, transparent)"},children:e.jsx(c,{Icon:o.Zap,size:12,style:{color:"#F59E0B"}})}),e.jsx("p",{className:"text-white/80 text-sm flex-1",children:r})]},i))})]}),Ae=({onCancel:s,handleSave:r,isSaving:i,isEditing:t})=>e.jsxs(e.Fragment,{children:[t&&e.jsx(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex items-center justify-center gap-3 p-4 rounded-xl",style:{background:"color-mix(in srgb, #F59E0B 8%, transparent)",border:"1px solid color-mix(in srgb, #F59E0B 20%, transparent)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{background:"color-mix(in srgb, #F59E0B 15%, transparent)",border:"1px solid color-mix(in srgb, #F59E0B 25%, transparent)"},children:e.jsx(c,{Icon:o.Edit,size:14,style:{color:"#F59E0B"}})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-orange-300 font-semibold",children:"Modifications d√©tect√©es"}),e.jsx("div",{className:"text-orange-200 text-sm",children:"Vos ajustements seront sauvegard√©s"})]})]})}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx("button",{onClick:s,disabled:i,className:"px-6 py-3 text-lg font-semibold rounded-full",style:{background:"color-mix(in srgb, #6B7280 15%, transparent)",border:"1px solid color-mix(in srgb, #6B7280 25%, transparent)",color:"#9CA3AF",backdropFilter:"blur(12px) saturate(130%)"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{Icon:o.X,size:18}),e.jsx("span",{children:"Annuler"})]})}),e.jsx("button",{onClick:r,disabled:i,className:"px-8 py-3 text-lg font-bold rounded-full relative overflow-hidden",style:{background:`linear-gradient(135deg, 
              color-mix(in srgb, #22C55E 80%, transparent), 
              color-mix(in srgb, #10B981 60%, transparent)
            )`,border:"2px solid color-mix(in srgb, #22C55E 60%, transparent)",boxShadow:`
              0 12px 40px color-mix(in srgb, #22C55E 40%, transparent),
              0 0 60px color-mix(in srgb, #22C55E 30%, transparent),
              inset 0 3px 0 rgba(255,255,255,0.4)
            `,backdropFilter:"blur(20px) saturate(160%)",color:"#fff",transition:"all 0.2s ease",opacity:i?.7:1},children:e.jsxs("div",{className:"flex items-center gap-2",children:[i?e.jsx(c,{Icon:o.Loader2,size:20,className:"text-white animate-spin"}):e.jsx(c,{Icon:o.Save,size:20,className:"text-white"}),e.jsx("span",{children:i?"Sauvegarde...":"Enregistrer ma Forge"})]})})]})]}),Ee=({analysisResult:s,onComplete:r,onCancel:i})=>{const[t,a]=b.useState(s?.activities||[]),[n,l]=b.useState(!1),[y,p]=b.useState(!1),[S,g]=b.useState(!1),[f,j]=b.useState({type:"",duration_min:30,intensity:"medium",calories_est:0}),{success:_,click:m,error:N}=Y(),{showToast:C}=X(),{profile:A,session:v}=K(),O=ae(),L=t.reduce((d,u)=>d+u.calories_est,0),W=t.reduce((d,u)=>d+u.duration_min,0),Z=d=>{const u=A?.weight_kg||70;return se(d.type,d.intensity,d.duration_min,u)},I=(d,u)=>{a(k=>{const w=[...k];return w[d]={...w[d],...u},(u.duration_min!==void 0||u.intensity!==void 0)&&(w[d].calories_est=Z(w[d])),w}),l(!0)},F=d=>{a(u=>u.filter((k,w)=>w!==d)),l(!0)},V=()=>{if(!f.type||!f.duration_min){C({type:"error",title:"Informations manquantes",message:"Veuillez renseigner le type et la dur√©e de l'activit√©",duration:3e3});return}const d=de({type:f.type,duration_min:f.duration_min,intensity:f.intensity});if(!d.isValid){C({type:"error",title:"Donn√©es invalides",message:d.errors.join(", "),duration:4e3});return}const u=A?.weight_kg||70,k=se(f.type,f.intensity,f.duration_min,u),w={type:f.type,duration_min:f.duration_min,intensity:f.intensity,calories_est:k,notes:f.notes};a(x=>[...x,w]),j({type:"",duration_min:30,intensity:"medium",calories_est:0}),g(!1),l(!0),_(),C({type:"success",title:"Activit√© ajout√©e",message:"Nouvelle activit√© ajout√©e √† votre forge √©nerg√©tique",duration:3e3})},E=async()=>{if(!v?.user?.id){N(),C({type:"error",title:"Erreur d'authentification",message:"Vous devez √™tre connect√© pour sauvegarder",duration:4e3});return}if(t.length===0){N(),C({type:"error",title:"Aucune activit√© √† sauvegarder",message:"Ajoutez au moins une activit√© avant de sauvegarder",duration:3e3});return}p(!0);try{h.info("ACTIVITY_REVIEW","Saving activities to database",{userId:v.user.id,activitiesCount:t.length,totalCalories:L,totalDuration:W,activitiesData:t.map(x=>({type:x.type,duration_min:x.duration_min,intensity:x.intensity,calories_est:x.calories_est})),timestamp:new Date().toISOString()});const d=new Date().toISOString(),u=t.map(x=>({user_id:v.user.id,type:x.type,duration_min:x.duration_min,intensity:x.intensity,calories_est:x.calories_est,notes:x.notes||null,timestamp:d,created_at:d}));h.info("ACTIVITY_REVIEW","Prepared activities for database insertion",{userId:v.user.id,activitiesToSave:u,totalActivities:u.length,timestamp:new Date().toISOString()});const{data:k,error:w}=await te.from("activities").insert(u).select();if(w)throw h.error("ACTIVITY_REVIEW","Supabase insertion failed",{error:w.message,errorDetails:w,errorCode:w.code,errorHint:w.hint,userId:v.user.id,activitiesCount:t.length,timestamp:new Date().toISOString()}),w;h.info("ACTIVITY_REVIEW","Activities saved successfully",{userId:v.user.id,savedCount:k?.length||0,savedActivities:k?.map(x=>({id:x.id,type:x.type,duration_min:x.duration_min,calories_est:x.calories_est,timestamp:x.timestamp})),timestamp:new Date().toISOString()}),k&&k.length>0&&(h.info("ACTIVITY_REVIEW","Starting async wearable goals sync",{userId:v.user.id,activitiesCount:k.length,timestamp:new Date().toISOString()}),Promise.allSettled(k.map(async x=>{try{const D=new Promise((J,re)=>setTimeout(()=>re(new Error("Sync timeout after 5s")),5e3)),P=te.functions.invoke("sync-wearable-goals",{body:{activity_id:x.id,user_id:v.user.id}}),{data:q,error:M}=await Promise.race([P,D]);M?h.warn("ACTIVITY_REVIEW","Failed to sync wearable goals (non-blocking)",{activityId:x.id,error:M.message,timestamp:new Date().toISOString()}):h.info("ACTIVITY_REVIEW","Wearable goals synced successfully",{activityId:x.id,goalsUpdated:q?.goals_updated||0,timestamp:new Date().toISOString()})}catch(D){h.warn("ACTIVITY_REVIEW","Exception during wearable goal sync (non-blocking)",{activityId:x.id,error:D instanceof Error?D.message:"Unknown error",timestamp:new Date().toISOString()})}})).then(x=>{const D=x.filter(P=>P.status==="fulfilled").length;h.info("ACTIVITY_REVIEW","Wearable goals sync completed",{total:x.length,successful:D,failed:x.length-D,timestamp:new Date().toISOString()})})),h.info("ACTIVITY_REVIEW","Starting aggressive cache invalidation",{userId:v.user.id,timestamp:new Date().toISOString()}),await Promise.all([O.invalidateQueries({queryKey:["activities"],refetchType:"all"}),O.refetchQueries({queryKey:["activities","daily",v.user.id],type:"all"}),O.refetchQueries({queryKey:["activities","has-history",v.user.id],type:"all"}),O.refetchQueries({queryKey:["activities","recent",v.user.id],type:"all"})]),h.info("ACTIVITY_REVIEW","All activity caches invalidated and refetched",{userId:v.user.id,timestamp:new Date().toISOString()}),_(),C({type:"success",title:"Forge √ânerg√©tique Sauvegard√©e",message:`${t.length} activit√©${t.length>1?"s":""} enregistr√©e${t.length>1?"s":""} avec succ√®s`,duration:4e3}),setTimeout(()=>{r()},1e3)}catch(d){h.error("ACTIVITY_REVIEW","Failed to save activities",{error:d instanceof Error?d.message:"Unknown error",errorStack:d instanceof Error?d.stack:void 0,userId:v.user.id,activitiesCount:t.length,activitiesData:t.map(u=>({type:u.type,duration_min:u.duration_min,intensity:u.intensity,calories_est:u.calories_est})),timestamp:new Date().toISOString()}),N(),C({type:"error",title:"Erreur de Sauvegarde",message:d instanceof Error?`Erreur: ${d.message}. V√©rifiez votre connexion et r√©essayez.`:"Impossible de sauvegarder vos activit√©s. R√©essayez.",duration:4e3})}finally{p(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Se,{activities:t,totalCalories:L,totalDuration:W}),e.jsx(_e,{activities:t,updateActivity:I,removeActivity:F}),e.jsx(Te,{showAddForm:S,setShowAddForm:g,newActivity:f,setNewActivity:j,addNewActivity:V,profile:A}),e.jsx(ke,{forgeInsights:s?.forgeInsights}),e.jsx(Ae,{onCancel:i,handleSave:E,isSaving:y,isEditing:n})]})},Fe="_wrap_1mo7s_11",Pe="_card_1mo7s_18",ze="_grid_1mo7s_32",De="_icon_1mo7s_42",Be="_iconHalo_1mo7s_66",Ve="_iconGlyph_1mo7s_77",Me="_center_1mo7s_83",Re="_title_1mo7s_91",$e="_subtitle_1mo7s_102",qe="_rail_1mo7s_112",Oe="_seg_1mo7s_119",Ye="_segBlue_1mo7s_127",Ue="_segCyan_1mo7s_131",Le="_isCurrent_1mo7s_135",We="_isComplete_1mo7s_139",Je="_fill_1mo7s_143",Ge="_fillBlue_1mo7s_151",Xe="_fillCyan_1mo7s_157",Ze="_step_1mo7s_164",Qe="_percent_1mo7s_173",T={wrap:Fe,card:Pe,grid:ze,icon:De,iconHalo:Be,iconGlyph:Ve,center:Me,title:Re,subtitle:$e,rail:qe,seg:Oe,segBlue:Ye,segCyan:Ue,isCurrent:Le,isComplete:We,fill:Je,fillBlue:Ge,fillCyan:Xe,step:Ze,percent:Qe},Ke={capture:"Camera",analysis:"Scan",review:"Eye",complete:"Check"},He=({steps:s,currentStepId:r,progress:i,message:t,subMessage:a,className:n=""})=>{const l=Number.isFinite(i)?Math.min(100,Math.max(0,i)):0,y=100/s.length,p=Math.max(0,s.findIndex(_=>_.id===r)),S=p*y,g=Math.max(0,Math.min(1,(l-S)/y)),f=Ke[r]||"Activity",j={gridTemplateColumns:`repeat(${s.length}, 1fr)`};return e.jsx("div",{className:`${T.wrap} ${n}`,children:e.jsx(B,{className:T.card,children:e.jsxs("div",{className:T.grid,"data-energy-forge":!0,children:[e.jsxs("div",{className:T.icon,children:[e.jsx("div",{className:T.iconHalo}),e.jsx(c,{Icon:o[f],size:26,className:T.iconGlyph})]}),e.jsxs("div",{className:T.center,children:[e.jsx("h2",{className:T.title,children:t||"Forge √ânerg√©tique"}),a&&e.jsx("p",{className:T.subtitle,children:a}),e.jsx("div",{className:T.rail,style:j,role:"progressbar","aria-valuenow":Math.round(l),"aria-valuemin":0,"aria-valuemax":100,children:s.map((_,m)=>{const N=m<p,C=m===p,A=N?"100%":C?`${g*100}%`:"0%",v=m%2===0?T.segBlue:T.segCyan,O=m%2===0?T.fillBlue:T.fillCyan;return e.jsx("div",{className:`${T.seg} ${v} ${N?T.isComplete:""} ${C?T.isCurrent:""}`,children:(N||C)&&e.jsx(z.span,{className:`${T.fill} ${O}`,initial:{width:0},animate:{width:A},transition:{duration:.45,ease:"easeOut"}})},_.id)})}),e.jsxs("div",{className:T.step,children:["Forge ",p+1," / ",s.length]})]}),e.jsxs("div",{className:T.percent,"aria-hidden":"true",children:[Math.round(l),"%"]})]})})})},dt=()=>{G();const{state:s,actions:r}=ue(),{profile:i,session:t}=K(),{showToast:a}=X(),{error:n}=Y(),[l,y]=b.useState(!1),[p,S]=b.useState(0),[g,f]=b.useState(null),j=b.useRef(null),_=b.useRef(null),[m,N]=b.useState(null),[C,A]=b.useState(!1),v=b.useCallback(async()=>{try{const I=await navigator.mediaDevices.getUserMedia({audio:!0}),F=new MediaRecorder(I),V=[];F.ondataavailable=E=>{E.data.size>0&&V.push(E.data)},F.onstop=()=>{const E=new Blob(V,{type:"audio/webm;codecs=opus"});f(E),I.getTracks().forEach(d=>d.stop())},F.start(),j.current=F,y(!0),S(0),_.current=setInterval(()=>{S(E=>E+1)},1e3),h.info("ACTIVITY_INPUT","Audio recording started",{userId:t?.user?.id,timestamp:new Date().toISOString()})}catch(I){h.error("ACTIVITY_INPUT","Failed to start recording",{error:I instanceof Error?I.message:"Unknown error"}),n(),a({type:"error",title:"Erreur Microphone",message:"Impossible d'acc√©der au microphone. V√©rifiez les permissions.",duration:4e3})}},[t,n,a]),O=b.useCallback(()=>{j.current&&l&&(j.current.stop(),y(!1),_.current&&(clearInterval(_.current),_.current=null),h.info("ACTIVITY_INPUT","Audio recording stopped",{duration:p,userId:t?.user?.id,timestamp:new Date().toISOString()}))},[l,p,t]),L=b.useCallback(async()=>{if(!g){n(),a({type:"error",title:"Aucun Audio",message:"Veuillez d'abord enregistrer un audio",duration:3e3});return}if(g.size<1e3){n(),a({type:"error",title:"Audio Trop Court",message:"L'enregistrement est trop court. Veuillez parler au moins 2 secondes.",duration:4e3}),h.error("ACTIVITY_INPUT","Audio blob too small",{blobSize:g.size,timestamp:new Date().toISOString()});return}if(!t?.user?.id){n(),a({type:"error",title:"Authentification requise",message:"Vous devez √™tre connect√© pour continuer",duration:4e3});return}A(!0),r.setStep("analysis",25,"Transcription Audio","Conversion de votre voix en texte...");try{const I=new FileReader,V=await new Promise((P,q)=>{I.onloadend=()=>{const M=I.result;if(!M||M.length<100){q(new Error("Failed to read audio blob or blob is empty"));return}const J=M.split(",")[1];if(!J||J.length===0){q(new Error("Failed to extract base64 from audio blob"));return}P(J)},I.onerror=()=>q(new Error("FileReader error")),I.readAsDataURL(g)});r.setAudioData(V),h.info("ACTIVITY_INPUT","Audio blob converted to base64",{originalBlobSize:g.size,base64Length:V.length,userId:t.user.id,timestamp:new Date().toISOString()}),h.info("ACTIVITY_INPUT","Calling activity-transcriber",{userId:t.user.id,audioSize:g.size,base64Length:V.length,timestamp:new Date().toISOString()});const E="https://kwipydbtjagypocpvbwn.supabase.co",d="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3aXB5ZGJ0amFneXBvY3B2YnduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODg0MjIsImV4cCI6MjA3MDI2NDQyMn0.IS5IdKbmnGtgU_AaGYtUgX3ewaNpsiSAui5kbFV31_U",u={audioData:V,userId:t.user.id,clientTraceId:`activity_transcription_${Date.now()}`};h.info("ACTIVITY_INPUT","Transcription payload prepared",{hasAudioData:!!u.audioData,audioDataLength:u.audioData?.length||0,hasUserId:!!u.userId,userId:u.userId,clientTraceId:u.clientTraceId,timestamp:new Date().toISOString()});const k=await fetch(`${E}/functions/v1/activity-transcriber`,{method:"POST",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"},body:JSON.stringify(u)});if(!k.ok)throw new Error(`Transcription failed: ${k.statusText}`);const w=await k.json();r.setTranscriptionResult(w),h.info("ACTIVITY_INPUT","Transcription completed",{cleanText:w.cleanText,confidence:w.confidence,timestamp:new Date().toISOString()}),r.setStep("analysis",60,"Analyse √ânerg√©tique","Extraction et calcul des activit√©s...");const x=await fetch(`${E}/functions/v1/activity-analyzer`,{method:"POST",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"},body:JSON.stringify({cleanText:w.cleanText,userId:t.user.id,userProfile:{weight_kg:i?.weight_kg||70,height_cm:i?.height_cm,sex:i?.sex,age:i?.birthdate?new Date().getFullYear()-new Date(i.birthdate).getFullYear():void 0},clientTraceId:`activity_analysis_${Date.now()}`})});if(!x.ok){let P=`Analysis failed: ${x.statusText}`,q=!1;try{const M=await x.json();P=M.message||M.error||P,(P.includes("dns error")||P.includes("name resolution")||P.includes("Network error")||P.includes("Unable to reach OpenAI API"))&&(q=!0),h.error("ACTIVITY_INPUT","API Error Details (Audio Path)",{status:x.status,statusText:x.statusText,errorData:M,isNetworkError:q,timestamp:new Date().toISOString()})}catch{}throw q&&(n(),a({type:"error",title:"Erreur de Connexion",message:"Impossible de contacter le service d'analyse. V√©rifiez votre connexion internet ou r√©essayez plus tard.",duration:6e3})),new Error(P)}const D=await x.json();r.setAnalysisResult(D),h.info("ACTIVITY_INPUT","Analysis completed",{activitiesCount:D.activities.length,totalCalories:D.totalCalories,totalDuration:D.totalDuration,timestamp:new Date().toISOString()}),r.setStep("review",100,"Revue √ânerg√©tique","Validez vos activit√©s avant sauvegarde")}catch(I){h.error("ACTIVITY_INPUT","Processing failed",{error:I instanceof Error?I.message:"Unknown error",userId:t.user.id,timestamp:new Date().toISOString()}),r.handleError(I instanceof Error?I.message:"Erreur lors du traitement de l'audio","analysis")}finally{A(!1)}},[g,t,i,r,n,a]),W=b.useCallback(async I=>{if(!I||I.trim().length<10){n(),a({type:"error",title:"Texte trop court",message:"Veuillez saisir au moins 10 caract√®res",duration:3e3});return}if(!t?.user?.id){n(),a({type:"error",title:"Authentification requise",message:"Vous devez √™tre connect√© pour continuer",duration:4e3});return}A(!0),r.setStep("analysis",40,"Analyse √ânerg√©tique","Extraction et calcul des activit√©s...");try{h.info("ACTIVITY_INPUT","Processing text input",{textLength:I.length,userId:t.user.id,timestamp:new Date().toISOString()});const E=await fetch("https://kwipydbtjagypocpvbwn.supabase.co/functions/v1/activity-analyzer",{method:"POST",headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3aXB5ZGJ0amFneXBvY3B2YnduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODg0MjIsImV4cCI6MjA3MDI2NDQyMn0.IS5IdKbmnGtgU_AaGYtUgX3ewaNpsiSAui5kbFV31_U","Content-Type":"application/json"},body:JSON.stringify({cleanText:I,userId:t.user.id,userProfile:{weight_kg:i?.weight_kg||70,height_cm:i?.height_cm,sex:i?.sex,age:i?.birthdate?new Date().getFullYear()-new Date(i.birthdate).getFullYear():void 0},clientTraceId:`activity_analysis_text_${Date.now()}`})});if(!E.ok){let u=`Analysis failed: ${E.statusText}`,k=!1;try{const w=await E.json();u=w.message||w.error||u,(u.includes("dns error")||u.includes("name resolution")||u.includes("Network error")||u.includes("Unable to reach OpenAI API"))&&(k=!0),h.error("ACTIVITY_INPUT","API Error Details (Text Path)",{status:E.status,statusText:E.statusText,errorData:w,isNetworkError:k,timestamp:new Date().toISOString()})}catch{}throw k&&(n(),a({type:"error",title:"Erreur de Connexion",message:"Impossible de contacter le service d'analyse. V√©rifiez votre connexion internet ou r√©essayez plus tard.",duration:6e3})),new Error(u)}const d=await E.json();r.setAnalysisResult(d),h.info("ACTIVITY_INPUT","Text analysis completed",{activitiesCount:d.activities.length,totalCalories:d.totalCalories,totalDuration:d.totalDuration,timestamp:new Date().toISOString()}),r.setStep("review",100,"Revue √ânerg√©tique","Validez vos activit√©s avant sauvegarde")}catch(F){h.error("ACTIVITY_INPUT","Text processing failed",{error:F instanceof Error?F.message:"Unknown error",userId:t.user.id,timestamp:new Date().toISOString()}),r.handleError(F instanceof Error?F.message:"Erreur lors de l'analyse du texte","analysis")}finally{A(!1)}},[t,i,r,n,a]),Z=b.useCallback(I=>{N(I),f(null),S(0),h.info("ACTIVITY_INPUT","Input mode changed",{mode:I})},[]);return $.useEffect(()=>(r.startPipeline("capture"),()=>{_.current&&clearInterval(_.current),j.current&&l&&j.current.stop()}),[]),e.jsxs(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"},className:"max-w-4xl mx-auto mt-4 space-y-6",children:[e.jsx(He,{steps:s.steps,currentStepId:s.currentStep,progress:s.progress,message:s.message,subMessage:s.subMessage}),e.jsxs(ee,{mode:"wait",children:[s.currentStep==="capture"&&e.jsx(z.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:e.jsx(be,{isRecording:l,recordingDuration:p,audioBlob:g,onStartRecording:v,onStopRecording:O,onProcessAudio:L,onProcessText:W,isProcessing:C,selectedInputMode:m,onInputModeChange:Z})},"capture"),s.currentStep==="analysis"&&e.jsx(z.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:e.jsx(Ce,{isProcessing:C,progress:s.overallProgress,currentMessage:s.message,subMessage:s.subMessage})},"analysis"),s.currentStep==="review"&&e.jsx(z.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:e.jsx(Ee,{analysisResult:s.analysisResult,onComplete:r.completePipeline,onCancel:r.cancelPipeline})},"review")]})]})};export{dt as default};
